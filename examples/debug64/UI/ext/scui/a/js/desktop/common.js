/*! moment.js
 version : 2.5.1
 authors : Tim Wood, Iskren Chernev, Moment.js contributors
 license : MIT
 momentjs.com 
 
 * Modified by Rockstar 2015-03-30
 * Modified by Rockstar 2015-12-01
 */

//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors

//     Underscore may be freely distributed under the MIT license.

/*!     Backbone.js 1.1.2
     (c) 2010-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
     Backbone may be freely distributed under the MIT license.
*/

/** @license
 * XML to JSON (AMD module) based on
 * ### jQuery XML to JSON Plugin v1.3 - 2013-02-18 ###
 * http://www.fyneworks.com/ - diego@fyneworks.com
 * Licensed under http://en.wikipedia.org/wiki/MIT_License
 * ###
 * Website: http://www.fyneworks.com/jquery/xml-to-json/
*/

/**
* Copyright (c) 2010,2011,2012,2013,2014 Morgan Roderick http://roderick.dk
* @license: MIT - http://mrgnrdrck.mit-license.org
* 
* https://github.com/mroderick/PubSubJS
*/

/*! jQuery UI - v1.10.4 - 2014-05-08
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.autocomplete.js, jquery.ui.menu.js, jquery.ui.effect.js
* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */

/*!
     * jQuery Color Animations v2.1.2
     * https://github.com/jquery/jquery-color
     *
     * Copyright 2013 jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     *
     * Date: Wed Jan 16 08:47:09 2013 -0600
     */

/* Copyright (c) 2013 Brandon Aaron (http://brandon.aaron.sh)
 * Licensed under the MIT License (LICENSE.txt).
 * Version: 3.1.12
 */

/*! Mousewheel version: 3.1.12 * (c) 2014 Brandon Aaron * MIT License */

/*!
 * Copyright (c) 2010 C. F., Wong (<a href="http://cloudgen.w0ng.hk">Cloudgen Examplet Store</a>)
 * Licensed under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 * Highly modified from the original jquery.caret.1.02.js
*/

/*!
jQuery UI Virtual Keyboard
Version 1.18.12

Author: Jeremy Satterfield
Modified: Rob Garrison (Mottie on github)
Modified: R*
-----------------------------------------
Licensed under the MIT License

Caret code modified from jquery.caret.1.02.js
Licensed under the MIT License:
http://www.opensource.org/licenses/mit-license.php
-----------------------------------------
*/

/** @license
 * jQuery UI Virtual Keyboard Autocomplete v1.5 for Keyboard v1.18+ only (3/1/2014)
 *
 * By Rob Garrison (aka Mottie & Fudgey)
 * Modified: R* - Added AMD wrapper
 * Licensed under the MIT License
 */

/*!

 handlebars v1.3.0

Copyright (C) 2011 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/

/**
 * @license Handlebars hbs 0.8.0 - Alex Sexton, but Handlebars has it's own licensing junk
 *
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/require-cs for details on the plugin this was based off of
 */

/*! visualCaptcha - v0.0.5 - 2014-03-13
 * http://visualcaptcha.net
 * Copyright (c) 2014 emotionLoop; Licensed MIT */

/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
     * Copyright 2012, Digital Fusion
     * Licensed under the MIT license.
     * http://teamdf.com/jquery-plugins/license/
     *
     * @author Sam Sehnert
     * @desc A small plugin that checks whether elements are within
     *       the user visible viewport of a web browser (or within a specified container element if $el is provided).
     *       only accounts for vertical position, not horizontal.
     *
     * Updated by R*
     */

/*!
Copyright (c) 2011 Guillermo Rauch <guillermo@learnboost.com>
Licensed under the MIT license.
https://github.com/LearnBoost/antiscroll#license
*/

/** @license
 ### jQuery XML to JSON Plugin v1.3 - 2013-02-18 ###
 * http://www.fyneworks.com/ - diego@fyneworks.com
	* Licensed under http://en.wikipedia.org/wiki/MIT_License
 ###
 Website: http://www.fyneworks.com/jquery/xml-to-json/
*/

/*
Copyright (c) Jim Garvin (http://github.com/coderifous), 2008.
Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses.
Written by Jim Garvin (@coderifous) for use on LMGTFY.com.
http://github.com/coderifous/jquery-localize
Based off of Keith Wood's Localisation jQuery plugin.
http://keith-wood.name/localisation.html
 */

/*
 * jTweetsAnywhere V1.2.1
 * http://thomasbillenstein.com/jTweetsAnywhere/
 *
 * Copyright 2010, Thomas Billenstein
 * Licensed under the MIT license.
 * http://thomasbillenstein.com/jTweetsAnywhere/license.txt
 * 
 * Modified from original
 */

/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

/** @license
 * DropKick 1.4
 *
 * Highly customizable <select> lists
 * https://github.com/robdel12/DropKick
 *
 * Created by: Jamie Lottering <http://github.com/JamieLottering> <http://twitter.com/JamieLottering>
 */

/*
 * jQuery.bind-first library v0.2.3
 * Copyright (c) 2013 Vladimir Zhuravlev
 *
 * Released under MIT License
 * @license
 *
 * Date: Thu Feb  6 10:13:59 ICT 2014
 **/

/*! Native Promise Only
    v0.8.0-a (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/

!function(e,t){function n(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function i(e,t){return function(n){return d(e.call(this,n),t)}}function a(e,t){return function(n){return this.lang().ordinal(e.call(this,n),t)}}function r(){}function o(e){_(e),l(this,e)}function s(e){var t=v(e),n=t.year||0,i=t.month||0,a=t.week||0,r=t.day||0,o=t.hour||0,s=t.minute||0,l=t.second||0,c=t.millisecond||0;this._milliseconds=+c+1e3*l+6e4*s+36e5*o,this._days=+r+7*a,this._months=+i+12*n,this._data={},this._bubble()}function l(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return t.hasOwnProperty("toString")&&(e.toString=t.toString),t.hasOwnProperty("valueOf")&&(e.valueOf=t.valueOf),e}function c(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&bt.hasOwnProperty(t)&&(n[t]=e[t]);return n}function u(e){return 0>e?Math.ceil(e):Math.floor(e)}function d(e,t,n){for(var i=""+Math.abs(e),a=e>=0;i.length<t;)i="0"+i;return(a?n?"+":"":"-")+i}function f(e,t,n,i){var a,r,o=t._milliseconds,s=t._days,l=t._months;o&&e._d.setTime(+e._d+o*n),(s||l)&&(a=e.minute(),r=e.hour()),s&&e.date(e.date()+s*n),l&&e.month(e.month()+l*n),o&&!i&&at.updateOffset(e),(s||l)&&(e.minute(a),e.hour(r))}function h(e){return"[object Array]"===Object.prototype.toString.call(e)}function p(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}function m(e,t,n){var i,a=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),o=0;for(i=0;a>i;i++)(n&&e[i]!==t[i]||!n&&C(e[i])!==C(t[i]))&&o++;return o+r}function g(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=$t[e]||zt[t]||t}return e}function v(e){var t,n,i={};for(n in e)e.hasOwnProperty(n)&&(t=g(n),t&&(i[t]=e[n]));return i}function b(e){var n,i;if(0===e.indexOf("week"))n=7,i="day";else{if(0!==e.indexOf("month"))return;n=12,i="month"}at[e]=function(a,r){var o,s,l=at.fn._lang[e],c=[];if("number"==typeof a&&(r=a,a=t),s=function(e){var t=at().utc().set(i,e);return l.call(at.fn._lang,t,a||"")},null!=r)return s(r);for(o=0;n>o;o++)c.push(s(o));return c}}function C(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=t>=0?Math.floor(t):Math.ceil(t)),n}function S(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function y(e){return w(e)?366:365}function w(e){return e%4===0&&e%100!==0||e%400===0}function _(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[ut]<0||e._a[ut]>11?ut:e._a[dt]<1||e._a[dt]>S(e._a[ct],e._a[ut])?dt:e._a[ft]<0||e._a[ft]>23?ft:e._a[ht]<0||e._a[ht]>59?ht:e._a[pt]<0||e._a[pt]>59?pt:e._a[mt]<0||e._a[mt]>999?mt:-1,e._pf._overflowDayOfYear&&(ct>t||t>dt)&&(t=dt),e._pf.overflow=t)}function E(e){return null==e._isValid&&(e._isValid=!isNaN(e._d.getTime())&&e._pf.overflow<0&&!e._pf.empty&&!e._pf.invalidMonth&&!e._pf.nullInput&&!e._pf.invalidFormat&&!e._pf.userInvalidated,e._strict&&(e._isValid=e._isValid&&0===e._pf.charsLeftOver&&0===e._pf.unusedTokens.length)),e._isValid}function k(e){return e?e.toLowerCase().replace("_","-"):e}function T(e,t){return t._isUTC?at(e).zone(t._offset||0):at(e).local()}function I(e,t){return t.abbr=e,vt[e]||(vt[e]=new r),vt[e].set(t),vt[e]}function R(e){delete vt[e]}function A(e){var t,n,i,a,r=0,o=function(e){if(!vt[e]&&Ct)try{require("./lang/"+e)}catch(t){}return vt[e]};if(!e)return at.fn._lang;if(!h(e)){if(n=o(e))return n;e=[e]}for(;r<e.length;){for(a=k(e[r]).split("-"),t=a.length,i=k(e[r+1]),i=i?i.split("-"):null;t>0;){if(n=o(a.slice(0,t).join("-")))return n;if(i&&i.length>=t&&m(a,i,!0)>=t-1)break;t--}r++}return at.fn._lang}function L(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function P(e){var t,n,i=e.match(_t);for(t=0,n=i.length;n>t;t++)i[t]=Xt[i[t]]?Xt[i[t]]:L(i[t]);return function(a){var r="";for(t=0;n>t;t++)r+=i[t]instanceof Function?i[t].call(a,e):i[t];return r}}function D(e,t){return e.isValid()?(t=x(t,e.lang()),Yt[t]||(Yt[t]=P(t)),Yt[t](e)):e.lang().invalidDate()}function x(e,t){function n(e){return t.longDateFormat(e)||e}var i=5;for(Et.lastIndex=0;i>=0&&Et.test(e);)e=e.replace(Et,n),Et.lastIndex=0,i-=1;return e}function N(e,t){var n,i=t._strict;switch(e){case"DDDD":return Ot;case"YYYY":case"GGGG":case"gggg":return i?Ut:It;case"Y":case"G":case"g":return Gt;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return i?Ft:Rt;case"S":if(i)return Nt;case"SS":if(i)return Mt;case"SSS":if(i)return Ot;case"DDD":return Tt;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Lt;case"a":case"A":return A(t._l)._meridiemParse;case"X":return xt;case"Z":case"ZZ":return Pt;case"T":return Dt;case"SSSS":return At;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return i?Mt:kt;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return kt;default:return n=new RegExp(W(j(e.replace("\\","")),"i"))}}function M(e){e=e||"";var t=e.match(Pt)||[],n=t[t.length-1]||[],i=(n+"").match(Ht)||["-",0,0],a=+(60*i[1])+C(i[2]);return"+"===i[0]?-a:a}function O(e,t,n){var i,a=n._a;switch(e){case"M":case"MM":null!=t&&(a[ut]=C(t)-1);break;case"MMM":case"MMMM":i=A(n._l).monthsParse(t),null!=i?a[ut]=i:n._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(a[dt]=C(t));break;case"DDD":case"DDDD":null!=t&&(n._dayOfYear=C(t));break;case"YY":a[ct]=C(t)+(C(t)>68?1900:2e3);break;case"YYYY":case"YYYYY":case"YYYYYY":a[ct]=C(t);break;case"a":case"A":n._isPm=A(n._l).isPM(t);break;case"H":case"HH":case"h":case"hh":a[ft]=C(t);break;case"m":case"mm":a[ht]=C(t);break;case"s":case"ss":a[pt]=C(t);break;case"S":case"SS":case"SSS":case"SSSS":a[mt]=C(1e3*("0."+t));break;case"X":n._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=M(t);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":e=e.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(n._w=n._w||{},n._w[e]=t)}}function U(e){var t,n,i,a,r,o,s,l,c,u,d=[];if(!e._d){for(i=G(e),e._w&&null==e._a[dt]&&null==e._a[ut]&&(r=function(t){var n=parseInt(t,10);return t?t.length<3?n>68?1900+n:2e3+n:n:null==e._a[ct]?at().weekYear():e._a[ct]},o=e._w,null!=o.GG||null!=o.W||null!=o.E?s=X(r(o.GG),o.W||1,o.E,4,1):(l=A(e._l),c=null!=o.d?z(o.d,l):null!=o.e?parseInt(o.e,10)+l._week.dow:0,u=parseInt(o.w,10)||1,null!=o.d&&c<l._week.dow&&u++,s=X(r(o.gg),u,c,l._week.doy,l._week.dow)),e._a[ct]=s.year,e._dayOfYear=s.dayOfYear),e._dayOfYear&&(a=null==e._a[ct]?i[ct]:e._a[ct],e._dayOfYear>y(a)&&(e._pf._overflowDayOfYear=!0),n=$(a,0,e._dayOfYear),e._a[ut]=n.getUTCMonth(),e._a[dt]=n.getUTCDate()),t=0;3>t&&null==e._a[t];++t)e._a[t]=d[t]=i[t];for(;7>t;t++)e._a[t]=d[t]=null==e._a[t]?2===t?1:0:e._a[t];d[ft]+=C((e._tzm||0)/60),d[ht]+=C((e._tzm||0)%60),e._d=(e._useUTC?$:J).apply(null,d)}}function F(e){var t;e._d||(t=v(e._i),e._a=[t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond],U(e))}function G(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function V(e){e._a=[],e._pf.empty=!0;var t,n,i,a,r,o=A(e._l),s=""+e._i,l=s.length,c=0;for(i=x(e._f,o).match(_t)||[],t=0;t<i.length;t++)a=i[t],n=(s.match(N(a,e))||[])[0],n&&(r=s.substr(0,s.indexOf(n)),r.length>0&&e._pf.unusedInput.push(r),s=s.slice(s.indexOf(n)+n.length),c+=n.length),Xt[a]?(n?e._pf.empty=!1:e._pf.unusedTokens.push(a),O(a,n,e)):e._strict&&!n&&e._pf.unusedTokens.push(a);e._pf.charsLeftOver=l-c,s.length>0&&e._pf.unusedInput.push(s),e._isPm&&e._a[ft]<12&&(e._a[ft]+=12),e._isPm===!1&&12===e._a[ft]&&(e._a[ft]=0),U(e),_(e)}function j(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,i,a){return t||n||i||a})}function W(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function B(e){var t,i,a,r,o;if(0===e._f.length)return e._pf.invalidFormat=!0,void(e._d=new Date(0/0));for(r=0;r<e._f.length;r++)o=0,t=l({},e),t._pf=n(),t._f=e._f[r],V(t),E(t)&&(o+=t._pf.charsLeftOver,o+=10*t._pf.unusedTokens.length,t._pf.score=o,(null==a||a>o)&&(a=o,i=t));l(e,i||t)}function H(e){var t,n,i=e._i,a=Vt.exec(i);if(a){for(e._pf.iso=!0,t=0,n=Wt.length;n>t;t++)if(Wt[t][1].exec(i)){e._f=Wt[t][0]+(a[6]||" ");break}for(t=0,n=Bt.length;n>t;t++)if(Bt[t][1].exec(i)){e._f+=Bt[t][0];break}i.match(Pt)&&(e._f+="Z"),V(e)}else e._d=new Date(i)}function q(e){var n=e._i,i=St.exec(n);n===t?e._d=new Date:i?e._d=new Date(+i[1]):"string"==typeof n?H(e):h(n)?(e._a=n.slice(0),U(e)):p(n)?e._d=new Date(+n):"object"==typeof n?F(e):e._d=new Date(n)}function J(e,t,n,i,a,r,o){var s=new Date(e,t,n,i,a,r,o);return 1970>e&&s.setFullYear(e),s}function $(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function z(e,t){if("string"==typeof e)if(isNaN(e)){if(e=t.weekdaysParse(e),"number"!=typeof e)return null}else e=parseInt(e,10);return e}function Y(e,t,n,i,a){return a.relativeTime(t||1,!!n,e,i)}function K(e,t,n){var i=lt(Math.abs(e)/1e3),a=lt(i/60),r=lt(a/60),o=lt(r/24),s=lt(o/365),l=45>i&&["s",i]||1===a&&["m"]||45>a&&["mm",a]||1===r&&["h"]||22>r&&["hh",r]||1===o&&["d"]||25>=o&&["dd",o]||45>=o&&["M"]||345>o&&["MM",lt(o/30)]||1===s&&["y"]||["yy",s];return l[2]=t,l[3]=e>0,l[4]=n,Y.apply({},l)}function Q(e,t,n){var i,a=n-t,r=n-e.day();return r>a&&(r-=7),a-7>r&&(r+=7),i=at(e).add("d",r),{week:Math.ceil(i.dayOfYear()/7),year:i.year()}}function X(e,t,n,i,a){var r,o,s=$(e,0,1).getUTCDay();return n=null!=n?n:a,r=a-s+(s>i?7:0)-(a>s?7:0),o=7*(t-1)+(n-a)+r+1,{year:o>0?e:e-1,dayOfYear:o>0?o:y(e-1)+o}}function Z(e){var t=e._i,n=e._f;return null===t?at.invalid({nullInput:!0}):("string"==typeof t&&(e._i=t=A().preparse(t)),at.isMoment(t)?(e=c(t),e._d=new Date(+t._d)):n?h(n)?B(e):V(e):q(e),new o(e))}function et(e,t){at.fn[e]=at.fn[e+"s"]=function(e){var n=this._isUTC?"UTC":"";return null!=e?(this._d["set"+n+t](e),at.updateOffset(this),this):this._d["get"+n+t]()}}function tt(e){at.duration.fn[e]=function(){return this._data[e]}}function nt(e,t){at.duration.fn["as"+e]=function(){return+this/t}}function it(e){var t=!1,n=at;"undefined"==typeof ender&&(e?(st.moment=function(){return!t&&console&&console.warn&&(t=!0,console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),n.apply(null,arguments)},l(st.moment,n)):st.moment=at)}for(var at,rt,ot="2.5.1",st=e,lt=Math.round,ct=0,ut=1,dt=2,ft=3,ht=4,pt=5,mt=6,gt=!1,vt={},bt={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_isUTC:null,_offset:null,_pf:null,_lang:null},Ct="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require,St=/^\/?Date\((\-?\d+)/i,yt=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,wt=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,_t=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,Et=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,kt=/\d\d?/,Tt=/\d{1,3}/,It=/\d{1,4}/,Rt=/[+\-]?\d{1,6}/,At=/\d+/,Lt=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Pt=/Z|[\+\-]\d\d:?\d\d/gi,Dt=/T/i,xt=/[\+\-]?\d+(\.\d{1,3})?/,Nt=/\d/,Mt=/\d\d/,Ot=/\d{3}/,Ut=/\d{4}/,Ft=/[+-]?\d{6}/,Gt=/[+-]?\d+/,Vt=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,jt="YYYY-MM-DDTHH:mm:ssZ",Wt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],Bt=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Ht=/([\+\-]|\d\d)/gi,qt="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),Jt={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},$t={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},zt={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},Yt={},Kt="DDD w W M D d".split(" "),Qt="M D H h m s w W".split(" "),Xt={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return d(this.year()%100,2)},YYYY:function(){return d(this.year(),4)},YYYYY:function(){return d(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+d(Math.abs(e),6)},gg:function(){return d(this.weekYear()%100,2)},gggg:function(){return d(this.weekYear(),4)},ggggg:function(){return d(this.weekYear(),5)},GG:function(){return d(this.isoWeekYear()%100,2)},GGGG:function(){return d(this.isoWeekYear(),4)},GGGGG:function(){return d(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return C(this.milliseconds()/100)},SS:function(){return d(C(this.milliseconds()/10),2)},SSS:function(){return d(this.milliseconds(),3)},SSSS:function(){return d(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+d(C(e/60),2)+":"+d(C(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+d(C(e/60),2)+d(C(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},Zt=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];Kt.length;)rt=Kt.pop(),Xt[rt+"o"]=a(Xt[rt],rt);for(;Qt.length;)rt=Qt.pop(),Xt[rt+rt]=i(Xt[rt],2);for(Xt.DDDD=i(Xt.DDD,3),l(r.prototype,{set:function(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var t,n,i;for(this._monthsParse||(this._monthsParse=[]),t=0;12>t;t++)if(this._monthsParse[t]||(n=at.utc([2e3,t]),i="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[t]=new RegExp(i.replace(".",""),"i")),this._monthsParse[t].test(e))return t},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,n,i;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(n=at([2e3,1]).day(t),i="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[t]=new RegExp(i.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var n=this._calendar[e];return"function"==typeof n?n.apply(t):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,i){var a=this._relativeTime[n];return"function"==typeof a?a(e,t,n,i):a.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[gt&&e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return Q(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),at=function(e,i,a,r){var o;return"boolean"==typeof a&&(r=a,a=t),o={},o._isAMomentObject=!0,o._i=e,o._f=i,o._l=a,o._strict=r,o._isUTC=!1,o._pf=n(),Z(o)},at.utc=function(e,i,a,r){var o;return"boolean"==typeof a&&(r=a,a=t),o={},o._isAMomentObject=!0,o._useUTC=!0,o._isUTC=!0,o._l=a,o._i=e,o._f=i,o._strict=r,o._pf=n(),Z(o).utc()},at.unix=function(e){return at(1e3*e)},at.duration=function(e,t){var n,i,a,r=e,o=null;return at.isDuration(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(r={},t?r[t]=e:r.milliseconds=e):(o=yt.exec(e))?(n="-"===o[1]?-1:1,r={y:0,d:C(o[dt])*n,h:C(o[ft])*n,m:C(o[ht])*n,s:C(o[pt])*n,ms:C(o[mt])*n}):(o=wt.exec(e))&&(n="-"===o[1]?-1:1,a=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*n},r={y:a(o[2]),M:a(o[3]),d:a(o[4]),h:a(o[5]),m:a(o[6]),s:a(o[7]),w:a(o[8])}),i=new s(r),at.isDuration(e)&&e.hasOwnProperty("_lang")&&(i._lang=e._lang),i},at.version=ot,at.defaultFormat=jt,at.updateOffset=function(){},at.lang=function(e,t){var n;return e?(t?I(k(e),t):null===t?(R(e),e="en"):vt[e]||A(e),n=at.duration.fn._lang=at.fn._lang=A(e),n._abbr):at.fn._lang._abbr},at.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),A(e)},at.isMoment=function(e){return e instanceof o||null!=e&&e.hasOwnProperty("_isAMomentObject")},at.isDuration=function(e){return e instanceof s},rt=Zt.length-1;rt>=0;--rt)b(Zt[rt]);for(at.normalizeUnits=function(e){return g(e)},at.invalid=function(e){var t=at.utc(0/0);return null!=e?l(t._pf,e):t._pf.userInvalidated=!0,t},at.parseZone=function(e){return at(e).parseZone()},l(at.fn=o.prototype,{clone:function(){return at(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=at(this).utc();return 0<e.year()&&e.year()<=9999?D(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):D(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return E(this)},isDSTShifted:function(){return this._a?this.isValid()&&m(this._a,(this._isUTC?at.utc(this._a):at(this._a)).toArray())>0:!1},parsingFlags:function(){return l({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(e){var t=D(this,e||at.defaultFormat);return this.lang().postformat(t)},add:function(e,t){var n;return n="string"==typeof e?at.duration(+t,e):at.duration(e,t),f(this,n,1),this},subtract:function(e,t){var n;return n="string"==typeof e?at.duration(+t,e):at.duration(e,t),f(this,n,-1),this},diff:function(e,t,n){var i,a,r=T(e,this),o=6e4*(this.zone()-r.zone());return t=g(t),"year"===t||"month"===t?(i=432e5*(this.daysInMonth()+r.daysInMonth()),a=12*(this.year()-r.year())+(this.month()-r.month()),a+=(this-at(this).startOf("month")-(r-at(r).startOf("month")))/i,a-=6e4*(this.zone()-at(this).startOf("month").zone()-(r.zone()-at(r).startOf("month").zone()))/i,"year"===t&&(a/=12)):(i=this-r,a="second"===t?i/1e3:"minute"===t?i/6e4:"hour"===t?i/36e5:"day"===t?(i-o)/864e5:"week"===t?(i-o)/6048e5:i),n?a:u(a)},from:function(e,t){return at.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!t)},fromNow:function(e){return this.from(at(),e)},calendar:function(){var e=T(at(),this).startOf("day"),t=this.diff(e,"days",!0),n=-6>t?"sameElse":-1>t?"lastWeek":0>t?"lastDay":1>t?"sameDay":2>t?"nextDay":7>t?"nextWeek":"sameElse";return this.format(this.lang().calendar(n,this))},isLeapYear:function(){return w(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=z(e,this.lang()),this.add({d:e-t})):t},month:function(e){var t,n=this._isUTC?"UTC":"";return null!=e?"string"==typeof e&&(e=this.lang().monthsParse(e),"number"!=typeof e)?this:(t=this.date(),this.date(1),this._d["set"+n+"Month"](e),this.date(Math.min(t,this.daysInMonth())),at.updateOffset(this),this):this._d["get"+n+"Month"]()},startOf:function(e){switch(e=g(e)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),this},endOf:function(e){return e=g(e),this.startOf(e).add("isoWeek"===e?"week":e,1).subtract("ms",1)},isAfter:function(e,t){return t="undefined"!=typeof t?t:"millisecond",+this.clone().startOf(t)>+at(e).startOf(t)},isBefore:function(e,t){return t="undefined"!=typeof t?t:"millisecond",+this.clone().startOf(t)<+at(e).startOf(t)},isSame:function(e,t){return t=t||"ms",+this.clone().startOf(t)===+T(e,this).startOf(t)},min:function(e){return e=at.apply(null,arguments),this>e?this:e},max:function(e){return e=at.apply(null,arguments),e>this?this:e},zone:function(e){var t=this._offset||0;return null==e?this._isUTC?t:this._d.getTimezoneOffset():("string"==typeof e&&(e=M(e)),Math.abs(e)<16&&(e=60*e),this._offset=e,this._isUTC=!0,t!==e&&f(this,at.duration(t-e,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(e){return e=e?at(e).zone():0,(this.zone()-e)%60===0},daysInMonth:function(){return S(this.year(),this.month())},dayOfYear:function(e){var t=lt((at(this).startOf("day")-at(this).startOf("year"))/864e5)+1;return null==e?t:this.add("d",e-t)},quarter:function(){return Math.ceil((this.month()+1)/3)},weekYear:function(e){var t=Q(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==e?t:this.add("y",e-t)},isoWeekYear:function(e){var t=Q(this,1,4).year;return null==e?t:this.add("y",e-t)},week:function(e){var t=this.lang().week(this);return null==e?t:this.add("d",7*(e-t))},isoWeek:function(e){var t=Q(this,1,4).week;return null==e?t:this.add("d",7*(e-t))},weekday:function(e){var t=(this.day()+7-this.lang()._week.dow)%7;return null==e?t:this.add("d",e-t)},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},get:function(e){return e=g(e),this[e]()},set:function(e,t){return e=g(e),"function"==typeof this[e]&&this[e](t),this},lang:function(e){return e===t?this._lang:(this._lang=A(e),this)}}),rt=0;rt<qt.length;rt++)et(qt[rt].toLowerCase().replace(/s$/,""),qt[rt]);et("year","FullYear"),at.fn.days=at.fn.day,at.fn.months=at.fn.month,at.fn.weeks=at.fn.week,at.fn.isoWeeks=at.fn.isoWeek,at.fn.toJSON=at.fn.toISOString,l(at.duration.fn=s.prototype,{_bubble:function(){var e,t,n,i,a=this._milliseconds,r=this._days,o=this._months,s=this._data;s.milliseconds=a%1e3,e=u(a/1e3),s.seconds=e%60,t=u(e/60),s.minutes=t%60,n=u(t/60),s.hours=n%24,r+=u(n/24),s.days=r%30,o+=u(r/30),s.months=o%12,i=u(o/12),s.years=i},weeks:function(){return u(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*C(this._months/12)},humanize:function(e){var t=+this,n=K(t,!e,this.lang());return e&&(n=this.lang().pastFuture(t,n)),this.lang().postformat(n)},add:function(e,t){var n=at.duration(e,t);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(e,t){var n=at.duration(e,t);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(e){return e=g(e),this[e.toLowerCase()+"s"]()},as:function(e){return e=g(e),this["as"+e.charAt(0).toUpperCase()+e.slice(1)+"s"]()},lang:at.fn.lang,toIsoString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),n=Math.abs(this.days()),i=Math.abs(this.hours()),a=Math.abs(this.minutes()),r=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(n?n+"D":"")+(i||a||r?"T":"")+(i?i+"H":"")+(a?a+"M":"")+(r?r+"S":""):"P0D"}});for(rt in Jt)Jt.hasOwnProperty(rt)&&(nt(rt,Jt[rt]),tt(rt.toLowerCase()));nt("Weeks",6048e5),at.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},at.lang("en",{ordinal:function(e){var t=e%10,n=1===C(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),function(e){e(at)}(function(e){function t(e,t,n){var i={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?i[n][0]:i[n][1]}return e.lang("de",{months:"Januar_Februar_März_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),longDateFormat:{LT:"H:mm [Uhr]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Heute um] LT",sameElse:"L",nextDay:"[Morgen um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gestern um] LT",lastWeek:"[letzten] dddd [um] LT"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,M:t,MM:t,y:t,yy:t},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(at)}(function(e){return e.lang("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:"ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"Do_Lu_Ma_Mi_Ju_Vi_Sá".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[mañana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},ordinal:"%dº",week:{dow:1,doy:4}})}),function(e){e(at)}(function(e){return e.lang("fr",{months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui à] LT",nextDay:"[Demain à] LT",nextWeek:"dddd [à] LT",lastDay:"[Hier à] LT",lastWeek:"dddd [dernier à] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinal:function(e){return e+(1===e?"er":"")},week:{dow:1,doy:4}})}),function(e){e(at)}(function(e){return e.lang("it",{months:"Gennaio_Febbraio_Marzo_Aprile_Maggio_Giugno_Luglio_Agosto_Settembre_Ottobre_Novembre_Dicembre".split("_"),monthsShort:"Gen_Feb_Mar_Apr_Mag_Giu_Lug_Ago_Set_Ott_Nov_Dic".split("_"),weekdays:"Domenica_Lunedì_Martedì_Mercoledì_Giovedì_Venerdì_Sabato".split("_"),weekdaysShort:"Dom_Lun_Mar_Mer_Gio_Ven_Sab".split("_"),weekdaysMin:"D_L_Ma_Me_G_V_S".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:"[lo scorso] dddd [alle] LT",sameElse:"L"},relativeTime:{future:function(e){return(/^[0-9].+$/.test(e)?"tra":"in")+" "+e},past:"%s fa",s:"alcuni secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},ordinal:"%dº",week:{dow:1,doy:4}})}),function(e){e(at)}(function(e){return e.lang("ja",{months:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"日曜日_月曜日_火曜日_水曜日_木曜日_金曜日_土曜日".split("_"),weekdaysShort:"日_月_火_水_木_金_土".split("_"),weekdaysMin:"日_月_火_水_木_金_土".split("_"),longDateFormat:{LT:"Ah時m分",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日LT",LLLL:"YYYY年M月D日LT dddd"},meridiem:function(e){return 12>e?"午前":"午後"},calendar:{sameDay:"[今日] LT",nextDay:"[明日] LT",nextWeek:"[来週]dddd LT",lastDay:"[昨日] LT",lastWeek:"[前週]dddd LT",sameElse:"L"},relativeTime:{future:"%s後",past:"%s前",s:"数秒",m:"1分",mm:"%d分",h:"1時間",hh:"%d時間",d:"1日",dd:"%d日",M:"1ヶ月",MM:"%dヶ月",y:"1年",yy:"%d年"}})}),function(e){e(at)}(function(e){return e.lang("ko",{months:"1월_2월_3월_4월_5월_6월_7월_8월_9월_10월_11월_12월".split("_"),monthsShort:"1월_2월_3월_4월_5월_6월_7월_8월_9월_10월_11월_12월".split("_"),weekdays:"일요일_월요일_화요일_수요일_목요일_금요일_토요일".split("_"),weekdaysShort:"일_월_화_수_목_금_토".split("_"),weekdaysMin:"일_월_화_수_목_금_토".split("_"),longDateFormat:{LT:"A h시 mm분",L:"YYYY.MM.DD",LL:"YYYY년 MMMM D일",LLL:"YYYY년 MMMM D일 LT",LLLL:"YYYY년 MMMM D일 dddd LT"},meridiem:function(e){return 12>e?"오전":"오후"},calendar:{sameDay:"오늘 LT",nextDay:"내일 LT",nextWeek:"dddd LT",lastDay:"어제 LT",lastWeek:"지난주 dddd LT",sameElse:"L"},relativeTime:{future:"%s 후",past:"%s 전",s:"몇초",ss:"%d초",m:"일분",mm:"%d분",h:"한시간",hh:"%d시간",d:"하루",dd:"%d일",M:"한달",MM:"%d달",y:"일년",yy:"%d년"},ordinal:"%d일",meridiemParse:/(오전|오후)/,isPM:function(e){return"오후"===e}})}),function(e){e(at)}(function(e){function t(e){return 5>e%10&&e%10>1&&~~(e/10)%10!==1}function n(e,n,i){var a=e+" ";switch(i){case"m":return n?"minuta":"minutę";case"mm":return a+(t(e)?"minuty":"minut");case"h":return n?"godzina":"godzinę";case"hh":return a+(t(e)?"godziny":"godzin");case"MM":return a+(t(e)?"miesiące":"miesięcy");case"yy":return a+(t(e)?"lata":"lat")}}var i="styczeń_luty_marzec_kwiecień_maj_czerwiec_lipiec_sierpień_wrzesień_październik_listopad_grudzień".split("_"),a="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_września_października_listopada_grudnia".split("_");
return e.lang("pl",{months:function(e,t){return/D MMMM/.test(t)?a[e.month()]:i[e.month()]},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_paź_lis_gru".split("_"),weekdays:"niedziela_poniedziałek_wtorek_środa_czwartek_piątek_sobota".split("_"),weekdaysShort:"nie_pon_wt_śr_czw_pt_sb".split("_"),weekdaysMin:"N_Pn_Wt_Śr_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Dziś o] LT",nextDay:"[Jutro o] LT",nextWeek:"[W] dddd [o] LT",lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zeszłą niedzielę o] LT";case 3:return"[W zeszłą środę o] LT";case 6:return"[W zeszłą sobotę o] LT";default:return"[W zeszły] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",m:n,mm:n,h:n,hh:n,d:"1 dzień",dd:"%d dni",M:"miesiąc",MM:n,y:"rok",yy:n},ordinal:"%d.",week:{dow:1,doy:4}})}),function(e){e(at)}(function(e){return e.lang("pt-br",{months:"Janeiro_Fevereiro_Março_Abril_Maio_Junho_Julho_Agosto_Setembro_Outubro_Novembro_Dezembro".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingo_Segunda-feira_Terça-feira_Quarta-feira_Quinta-feira_Sexta-feira_Sábado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sáb".split("_"),weekdaysMin:"Dom_2ª_3ª_4ª_5ª_6ª_Sáb".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:"[Hoje às] LT",nextDay:"[Amanhã às] LT",nextWeek:"dddd [às] LT",lastDay:"[Ontem às] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[Último] dddd [às] LT":"[Última] dddd [às] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"%s atrás",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um mês",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinal:"%dº"})}),function(e){e(at)}(function(e){return e.lang("pt",{months:"Janeiro_Fevereiro_Março_Abril_Maio_Junho_Julho_Agosto_Setembro_Outubro_Novembro_Dezembro".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingo_Segunda-feira_Terça-feira_Quarta-feira_Quinta-feira_Sexta-feira_Sábado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sáb".split("_"),weekdaysMin:"Dom_2ª_3ª_4ª_5ª_6ª_Sáb".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:"[Hoje às] LT",nextDay:"[Amanhã às] LT",nextWeek:"dddd [às] LT",lastDay:"[Ontem às] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[Último] dddd [às] LT":"[Última] dddd [às] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"%s atrás",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um mês",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinal:"%dº",week:{dow:1,doy:4}})}),function(e){e(at)}(function(e){function t(e,t){var n=e.split("_");return t%10===1&&t%100!==11?n[0]:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?n[1]:n[2]}function n(e,n,i){var a={mm:"минута_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",MM:"месяц_месяца_месяцев",yy:"год_года_лет"};return"m"===i?n?"минута":"минуту":e+" "+t(a[i],+e)}function i(e,t){var n={nominative:"январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),accusative:"января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function a(e,t){var n={nominative:"янв_фев_мар_апр_май_июнь_июль_авг_сен_окт_ноя_дек".split("_"),accusative:"янв_фев_мар_апр_мая_июня_июля_авг_сен_окт_ноя_дек".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function r(e,t){var n={nominative:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),accusative:"воскресенье_понедельник_вторник_среду_четверг_пятницу_субботу".split("_")},i=/\[ ?[Вв] ?(?:прошлую|следующую)? ?\] ?dddd/.test(t)?"accusative":"nominative";return n[i][e.day()]}return e.lang("ru",{months:i,monthsShort:a,weekdays:r,weekdaysShort:"вс_пн_вт_ср_чт_пт_сб".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),monthsParse:[/^янв/i,/^фев/i,/^мар/i,/^апр/i,/^ма[й|я]/i,/^июн/i,/^июл/i,/^авг/i,/^сен/i,/^окт/i,/^ноя/i,/^дек/i],longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., LT",LLLL:"dddd, D MMMM YYYY г., LT"},calendar:{sameDay:"[Сегодня в] LT",nextDay:"[Завтра в] LT",lastDay:"[Вчера в] LT",nextWeek:function(){return 2===this.day()?"[Во] dddd [в] LT":"[В] dddd [в] LT"},lastWeek:function(){switch(this.day()){case 0:return"[В прошлое] dddd [в] LT";case 1:case 2:case 4:return"[В прошлый] dddd [в] LT";case 3:case 5:case 6:return"[В прошлую] dddd [в] LT"}},sameElse:"L"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",m:n,mm:n,h:"час",hh:n,d:"день",dd:n,M:"месяц",MM:n,y:"год",yy:n},meridiem:function(e){return 4>e?"ночи":12>e?"утра":17>e?"дня":"вечера"},ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":return e+"-й";case"D":return e+"-го";case"w":case"W":return e+"-я";default:return e}},week:{dow:1,doy:7}})}),function(e){e(at)}(function(e){return e.lang("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah点mm",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY-MM-DD",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"},meridiem:function(e,t){var n=100*e+t;return 600>n?"凌晨":900>n?"早上":1130>n?"上午":1230>n?"中午":1800>n?"下午":"晚上"},calendar:{sameDay:function(){return 0===this.minutes()?"[今天]Ah[点整]":"[今天]LT"},nextDay:function(){return 0===this.minutes()?"[明天]Ah[点整]":"[明天]LT"},lastDay:function(){return 0===this.minutes()?"[昨天]Ah[点整]":"[昨天]LT"},nextWeek:function(){var t,n;return t=e().startOf("week"),n=this.unix()-t.unix()>=604800?"[下]":"[本]",0===this.minutes()?n+"dddAh点整":n+"dddAh点mm"},lastWeek:function(){var t,n;return t=e().startOf("week"),n=this.unix()<t.unix()?"[上]":"[本]",0===this.minutes()?n+"dddAh点整":n+"dddAh点mm"},sameElse:"LL"},ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"周";default:return e}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1分钟",mm:"%d分钟",h:"1小时",hh:"%d小时",d:"1天",dd:"%d天",M:"1个月",MM:"%d个月",y:"1年",yy:"%d年"},week:{dow:1,doy:4}})}),function(e){e(at)}(function(e){return e.lang("zh-tw",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"週日_週一_週二_週三_週四_週五_週六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah點mm",L:"YYYY年MMMD日",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY年MMMD日",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"},meridiem:function(e,t){var n=100*e+t;return 900>n?"早上":1130>n?"上午":1230>n?"中午":1800>n?"下午":"晚上"},calendar:{sameDay:"[今天]LT",nextDay:"[明天]LT",nextWeek:"[下]ddddLT",lastDay:"[昨天]LT",lastWeek:"[上]ddddLT",sameElse:"L"},ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"週";default:return e}},relativeTime:{future:"%s內",past:"%s前",s:"幾秒",m:"一分鐘",mm:"%d分鐘",h:"一小時",hh:"%d小時",d:"一天",dd:"%d天",M:"一個月",MM:"%d個月",y:"一年",yy:"%d年"}})}),at.lang("en"),Ct?(module.exports=at,it(!0)):"function"==typeof define&&define.amd?define("moment",["require","exports","module"],function(e,n,i){return i.config&&i.config()&&i.config().noGlobal!==!0&&it(i.config().noGlobal===t),at}):it()}(window),function(){function e(e){function t(t,n,i,a,r,o){for(;r>=0&&o>r;r+=e){var s=a?a[r]:r;i=n(i,t[s],s,t)}return i}return function(n,i,a,r){i=C(i,r,4);var o=!T(n)&&b.keys(n),s=(o||n).length,l=e>0?0:s-1;return arguments.length<3&&(a=n[o?o[l]:l],l+=e),t(n,i,a,o,l,s)}}function t(e){return function(t,n,i){n=S(n,i);for(var a=k(t),r=e>0?0:a-1;r>=0&&a>r;r+=e)if(n(t[r],r,t))return r;return-1}}function n(e,t,n){return function(i,a,r){var o=0,s=k(i);if("number"==typeof r)e>0?o=r>=0?r:Math.max(r+s,o):s=r>=0?Math.min(r+1,s):r+s+1;else if(n&&r&&s)return r=n(i,a),i[r]===a?r:-1;if(a!==a)return r=t(u.call(i,o,s),b.isNaN),r>=0?r+o:-1;for(r=e>0?o:s-1;r>=0&&s>r;r+=e)if(i[r]===a)return r;return-1}}function i(e,t){var n=P.length,i=e.constructor,a=b.isFunction(i)&&i.prototype||s,r="constructor";for(b.has(e,r)&&!b.contains(t,r)&&t.push(r);n--;)r=P[n],r in e&&e[r]!==a[r]&&!b.contains(t,r)&&t.push(r)}var a=this,r=a._,o=Array.prototype,s=Object.prototype,l=Function.prototype,c=o.push,u=o.slice,d=s.toString,f=s.hasOwnProperty,h=Array.isArray,p=Object.keys,m=l.bind,g=Object.create,v=function(){},b=function(e){return e instanceof b?e:this instanceof b?void(this._wrapped=e):new b(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports._=b):a._=b,b.VERSION="1.8.3";var C=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,a){return e.call(t,n,i,a)};case 4:return function(n,i,a,r){return e.call(t,n,i,a,r)}}return function(){return e.apply(t,arguments)}},S=function(e,t,n){return null==e?b.identity:b.isFunction(e)?C(e,t,n):b.isObject(e)?b.matcher(e):b.property(e)};b.iteratee=function(e,t){return S(e,t,1/0)};var y=function(e,t){return function(n){var i=arguments.length;if(2>i||null==n)return n;for(var a=1;i>a;a++)for(var r=arguments[a],o=e(r),s=o.length,l=0;s>l;l++){var c=o[l];t&&void 0!==n[c]||(n[c]=r[c])}return n}},w=function(e){if(!b.isObject(e))return{};if(g)return g(e);v.prototype=e;var t=new v;return v.prototype=null,t},_=function(e){return function(t){return null==t?void 0:t[e]}},E=Math.pow(2,53)-1,k=_("length"),T=function(e){var t=k(e);return"number"==typeof t&&t>=0&&E>=t};b.each=b.forEach=function(e,t,n){t=C(t,n);var i,a;if(T(e))for(i=0,a=e.length;a>i;i++)t(e[i],i,e);else{var r=b.keys(e);for(i=0,a=r.length;a>i;i++)t(e[r[i]],r[i],e)}return e},b.map=b.collect=function(e,t,n){t=S(t,n);for(var i=!T(e)&&b.keys(e),a=(i||e).length,r=Array(a),o=0;a>o;o++){var s=i?i[o]:o;r[o]=t(e[s],s,e)}return r},b.reduce=b.foldl=b.inject=e(1),b.reduceRight=b.foldr=e(-1),b.find=b.detect=function(e,t,n){var i;return i=T(e)?b.findIndex(e,t,n):b.findKey(e,t,n),void 0!==i&&-1!==i?e[i]:void 0},b.filter=b.select=function(e,t,n){var i=[];return t=S(t,n),b.each(e,function(e,n,a){t(e,n,a)&&i.push(e)}),i},b.reject=function(e,t,n){return b.filter(e,b.negate(S(t)),n)},b.every=b.all=function(e,t,n){t=S(t,n);for(var i=!T(e)&&b.keys(e),a=(i||e).length,r=0;a>r;r++){var o=i?i[r]:r;if(!t(e[o],o,e))return!1}return!0},b.some=b.any=function(e,t,n){t=S(t,n);for(var i=!T(e)&&b.keys(e),a=(i||e).length,r=0;a>r;r++){var o=i?i[r]:r;if(t(e[o],o,e))return!0}return!1},b.contains=b.includes=b.include=function(e,t,n,i){return T(e)||(e=b.values(e)),("number"!=typeof n||i)&&(n=0),b.indexOf(e,t,n)>=0},b.invoke=function(e,t){var n=u.call(arguments,2),i=b.isFunction(t);return b.map(e,function(e){var a=i?t:e[t];return null==a?a:a.apply(e,n)})},b.pluck=function(e,t){return b.map(e,b.property(t))},b.where=function(e,t){return b.filter(e,b.matcher(t))},b.findWhere=function(e,t){return b.find(e,b.matcher(t))},b.max=function(e,t,n){var i,a,r=-1/0,o=-1/0;if(null==t&&null!=e){e=T(e)?e:b.values(e);for(var s=0,l=e.length;l>s;s++)i=e[s],i>r&&(r=i)}else t=S(t,n),b.each(e,function(e,n,i){a=t(e,n,i),(a>o||a===-1/0&&r===-1/0)&&(r=e,o=a)});return r},b.min=function(e,t,n){var i,a,r=1/0,o=1/0;if(null==t&&null!=e){e=T(e)?e:b.values(e);for(var s=0,l=e.length;l>s;s++)i=e[s],r>i&&(r=i)}else t=S(t,n),b.each(e,function(e,n,i){a=t(e,n,i),(o>a||1/0===a&&1/0===r)&&(r=e,o=a)});return r},b.shuffle=function(e){for(var t,n=T(e)?e:b.values(e),i=n.length,a=Array(i),r=0;i>r;r++)t=b.random(0,r),t!==r&&(a[r]=a[t]),a[t]=n[r];return a},b.sample=function(e,t,n){return null==t||n?(T(e)||(e=b.values(e)),e[b.random(e.length-1)]):b.shuffle(e).slice(0,Math.max(0,t))},b.sortBy=function(e,t,n){return t=S(t,n),b.pluck(b.map(e,function(e,n,i){return{value:e,index:n,criteria:t(e,n,i)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return e.index-t.index}),"value")};var I=function(e){return function(t,n,i){var a={};return n=S(n,i),b.each(t,function(i,r){var o=n(i,r,t);e(a,i,o)}),a}};b.groupBy=I(function(e,t,n){b.has(e,n)?e[n].push(t):e[n]=[t]}),b.indexBy=I(function(e,t,n){e[n]=t}),b.countBy=I(function(e,t,n){b.has(e,n)?e[n]++:e[n]=1}),b.toArray=function(e){return e?b.isArray(e)?u.call(e):T(e)?b.map(e,b.identity):b.values(e):[]},b.size=function(e){return null==e?0:T(e)?e.length:b.keys(e).length},b.partition=function(e,t,n){t=S(t,n);var i=[],a=[];return b.each(e,function(e,n,r){(t(e,n,r)?i:a).push(e)}),[i,a]},b.first=b.head=b.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:b.initial(e,e.length-t)},b.initial=function(e,t,n){return u.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},b.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:b.rest(e,Math.max(0,e.length-t))},b.rest=b.tail=b.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},b.compact=function(e){return b.filter(e,b.identity)};var R=function(e,t,n,i){for(var a=[],r=0,o=i||0,s=k(e);s>o;o++){var l=e[o];if(T(l)&&(b.isArray(l)||b.isArguments(l))){t||(l=R(l,t,n));var c=0,u=l.length;for(a.length+=u;u>c;)a[r++]=l[c++]}else n||(a[r++]=l)}return a};b.flatten=function(e,t){return R(e,t,!1)},b.without=function(e){return b.difference(e,u.call(arguments,1))},b.uniq=b.unique=function(e,t,n,i){b.isBoolean(t)||(i=n,n=t,t=!1),null!=n&&(n=S(n,i));for(var a=[],r=[],o=0,s=k(e);s>o;o++){var l=e[o],c=n?n(l,o,e):l;t?(o&&r===c||a.push(l),r=c):n?b.contains(r,c)||(r.push(c),a.push(l)):b.contains(a,l)||a.push(l)}return a},b.union=function(){return b.uniq(R(arguments,!0,!0))},b.intersection=function(e){for(var t=[],n=arguments.length,i=0,a=k(e);a>i;i++){var r=e[i];if(!b.contains(t,r)){for(var o=1;n>o&&b.contains(arguments[o],r);o++);o===n&&t.push(r)}}return t},b.difference=function(e){var t=R(arguments,!0,!0,1);return b.filter(e,function(e){return!b.contains(t,e)})},b.zip=function(){return b.unzip(arguments)},b.unzip=function(e){for(var t=e&&b.max(e,k).length||0,n=Array(t),i=0;t>i;i++)n[i]=b.pluck(e,i);return n},b.object=function(e,t){for(var n={},i=0,a=k(e);a>i;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},b.findIndex=t(1),b.findLastIndex=t(-1),b.sortedIndex=function(e,t,n,i){n=S(n,i,1);for(var a=n(t),r=0,o=k(e);o>r;){var s=Math.floor((r+o)/2);n(e[s])<a?r=s+1:o=s}return r},b.indexOf=n(1,b.findIndex,b.sortedIndex),b.lastIndexOf=n(-1,b.findLastIndex),b.range=function(e,t,n){null==t&&(t=e||0,e=0),n=n||1;for(var i=Math.max(Math.ceil((t-e)/n),0),a=Array(i),r=0;i>r;r++,e+=n)a[r]=e;return a};var A=function(e,t,n,i,a){if(!(i instanceof t))return e.apply(n,a);var r=w(e.prototype),o=e.apply(r,a);return b.isObject(o)?o:r};b.bind=function(e,t){if(m&&e.bind===m)return m.apply(e,u.call(arguments,1));if(!b.isFunction(e))throw new TypeError("Bind must be called on a function");var n=u.call(arguments,2),i=function(){return A(e,i,t,this,n.concat(u.call(arguments)))};return i},b.partial=function(e){var t=u.call(arguments,1),n=function(){for(var i=0,a=t.length,r=Array(a),o=0;a>o;o++)r[o]=t[o]===b?arguments[i++]:t[o];for(;i<arguments.length;)r.push(arguments[i++]);return A(e,n,this,this,r)};return n},b.bindAll=function(e){var t,n,i=arguments.length;if(1>=i)throw new Error("bindAll must be passed function names");for(t=1;i>t;t++)n=arguments[t],e[n]=b.bind(e[n],e);return e},b.memoize=function(e,t){var n=function(i){var a=n.cache,r=""+(t?t.apply(this,arguments):i);return b.has(a,r)||(a[r]=e.apply(this,arguments)),a[r]};return n.cache={},n},b.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},b.defer=b.partial(b.delay,b,1),b.throttle=function(e,t,n){var i,a,r,o=null,s=0;n||(n={});var l=function(){s=n.leading===!1?0:b.now(),o=null,r=e.apply(i,a),o||(i=a=null)};return function(){var c=b.now();s||n.leading!==!1||(s=c);var u=t-(c-s);return i=this,a=arguments,0>=u||u>t?(o&&(clearTimeout(o),o=null),s=c,r=e.apply(i,a),o||(i=a=null)):o||n.trailing===!1||(o=setTimeout(l,u)),r}},b.debounce=function(e,t,n){var i,a,r,o,s,l=function(){var c=b.now()-o;t>c&&c>=0?i=setTimeout(l,t-c):(i=null,n||(s=e.apply(r,a),i||(r=a=null)))};return function(){r=this,a=arguments,o=b.now();var c=n&&!i;return i||(i=setTimeout(l,t)),c&&(s=e.apply(r,a),r=a=null),s}},b.wrap=function(e,t){return b.partial(t,e)},b.negate=function(e){return function(){return!e.apply(this,arguments)}},b.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,i=e[t].apply(this,arguments);n--;)i=e[n].call(this,i);return i}},b.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},b.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),1>=e&&(t=null),n}},b.once=b.partial(b.before,2);var L=!{toString:null}.propertyIsEnumerable("toString"),P=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];b.keys=function(e){if(!b.isObject(e))return[];if(p)return p(e);var t=[];for(var n in e)b.has(e,n)&&t.push(n);return L&&i(e,t),t},b.allKeys=function(e){if(!b.isObject(e))return[];var t=[];for(var n in e)t.push(n);return L&&i(e,t),t},b.values=function(e){for(var t=b.keys(e),n=t.length,i=Array(n),a=0;n>a;a++)i[a]=e[t[a]];return i},b.mapObject=function(e,t,n){t=S(t,n);for(var i,a=b.keys(e),r=a.length,o={},s=0;r>s;s++)i=a[s],o[i]=t(e[i],i,e);return o},b.pairs=function(e){for(var t=b.keys(e),n=t.length,i=Array(n),a=0;n>a;a++)i[a]=[t[a],e[t[a]]];return i},b.invert=function(e){for(var t={},n=b.keys(e),i=0,a=n.length;a>i;i++)t[e[n[i]]]=n[i];return t},b.functions=b.methods=function(e){var t=[];for(var n in e)b.isFunction(e[n])&&t.push(n);return t.sort()},b.extend=y(b.allKeys),b.extendOwn=b.assign=y(b.keys),b.findKey=function(e,t,n){t=S(t,n);for(var i,a=b.keys(e),r=0,o=a.length;o>r;r++)if(i=a[r],t(e[i],i,e))return i},b.pick=function(e,t,n){var i,a,r={},o=e;if(null==o)return r;b.isFunction(t)?(a=b.allKeys(o),i=C(t,n)):(a=R(arguments,!1,!1,1),i=function(e,t,n){return t in n},o=Object(o));for(var s=0,l=a.length;l>s;s++){var c=a[s],u=o[c];i(u,c,o)&&(r[c]=u)}return r},b.omit=function(e,t,n){if(b.isFunction(t))t=b.negate(t);else{var i=b.map(R(arguments,!1,!1,1),String);t=function(e,t){return!b.contains(i,t)}}return b.pick(e,t,n)},b.defaults=y(b.allKeys,!0),b.create=function(e,t){var n=w(e);return t&&b.extendOwn(n,t),n},b.clone=function(e){return b.isObject(e)?b.isArray(e)?e.slice():b.extend({},e):e},b.tap=function(e,t){return t(e),e},b.isMatch=function(e,t){var n=b.keys(t),i=n.length;if(null==e)return!i;for(var a=Object(e),r=0;i>r;r++){var o=n[r];if(t[o]!==a[o]||!(o in a))return!1}return!0};var D=function(e,t,n,i){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof b&&(e=e._wrapped),t instanceof b&&(t=t._wrapped);var a=d.call(e);if(a!==d.call(t))return!1;switch(a){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var r="[object Array]"===a;if(!r){if("object"!=typeof e||"object"!=typeof t)return!1;var o=e.constructor,s=t.constructor;if(o!==s&&!(b.isFunction(o)&&o instanceof o&&b.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],i=i||[];for(var l=n.length;l--;)if(n[l]===e)return i[l]===t;if(n.push(e),i.push(t),r){if(l=e.length,l!==t.length)return!1;for(;l--;)if(!D(e[l],t[l],n,i))return!1}else{var c,u=b.keys(e);if(l=u.length,b.keys(t).length!==l)return!1;for(;l--;)if(c=u[l],!b.has(t,c)||!D(e[c],t[c],n,i))return!1}return n.pop(),i.pop(),!0};b.isEqual=function(e,t){return D(e,t)},b.isEmpty=function(e){return null==e?!0:T(e)&&(b.isArray(e)||b.isString(e)||b.isArguments(e))?0===e.length:0===b.keys(e).length},b.isElement=function(e){return!(!e||1!==e.nodeType)},b.isArray=h||function(e){return"[object Array]"===d.call(e)},b.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},b.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){b["is"+e]=function(t){return d.call(t)==="[object "+e+"]"}}),b.isArguments(arguments)||(b.isArguments=function(e){return b.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(b.isFunction=function(e){return"function"==typeof e||!1}),b.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},b.isNaN=function(e){return b.isNumber(e)&&e!==+e},b.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===d.call(e)},b.isNull=function(e){return null===e},b.isUndefined=function(e){return void 0===e},b.has=function(e,t){return null!=e&&f.call(e,t)},b.noConflict=function(){return a._=r,this},b.identity=function(e){return e},b.constant=function(e){return function(){return e}},b.noop=function(){},b.property=_,b.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},b.matcher=b.matches=function(e){return e=b.extendOwn({},e),function(t){return b.isMatch(t,e)}},b.times=function(e,t,n){var i=Array(Math.max(0,e));t=C(t,n,1);for(var a=0;e>a;a++)i[a]=t(a);return i},b.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},b.now=Date.now||function(){return(new Date).getTime()};var x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=b.invert(x),M=function(e){var t=function(t){return e[t]},n="(?:"+b.keys(e).join("|")+")",i=RegExp(n),a=RegExp(n,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(a,t):e}};b.escape=M(x),b.unescape=M(N),b.result=function(e,t,n){var i=null==e?void 0:e[t];return void 0===i&&(i=n),b.isFunction(i)?i.call(e):i};var O=0;b.uniqueId=function(e){var t=++O+"";return e?e+t:t},b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var U=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},G=/\\|'|\r|\n|\u2028|\u2029/g,V=function(e){return"\\"+F[e]};b.template=function(e,t,n){!t&&n&&(t=n),t=b.defaults({},t,b.templateSettings);var i=RegExp([(t.escape||U).source,(t.interpolate||U).source,(t.evaluate||U).source].join("|")+"|$","g"),a=0,r="__p+='";e.replace(i,function(t,n,i,o,s){return r+=e.slice(a,s).replace(G,V),a=s+t.length,n?r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?r+="'+\n((__t=("+i+"))==null?'':__t)+\n'":o&&(r+="';\n"+o+"\n__p+='"),t}),r+="';\n",t.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{var o=new Function(t.variable||"obj","_",r)}catch(s){throw s.source=r,s}var l=function(e){return o.call(this,e,b)},c=t.variable||"obj";return l.source="function("+c+"){\n"+r+"}",l},b.chain=function(e){var t=b(e);return t._chain=!0,t};var j=function(e,t){return e._chain?b(t).chain():t};b.mixin=function(e){b.each(b.functions(e),function(t){var n=b[t]=e[t];b.prototype[t]=function(){var e=[this._wrapped];return c.apply(e,arguments),j(this,n.apply(b,e))}})},b.mixin(b),b.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=o[e];b.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],j(this,n)}}),b.each(["concat","join","slice"],function(e){var t=o[e];b.prototype[e]=function(){return j(this,t.apply(this._wrapped,arguments))}}),b.prototype.value=function(){return this._wrapped},b.prototype.valueOf=b.prototype.toJSON=b.prototype.value,b.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return b})}.call(this),define("common/xhr",["require","jquery"],function(e){var t=e("jquery");return{ajax:t.ajax}}),function(e,t){if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(n,i,a){e.Backbone=t(e,a,n,i)});else if("undefined"!=typeof exports){var n=require("underscore");t(e,exports,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,i){{var a=e.Backbone,r=[],o=(r.push,r.slice);r.splice}t.VERSION="1.1.2",t.$=i,t.noConflict=function(){return e.Backbone=a,this},t.emulateHTTP=!1,t.emulateJSON=!1;var s=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var i=this._events[e]||(this._events[e]=[]);return i.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,i){if(!c(this,"once",e,[t,i])||!t)return this;var a=this,r=n.once(function(){a.off(e,r),t.apply(this,arguments)});return r._callback=t,this.on(e,r,i)},off:function(e,t,i){var a,r,o,s,l,u,d,f;if(!this._events||!c(this,"off",e,[t,i]))return this;if(!e&&!t&&!i)return this._events=void 0,this;for(s=e?[e]:n.keys(this._events),l=0,u=s.length;u>l;l++)if(e=s[l],o=this._events[e]){if(this._events[e]=a=[],t||i)for(d=0,f=o.length;f>d;d++)r=o[d],(t&&t!==r.callback&&t!==r.callback._callback||i&&i!==r.context)&&a.push(r);a.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=o.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],i=this._events.all;return n&&u(n,t),i&&u(i,arguments),this},stopListening:function(e,t,i){var a=this._listeningTo;if(!a)return this;var r=!t&&!i;i||"object"!=typeof t||(i=this),e&&((a={})[e._listenId]=e);for(var o in a)e=a[o],e.off(t,i,this),(r||n.isEmpty(e._events))&&delete this._listeningTo[o];return this}},l=/\s+/,c=function(e,t,n,i){if(!n)return!0;if("object"==typeof n){for(var a in n)e[t].apply(e,[a,n[a]].concat(i));return!1}if(l.test(n)){for(var r=n.split(l),o=0,s=r.length;s>o;o++)e[t].apply(e,[r[o]].concat(i));return!1}return!0},u=function(e,t){var n,i=-1,a=e.length,r=t[0],o=t[1],s=t[2];switch(t.length){case 0:for(;++i<a;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;++i<a;)(n=e[i]).callback.call(n.ctx,r);return;case 2:for(;++i<a;)(n=e[i]).callback.call(n.ctx,r,o);return;case 3:for(;++i<a;)(n=e[i]).callback.call(n.ctx,r,o,s);return;default:for(;++i<a;)(n=e[i]).callback.apply(n.ctx,t);return}},d={listenTo:"on",listenToOnce:"once"};n.each(d,function(e,t){s[t]=function(t,i,a){var r=this._listeningTo||(this._listeningTo={}),o=t._listenId||(t._listenId=n.uniqueId("l"));return r[o]=t,a||"object"!=typeof i||(a=this),t[e](i,a,this),this}}),s.bind=s.on,s.unbind=s.off,n.extend(t,s);var f=t.Model=function(e,t){var i=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(i=this.parse(i,t)||{}),i=n.defaults({},i,n.result(this,"defaults")),this.set(i,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(f.prototype,s,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,i){var a,r,o,s,l,c,u,d;if(null==e)return this;if("object"==typeof e?(r=e,i=t):(r={})[e]=t,i||(i={}),!this._validate(r,i))return!1;o=i.unset,l=i.silent,s=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=n.clone(this.attributes),this.changed={}),d=this.attributes,u=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]);for(a in r)t=r[a],n.isEqual(d[a],t)||s.push(a),n.isEqual(u[a],t)?delete this.changed[a]:this.changed[a]=t,o?delete d[a]:d[a]=t;if(!l){s.length&&(this._pending=i);for(var f=0,h=s.length;h>f;f++)this.trigger("change:"+s[f],this,d[s[f]],i)}if(c)return this;if(!l)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,i=!1,a=this._changing?this._previousAttributes:this.attributes;for(var r in e)n.isEqual(a[r],t=e[r])||((i||(i={}))[r]=t);return i},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,i=e.success;return e.success=function(n){return t.set(t.parse(n,e),e)?(i&&i(t,n,e),void t.trigger("sync",t,n,e)):!1},U(this,e),this.sync("read",this,e)},save:function(e,t,i){var a,r,o,s=this.attributes;if(null==e||"object"==typeof e?(a=e,i=t):(a={})[e]=t,i=n.extend({validate:!0},i),a&&!i.wait){if(!this.set(a,i))return!1}else if(!this._validate(a,i))return!1;a&&i.wait&&(this.attributes=n.extend({},s,a)),void 0===i.parse&&(i.parse=!0);var l=this,c=i.success;return i.success=function(e){l.attributes=s;var t=l.parse(e,i);return i.wait&&(t=n.extend(a||{},t)),n.isObject(t)&&!l.set(t,i)?!1:(c&&c(l,e,i),void l.trigger("sync",l,e,i))},U(this,i),r=this.isNew()?"create":i.patch?"patch":"update","patch"===r&&(i.attrs=a),o=this.sync(r,this,i),a&&i.wait&&(this.attributes=s),o},destroy:function(e){e=e?n.clone(e):{};var t=this,i=e.success,a=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(n){(e.wait||t.isNew())&&a(),i&&i(t,n,e),t.isNew()||t.trigger("sync",t,n,e)},this.isNew())return e.success(),!1;U(this,e);var r=this.sync("delete",this,e);return e.wait||a(),r},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||O();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return i?(this.trigger("invalid",this,i,n.extend(t,{validationError:i})),!1):!0}});var h=["keys","values","pairs","invert","pick","omit"];n.each(h,function(e){f.prototype[e]=function(){var t=o.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var p=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},m={add:!0,remove:!0,merge:!0},g={add:!0,remove:!1};n.extend(p.prototype,s,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,g))},remove:function(e,t){var i=!n.isArray(e);e=i?[e]:n.clone(e),t||(t={});var a,r,o,s;for(a=0,r=e.length;r>a;a++)s=e[a]=this.get(e[a]),s&&(delete this._byId[s.id],delete this._byId[s.cid],o=this.indexOf(s),this.models.splice(o,1),this.length--,t.silent||(t.index=o,s.trigger("remove",s,this,t)),this._removeReference(s,t));return i?e[0]:e},set:function(e,t){t=n.defaults({},t,m),t.parse&&(e=this.parse(e,t));var i=!n.isArray(e);e=i?e?[e]:[]:n.clone(e);var a,r,o,s,l,c,u,d=t.at,h=this.model,p=this.comparator&&null==d&&t.sort!==!1,g=n.isString(this.comparator)?this.comparator:null,v=[],b=[],C={},S=t.add,y=t.merge,w=t.remove,_=!p&&S&&w?[]:!1;for(a=0,r=e.length;r>a;a++){if(l=e[a]||{},o=l instanceof f?s=l:l[h.prototype.idAttribute||"id"],c=this.get(o))w&&(C[c.cid]=!0),y&&(l=l===s?s.attributes:l,t.parse&&(l=c.parse(l,t)),c.set(l,t),p&&!u&&c.hasChanged(g)&&(u=!0)),e[a]=c;
else if(S){if(s=e[a]=this._prepareModel(l,t),!s)continue;v.push(s),this._addReference(s,t)}s=c||s,!_||!s.isNew()&&C[s.id]||_.push(s),C[s.id]=!0}if(w){for(a=0,r=this.length;r>a;++a)C[(s=this.models[a]).cid]||b.push(s);b.length&&this.remove(b,t)}if(v.length||_&&_.length)if(p&&(u=!0),this.length+=v.length,null!=d)for(a=0,r=v.length;r>a;a++)this.models.splice(d+a,0,v[a]);else{_&&(this.models.length=0);var E=_||v;for(a=0,r=E.length;r>a;a++)this.models.push(E[a])}if(u&&this.sort({silent:!0}),!t.silent){for(a=0,r=v.length;r>a;a++)(s=v[a]).trigger("add",s,this,t);(u||_&&_.length)&&this.trigger("sort",this,t)}return i?e[0]:e},reset:function(e,t){t||(t={});for(var i=0,a=this.models.length;a>i;i++)this._removeReference(this.models[i],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return o.apply(this.models,arguments)},get:function(e){return null==e?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,i=this;return e.success=function(n){var a=e.reset?"reset":"set";i[a](n,e),t&&t(i,n,e),i.trigger("sync",i,n,e)},U(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?n.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var i=this,a=t.success;return t.success=function(e,n){t.wait&&i.add(e,t),a&&a(e,n,t)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof f)return e;t=t?n.clone(t):{},t.collection=this;var i=new this.model(e,t);return i.validationError?(this.trigger("invalid",this,i.validationError,t),!1):i},_addReference:function(e){this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,i),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var v=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(v,function(e){p.prototype[e]=function(){var t=o.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var b=["groupBy","countBy","sortBy","indexBy"];n.each(b,function(e){p.prototype[e]=function(t,i){var a=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,a,i)}});var C=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,y)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,y=["model","collection","el","id","attributes","className","tagName","events"];n.extend(C.prototype,s,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var i=e[t];if(n.isFunction(i)||(i=this[e[t]]),i){var a=t.match(S),r=a[1],o=a[2];i=n.bind(i,this),r+=".delegateEvents"+this.cid,""===o?this.$el.on(r,i):this.$el.on(r,o,i)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"),!1);else{var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var i=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(i,!1)}}}),t.sync=function(e,i,a){var r=_[e];n.defaults(a||(a={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:r,dataType:"json"};if(a.url||(o.url=n.result(i,"url")||O()),null!=a.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",o.data=JSON.stringify(a.attrs||i.toJSON(a))),a.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),a.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){o.type="POST",a.emulateJSON&&(o.data._method=r);var s=a.beforeSend;a.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",r),s?s.apply(this,arguments):void 0}}"GET"===o.type||a.emulateJSON||(o.processData=!1),"PATCH"===o.type&&w&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=a.xhr=t.ajax(n.extend(o,a));return i.trigger("request",i,l,a),l};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),_={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var E=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,T=/(\(\?)?:\w+/g,I=/\*\w+/g,R=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(E.prototype,s,{initialize:function(){},route:function(e,i,a){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(i)&&(a=i,i=""),a||(a=this[i]);var r=this;return t.history.route(e,function(n){var o=r._extractParameters(e,n);r.execute(a,o),r.trigger.apply(r,["route:"+i].concat(o)),r.trigger("route",i,o),t.history.trigger("route",r,i,o)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var e,t=n.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(R,"\\$&").replace(k,"(?:$1)?").replace(T,function(e,t){return t?e:"([^/?]+)"}).replace(I,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var i=e.exec(t).slice(1);return n.map(i,function(e,t){return t===i.length-1?e||null:e?decodeURIComponent(e):null})}});var A=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},L=/^[#\/]|\s+$/g,P=/^\/+|\/+$/g,D=/msie [\w.]+/,x=/\/$/,N=/#.*$/;A.started=!1,n.extend(A.prototype,s,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(x,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(L,"")},start:function(e){if(A.started)throw new Error("Backbone.history has already been started");A.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment(),a=document.documentMode,r=D.exec(navigator.userAgent.toLowerCase())&&(!a||7>=a);if(this.root=("/"+this.root+"/").replace(P,"/"),r&&this._wantsHashChange){var o=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=o.hide().appendTo("body")[0].contentWindow,this.navigate(i)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=i;var s=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&s.hash&&(this.fragment=this.getHash().replace(L,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),A.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(e,t){if(!A.started)return!1;t&&t!==!0||(t={trigger:!!t});var n=this.root+(e=this.getFragment(e||""));if(e=e.replace(N,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),t.history=new A;var M=function(e,t){var i,a=this;i=e&&n.has(e,"constructor")?e.constructor:function(){return a.apply(this,arguments)},n.extend(i,a,t);var r=function(){this.constructor=i};return r.prototype=a.prototype,i.prototype=new r,e&&n.extend(i.prototype,e),i.__super__=a.prototype,i};f.extend=p.extend=E.extend=C.extend=A.extend=M;var O=function(){throw new Error('A "url" property or function must be specified')},U=function(e,t){var n=t.error;t.error=function(i){n&&n(e,i,t),e.trigger("error",e,i,t)}};return t}),define("xmlToJson",["require","underscore"],function(e){function t(e,t){function a(e,n){if(!e)return null;{var s="",l=null,c=null;e.nodeType,r(e.localName||e.nodeName),e.text||e.nodeValue||""}e.childNodes&&e.childNodes.length>0&&i.each(e.childNodes,function(e){var t=e.nodeType,n=r(e.localName||e.nodeName),i=e.text||e.nodeValue||"";if(8!=t)if(3!=t&&4!=t&&n)l=l||{},l[n]?(l[n].length||(l[n]=o(l[n])),l[n]=o(l[n]),l[n][l[n].length]=a(e,!0),l[n].length=l[n].length):l[n]=a(e);else{if(i.match(/^\s+$/))return;s+=i.replace(/^\s+/,"").replace(/\s+$/,"")}}),e.attributes&&e.attributes.length>0&&(c={},l=l||{},i.each(e.attributes,function(e){var t=r(e.name),n=e.value;c[t]=n,l[t]?(l[cnn]=o(l[cnn]),l[t][l[t].length]=n,l[t].length=l[t].length):l[t]=n})),l&&(l=i.extend(""!=s?new String(s):{},l||{}),s=l.text?[l.text||""].concat([s]):s,s&&(l.text=s),s="");var u=l||s;return t&&(s&&(u={}),s=u.text||s||"",s&&(u.text=s),n||(u=o(u))),u}if(!e)return{};var r=function(e){return String(e||"").replace(/-/g,"_")},o=function(e){return Array.isArray(e)||(e=[e]),e.length=e.length,e};if("string"==typeof e&&(e=n(e)),e.nodeType){if(3==e.nodeType||4==e.nodeType)return e.nodeValue;var s=9==e.nodeType?e.documentElement:e,l=a(s,!0);return e=null,s=null,l}}function n(e){var t;try{var n=new DOMParser;n.async=!1}catch(i){throw new Error("XML Parser could not be instantiated")}try{t=n.parseFromString(e,"text/xml")}catch(i){throw new Error("Error parsing XML string")}return t}var i=e("underscore");return t}),function(e,t){"function"==typeof define&&define.amd?define("common/pubsub",["exports"],t):"object"==typeof exports&&t(exports);var n={};e.PubSub=n,t(n)}("object"==typeof window&&window||this,function(e){function t(e){var t;for(t in e)if(e.hasOwnProperty(t))return!0;return!1}function n(e){return function(){throw e}}function i(e,t,i){try{e(t,i)}catch(a){setTimeout(n(a),0)}}function a(e,t,n){e(t,n)}function r(e,t,n,r){var o,s=c[t],l=r?a:i;if(c.hasOwnProperty(t))for(o in s)s.hasOwnProperty(o)&&l(s[o],e,n)}function o(e,t,n){return function(){var i=String(e),a=i.lastIndexOf(".");for(r(e,e,t,n);-1!==a;)i=i.substr(0,a),a=i.lastIndexOf("."),r(e,i,t,n)}}function s(e){for(var n=String(e),i=Boolean(c.hasOwnProperty(n)&&t(c[n])),a=n.lastIndexOf(".");!i&&-1!==a;)n=n.substr(0,a),a=n.lastIndexOf("."),i=Boolean(c.hasOwnProperty(n)&&t(c[n]));return i}function l(e,t,n,i){var a=o(e,t,i),r=s(e);return r?(n===!0?a():setTimeout(a,0),!0):!1}var c={},u=-1;e.publish=function(t,n){return l(t,n,!1,e.immediateExceptions)},e.publishSync=function(t,n){return l(t,n,!0,e.immediateExceptions)},e.subscribe=function(e,t){if("function"!=typeof t)return!1;c.hasOwnProperty(e)||(c[e]={});var n="uid_"+String(++u);return c[e][n]=t,n},e.clearAllSubscriptions=function(){c={}},e.clearSubscriptions=function(e){var t;for(t in c)c.hasOwnProperty(t)&&0===t.indexOf(e)&&delete c[t]},e.unsubscribe=function(e){var t,n,i,a="string"==typeof e&&c.hasOwnProperty(e),r=!a&&"string"==typeof e,o="function"==typeof e,s=!1;if(a)return void delete c[e];for(t in c)if(c.hasOwnProperty(t)){if(n=c[t],r&&n[e]){delete n[e],s=e;break}if(o)for(i in n)n.hasOwnProperty(i)&&n[i]===e&&(delete n[i],s=!0)}return s}}),define("common/baseUtils",["require","xmlToJson","common/pubsub","underscore"],function(e){var t=e("xmlToJson"),n=e("common/pubsub"),i=e("underscore"),a={};a.pubsub=n;var r={4e3:"AuthenticationFailed",4001:"NotAllowed",6e3:"DoesNotExist"},o={23:"LoginAttempts",31:"Password",35:"PlayerAccount",38:"Privilege",49:"SteamAccountLink",50:"SteamAPI",81:"RockstarAccountLink",89:"DupLogin",96:"Password"};return a.errorCode=function(e){return e||"1000.1"},a.errorCodeLocKey=function(e){return"errorcode_"+e},a.isNumeric=function(e){return!Array.isArray(e)&&e-parseFloat(e)+1>=0},a.formatDob=function(e,t,n){return void 0===e||void 0===t||void 0===n?"":e+"-"+t+"-"+n},a.errorCodeIs=function(e,t){if(a.isNumeric(e)){var n=parseInt(e,10);return t===a.getErrorCodeString(n)}return e===t},a.errorCodeExIs=function(e,t){if(a.isNumeric(e)){var n=parseInt(e,10);return t===a.getErrorCodeExString(n)}return e===t},a.getErrorCodeString=function(e){var t=r[e];return"undefined"==typeof t?e:t},a.getErrorCodeExString=function(e){var t=o[e];return"undefined"==typeof t?e:t},a.splitErrorCode=function(e){var t=[e,""];return"string"==typeof e&&e.indexOf(".")>0&&(t=e.split(".")),{code:t[0],codeEx:t[1]}},a.stringHasContent=function(e){return"string"==typeof e&&e.length>0},a.htmlEncode=function(e){return e?i.escape(e):""},a.htmlDecode=function(e){return e?i.unescape(e):""},a.mapLanguage=function(e){var t;switch(e.toLowerCase()){case"pt-pt":t="pt-BR";break;case"zh-cht":t="zh-TW";break;default:t=e}return t},a.getUrlVars=function(e){for(var t,n=[],i=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),a=0;a<i.length;a++){if(t=i[a].split("="),e===t[0])return t[1];n.push(t[0]),n[t[0]]=t[1]}return null!=e?"":n},a.createCookie=function(e,t,n){var i;if(n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),i="; expires="+a.toGMTString()}else i="";document.cookie=e+"="+t+i+"; path=/"},a.readCookie=function(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var a=n[i];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return null},a.eraseCookie=function(e){a.createCookie(e,"",-1)},a.getDaysForMonth=function(e,t){var n=[31,29,31,30,31,30,31,31,30,31,30,31],i=Number(e)-1,a=Number(t);return 1===i&&a>0&&1!=new Date(a,i,29).getMonth()&&n[i]--,n[i]},a.getYears=function(){for(var e=100,t=new Date,n=t.getFullYear(),i=[],a=n,r=n-e;a>=r;a--)i.push(a);return i},a.jsToDll=function(e){return e.replace(/RGSC_/g,"RGSC_JS_")+"_ASYNC_RESULT"},a.dllToJs=function(e){return e.replace(/RGSC_JS_/g,"RGSC_").replace(/_ASYNC_RESULT/,"")},a.isLegacyServiceLayer=function(){return globals.RosTitleVersion<11},a.isSteam=function(){return"steam"===a.getGamePlatform()&&globals.steamAppId>0&&""!==globals.steamAuthTicket&&!a.isLegacyServiceLayer()},a.isScDownError=function(e){var t=!1;if("undefined"==typeof e||""===e)return!1;var n=[2e3,2999],i=parseInt(e,10);return i>=n[0]&&i<=n[1]&&(t=!0),t},a.getLastStringSegment=function(e,t,n){if(e){var i=e.split(t);return i.length>n?i[i.length-2]+t+i[i.length-1]:e}return""},a.getGamePlatform=function(){return globals.gamePlatform},a.setGamePlatform=function(e){globals.gamePlatform=e.toLowerCase()},a.inGamePadMode=function(){return 1==globals.inputMethod},a.isLogoutDisabled=function(){return"steam"===a.getGamePlatform()&&"lanoire"!==globals.titleName.toLowerCase()},a.isNewSigninFlowEnabled=function(){return"gta5"===globals.titleName.toLowerCase()&&a.isOnline()},a.isLauncherV2Enabled=function(){var e=["gta5"];return i.contains(e,globals.titleName)},a.isOffline=function(e){var t=void 0!==e?!e:void 0;return!a.isOnline(t)},a.isOnline=function(e){return void 0!==e&&(globals.isOnline=e,a.pubsub.publish("baseUtils.isOnline",e)),void 0===globals.isOnline&&(globals.isOnline=globals.scsServiceEnabled),globals.isOnline&&(globals.hasConnection=!0,globals.hasInternet=!0),globals.isOnline},a.isLoadedInOnlineMode=function(){return globals.isOnlineMode},a.isLoadedInOfflineMode=function(){return!globals.isOnlineMode},a.isLocal=function(e){return void 0!==e&&(globals.isLocal=e),globals.isLocal},a.isSignedIn=function(e){return void 0!==e&&(globals.isSignedIn=e),globals.isSignedIn},a.isScuiVisible=function(){return globals.isScuiVisible},a.isAjaxXml=function(e){var t=e.dataTypes[0];return"xml"===e.dataType||"xml"===t||"text"===t&&"application/xml"===e.accepts.text},a.tryConvertRespToJson=function(e){var n=null;try{n=e.isXml?t(e.resp):JSON.parse(e.resp)}catch(i){}return n||{}},a.isPanelVisible=function(e){var t=0===e.css("top").indexOf("-");return!t&&e.hasClass("active")&&"none"!==e.css("display")},a.objStrMatch=function(e,t,n){return"undefined"!=typeof e&&"string"==typeof e[t]&&e[t].toLowerCase()===n},a.extractErrorFromResponse=function(e){if("undefined"==typeof e)return void 0;var t;return t=e&&e.jqXhr?e.jqXhr.responseJSON?e.jqXhr.responseJSON.Message:e.jqXhr.responseText:e.responseJSON?e.responseJSON.Message:e.responseText?e.responseText:e.errorThrown,null===t&&(t=void 0),t},a}),function(e){function t(e,t){"undefined"!=typeof log&&(new Date).getTime()%10==0&&log("redraw: this should only be happening when the spinner is visible");var n,i=e.data("spinner");if(i){if(!e.is(":visible"))return void e.spinner("stop");i.options.frame>=i.options.frames&&(i.options.frame=1),n="-"+i.options.frame*i.options.width+"px 0px",e.css("background-position",n),i.options.frame++}else clearInterval(t)}var n={init:function(n){return this.each(function(){var i,a=e(this),r=a.data("spinner"),o={speed:25,width:32,height:32};n=e.extend({},o,n),r||(a.data("spinner",{options:n}),r=a.data("spinner")),a.height(r.options.height),a.width(r.options.width),r.options.image?(a.css("background-image","url("+r.options.image+")"),a.css("background-position","0px 0px"),a.css("background-repeat","no-repeat")):r.options.image=a.css("background-image"),r.options.frames||(i=new Image,i.src=r.options.image,i.onload=function(){r.options.frames=i.width/r.options.width}),r.options.endTime||(r.options.endTime=(new Date).getTime()+6e4),r.options.frame=1,r.options.animation=setInterval(function(){t(a,r.options.animation),(new Date).getTime()>r.options.endTime&&clearInterval(r.options.animation)},r.options.speed)})},stop:function(){return this.each(function(){var t=e(this),n=t.data("spinner");n&&(clearInterval(n.options.animation),t.removeData("spinner"))})},attachToMouse:function(){return this.each(function(){var t=e(this);e("body").mousemove(function(e){t.is(":hidden")&&t.show(),t.css({top:e.pageY-25+"px",left:e.pageX+10+"px"})})})}};e.fn.spinner=function(t){return n[t]?n[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.spinner"),null):n.init.apply(this,arguments)}}(jQuery),define("common/jquery.spinner",["jquery"],function(e){return function(){var t;return t||e.$}}(this)),define("utils",["require","jquery","common/xhr","backbone","underscore","moment","common/baseUtils","common/jquery.spinner"],function(e){function t(e){return"s"===e||"S"===e||32===e||"32"===e||64===e||"64"===e}function n(e){return"l"===e||"L"===e||128==e||"128"==e}function i(e){return null===e||"undefined"==typeof e||""==e||"undefined"==e||e.match(/default.png$/)}function a(e,t,n){var i=null!=e&&"undefined"!=typeof e&&null!=n&&"undefined"!=typeof n,a=i&&(e.toString().indexOf("RGSC_RAISE_UI_EVENT")>-1||e.toString().indexOf("RGSC_DEBUG_EVENT")>-1)&&n.toString().indexOf('"EventId":3')>-1&&n.toString().indexOf('"Action":"Debug"')>-1;return a}function r(e,t,n){var i=null!=e&&"undefined"!=typeof e&&null!=n&&"undefined"!=typeof n,a=i&&(e.toString().indexOf("RGSC_JS_FINISH_SIGN_IN")>-1||e.toString().indexOf("RGSC_SIGN_IN")>-1)&&t.toString().indexOf("json")>-1;return a}function o(e,t){if("undefined"==typeof e||!e.length)return e;var n=new RegExp("([\"'])("+t+")\\1 *: *([\"']).+?\\3","ig"),i="$1$2$1:$3***$3",a=e.replace(n,i),r=new RegExp("(%3C)("+t+")(%3E).+?(%3C%2F\\2%3E)","ig");return i="$1$2$3***$4",a.replace(r,i)}var s=e("jquery"),l=e("common/xhr"),c=e("backbone"),u=e("underscore"),d=e("moment"),f=e("common/baseUtils");e("common/jquery.spinner"),globals.headerHeight="63px",globals.headerHeightBtm="60px";var h={};h.initDownloaderLauncher=function(){s("#launcherStyle").find(".headerText").html(h.processLauncherText(globals.titleDisplayName))},h.getAvatarUrlFromNickname=function(e,i){if(!globals.avatarServiceEnabled||null===e||"undefined"==typeof e||""===e)return h.getAvatarUrlFromUrl(i);var a="";t(i)?a="/s":n(i)&&(a="/l");var r,o=e.toLowerCase();return r=globals.account&&e===globals.account.Nickname?globals.account.AvatarCacheBust?"n"+globals.account.AvatarCacheBust+"/"+o:"n/"+o:"n/"+o,globals.avatarCloudBase+r+a},h.getAvatarUrlFromUrl=function(e,n){var a="";return t(n)?a="32x32/":(128==n||"128"==n)&&(a="128x128/"),i(e)?globals.avatarUrl+a+"default.png":globals.avatarUrl+a+f.getLastStringSegment(e,"/",2)},h.getAvatarUrl=function(e,t,n){return globals.avatarServiceEnabled&&null!==t&&"undefined"!=typeof t&&""!==t?h.getAvatarUrlFromNickname(t,n):h.getAvatarUrlFromUrl(e,n)},h.prefixAvatarUrl=function(e){var t="../images/avatars/";return-1===e.indexOf(t)?h.urlCombine(t,e):e},h.trimValueIfExceedMaxLength=function(e){var t=e.attr("maxlength")||255,n=e.val();n.length>t&&e.val(n.substring(0,t))},h.getScBaseUrl=function(){return globals.scBaseUrl||"http://socialclub.rockstargames.com/"},h.getSecureScBaseUrl=function(){return h.getScBaseUrl().replace("http://","https://")},String.prototype.chunk=function(e){for(var t=[],n=0,i=this.length;i>n;n+=e)t.push(this.substr(n,e));return t},String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return void 0!=typeof e[n]?e[n]:t})},s.fn.preload=function(){this.each(function(){s("<img/>")[0].src=this})},h.pubsub=u.extend({},c.Events,f.pubsub),c.View.prototype.close=function(){this.remove(),this.off(),this.stopListening(),this.onClose&&this.onClose()},Object.prototype.hasOwnProperty("renameProperty")||Object.defineProperty(Object.prototype,"renameProperty",{writable:!1,enumerable:!1,configurable:!1,value:function(e,t){return this.hasOwnProperty(e)&&(this[t]=this[e],delete this[e]),this}}),h.renderCompiledTemplate=function(e,t){return t||(t={}),t.scBaseUrl||(t.scBaseUrl=h.getScBaseUrl()),t.secureScBaseUrl||(t.secureScBaseUrl=h.getSecureScBaseUrl()),e(t)},h.setCreateAccount3003=function(){globals.createAccount3003=!0},h.getCreateAccount3003=function(){return globals.createAccount3003},h.clearCreateAccount3003=function(){delete globals.createAccount3003},h.getApiUrl=function(e){return void 0!=e&&"/"==e.charAt(0)&&(e=e.substr(1)),h.urlCombine(globals.apiUrl,e)},h.loadDateDropdowns=function(){if(!globals.underage){var e;s("#monthOfBirth option:first").prop("selected",!0),s("#dayOfBirth").empty();var t=[];for(e=1;32>e;e++)t.push('<option value="'+e+'">'+e+"</option>");s("#dayOfBirth").append(t.join(""));var n,i=h.getYears();for(t=[],s("#yearOfBirth").html('<option value="">-</option>'),e=0,n=i.length;n>e;e++)t.push('<option value="'+i[e]+'">'+i[e]+"</option>");s("#yearOfBirth").append(t.join("")),s("#signupDobContainer").show()}},h.getDaysForMonth=function(e,t){return f.getDaysForMonth(e,t)},h.getYears=function(){return f.getYears()},h.ConvertDateString=function(e,t){var n=parseInt(e);1e10>n&&(n*=1e3);var i=new Date;i.setTime(n);var a,r=new Date(i.toLocaleString()),o=r.getDate();if(isNaN(o))a=i.toLocaleString();else{var s=r.getMonth();s++;var l=r.getFullYear();if(a=l+"-"+s+"-"+o,t){var c=r.getHours(),u=r.getMinutes(),d="AM";c>11&&(d="PM"),c>12&&(c-=12),0==c&&(c=12),10>c&&(c="0"+c),10>u&&(u="0"+u);var f=c+":"+u+" "+d;a+=" "+f}}return a},h.localizedDate=function(e,t){return d.lang(globals.titlelang),d(e).format(t)},h.localizedDateFromUnix=function(e,t){return d.lang(globals.titlelang),d.unix(e).format(t)},h.stripRegion=function(e){if("undefined"==typeof e||!e.length)return e;switch(e){case"pt-BR":case"es-MX":return e.replace(/-/,"_").toLowerCase();default:return e.split("-")[0]}},h.toLower=function(e){return null===e||"string"!=typeof e?e:e.toLowerCase()},h.addCommas=function(e){e=Math.round(e,0),e+="";for(var t=e.split("."),n=t[0],i=/(\d+)(\d{3})/;i.test(n);)n=n.replace(i,"$1,$2");return n},h.processLauncherText=function(e){var t=/(https?:\/\/[^\s]+)/g;return h.jhtmlEncode(decodeURI(e)).replace(t,function(e){return'<a class="RGSCLoadExt" href="'+e+'">'+e+"</a>"}).replace(/\r\n/g,"<br>")},h.getCaretPosition=function(e){var t=0;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t},h.setCaretPosition=function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}},h.getLastStringSegment=function(e,t,n){return f.getLastStringSegment(e,t,n)};return h.logType={error:"error",debug:"debug"},h.logController={debug:"debug",friend:"friend",crew:"crew",profile:"profile",privacy:"privacy",messaging:"messaging",lanoire:"lan",mp3:"mp3",gta5:"gta5"},h.WriteDebugLog=function(e,t,n,i,s,l){if(!a(e,t,n)&&(l||!r(e,t,n))){var c=null!=e&&void 0!=e&&null!=n&&void 0!=n&&(e.toString().indexOf("RGSC_SET_TEXT_BOX_HAS_FOCUS")>-1&&n.toString().indexOf('"IsPassword":true')>-1||n.toString().search(/["']password["'] *:/gi)>-1||n.toString().search(/["']email["'] *:/gi)>-1);c&&(n=o(n,"text"),n=o(n,"password"),n=o(n,"email"),n=o(n,"zipcode"));var u=h.formatLogData(e,t,n);if(h.pubsub.trigger("debug:UpdateDebugTable",u),globals.isLog){var d=encodeURI((u.minutes+","+u.seconds+","+u.ms+","+u.method+","+u.key+","+u.value).replace(/\"/g,"'"));h.pubsub.trigger("setupEnvUtils:launcherDebugEvent",d)}h.WriteErrorLogFile(u,i,s,l)}},h.WriteDllLog=function(e,t,n,i,a){"object"==typeof n&&(n=JSON.stringify(n)),h.WriteDebugLog(e,t,n,i,a,!0)},globals.debugLog="",h.WriteErrorLogFile=function(e,t,n,i){var a,r=e.method;r+=" | SDK:"+globals.sdkVersion,h.isLanguageSupported()||(r+=" | Unsupported Lang:"+globals.titlelang),n=n||h.logController.debug,"undefined"!=typeof e.key&&e.key.length&&(r+=" | "+e.key),"undefined"!=typeof e.value&&e.value.length&&(r+=": "+e.value),!globals.logJs||t!==h.logType.error&&"Error"!==e.key||(a='{ "logData":"'+encodeURIComponent(r)+'" }',l.ajax({type:"POST",url:h.getApiUrl("api/"+n+"/writeerrorlogfile"),data:a,contentType:"application/json; charset=utf-8",dataType:"json",silentFail:!0,disableSlowMsg:!0})),globals.fullLog&&i&&(globals.debugLog+=r+"; ")},h.formatLogData=function(e,t,n){var i=new Date;return{minutes:i.getMinutes(),seconds:i.getSeconds(),ms:i.getMilliseconds(),method:h.jhtmlEncode(e),key:h.jhtmlEncode(t),value:h.jhtmlEncode(n)}},h.isLanguageSupported=function(){if("en-US"===globals.titlelang)return!0;var e=[{title:"gta5",languages:["en-US","fr-FR","it-IT","de-DE","es-ES","ru-RU","ja-JP","pt-BR","pl-PL","ko-KR","zh-TW","es-MX"]},{title:"mp3",languages:["en-US","fr-FR","it-IT","de-DE","es-ES","ru-RU","ja-JP","pt-BR","pl-PL","ko-KR"]},{title:"lanoire",languages:["en-US","fr-FR","it-IT","de-DE","es-ES","ru-RU","ja-JP"]}],t=u.find(e,function(e){return e.title===globals.titleName});return"undefined"!=typeof t?s.inArray(globals.titlelang,t.languages)>-1:!1},h.SortSelect=function(e){var t=s(e);t.length>0&&t.each(function(e,t){var n=s(t).val(),i=s("option",s(t)),a=[];i.each(function(){a.push({val:s(this).val(),text:s(this).text()})}),a.humanSort();for(var e=0,r=a.length;r>e;e++)s(i[e]).val(a[e].val).text(a[e].text);s(t).val(n)})},h.jhtmlEncode=function(e){return e?s("<div />").text(e).html().replace("'","&#39;"):""},h.jhtmlDecode=function(e){return e?s("<div />").html(e).text():""},h.stripHTMLNewLine=function(e){return e.replace(/<br ?\/?>/gi,"")},Array.prototype.humanSort=function(){return this.sort(function(e,t){var n,i;n="- "==e.text.substring(0,2)?e.text.substring(2).split(/(\d+)/):e.text.split(/(\d+)/),i="- "==t.text.substring(0,2)?t.text.substring(2).split(/(\d+)/):t.text.split(/(\d+)/);for(var a=0;a<Math.max(n.length,i.length);a++)if(n[a]!=i[a]){var r=isNaN(parseInt(n[a],10))?n[a]:parseInt(n[a],10),o=isNaN(parseInt(i[a],10))?i[a]:parseInt(i[a],10);return void 0==r||void 0==o?n.length-i.length:o>r?-1:1}return 0})},h.secondsToTime=function(e){var t=Math.floor(e/3600),n=e%3600,i=Math.floor(n/60),a=n%60,r=Math.ceil(a);return t+"h "+i+"m "+r+"s"},h.msToTime=function(e){var t=e%1e3;e=(e-t)/1e3;var n=e%60;e=(e-n)/60;var i=e%60,a=(e-i)/60;return a+"h "+i+"m "+n+"s"},h.metersToMiles=function(e){var t=.000621371192*e;t=t.toFixed(2);var n=1==t?" mile":" miles";return t.toString()+n},h.kphToMph=function(e){var t=.621371*e;return t=t.toFixed(2),t.toString()+" mph"},h.metersToFeet=function(e){var t=3.2808399*e;t=t.toFixed(2);var n=" ft";return t.toString()+n},h.formatMoney=function(e){return e>0?"$"+h.abbreviateNumber(e):"$"+e},h.formatMeters=function(e){return e+" meters"},h.formatPercent=function(e){var t=parseInt(e,10);return t.toString()+"%"},h.decimal=function(e){if("undefined"==typeof e||""===e)return 0;var t=parseFloat(e);return Math.round(100*t)/100},h.abbreviateNumber=function(e){var t,n=Math.pow(10,12),i=Math.pow(10,9),a=Math.pow(10,6),r=Math.abs(e);if(1e3>r)return e.toString();var o,s;return a>r?(o=1,s="K"):i>r?(o=2,s="M"):n>r?(o=3,s="B"):(o=4,s="T"),t=parseFloat(e/Math.pow(1e3,o)).toFixed(1),t.toString()+s},h.expandDashString=function(e){var t="";if(void 0!=e&&e.indexOf("-")>-1)for(var n=e.split(","),i=0;i<n.length;i++)if(n[i].indexOf("-")>0)for(var a=n[i].split("-"),r=a[0];r<=a[1];r++)t+=","+r;
else t+=","+n[i];return""!=t?t.substring(1):e},h.pausecomp=function(e){for(e+=(new Date).getTime();new Date<e;);},h.countKeys=function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t},h.isCloudSaveEnabled=function(){var e=["gta5"];return s.inArray(globals.titleName,e)>-1},h.isStoreV2Enabled=function(){var e=["gta5"];return s.inArray(globals.titleName,e)>-1},h.isEntitlementsV2Enabled=function(){var e=["gta5"];return s.inArray(globals.titleName,e)>-1},h.isActLglEnabled=function(){var e=["gta5"];return s.inArray(globals.titleName,e)>-1},h.isSteamV2Enabled=function(){var e=["gta5"];return s.inArray(globals.titleName,e)>-1},h.areChunkedVoucherCodesEnabled=function(){var e=["lanoire","mp3","gta5"];return s.inArray(globals.titleName,e)>-1},h.isGameSupported=function(){var e=["lanoire","mp3","gta5"];return s.inArray(globals.titleName,e)>-1},h.isLegacyServiceLayer=function(){return f.isLegacyServiceLayer()},h.crewImage404=function(){var e=globals.baseUrl+"images/emblems/128x128/rockstar1.png";e!=this.src&&(this.src=e),s(this).off("error")},h.initSpinner=function(e,t){try{t=u.extend({height:32,width:32,speed:80,image:globals.baseUrl+"images/spinners/spinner32x32black.png",frames:12},t),e.spinner("stop").spinner(t)}catch(n){}return e},h.stopSpinner=function(e){try{e.spinner("stop")}catch(t){}return e},h.removeLoading=function(e){var t=s("#"+e).find(".loadingMask");t.length?t.fadeOut(600,function(){h.stopSpinner(s(this).find("span.loading")),t.removeClass("noMask")}):h.stopSpinner(s("#"+e).find("span.loading")).fadeOut()},h.getButtonHtml=function(e,t,n,i){var a="";return void 0!=i&&i.length&&(a='id="'+i+'"'),'<a href="#" {3} class="btn btnLarge {0} btn1" data="{1}">{2}</a>'.format(e||"",n.toString()||"",h.processLauncherText(t||""),a)},h.parseUri=function(e){var t=document.createElement("a");return t.href=e,t},h.urlCombine=function(e,t){return void 0!=e&&e.length?void 0!=t&&t.length?("/"==e.charAt(e.length-1)&&(e=e.substr(e,e.length-1)),"/"==t.charAt(0)&&(t=t.substr(1)),e+"/"+t):e:t},h.errorCode=function(e){return f.errorCode(e)},h.errorCodeLocKey=function(e){return f.errorCodeLocKey(e)},h.isSdkAtLeast=function(e){if(null===e||"undefined"==typeof e)throw"Parameter missing";if("undefined"==typeof globals.sdkVersion)throw"SDK version not yet initialized";var t=e.split("."),n=globals.sdkVersion.split("."),i=u.any(n,function(e,n){return e<t[n]});return!i},h.formatDob=function(e,t,n){return f.formatDob(e,t,n)},h.GetBase64AvatarSrc=function(e){return void 0!=e&&"undefined"!=e&&e.length>0?"data:image/png;base64,"+e:h.getAvatarUrl()},h.HideNonSteamFeatures=function(){"lanoire"!=globals.titleName&&"mp3"!=globals.titleName&&(s("#formSignInProfile #autoSignInProfile").closest("fieldset").hide(),s(".formSignIn #signinAction fieldset.options").hide(),s("#profileSettings").find(".editAutoSignIn").parent().hide(),s("#profileSettings").find(".deleteLocalUserData").parent().hide())},h.ShowInvisibleMask=function(e,t){void 0!=e&&(e.each(function(){var e=s(this);e.data("maskTxt",e.text()),e.text(t)}),e.addClass("invisMask")),s("#invisibleMask").show(),setTimeout(h.HideInvisibleMask,1e4)},h.HideInvisibleMask=function(){var e=s(".invisMask");e.length&&(e.each(function(){var e=s(this),t=e.data("maskTxt");void 0!=t&&t.length&&e.text(t)}),e.removeClass("invisMask")),s("#invisibleMask").hide()},h.UpdateDebugTable=function(){},h.AjaxRequestAborted=function(e){return"abort"===e||"TypeError: Cannot read property 'send' of undefined"===e},h.ToggleCompareFriendElements=function(e){"success"===e?(s("#comparedFriendInfo").show(),s(".pointsFriend").show()):(s("#comparedFriendInfo").hide(),s(".pointsFriend").hide())},h.ActiveFriendsMenuId=function(){var e=s("#friendsPanel").find(".sideMenu a.on");return e.length?e.attr("id"):void 0},h.IsCountryListEmpty=function(){return 0===s("#editCountry").find("option").length},h.getOnlineTitle=function(e,t){var n,i,a=!1;if(e)if(1==t.length)n=t[0].TitleFriendlyName,i=t[0].PlatformFriendlyName;else{var r=u.find(t,function(e){return"pcros"==e.PlatformName});r&&(a=!0,n=r.TitleFriendlyName,i=r.PlatformFriendlyName),a||(n=t[0].TitleFriendlyName,i=t[0].PlatformFriendlyName)}return{game:n,platform:i}},h.avatar404=function(e){e&&e.preventDefault();var t=s(e.currentTarget),n=t.hasClass("extraLargeAvatar")?globals.baseUrl+"images/avatars/128x128/default.png":globals.baseUrl+"images/avatars/default.png";n!=this.src&&(this.src=n),s(this).off("error")},h.customAvatarsEnabled=function(){return globals.customAvatarsEnabled&&globals.account.UgcWritePrivilege},h.getSelfieUrl=function(e,t){return e&&t?"gen8selfie"===t||"gen8mugshot"===t?e.replace(/.jpg/gi,"_small.jpg"):e:e},h}),function(e,t){function n(t,n){var a,r,o,s=t.nodeName.toLowerCase();return"area"===s?(a=t.parentNode,r=a.name,t.href&&r&&"map"===a.nodeName.toLowerCase()?(o=e("img[usemap=#"+r+"]")[0],!!o&&i(o)):!1):(/input|select|textarea|button|object/.test(s)?!t.disabled:"a"===s?t.href||n:n)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var a=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(n,i){return"number"==typeof n?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),i&&i.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var i,a,r=e(this[0]);r.length&&r[0]!==document;){if(i=r.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(a=parseInt(r.css("zIndex"),10),!isNaN(a)&&0!==a))return a;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,i){return!!e.data(t,i[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var i=e.attr(t,"tabindex"),a=isNaN(i);return(a||i>=0)&&n(t,!a)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,i){function a(t,n,i,a){return e.each(r,function(){n-=parseFloat(e.css(t,"padding"+this))||0,i&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var r="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),s={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(n){return n===t?s["inner"+i].call(this):this.each(function(){e(this).css(o,a(this,n)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?s["outer"+i].call(this,t):this.each(function(){e(this).css(o,a(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,i){var a,r=e.ui[t].prototype;for(a in i)r.plugins[a]=r.plugins[a]||[],r.plugins[a].push([n,i[a]])},call:function(e,t,n){var i,a=e.plugins[t];if(a&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(i=0;i<a.length;i++)e.options[a[i][0]]&&a[i][1].apply(e.element,n)}},hasScroll:function(t,n){if("hidden"===e(t).css("overflow"))return!1;var i=n&&"left"===n?"scrollLeft":"scrollTop",a=!1;return t[i]>0?!0:(t[i]=1,a=t[i]>0,t[i]=0,a)}})}(jQuery),function(e,t){var n=0,i=Array.prototype.slice,a=e.cleanData;e.cleanData=function(t){for(var n,i=0;null!=(n=t[i]);i++)try{e(n).triggerHandler("remove")}catch(r){}a(t)},e.widget=function(t,n,i){var a,r,o,s,l={},c=t.split(".")[0];t=t.split(".")[1],a=c+"-"+t,i||(i=n,n=e.Widget),e.expr[":"][a.toLowerCase()]=function(t){return!!e.data(t,a)},e[c]=e[c]||{},r=e[c][t],o=e[c][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new o(e,t)},e.extend(o,r,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),s=new n,s.options=e.widget.extend({},s.options),e.each(i,function(t,i){return e.isFunction(i)?void(l[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},a=function(e){return n.prototype[t].apply(this,e)};return function(){var t,n=this._super,r=this._superApply;return this._super=e,this._superApply=a,t=i.apply(this,arguments),this._super=n,this._superApply=r,t}}()):void(l[t]=i)}),o.prototype=e.widget.extend(s,{widgetEventPrefix:r?s.widgetEventPrefix||t:t},l,{constructor:o,namespace:c,widgetName:t,widgetFullName:a}),r?(e.each(r._childConstructors,function(t,n){var i=n.prototype;e.widget(i.namespace+"."+i.widgetName,o,n._proto)}),delete r._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){for(var a,r,o=i.call(arguments,1),s=0,l=o.length;l>s;s++)for(a in o[s])r=o[s][a],o[s].hasOwnProperty(a)&&r!==t&&(n[a]=e.isPlainObject(r)?e.isPlainObject(n[a])?e.widget.extend({},n[a],r):e.widget.extend({},r):r);return n},e.widget.bridge=function(n,a){var r=a.prototype.widgetFullName||n;e.fn[n]=function(o){var s="string"==typeof o,l=i.call(arguments,1),c=this;return o=!s&&l.length?e.widget.extend.apply(null,[o].concat(l)):o,this.each(s?function(){var i,a=e.data(this,r);return a?e.isFunction(a[o])&&"_"!==o.charAt(0)?(i=a[o].apply(a,l),i!==a&&i!==t?(c=i&&i.jquery?c.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+o+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+o+"'")}:function(){var t=e.data(this,r);t?t.option(o||{})._init():e.data(this,r,new a(o,this))}),c}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,i){var a,r,o,s=n;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(s={},a=n.split("."),n=a.shift(),a.length){for(r=s[n]=e.widget.extend({},this.options[n]),o=0;o<a.length-1;o++)r[a[o]]=r[a[o]]||{},r=r[a[o]];if(n=a.pop(),1===arguments.length)return r[n]===t?null:r[n];r[n]=i}else{if(1===arguments.length)return this.options[n]===t?null:this.options[n];s[n]=i}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,i){var a,r=this;"boolean"!=typeof t&&(i=n,n=t,t=!1),i?(n=a=e(n),this.bindings=this.bindings.add(n)):(i=n,n=this.element,a=this.widget()),e.each(i,function(i,o){function s(){return t||r.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?r[o]:o).apply(r,arguments):void 0}"string"!=typeof o&&(s.guid=o.guid=o.guid||s.guid||e.guid++);var l=i.match(/^(\w+)\s*(.*)$/),c=l[1]+r.eventNamespace,u=l[2];u?a.delegate(u,c,s):n.bind(c,s)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?i[e]:e).apply(i,arguments)}var i=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,i){var a,r,o=this.options[t];if(i=i||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],r=n.originalEvent)for(a in r)a in n||(n[a]=r[a]);return this.element.trigger(n,i),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(i))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(i,a,r){"string"==typeof a&&(a={effect:a});var o,s=a?a===!0||"number"==typeof a?n:a.effect||n:t;a=a||{},"number"==typeof a&&(a={duration:a}),o=!e.isEmptyObject(a),a.complete=r,a.delay&&i.delay(a.delay),o&&e.effects&&e.effects.effect[s]?i[t](a):s!==t&&i[s]?i[s](a.duration,a.easing,r):i.queue(function(n){e(this)[t](),r&&r.call(i[0]),n()})}})}(jQuery),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){return!0===e.data(n.target,t.widgetName+".preventClickEvent")?(e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(n){if(!t){this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var i=this,a=1===n.which,r="string"==typeof this.options.cancel&&n.target.nodeName?e(n.target).closest(this.options.cancel).length:!1;return a&&!r&&this._mouseCapture(n)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=this._mouseStart(n)!==!1,!this._mouseStarted)?(n.preventDefault(),!0):(!0===e.data(n.target,this.widgetName+".preventClickEvent")&&e.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){function n(e,t,n){return[parseFloat(e[0])*(h.test(e[0])?t/100:1),parseFloat(e[1])*(h.test(e[1])?n/100:1)]}function i(t,n){return parseInt(e.css(t,n),10)||0}function a(t){var n=t[0];return 9===n.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(n)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:n.preventDefault?{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var r,o=Math.max,s=Math.abs,l=Math.round,c=/left|center|right/,u=/top|center|bottom/,d=/[\+\-]\d+(\.[\d]+)?%?/,f=/^\w+/,h=/%$/,p=e.fn.position;e.position={scrollbarWidth:function(){if(r!==t)return r;var n,i,a=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=a.children()[0];return e("body").append(a),n=o.offsetWidth,a.css("overflow","scroll"),i=o.offsetWidth,n===i&&(i=a[0].clientWidth),a.remove(),r=n-i},getScrollInfo:function(t){var n=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),i=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),a="scroll"===n||"auto"===n&&t.width<t.element[0].scrollWidth,r="scroll"===i||"auto"===i&&t.height<t.element[0].scrollHeight;return{width:r?e.position.scrollbarWidth():0,height:a?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),i=e.isWindow(n[0]),a=!!n[0]&&9===n[0].nodeType;return{element:n,isWindow:i,isDocument:a,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:i?n.width():n.outerWidth(),height:i?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return p.apply(this,arguments);t=e.extend({},t);var r,h,m,g,v,b,C=e(t.of),S=e.position.getWithinInfo(t.within),y=e.position.getScrollInfo(S),w=(t.collision||"flip").split(" "),_={};return b=a(C),C[0].preventDefault&&(t.at="left top"),h=b.width,m=b.height,g=b.offset,v=e.extend({},g),e.each(["my","at"],function(){var e,n,i=(t[this]||"").split(" ");1===i.length&&(i=c.test(i[0])?i.concat(["center"]):u.test(i[0])?["center"].concat(i):["center","center"]),i[0]=c.test(i[0])?i[0]:"center",i[1]=u.test(i[1])?i[1]:"center",e=d.exec(i[0]),n=d.exec(i[1]),_[this]=[e?e[0]:0,n?n[0]:0],t[this]=[f.exec(i[0])[0],f.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===t.at[0]?v.left+=h:"center"===t.at[0]&&(v.left+=h/2),"bottom"===t.at[1]?v.top+=m:"center"===t.at[1]&&(v.top+=m/2),r=n(_.at,h,m),v.left+=r[0],v.top+=r[1],this.each(function(){var a,c,u=e(this),d=u.outerWidth(),f=u.outerHeight(),p=i(this,"marginLeft"),b=i(this,"marginTop"),E=d+p+i(this,"marginRight")+y.width,k=f+b+i(this,"marginBottom")+y.height,T=e.extend({},v),I=n(_.my,u.outerWidth(),u.outerHeight());"right"===t.my[0]?T.left-=d:"center"===t.my[0]&&(T.left-=d/2),"bottom"===t.my[1]?T.top-=f:"center"===t.my[1]&&(T.top-=f/2),T.left+=I[0],T.top+=I[1],e.support.offsetFractions||(T.left=l(T.left),T.top=l(T.top)),a={marginLeft:p,marginTop:b},e.each(["left","top"],function(n,i){e.ui.position[w[n]]&&e.ui.position[w[n]][i](T,{targetWidth:h,targetHeight:m,elemWidth:d,elemHeight:f,collisionPosition:a,collisionWidth:E,collisionHeight:k,offset:[r[0]+I[0],r[1]+I[1]],my:t.my,at:t.at,within:S,elem:u})}),t.using&&(c=function(e){var n=g.left-T.left,i=n+h-d,a=g.top-T.top,r=a+m-f,l={target:{element:C,left:g.left,top:g.top,width:h,height:m},element:{element:u,left:T.left,top:T.top,width:d,height:f},horizontal:0>i?"left":n>0?"right":"center",vertical:0>r?"top":a>0?"bottom":"middle"};d>h&&s(n+i)<h&&(l.horizontal="center"),f>m&&s(a+r)<m&&(l.vertical="middle"),l.important=o(s(n),s(i))>o(s(a),s(r))?"horizontal":"vertical",t.using.call(this,e,l)}),u.offset(e.extend(T,{using:c}))})},e.ui.position={fit:{left:function(e,t){var n,i=t.within,a=i.isWindow?i.scrollLeft:i.offset.left,r=i.width,s=e.left-t.collisionPosition.marginLeft,l=a-s,c=s+t.collisionWidth-r-a;t.collisionWidth>r?l>0&&0>=c?(n=e.left+l+t.collisionWidth-r-a,e.left+=l-n):e.left=c>0&&0>=l?a:l>c?a+r-t.collisionWidth:a:l>0?e.left+=l:c>0?e.left-=c:e.left=o(e.left-s,e.left)},top:function(e,t){var n,i=t.within,a=i.isWindow?i.scrollTop:i.offset.top,r=t.within.height,s=e.top-t.collisionPosition.marginTop,l=a-s,c=s+t.collisionHeight-r-a;t.collisionHeight>r?l>0&&0>=c?(n=e.top+l+t.collisionHeight-r-a,e.top+=l-n):e.top=c>0&&0>=l?a:l>c?a+r-t.collisionHeight:a:l>0?e.top+=l:c>0?e.top-=c:e.top=o(e.top-s,e.top)}},flip:{left:function(e,t){var n,i,a=t.within,r=a.offset.left+a.scrollLeft,o=a.width,l=a.isWindow?a.scrollLeft:a.offset.left,c=e.left-t.collisionPosition.marginLeft,u=c-l,d=c+t.collisionWidth-o-l,f="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,h="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,p=-2*t.offset[0];0>u?(n=e.left+f+h+p+t.collisionWidth-o-r,(0>n||n<s(u))&&(e.left+=f+h+p)):d>0&&(i=e.left-t.collisionPosition.marginLeft+f+h+p-l,(i>0||s(i)<d)&&(e.left+=f+h+p))},top:function(e,t){var n,i,a=t.within,r=a.offset.top+a.scrollTop,o=a.height,l=a.isWindow?a.scrollTop:a.offset.top,c=e.top-t.collisionPosition.marginTop,u=c-l,d=c+t.collisionHeight-o-l,f="top"===t.my[1],h=f?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,p="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>u?(i=e.top+h+p+m+t.collisionHeight-o-r,e.top+h+p+m>u&&(0>i||i<s(u))&&(e.top+=h+p+m)):d>0&&(n=e.top-t.collisionPosition.marginTop+h+p+m-l,e.top+h+p+m>d&&(n>0||s(n)<d)&&(e.top+=h+p+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,i,a,r,o=document.getElementsByTagName("body")[0],s=document.createElement("div");t=document.createElement(o?"div":"body"),i={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(i,{position:"absolute",left:"-1000px",top:"-1000px"});for(r in i)t.style[r]=i[r];t.appendChild(s),n=o||document.documentElement,n.insertBefore(t,n.firstChild),s.style.cssText="position: absolute; left: 10.7432222px;",a=e(s).offset().left,e.support.offsetFractions=a>10&&11>a,t.innerHTML="",n.removeChild(t)}()}(jQuery),function(e){e.widget("ui.autocomplete",{version:"1.10.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,n,i,a=this.element[0].nodeName.toLowerCase(),r="textarea"===a,o="input"===a;this.isMultiLine=r?!0:o?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[r||o?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(a){if(this.element.prop("readOnly"))return t=!0,i=!0,void(n=!0);t=!1,i=!1,n=!1;var r=e.ui.keyCode;switch(a.keyCode){case r.PAGE_UP:t=!0,this._move("previousPage",a);break;case r.PAGE_DOWN:t=!0,this._move("nextPage",a);break;case r.UP:t=!0,this._keyEvent("previous",a);break;case r.DOWN:t=!0,this._keyEvent("next",a);break;case r.ENTER:case r.NUMPAD_ENTER:this.menu.active&&(t=!0,a.preventDefault(),this.menu.select(a));break;case r.TAB:this.menu.active&&this.menu.select(a);break;case r.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(a),a.preventDefault());break;default:n=!0,this._searchTimeout(a)}},keypress:function(i){if(t)return t=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&i.preventDefault());if(!n){var a=e.ui.keyCode;switch(i.keyCode){case a.PAGE_UP:this._move("previousPage",i);break;case a.PAGE_DOWN:this._move("nextPage",i);break;case a.UP:this._keyEvent("previous",i);break;case a.DOWN:this._keyEvent("next",i)}}},input:function(e){return i?(i=!1,void e.preventDefault()):void this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),void this._change(e))}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var n=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(i){i.target===t.element[0]||i.target===n||e.contains(n,i.target)||t.close()})})},menufocus:function(t,n){if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)});var i=n.item.data("ui-autocomplete-item");!1!==this._trigger("focus",t,{item:i})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(i.value):this.liveRegion.text(i.value)},menuselect:function(e,t){var n=t.item.data("ui-autocomplete-item"),i=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=i,this._delay(function(){this.previous=i,this.selectedItem=n})),!1!==this._trigger("select",e,{item:n})&&this._value(n.value),this.term=this._value(),this.close(e),this.selectedItem=n}}),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,n,i=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(n,i){i(e.ui.autocomplete.filter(t,n.term))}):"string"==typeof this.options.source?(n=this.options.source,this.source=function(t,a){i.xhr&&i.xhr.abort(),i.xhr=e.ajax({url:n,data:t,dataType:"json",success:function(e){a(e)},error:function(){a([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var n=this.menu.element.empty();this._renderMenu(n,t),this.isNewMenu=!0,this.menu.refresh(),n.show(),this._resizeMenu(),n.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,n){var i=this;e.each(n,function(e,n){i._renderItemData(t,n)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,n){return e("<li>").append(e("<a>").text(n.label)).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this._value(this.term),void this.menu.blur()):void this.menu[e](t):void this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,n){var i=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(e){return i.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments),this.options.disabled||this.cancelSearch||(t=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.text(t))}})}(jQuery),function(e){e.widget("ui.menu",{version:"1.10.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,e.proxy(function(e){this.options.disabled&&e.preventDefault()
},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(t){var n=e(t.target).closest(".ui-menu-item");!this.mouseHandled&&n.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),n.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&e(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){var n=e(t.currentTarget);n.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,n)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var n=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,n)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){e(t.target).closest(".ui-menu").length||this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var i,a,r,o,s,l=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:l=!1,a=this.previousFilter||"",r=String.fromCharCode(t.keyCode),o=!1,clearTimeout(this.filterTimer),r===a?o=!0:r=a+r,s=new RegExp("^"+n(r),"i"),i=this.activeMenu.children(".ui-menu-item").filter(function(){return s.test(e(this).children("a").text())}),i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(r=String.fromCharCode(t.keyCode),s=new RegExp("^"+n(r),"i"),i=this.activeMenu.children(".ui-menu-item").filter(function(){return s.test(e(this).children("a").text())})),i.length?(this.focus(t,i),i.length>1?(this.previousFilter=r,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}l&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,n=this.options.icons.submenu,i=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),i.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.prev("a"),a=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(a),t.attr("aria-labelledby",i.attr("id"))}),t=i.add(this.element),t.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),t.children(":not(.ui-menu-item)").each(function(){var t=e(this);/[^\-\u2014\u2013\s]/.test(t.text())||t.addClass("ui-widget-content ui-menu-divider")}),t.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),this._super(e,t)},focus:function(e,t){var n,i;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),i=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",i.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),n=t.children(".ui-menu"),n.length&&e&&/^mouse/.test(e.type)&&this._startOpening(n),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var n,i,a,r,o,s;this._hasScroll()&&(n=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,i=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,a=t.offset().top-this.activeMenu.offset().top-n-i,r=this.activeMenu.scrollTop(),o=this.activeMenu.height(),s=t.height(),0>a?this.activeMenu.scrollTop(r+a):a+s>o&&this.activeMenu.scrollTop(r+a-o+s))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var n=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(n)},collapseAll:function(t,n){clearTimeout(this.timer),this.timer=this._delay(function(){var i=n?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));i.length||(i=this.element),this._close(i),this.blur(t),this.activeMenu=i},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,n){var i;this.active&&(i="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),i&&i.length&&this.active||(i=this.activeMenu.children(".ui-menu-item")[t]()),this.focus(n,i)},nextPage:function(t){var n,i,a;return this.active?void(this.isLastItem()||(this._hasScroll()?(i=this.active.offset().top,a=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return n=e(this),n.offset().top-i-a<0}),this.focus(t,n)):this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]()))):void this.next(t)},previousPage:function(t){var n,i,a;return this.active?void(this.isFirstItem()||(this._hasScroll()?(i=this.active.offset().top,a=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return n=e(this),n.offset().top-i+a>0}),this.focus(t,n)):this.focus(t,this.activeMenu.children(".ui-menu-item").first()))):void this.next(t)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var n={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,n)}})}(jQuery),function(e,t){var n="ui-effects-";e.effects={effect:{}},function(e,t){function n(e,t,n){var i=d[t.type]||{};return null==e?n||!t.def?null:t.def:(e=i.floor?~~e:parseFloat(e),isNaN(e)?t.def:i.mod?(e+i.mod)%i.mod:0>e?0:i.max<e?i.max:e)}function i(t){var n=c(),i=n._rgba=[];return t=t.toLowerCase(),p(l,function(e,a){var r,o=a.re.exec(t),s=o&&a.parse(o),l=a.space||"rgba";return s?(r=n[l](s),n[u[l].cache]=r[u[l].cache],i=n._rgba=r._rgba,!1):void 0}),i.length?("0,0,0,0"===i.join()&&e.extend(i,r.transparent),n):r[t]}function a(e,t,n){return n=(n+1)%1,1>6*n?e+(t-e)*n*6:1>2*n?t:2>3*n?e+(t-e)*(2/3-n)*6:e}var r,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",s=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],c=e.Color=function(t,n,i,a){return new e.Color.fn.parse(t,n,i,a)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},d={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},f=c.support={},h=e("<p>")[0],p=e.each;h.style.cssText="background-color:rgba(1,1,1,.5)",f.rgba=h.style.backgroundColor.indexOf("rgba")>-1,p(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),c.fn=e.extend(c.prototype,{parse:function(a,o,s,l){if(a===t)return this._rgba=[null,null,null,null],this;(a.jquery||a.nodeType)&&(a=e(a).css(o),o=t);var d=this,f=e.type(a),h=this._rgba=[];return o!==t&&(a=[a,o,s,l],f="array"),"string"===f?this.parse(i(a)||r._default):"array"===f?(p(u.rgba.props,function(e,t){h[t.idx]=n(a[t.idx],t)}),this):"object"===f?(a instanceof c?p(u,function(e,t){a[t.cache]&&(d[t.cache]=a[t.cache].slice())}):p(u,function(t,i){var r=i.cache;p(i.props,function(e,t){if(!d[r]&&i.to){if("alpha"===e||null==a[e])return;d[r]=i.to(d._rgba)}d[r][t.idx]=n(a[e],t,!0)}),d[r]&&e.inArray(null,d[r].slice(0,3))<0&&(d[r][3]=1,i.from&&(d._rgba=i.from(d[r])))}),this):void 0},is:function(e){var t=c(e),n=!0,i=this;return p(u,function(e,a){var r,o=t[a.cache];return o&&(r=i[a.cache]||a.to&&a.to(i._rgba)||[],p(a.props,function(e,t){return null!=o[t.idx]?n=o[t.idx]===r[t.idx]:void 0})),n}),n},_space:function(){var e=[],t=this;return p(u,function(n,i){t[i.cache]&&e.push(n)}),e.pop()},transition:function(e,t){var i=c(e),a=i._space(),r=u[a],o=0===this.alpha()?c("transparent"):this,s=o[r.cache]||r.to(o._rgba),l=s.slice();return i=i[r.cache],p(r.props,function(e,a){var r=a.idx,o=s[r],c=i[r],u=d[a.type]||{};null!==c&&(null===o?l[r]=c:(u.mod&&(c-o>u.mod/2?o+=u.mod:o-c>u.mod/2&&(o-=u.mod)),l[r]=n((c-o)*t+o,a)))}),this[a](l)},blend:function(t){if(1===this._rgba[3])return this;var n=this._rgba.slice(),i=n.pop(),a=c(t)._rgba;return c(e.map(n,function(e,t){return(1-i)*a[t]+i*e}))},toRgbaString:function(){var t="rgba(",n=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===n[3]&&(n.pop(),t="rgb("),t+n.join()+")"},toHslaString:function(){var t="hsla(",n=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===n[3]&&(n.pop(),t="hsl("),t+n.join()+")"},toHexString:function(t){var n=this._rgba.slice(),i=n.pop();return t&&n.push(~~(255*i)),"#"+e.map(n,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),c.fn.parse.prototype=c.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,n,i=e[0]/255,a=e[1]/255,r=e[2]/255,o=e[3],s=Math.max(i,a,r),l=Math.min(i,a,r),c=s-l,u=s+l,d=.5*u;return t=l===s?0:i===s?60*(a-r)/c+360:a===s?60*(r-i)/c+120:60*(i-a)/c+240,n=0===c?0:.5>=d?c/u:c/(2-u),[Math.round(t)%360,n,d,null==o?1:o]},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,n=e[1],i=e[2],r=e[3],o=.5>=i?i*(1+n):i+n-i*n,s=2*i-o;return[Math.round(255*a(s,o,t+1/3)),Math.round(255*a(s,o,t)),Math.round(255*a(s,o,t-1/3)),r]},p(u,function(i,a){var r=a.props,o=a.cache,l=a.to,u=a.from;c.fn[i]=function(i){if(l&&!this[o]&&(this[o]=l(this._rgba)),i===t)return this[o].slice();var a,s=e.type(i),d="array"===s||"object"===s?i:arguments,f=this[o].slice();return p(r,function(e,t){var i=d["object"===s?e:t.idx];null==i&&(i=f[t.idx]),f[t.idx]=n(i,t)}),u?(a=c(u(f)),a[o]=f,a):c(f)},p(r,function(t,n){c.fn[t]||(c.fn[t]=function(a){var r,o=e.type(a),l="alpha"===t?this._hsla?"hsla":"rgba":i,c=this[l](),u=c[n.idx];return"undefined"===o?u:("function"===o&&(a=a.call(this,u),o=e.type(a)),null==a&&n.empty?this:("string"===o&&(r=s.exec(a),r&&(a=u+parseFloat(r[2])*("+"===r[1]?1:-1))),c[n.idx]=a,this[l](c)))})})}),c.hook=function(t){var n=t.split(" ");p(n,function(t,n){e.cssHooks[n]={set:function(t,a){var r,o,s="";if("transparent"!==a&&("string"!==e.type(a)||(r=i(a)))){if(a=c(r||a),!f.rgba&&1!==a._rgba[3]){for(o="backgroundColor"===n?t.parentNode:t;(""===s||"transparent"===s)&&o&&o.style;)try{s=e.css(o,"backgroundColor"),o=o.parentNode}catch(l){}a=a.blend(s&&"transparent"!==s?s:"_default")}a=a.toRgbaString()}try{t.style[n]=a}catch(l){}}},e.fx.step[n]=function(t){t.colorInit||(t.start=c(t.elem,n),t.end=c(t.end),t.colorInit=!0),e.cssHooks[n].set(t.elem,t.start.transition(t.end,t.pos))}})},c.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return p(["Top","Right","Bottom","Left"],function(n,i){t["border"+i+"Color"]=e}),t}},r=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function n(t){var n,i,a=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,r={};if(a&&a.length&&a[0]&&a[a[0]])for(i=a.length;i--;)n=a[i],"string"==typeof a[n]&&(r[e.camelCase(n)]=a[n]);else for(n in a)"string"==typeof a[n]&&(r[n]=a[n]);return r}function i(t,n){var i,a,o={};for(i in n)a=n[i],t[i]!==a&&(r[i]||(e.fx.step[i]||!isNaN(parseFloat(a)))&&(o[i]=a));return o}var a=["add","remove","toggle"],r={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,n){e.fx.step[n]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(jQuery.style(e.elem,n,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(t,r,o,s){var l=e.speed(r,o,s);return this.queue(function(){var r,o=e(this),s=o.attr("class")||"",c=l.children?o.find("*").addBack():o;c=c.map(function(){var t=e(this);return{el:t,start:n(this)}}),r=function(){e.each(a,function(e,n){t[n]&&o[n+"Class"](t[n])})},r(),c=c.map(function(){return this.end=n(this.el[0]),this.diff=i(this.start,this.end),this}),o.attr("class",s),c=c.map(function(){var t=this,n=e.Deferred(),i=e.extend({},l,{queue:!1,complete:function(){n.resolve(t)}});return this.el.animate(this.diff,i),n.promise()}),e.when.apply(e,c.get()).done(function(){r(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),l.complete.call(o[0])})})},e.fn.extend({addClass:function(t){return function(n,i,a,r){return i?e.effects.animateClass.call(this,{add:n},i,a,r):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(n,i,a,r){return arguments.length>1?e.effects.animateClass.call(this,{remove:n},i,a,r):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(n){return function(i,a,r,o,s){return"boolean"==typeof a||a===t?r?e.effects.animateClass.call(this,a?{add:i}:{remove:i},r,o,s):n.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},a,r,o)}}(e.fn.toggleClass),switchClass:function(t,n,i,a,r){return e.effects.animateClass.call(this,{add:n,remove:t},i,a,r)}})}(),function(){function i(t,n,i,a){return e.isPlainObject(t)&&(n=t,t=t.effect),t={effect:t},null==n&&(n={}),e.isFunction(n)&&(a=n,i=null,n={}),("number"==typeof n||e.fx.speeds[n])&&(a=i,i=n,n={}),e.isFunction(i)&&(a=i,i=null),n&&e.extend(t,n),i=i||n.duration,t.duration=e.fx.off?0:"number"==typeof i?i:i in e.fx.speeds?e.fx.speeds[i]:e.fx.speeds._default,t.complete=a||n.complete,t}function a(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.10.4",save:function(e,t){for(var i=0;i<t.length;i++)null!==t[i]&&e.data(n+t[i],e[0].style[t[i]])},restore:function(e,i){var a,r;for(r=0;r<i.length;r++)null!==i[r]&&(a=e.data(n+i[r]),a===t&&(a=""),e.css(i[r],a))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var n,i;switch(e[0]){case"top":n=0;break;case"middle":n=.5;break;case"bottom":n=1;break;default:n=e[0]/t.height}switch(e[1]){case"left":i=0;break;case"center":i=.5;break;case"right":i=1;break;default:i=e[1]/t.width}return{x:i,y:n}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var n={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},i=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),a={width:t.width(),height:t.height()},r=document.activeElement;try{r.id}catch(o){r=document.body}return t.wrap(i),(t[0]===r||e.contains(t[0],r))&&e(r).focus(),i=t.parent(),"static"===t.css("position")?(i.css({position:"relative"}),t.css({position:"relative"})):(e.extend(n,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,i){n[i]=t.css(i),isNaN(parseInt(n[i],10))&&(n[i]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(a),i.css(n).show()},removeWrapper:function(t){var n=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===n||e.contains(t[0],n))&&e(n).focus()),t},setTransition:function(t,n,i,a){return a=a||{},e.each(n,function(e,n){var r=t.cssUnit(n);r[0]>0&&(a[n]=r[0]*i+r[1])}),a}}),e.fn.extend({effect:function(){function t(t){function i(){e.isFunction(r)&&r.call(a[0]),e.isFunction(t)&&t()}var a=e(this),r=n.complete,s=n.mode;(a.is(":hidden")?"hide"===s:"show"===s)?(a[s](),i()):o.call(a[0],n,i)}var n=i.apply(this,arguments),a=n.mode,r=n.queue,o=e.effects.effect[n.effect];return e.fx.off||!o?a?this[a](n.duration,n.complete):this.each(function(){n.complete&&n.complete.call(this)}):r===!1?this.each(t):this.queue(r||"fx",t)},show:function(e){return function(t){if(a(t))return e.apply(this,arguments);var n=i.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(t){if(a(t))return e.apply(this,arguments);var n=i.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(t){if(a(t)||"boolean"==typeof t)return e.apply(this,arguments);var n=i.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var n=this.css(t),i=[];return e.each(["em","px","%","pt"],function(e,t){n.indexOf(t)>0&&(i=[parseFloat(n),t])}),i}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,n){t[n]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,n=4;e<((t=Math.pow(2,--n))-1)/11;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,n){e.easing["easeIn"+t]=n,e.easing["easeOut"+t]=function(e){return 1-n(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?n(2*e)/2:1-n(-2*e+2)/2}})}()}(jQuery),define("jquery-ui",["jquery"],function(e){return function(){var t;return t||e.$}}(this)),function(e){"function"==typeof define&&define.amd?define("common/jquery.mousewheel",["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){function t(t){var o=t||window.event,s=l.call(arguments,1),c=0,d=0,f=0,h=0,p=0,m=0;if(t=e.event.fix(o),t.type="mousewheel","detail"in o&&(f=-1*o.detail),"wheelDelta"in o&&(f=o.wheelDelta),"wheelDeltaY"in o&&(f=o.wheelDeltaY),"wheelDeltaX"in o&&(d=-1*o.wheelDeltaX),"axis"in o&&o.axis===o.HORIZONTAL_AXIS&&(d=-1*f,f=0),c=0===f?d:f,"deltaY"in o&&(f=-1*o.deltaY,c=f),"deltaX"in o&&(d=o.deltaX,0===f&&(c=-1*d)),0!==f||0!==d){if(1===o.deltaMode){var g=e.data(this,"mousewheel-line-height");c*=g,f*=g,d*=g}else if(2===o.deltaMode){var v=e.data(this,"mousewheel-page-height");c*=v,f*=v,d*=v}if(h=Math.max(Math.abs(f),Math.abs(d)),(!r||r>h)&&(r=h,i(o,h)&&(r/=40)),i(o,h)&&(c/=40,d/=40,f/=40),c=Math[c>=1?"floor":"ceil"](c/r),d=Math[d>=1?"floor":"ceil"](d/r),f=Math[f>=1?"floor":"ceil"](f/r),u.settings.normalizeOffset&&this.getBoundingClientRect){var b=this.getBoundingClientRect();p=t.clientX-b.left,m=t.clientY-b.top}return t.deltaX=d,t.deltaY=f,t.deltaFactor=r,t.offsetX=p,t.offsetY=m,t.deltaMode=0,s.unshift(t,c,d,f),a&&clearTimeout(a),a=setTimeout(n,200),(e.event.dispatch||e.event.handle).apply(this,s)}}function n(){r=null}function i(e,t){return u.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120===0}var a,r,o=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],s="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],l=Array.prototype.slice;if(e.event.fixHooks)for(var c=o.length;c;)e.event.fixHooks[o[--c]]=e.event.mouseHooks;var u=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var n=s.length;n;)this.addEventListener(s[--n],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",u.getLineHeight(this)),e.data(this,"mousewheel-page-height",u.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var n=s.length;n;)this.removeEventListener(s[--n],t,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var n=e(t),i=n["offsetParent"in e.fn?"offsetParent":"parent"]();return i.length||(i=e("body")),parseInt(i.css("fontSize"),10)||parseInt(n.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),function(e){"function"==typeof define&&define.amd?define("common/jquery.caret",["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){var t="length",n="createRange",i="duplicate";e.fn.caret=function(e,a){if("undefined"==typeof this[0]||this.is(":hidden")||"hidden"===this.css("visibility"))return this;var r,o,s,l,c,u,d,f,h,p=document.selection,m=this[0],g=m.scrollTop,v=!1,b=!0;try{v="undefined"!=typeof m.selectionStart}catch(C){b=!1}return"object"==typeof e&&e.start&&e.end?(o=e.start,l=e.end):"number"==typeof e&&"number"==typeof a&&(o=e,l=a),b&&"undefined"!=typeof o?(v?(m.selectionStart=o,m.selectionEnd=l):(c=m.createTextRange(),c.collapse(!0),c.moveStart("character",o),c.moveEnd("character",l-o),c.select()),(this.is(":visible")||"hidden"!==this.css("visibility"))&&(this.is(":focus")||this.focus()),m.scrollTop=g,this):(v?(r=m.selectionStart,s=m.selectionEnd):p?"TEXTAREA"===m.tagName?(h=this.val(),u=p[n](),d=u[i](),d.moveToElementText(m),d.setEndPoint("EndToEnd",u),r=d.text.replace(/\r/g,"\n")[t],s=r+u.text.replace(/\r/g,"\n")[t]):(h=this.val().replace(/\r/g,"\n"),u=p[n]()[i](),u.moveEnd("character",h[t]),r=""===u.text?h[t]:h.lastIndexOf(u.text),u=p[n]()[i](),u.moveStart("character",-h[t]),s=u.text[t]):(r=0,s=(m.value||"").length),f=(m.value||"").substring(r,s),{start:r,end:s,text:f,replace:function(e){return m.value.substring(0,r)+e+m.value.substring(s,m.value[t])}})}}),function(e){"function"==typeof define&&define.amd?define("common/jquery.keyboard",["jquery","jquery-ui","common/jquery.mousewheel","common/jquery.caret"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){e.keyboard=function(t,n){var i,a=this;a.version="1.18.12",a.$el=e(t),a.el=t,a.$el.data("keyboard",a),a.init=function(){a.options=i=e.extend(!0,{},e.keyboard.defaultOptions,n),a.shiftActive=a.altActive=a.metaActive=a.sets=a.capsLock=!1,a.lastKeyset=[!1,!1,!1],a.rows=["","-shift","-alt","-alt-shift"],e('<!--[if lte IE 8]><script>jQuery("body").addClass("oldie");</script><![endif]--><!--[if IE]><script>jQuery("body").addClass("ie");</script><![endif]-->').appendTo("body").remove(),a.msie=e("body").hasClass("oldie"),a.allie=e("body").hasClass("ie"),a.inPlaceholder=a.$el.attr("placeholder")||"",a.watermark="undefined"!=typeof document.createElement("input").placeholder&&""!==a.inPlaceholder,a.regex=e.keyboard.comboRegex,a.decimal=/^\./.test(i.display.dec)?!0:!1,a.repeatTime=1e3/(i.repeatRate||20),i.preventDoubleEventTime=i.preventDoubleEventTime||100,a.isOpen=!1,a.wheel=e.isFunction(e.fn.mousewheel),a.alwaysAllowed=[20,33,34,35,36,37,38,39,40,45,46],a.$keyboard=[],a.lastCaret={start:0,end:0},a.temp=["",0,0],e.each("initialized beforeVisible visible hidden canceled accepted beforeClose".split(" "),function(t,n){e.isFunction(i[n])&&a.$el.bind(n+".keyboard",i[n])}),i.alwaysOpen&&(i.stayOpen=!0),e(document).bind("mousedown keyup touchstart checkkeyboard ".split(" ").join(".keyboard "),function(t){if(!a.opening&&(a.escClose(t),t.target&&e(t.target).hasClass("ui-keyboard-input"))){var n=e(t.target).data("keyboard");n===a&&n.options.openOn&&n.focusOn()}}),a.$el.addClass("ui-keyboard-input "+i.css.input).attr({"aria-haspopup":"true",role:"textbox"}),(a.$el.is(":disabled")||a.$el.attr("readonly")&&!a.$el.hasClass("ui-keyboard-lockedinput"))&&a.$el.addClass("ui-keyboard-nokeyboard"),i.openOn&&a.$el.bind(i.openOn+".keyboard",function(){a.focusOn()}),a.watermark||""!==a.$el.val()||""===a.inPlaceholder||""===a.$el.attr("placeholder")||a.$el.addClass("ui-keyboard-placeholder").val(a.inPlaceholder),a.$el.trigger("initialized.keyboard",[a,a.el]),i.alwaysOpen&&a.reveal()},a.setCurrent=function(){e(".ui-keyboard-has-focus").removeClass("ui-keyboard-has-focus"),e(".ui-keyboard-input-current").removeClass("ui-keyboard-input-current"),a.$el.addClass("ui-keyboard-input-current"),a.$keyboard.addClass("ui-keyboard-has-focus"),a.isCurrent(!0),a.isOpen=!0},a.isCurrent=function(t){var n=e.keyboard.currentKeyboard||!1;return t?n=e.keyboard.currentKeyboard=a.el:t===!1&&n===a.el&&(n=e.keyboard.currentKeyboard=""),n===a.el},a.isVisible=function(){return a.$keyboard&&a.$keyboard.length?a.$keyboard.is(":visible"):!1},a.focusOn=function(){a.$el.is(":visible")&&setTimeout(function(){"number"!=a.$el.attr("type")&&(a.lastCaret=a.$el.caret())},20),a.isVisible()||(clearTimeout(a.timer),a.reveal()),i.alwaysOpen&&a.setCurrent()},a.reveal=function(){var t,n;return a.opening=!0,e(".ui-keyboard").not(".ui-keyboard-always-open").remove(),a.$el.is(":disabled")||a.$el.attr("readonly")&&!a.$el.hasClass("ui-keyboard-lockedinput")?void a.$el.addClass("ui-keyboard-nokeyboard"):(a.$el.removeClass("ui-keyboard-nokeyboard"),i.openOn&&a.$el.unbind(i.openOn+".keyboard"),(!a.$keyboard||a.$keyboard&&(!a.$keyboard.length||e.contains(document.body,a.$keyboard[0])))&&a.startup(),a.watermark||a.el.value!==a.inPlaceholder||a.$el.removeClass("ui-keyboard-placeholder").val(""),a.originalContent=a.$el.val(),a.$preview.val(a.originalContent),i.acceptValid&&a.checkValid(),i.resetDefault&&(a.shiftActive=a.altActive=a.metaActive=!1,a.showKeySet()),i.appendLocally||"body"!==i.appendTo||a.$keyboard.css({position:"absolute",left:0,top:0}),a.$el.trigger("beforeVisible.keyboard",[a,a.el]),a.setCurrent(),a.$keyboard.show(),i.usePreview&&a.msie&&("undefined"==typeof a.width&&(a.$preview.hide(),a.width=Math.ceil(a.$keyboard.width()),a.$preview.show()),a.$preview.width(a.width)),a.position=i.position,e.ui&&e.ui.position&&!e.isEmptyObject(a.position)&&(a.position.of=a.position.of||a.$el.data("keyboardPosition")||a.$el,a.position.collision=a.position.collision||"flipfit flipfit",a.$keyboard.position(a.position)),a.checkDecimal(),a.lineHeight=parseInt(a.$preview.css("lineHeight"),10)||parseInt(a.$preview.css("font-size"),10)+4,i.caretToEnd&&(n=a.originalContent.length,a.lastCaret={start:n,end:n}),a.allie&&(n=a.lastCaret.start||a.originalContent.length,t={start:n,end:n},a.lastCaret||(a.lastCaret=t),0===a.lastCaret.end&&a.lastCaret.start>0&&(a.lastCaret.end=a.lastCaret.start),a.lastCaret.start<0&&(a.lastCaret=t)),setTimeout(function(){a.opening=!1,i.initialFocus&&a.$preview.focus().caret(a.lastCaret),a.$el.trigger("visible.keyboard",[a,a.el])},10),a)},a.startup=function(){a.$keyboard&&a.$keyboard.length||("custom"===i.layout&&(i.layoutHash="custom"+a.customHash()),a.layout="custom"===i.layout?i.layoutHash:i.layout,"undefined"==typeof e.keyboard.builtLayouts[a.layout]&&(e.isFunction(i.create)&&i.create(a),a.$keyboard.length||a.buildKeyboard()),a.$keyboard=e.keyboard.builtLayouts[a.layout].$keyboard.clone(),i.usePreview?(a.$preview=a.$el.clone(!1).removeAttr("id").removeClass("ui-keyboard-placeholder ui-keyboard-input").addClass("ui-keyboard-preview "+i.css.input).removeAttr("aria-haspopup").attr("tabindex","-1").show(),"number"==a.$preview.attr("type")&&a.$preview.attr("type","text"),e("<div />").addClass("ui-keyboard-preview-wrapper").append(a.$preview).prependTo(a.$keyboard)):(a.$preview=a.$el,e.isEmptyObject(a.position)||(i.position.at=i.position.at2))),a.preview=a.$preview[0],a.$decBtn=a.$keyboard.find(".ui-keyboard-dec"),(i.enterNavigation||"TEXTAREA"===a.el.tagName)&&a.alwaysAllowed.push(13),i.lockInput&&a.$preview.addClass("ui-keyboard-lockedinput").attr({readonly:"readonly"}),a.bindKeyboard(),a.$keyboard.appendTo(i.appendLocally?a.$el.parent():i.appendTo||"body"),a.bindKeys(),e.ui&&e.ui.position&&!e.isEmptyObject(a.position)&&e(window).bind("resize.keyboard",function(){a.isVisible()&&a.$keyboard.position(a.position)})},a.bindKeyboard=function(){var t=e.keyboard.builtLayouts[a.layout];a.$preview.unbind("keypress keyup keydown mouseup touchend ".split(" ").join(".keyboard ")).bind("keypress.keyboard",function(n){var r=a.lastKey=String.fromCharCode(n.charCode||n.which);
if(a.$lastKey=[],a.checkCaret&&(a.lastCaret=a.$preview.caret()),a.capsLock=r>=65&&90>=r&&!n.shiftKey||r>=97&&122>=r&&n.shiftKey?!0:!1,i.restrictInput){if((8===n.which||0===n.which)&&e.inArray(n.keyCode,a.alwaysAllowed))return;-1===e.inArray(r,t.acceptedKeys)&&n.preventDefault()}else if((n.ctrlKey||n.metaKey)&&(97===n.which||99===n.which||118===n.which||n.which>=120&&n.which<=122))return;t.hasMappedKeys&&t.mappedKeys.hasOwnProperty(r)&&(a.lastKey=t.mappedKeys[r],a.insertText(a.lastKey),n.preventDefault()),a.checkMaxLength()}).bind("keyup.keyboard",function(t){switch(t.which){case 9:if(a.tab&&i.tabNavigation&&!i.lockInput){a.shiftActive=t.shiftKey;var n=e.keyboard.keyaction.tab(a);if(a.tab=!1,!n)return!1}else t.preventDefault();break;case 27:return a.close(),!1}clearTimeout(a.throttled),a.throttled=setTimeout(function(){a.isVisible()&&a.checkCombos()},100),a.checkMaxLength(),e.isFunction(i.change)&&i.change(e.Event("change"),a,a.el),a.$el.trigger("change.keyboard",[a,a.el])}).bind("keydown.keyboard",function(t){switch(t.which){case 8:e.keyboard.keyaction.bksp(a,null,t),t.preventDefault();break;case 9:return i.tabNavigation?(a.tab=!0,!1):(a.tab=!0,!1);case 13:e.keyboard.keyaction.enter(a,null,t);break;case 20:a.shiftActive=a.capsLock=!a.capsLock,a.showKeySet(this);break;case 86:if(t.ctrlKey||t.metaKey){if(i.preventPaste)return void t.preventDefault();a.checkCombos()}}}).bind("mouseup.keyboard touchend.keyboard",function(){a.checkCaret&&(a.lastCaret=a.$preview.caret())}),a.$keyboard.bind("mousedown.keyboard click.keyboard touchstart.keyboard",function(t){t.stopPropagation(),a.isCurrent()||(a.reveal(),e(document).trigger("checkkeyboard.keyboard"))}),i.preventPaste&&(a.$preview.bind("contextmenu.keyboard",function(e){e.preventDefault()}),a.$el.bind("contextmenu.keyboard",function(e){e.preventDefault()}))},a.bindKeys=function(){var t=(i.keyBinding+" repeater mouseenter mouseleave touchstart mousewheel mouseup click ").split(" ").join(".keyboard ")+"mouseleave mousedown touchstart touchend touchmove touchcancel ".split(" ").join(".kb ");a.$allKeys=a.$keyboard.find("button.ui-keyboard-button").unbind(t).bind(i.keyBinding.split(" ").join(".keyboard ")+".keyboard repeater.keyboard",function(t){if(!a.$keyboard.is(":visible"))return!1;var n,r=e(this),o=r.attr("data-action"),s=(new Date).getTime();if(o=":"===o?":":o.split(":")[0],!(s-(a.lastEventTime||0)<i.preventDoubleEventTime)){if(a.lastEventTime=s,a.$preview.focus(),a.$lastKey=r,a.lastKey=r.attr("data-curtxt"),a.checkCaret&&a.$preview.caret(a.lastCaret),o.match("meta")&&(o="meta"),e.keyboard.keyaction.hasOwnProperty(o)&&e(this).hasClass("ui-keyboard-actionkey")){if(e.keyboard.keyaction[o](a,this,t)===!1)return!1}else"undefined"!=typeof o&&(n=a.lastKey=a.wheel&&!e(this).hasClass("ui-keyboard-actionkey")?a.lastKey:o,a.insertText(n),a.capsLock||i.stickyShift||t.shiftKey||(a.shiftActive=!1,a.showKeySet(this)));a.$preview.focus().caret(a.lastCaret),a.checkCombos(),a.checkMaxLength(),e.isFunction(i.change)&&i.change(e.Event("change"),a,a.el),a.$el.trigger("change.keyboard",[a,a.el]),t.preventDefault()}}).bind("mouseenter.keyboard mouseleave.keyboard touchstart.keyboard",function(t){if(a.isCurrent()){var n=e(this),r=n.data("layers")||a.getLayers(n);n.data("layers",r=e.grep(r,function(t,n){return e.inArray(t,r)===n})),"mouseenter"!==t.type&&"touchstart"!==t.type||"password"===a.el.type||n.hasClass(i.css.buttonDisabled)||n.addClass(i.css.buttonHover).attr("title",function(e,n){return a.wheel&&""===n&&a.sets&&r.length>1&&"touchstart"!==t.type?i.wheelMessage:n}),"mouseleave"===t.type&&(n.data({curtxt:n.data("original"),curnum:0}),n.removeClass("password"===a.el.type?"":i.css.buttonHover).attr("title",function(e,t){return t===i.wheelMessage?"":t}).find("span").html(n.data("original")))}}).bind("mousewheel.keyboard",function(t,n){if(a.wheel){n=n||t.deltaY;var i,r,o=e(this);return r=o.data("layers")||a.getLayers(o),r.length>1?(i=o.data("curnum")+(n>0?-1:1),i>r.length-1&&(i=0),0>i&&(i=r.length-1)):i=0,o.data({curnum:i,layers:r,curtxt:r[i]}),o.find("span").html(r[i]),!1}}).bind("mouseup.keyboard mouseleave.kb touchend.kb touchmove.kb touchcancel.kb",function(t){return/(mouseleave|touchend|touchcancel)/.test(t.type)?e(this).removeClass(i.css.buttonHover):(a.isVisible()&&a.isCurrent()&&a.$preview.focus(),a.checkCaret&&a.$preview.caret(a.lastCaret)),a.mouseRepeat=[!1,""],clearTimeout(a.repeater),!1}).bind("click.keyboard",function(){return!1}).not(".ui-keyboard-actionkey").add(".ui-keyboard-tab, .ui-keyboard-bksp, .ui-keyboard-space, .ui-keyboard-enter",a.$keyboard).bind("mousedown.kb touchstart.kb",function(){if(0!==i.repeatRate){var t=e(this);a.mouseRepeat=[!0,t],setTimeout(function(){a.mouseRepeat[0]&&a.mouseRepeat[1]===t&&a.repeatKey(t)},i.repeatDelay)}return!1})},a.insertText=function(e){var t,n,i,r=a.$preview.val(),o=a.$preview.caret(),s=a.$preview.scrollLeft(),l=a.$preview.scrollTop(),c=r.length;o.end<o.start&&(o.end=o.start),o.start>c&&(o.end=o.start=c),"TEXTAREA"===a.preview.tagName&&(a.msie&&"\n"===r.substr(o.start,1)&&(o.start+=1,o.end+=1),i=r.split("\n").length-1,a.preview.scrollTop=i>0?a.lineHeight*i:l),t="bksp"===e&&o.start===o.end?!0:!1,e="bksp"===e?"":e,n=o.start+(t?-1:e.length),s+=parseInt(a.$preview.css("fontSize"),10)*("bksp"===e?-1:1),a.$preview.val(a.$preview.val().substr(0,o.start-(t?1:0))+e+a.$preview.val().substr(o.end)).scrollLeft(s).caret(n,n),a.lastCaret={start:n,end:n}},a.checkMaxLength=function(){var e,t=a.$preview.val();i.maxLength!==!1&&t.length>i.maxLength&&(e=Math.min(a.$preview.caret().start,i.maxLength),a.$preview.val(t.substring(0,i.maxLength)),a.$preview.caret(e,e),a.lastCaret={start:e,end:e}),a.$decBtn.length&&a.checkDecimal()},a.repeatKey=function(e){e.trigger("repeater.keyboard"),a.mouseRepeat[0]&&(a.repeater=setTimeout(function(){a.repeatKey(e)},a.repeatTime))},a.showKeySet=function(e){var t="",n=(a.shiftActive?1:0)+(a.altActive?2:0);return a.shiftActive||(a.capsLock=!1),a.metaActive?(t=e&&e.name&&/meta/.test(e.name)?e.name:"",""===t?t=a.metaActive===!0?"":a.metaActive:a.metaActive=t,(!i.stickyShift&&a.lastKeyset[2]!==a.metaActive||(a.shiftActive||a.altActive)&&!a.$keyboard.find(".ui-keyboard-keyset-"+t+a.rows[n]).length)&&(a.shiftActive=a.altActive=!1)):!i.stickyShift&&a.lastKeyset[2]!==a.metaActive&&a.shiftActive&&(a.shiftActive=a.altActive=!1),n=(a.shiftActive?1:0)+(a.altActive?2:0),t=0!==n||a.metaActive?""===t?"":"-"+t:"-default",a.$keyboard.find(".ui-keyboard-keyset"+t+a.rows[n]).length?(a.$keyboard.find(".ui-keyboard-alt, .ui-keyboard-shift, .ui-keyboard-actionkey[class*=meta]").removeClass(i.css.buttonAction).end().find(".ui-keyboard-alt")[a.altActive?"addClass":"removeClass"](i.css.buttonAction).end().find(".ui-keyboard-shift")[a.shiftActive?"addClass":"removeClass"](i.css.buttonAction).end().find(".ui-keyboard-lock")[a.capsLock?"addClass":"removeClass"](i.css.buttonAction).end().find(".ui-keyboard-keyset").hide().end().find(".ui-keyboard-keyset"+t+a.rows[n]).show().end().find(".ui-keyboard-actionkey.ui-keyboard"+t).addClass(i.css.buttonAction),void(a.lastKeyset=[a.shiftActive,a.altActive,a.metaActive])):(a.shiftActive=a.lastKeyset[0],a.altActive=a.lastKeyset[1],void(a.metaActive=a.lastKeyset[2]))},a.checkCombos=function(){if(!a.isVisible())return a.$preview.val();var t,n,r,o,s=a.$preview.val(),l=a.$preview.caret(),c=e.keyboard.builtLayouts[a.layout],u=s.length;if(l.end<l.start&&(l.end=l.start),l.start>u&&(l.end=l.start=u),a.msie&&"\n"===s.substr(l.start,1)&&(l.start+=1,l.end+=1),i.useCombos&&(a.msie?s=s.replace(a.regex,function(e,t,n){return i.combos.hasOwnProperty(t)?i.combos[t][n]||e:e}):a.$preview.length&&(r=l.start-(l.start-2>=0?2:0),a.$preview.caret(r,l.end),o=(a.$preview.caret().text||"").replace(a.regex,function(e,t,n){return i.combos.hasOwnProperty(t)?i.combos[t][n]||e:e}),a.$preview.val(a.$preview.caret().replace(o)),s=a.$preview.val())),i.restrictInput&&""!==s){for(r=s,n=c.acceptedKeys.length,t=0;n>t;t++)""!==r&&(o=c.acceptedKeys[t],s.indexOf(o)>=0&&(/[\[|\]|\\|\^|\$|\.|\||\?|\*|\+|\(|\)|\{|\}]/g.test(o)&&(o="\\"+o),r=r.replace(new RegExp(o,"g"),"")));""!==r&&(s=s.replace(r,""))}return l.start+=s.length-u,l.end+=s.length-u,a.$preview.val(s),a.$preview.caret(l.start,l.end),a.preview.scrollTop=a.lineHeight*(s.substring(0,l.start).split("\n").length-1),a.lastCaret={start:l.start,end:l.end},i.acceptValid&&a.checkValid(),s},a.checkValid=function(){var e=!0;i.validate&&"function"==typeof i.validate&&(e=i.validate(a,a.$preview.val(),!1)),a.$keyboard.find(".ui-keyboard-accept")[e?"removeClass":"addClass"]("ui-keyboard-invalid-input")[e?"addClass":"removeClass"]("ui-keyboard-valid-input")},a.checkDecimal=function(){a.decimal&&/\./g.test(a.preview.value)||!a.decimal&&/\,/g.test(a.preview.value)?a.$decBtn.attr({disabled:"disabled","aria-disabled":"true"}).removeClass(i.css.buttonDefault+" "+i.css.buttonHover).addClass(i.css.buttonDisabled):a.$decBtn.prop("disabled",!1).attr({"aria-disabled":"false"}).addClass(i.css.buttonDefault).removeClass(i.css.buttonDisabled)},a.getLayers=function(t){var n,i;return n=t.attr("data-pos"),i=t.closest(".ui-keyboard").find('button[data-pos="'+n+'"]').map(function(){return e(this).find("> span").html()}).get()},a.switchInput=function(t,n){if("function"==typeof i.switchInput)i.switchInput(a,t,n);else{a.$keyboard.hide();var r,o=!1,s=e("button, input, textarea, a:not(.dk_toggle.dk_label), .dk_container").filter(":visible"),l=s.index(a.$el)+(t?1:-1);if(a.$keyboard.show(),l>s.length-1&&(o=i.stopAtEnd,l=0),0>l&&(o=i.stopAtEnd,l=s.length-1),!o){if(n=a.close(n),!n)return;r=s.eq(l).data("keyboard"),r&&r.options.openOn.length?r.focusOn():s.eq(l).focus()}}return!1},a.close=function(t){if(a.isOpen){clearTimeout(a.throttled);var n=t?a.checkCombos():a.originalContent;if(t&&i.validate&&"function"==typeof i.validate&&!i.validate(a,n,!0)&&(n=a.originalContent,t=!1,i.cancelClose))return;a.isCurrent(!1),a.isOpen=!1,a.$preview.val(n),a.$el.removeClass("ui-keyboard-input-current ui-keyboard-autoaccepted").addClass(t?t===!0?"":"ui-keyboard-autoaccepted":"").trigger(i.alwaysOpen?"":"beforeClose.keyboard",[a,a.el,t||!1]).val(n).scrollTop(a.el.scrollHeight).trigger(t?"accepted.keyboard":"canceled.keyboard",[a,a.el]).trigger(i.alwaysOpen?"inactive.keyboard":"hidden.keyboard",[a,a.el]).blur(),i.openOn&&(a.timer=setTimeout(function(){a.$el.bind(i.openOn+".keyboard",function(){a.focusOn()}),e(":focus")[0]===a.el&&a.$el.blur()},500)),!i.alwaysOpen&&a.$keyboard&&(a.$keyboard.remove(),a.$keyboard=[]),a.watermark||""!==a.el.value||""===a.inPlaceholder||a.$el.addClass("ui-keyboard-placeholder").val(a.inPlaceholder),a.$el.trigger("change")}return!!t},a.accept=function(){return a.close(!0)},a.escClose=function(e){return e&&"keyup"===e.type?27===e.which?a.close():"":void(a.isOpen&&(!a.isCurrent()&&a.isOpen||a.isOpen&&e.target!==a.el&&!i.stayOpen)&&(a.allie&&e.preventDefault(),a.close(i.autoAccept?"true":!1)))},a.keyBtn=e("<button />").attr({role:"button",type:"button","aria-disabled":"false",tabindex:"-1"}).addClass("ui-keyboard-button"),a.addKey=function(t,n,r){var o,s,l,c,u,d=r===!0?t:i.display[n]||t,f=r===!0?t.charCodeAt(0):t;return/\(.+\)/.test(d)&&(c=d.replace(/\(([^()]+)\)/,""),l=d.match(/\(([^()]+)\)/)[1],d=c,u=c.split(":"),c=""!==u[0]&&u.length>1?u[0]:c,e.keyboard.builtLayouts[a.layout].mappedKeys[l]=c),u=d.split(":"),""===u[0]&&""===u[1]&&(d=":"),d=""!==u[0]&&u.length>1?e.trim(u[0]):d,o=u.length>1?e.trim(u[1]).replace(/_/g," ")||"":"",s=d.length>1?" ui-keyboard-widekey":"",s+=r?"":" ui-keyboard-actionkey",a.keyBtn.clone().attr({"data-value":d,name:f,"data-pos":a.temp[1]+","+a.temp[2],title:o,"data-action":t,"data-original":d,"data-curtxt":d,"data-curnum":0}).addClass((""===f?"":"ui-keyboard-"+f+s+" ")+i.css.buttonDefault).html("<span>"+d+"</span>").appendTo(a.temp[0])},a.customHash=function(){var e,t,n,a,r,o=i.customLayout,s=[],l=[];for(t in o)o.hasOwnProperty(t)&&s.push(o[t]);if(l=l.concat.apply(l,s).join(" "),n=0,r=l.length,0===r)return n;for(e=0;r>e;e++)a=l.charCodeAt(e),n=(n<<5)-n+a,n&=n;return n},a.buildKeyboard=function(){var t,n,r,o,s,l,c,u,d,f=0,h=e.keyboard.builtLayouts[a.layout]={mappedKeys:{},acceptedKeys:[]},p=h.acceptedKeys=[],m=e("<div />").addClass("ui-keyboard "+i.css.container+(i.alwaysOpen?" ui-keyboard-always-open":"")).attr({role:"textbox"}).hide();return"custom"!==i.layout&&e.keyboard.layouts.hasOwnProperty(i.layout)||(i.layout="custom",e.keyboard.layouts.custom=i.customLayout||{"default":["{cancel}"]}),e.each(e.keyboard.layouts[i.layout],function(h,g){if(""!==h)for(f++,o=e("<div />").attr("name",h).addClass("ui-keyboard-keyset ui-keyboard-keyset-"+h).appendTo(m)["default"===h?"show":"hide"](),r=0;r<g.length;r++){for(l=e.trim(g[r]).replace(/\{(\.?)[\s+]?:[\s+]?(\.?)\}/g,"{$1:$2}"),u=l.split(/\s+/),c=0;c<u.length;c++)if(a.temp=[o,r,c],s=!1,0!==u[c].length)if(/^\{\S+\}$/.test(u[c])){if(n=u[c].match(/^\{(\S+)\}$/)[1].toLowerCase(),/\!\!/.test(n)&&(n=n.replace("!!",""),s=!0),/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/.test(n)&&(d=parseFloat(n.replace(/,/,".").match(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/)[1]||0),e("<span>&nbsp;</span>").width(n.match("px")?d+"px":2*d+"em").addClass("ui-keyboard-button ui-keyboard-spacer").appendTo(o)),/^empty(:((\d+)?([\.|,]\d+)?)(em|px)?)?$/.test(n)&&(d=/:/.test(n)?parseFloat(n.replace(/,/,".").match(/^empty:((\d+)?([\.|,]\d+)?)(em|px)?$/)[1]||0):"",a.addKey(""," ").addClass(i.css.buttonDisabled+" "+i.css.buttonEmpty).attr("aria-disabled",!0).width(d?n.match("px")?d+"px":2*d+"em":"")),/^meta\d+\:?(\w+)?/.test(n)){a.addKey(n,n);continue}switch(n){case"a":case"accept":a.addKey("accept",n).addClass(i.css.buttonAction);break;case"alt":case"altgr":a.addKey("alt","alt");break;case"b":case"bksp":a.addKey("bksp",n);break;case"c":case"cancel":a.addKey("cancel",n).addClass(i.css.buttonAction);break;case"combo":a.addKey("combo","combo").addClass(i.css.buttonAction);break;case"dec":p.push(a.decimal?".":","),a.addKey("dec","dec");break;case"e":case"enter":a.addKey("enter",n).addClass(i.css.buttonAction);break;case"s":case"shift":a.addKey("shift",n);break;case"sign":p.push("-"),a.addKey("sign","sign");break;case"space":p.push(" "),a.addKey("space","space");break;case"t":case"tab":a.addKey("tab",n);break;default:e.keyboard.keyaction.hasOwnProperty(n)&&a.addKey(n,n)[s?"addClass":"removeClass"](i.css.buttonAction)}}else t=u[c],p.push(":"===t?t:t.split(":")[0]),a.addKey(t,t,!0);o.find(".ui-keyboard-button:last").after('<br class="ui-keyboard-button-endrow">')}}),f>1&&(a.sets=!0),h.hasMappedKeys=!e.isEmptyObject(h.mappedKeys),h.$keyboard=m,m},a.destroy=function(){e(document).unbind("mousedown.keyboard keyup.keyboard touchstart.keyboard"),a.$keyboard.length&&a.$keyboard.remove();var t=e.trim(i.openOn+" accepted beforeClose canceled change contextmenu hidden initialized keydown keypress keyup visible ").split(" ").join(".keyboard ");a.$el.removeClass("ui-keyboard-input ui-keyboard-lockedinput ui-keyboard-placeholder ui-keyboard-notallowed ui-keyboard-always-open "+i.css.input).removeAttr("aria-haspopup").removeAttr("role").unbind(t+".keyboard").removeData("keyboard")},a.init()},e.keyboard.keyaction={accept:function(e){return e.close(!0),!1},alt:function(e,t){e.altActive=!e.altActive,e.showKeySet(t)},bksp:function(e){e.insertText("bksp")},cancel:function(e){return e.close(),!1},clear:function(e){e.$preview.val("")},combo:function(e){var t=!e.options.useCombos;return e.options.useCombos=t,e.$keyboard.find(".ui-keyboard-combo").toggleClass(e.options.css.buttonAction,t),t&&e.checkCombos(),!1},dec:function(e){e.insertText(e.decimal?".":",")},"default":function(e,t){e.shiftActive=e.altActive=e.metaActive=!1,e.showKeySet(t)},enter:function(t,n,i){var a=t.el.tagName,r=t.options;return i.shiftKey?r.enterNavigation?t.switchInput(!i[r.enterMod],!0):t.close(!0):r.enterNavigation&&("TEXTAREA"!==a||i[r.enterMod])?t.switchInput(!i[r.enterMod],r.autoAccept?"true":!1):void("TEXTAREA"===a&&e(i.target).closest("button").length&&t.insertText(" \n"))},lock:function(e,t){e.lastKeyset[0]=e.shiftActive=e.capsLock=!e.capsLock,e.showKeySet(t)},left:function(e){var t=e.$preview.caret();t.start-1>=0&&(e.lastCaret={start:t.start-1,end:t.start-1})},meta:function(t,n){t.metaActive=e(n).hasClass(t.options.css.buttonAction)?!1:!0,t.showKeySet(n)},next:function(e){return e.switchInput(!0,e.options.autoAccept),!1},prev:function(e){return e.switchInput(!1,e.options.autoAccept),!1},right:function(e){var t=e.$preview.caret();t.start+1<=e.$preview.val().length&&(e.lastCaret={start:t.start+1,end:t.start+1})},shift:function(e,t){e.lastKeyset[0]=e.shiftActive=!e.shiftActive,e.showKeySet(t)},sign:function(e){/^\-?\d*\.?\d*$/.test(e.$preview.val())&&e.$preview.val(-1*e.$preview.val())},space:function(e){e.insertText(" ")},tab:function(e){var t=e.el.tagName,n=e.options;return"INPUT"===t?n.tabNavigation?e.switchInput(!e.shiftActive,!0):!1:void e.insertText("	")}},e.keyboard.builtLayouts={},e.keyboard.layouts={alpha:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} a b c d e f g h i j [ ] \\","k l m n o p q r s ; ' {enter}","{shift} t u v w x y z , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} A B C D E F G H I J { } |",'K L M N O P Q R S : " {enter}',"{shift} T U V W X Y Z < > ? {shift}","{accept} {space} {cancel}"]},qwerty:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {space} {cancel}"]},international:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["~ ¡ ² ³ ¤ € ¼ ½ ¾ ‘ ’ ¥ × {bksp}","{tab} ä å é ® þ ü ú í ó ö « » ¬","á ß ð f g h j k ø ¶ ´ {enter}","{shift} æ x © v b ñ µ ç > ¿ {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":["~ ¹ ² ³ £ € ¼ ½ ¾ ‘ ’ ¥ ÷ {bksp}","{tab} Ä Å É ® Þ Ü Ú Í Ó Ö « » ¦","Ä § Ð F G H J K Ø ° ¨ {enter}","{shift} Æ X ¢ V B Ñ µ Ç . ¿ {shift}","{accept} {alt} {space} {alt} {cancel}"]},colemak:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w f p g j l u y ; [ ] \\","{bksp} a r s t d h n e i o ' {enter}","{shift} z x c v b k m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W F P G J L U Y : { } |",'{bksp} A R S T D H N E I O " {enter}',"{shift} Z X C V B K M < > ? {shift}","{accept} {space} {cancel}"]},dvorak:{"default":["` 1 2 3 4 5 6 7 8 9 0 [ ] {bksp}","{tab} ' , . p y f g c r l / = \\","a o e u i d h t n s - {enter}","{shift} ; q j k x b m w v z {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) { } {bksp}",'{tab} " < > P Y F G C R L ? + |',"A O E U I D H T N S _ {enter}","{shift} : Q J K X B M W V Z {shift}","{accept} {space} {cancel}"]},num:{"default":["= ( ) {b}","{clear} / * -","7 8 9 +","4 5 6 {sign}","1 2 3 %","0 . {a} {c}"]}},e.keyboard.defaultOptions={layout:"qwerty",customLayout:null,position:{of:null,my:"center top",at:"center top",at2:"center bottom"},usePreview:!0,alwaysOpen:!1,initialFocus:!0,stayOpen:!1,display:{a:"✔:Accept (Shift-Enter)",accept:"Accept:Accept (Shift-Enter)",alt:"Alt:⌥ AltGr",b:"⌫:Backspace",bksp:"Bksp:Backspace",c:"✖:Cancel (Esc)",cancel:"Cancel:Cancel (Esc)",clear:"C:Clear",combo:"ö:Toggle Combo Keys",dec:".:Decimal",e:"⏎:Enter",empty:" ",enter:"Enter:Enter ⏎",left:"←",lock:"Lock:⇪ Caps Lock",next:"Next ⇨",prev:"⇦ Prev",right:"→",s:"⇧:Shift",shift:"Shift:Shift",sign:"±:Change Sign",space:"&nbsp;:Space",t:"⇥:Tab",tab:"⇥ Tab:Tab"},wheelMessage:"Use mousewheel to see other keys",css:{input:"ui-widget-content ui-corner-all",container:"ui-widget-content ui-widget ui-corner-all ui-helper-clearfix",buttonDefault:"ui-state-default ui-corner-all",buttonHover:"ui-state-hover",buttonAction:"ui-state-active",buttonDisabled:"ui-state-disabled",buttonEmpty:"ui-keyboard-empty"},autoAccept:!1,lockInput:!1,restrictInput:!1,acceptValid:!1,cancelClose:!0,tabNavigation:!1,enterNavigation:!1,enterMod:"altKey",stopAtEnd:!0,appendLocally:!1,appendTo:"body",stickyShift:!0,preventPaste:!1,caretToEnd:!1,maxLength:!1,repeatDelay:500,repeatRate:20,resetDefault:!1,openOn:"focus",keyBinding:"mousedown touchstart",useCombos:!0,combos:{"`":{a:"à",A:"À",e:"è",E:"È",i:"ì",I:"Ì",o:"ò",O:"Ò",u:"ù",U:"Ù",y:"ỳ",Y:"Ỳ"},"'":{a:"á",A:"Á",e:"é",E:"É",i:"í",I:"Í",o:"ó",O:"Ó",u:"ú",U:"Ú",y:"ý",Y:"Ý"},'"':{a:"ä",A:"Ä",e:"ë",E:"Ë",i:"ï",I:"Ï",o:"ö",O:"Ö",u:"ü",U:"Ü",y:"ÿ",Y:"Ÿ"},"^":{a:"â",A:"Â",e:"ê",E:"Ê",i:"î",I:"Î",o:"ô",O:"Ô",u:"û",U:"Û",y:"ŷ",Y:"Ŷ"},"~":{a:"ã",A:"Ã",e:"ẽ",E:"Ẽ",i:"ĩ",I:"Ĩ",o:"õ",O:"Õ",u:"ũ",U:"Ũ",y:"ỹ",Y:"Ỹ",n:"ñ",N:"Ñ"}},validate:function(){return!0}},e.keyboard.comboRegex=/([`\'~\^\"ao])([a-z])/gim,e.keyboard.currentKeyboard="",e.fn.keyboard=function(t){return this.each(function(){e(this).data("keyboard")||new e.keyboard(this,t)})},e.fn.getkeyboard=function(){return this.data("keyboard")}}),function(e){"function"==typeof define&&define.amd?define("common/keyboard/chinese",["jquery","common/jquery.keyboard"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){e.keyboard.layouts.chinese={"default":["~ ㄅ ㄉ ˇ ˋ ㄓ ˊ ॱ ㄚ ㄞ ㄢ ㄦ = {bksp}","{tab} ㄆ ㄊ ㄍ ㄐ ㄔ ㄗ ㄧ ㄛ ㄟ ㄣ [ ] \\","ㄇ ㄋ ㄎ ㄑ ㄕ ㄘ ㄨ ㄜ ㄠ ㄤ ' {enter}","{shift} ㄈ ㄌ ㄏ ㄒ ㄖ ㄙ ㄩ ㄝ ㄡ ㄥ {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["ˋ 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["~ ㄅ ㄉ ˇ ˋ ㄓ ˊ ॱ ㄚ ㄞ ㄢ ㄦ = {bksp}","{tab} ㄆ ㄊ ㄍ ㄐ ㄔ ㄗ ㄧ ㄛ ㄟ ㄣ [ ] \\","ㄇ ㄋ ㄎ ㄑ ㄕ ㄘ ㄨ ㄜ ㄠ ㄤ ' {enter}","{shift} ㄈ ㄌ ㄏ ㄒ ㄖ ㄙ ㄩ ㄝ ㄡ ㄥ {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":["ˋ 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {alt} {space} {alt} {cancel}"]},"undefined"==typeof e.keyboard.language&&(e.keyboard.language={}),e.keyboard.language.chinese={display:{a:"✔:Accept (Shift-Enter)",accept:"接受:Accept (Shift-Enter)",alt:"Alt:Alternate Graphemes",b:"←:Backspace",bksp:"Bksp:Backspace",c:"✖:Cancel (Esc)",cancel:"取消:Cancel (Esc)",clear:"C:Clear",combo:"ö:Toggle Combo Keys",dec:".:Decimal",e:"↵:Enter",enter:"Enter:Enter",lock:"⇪ Lock:Caps Lock",s:"⇧:Shift",shift:"Shift:Shift",sign:"±:Change Sign",space:"&nbsp;:Space",t:"⇥:Tab",tab:"⇥ Tab:Tab"},wheelMessage:"使用滑鼠滾輪來檢視其它按鍵。"}}),function(e){"function"==typeof define&&define.amd?define("common/keyboard/french",["jquery","common/jquery.keyboard"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){e.keyboard.layouts["french-azerty-1"]={"default":["² & é \" ' ( - è _ ç à ) = {bksp}","{tab} a z e r t y u i o p ^ $","q s d f g h j k l m  ù * {enter}","{shift} < w x c v b n , ; : ! {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["{sp:1} 1 2 3 4 5 6 7 8 9 0 ° + {bksp}","{tab} A Z E R T Y U I O P ¨ £","Q S D F G H J K L M % µ {enter}","{shift} > W X C V B N ? . / § {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["² & ~ # { [ | ` \\ ^ @ ] } {bksp}","{tab} a z € r t y u i o p ^ ¤","q s d f g h j k l m  ù * {enter}","{shift} < w x c v b n , ; : ! {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":["{sp:1} 1 ~ # { [ | ` \\ ^ @ ] } {bksp}","{tab} A Z € R T Y U I O P ¨ ¤","Q S D F G H J K L M % µ {enter}","{shift} > W X C V B N ? . / § {shift}","{accept} {alt} {space} {alt} {cancel}"]},e.keyboard.layouts["french-azerty-2"]={"default":["² & é \" ' ( - è _ ç à ) = {b}","{t} a z e r t y u i o p ^ $","q s d f g h j k l m  ù * {e}","{s} < w x c v b n , ; : ! {s}","{a} {alt} {space} {alt} {c}"],shift:["{sp:1} 1 2 3 4 5 6 7 8 9 0 ° + {b}","{t} A Z E R T Y U I O P ¨ £","Q S D F G H J K L M % µ {e}","{s} > W X C V B N ? . / § {s}","{accept} {alt} {space} {alt} {c}"],alt:["² & ~ # { [ | ` \\ ^ @ ] } {b}","{t} a z € r t y u i o p ^ ¤","q s d f g h j k l m  ù * {e}","{s} < w x c v b n , ; : ! {s}","{a} {alt} {space} {alt} {c}"],"alt-shift":["{sp:1} 1 ~ # { [ | ` \\ ^ @ ] } {b}","{t} A Z € R T Y U I O P ¨ ¤","Q S D F G H J K L M % µ {e}","{s} > W X C V B N ? . / § {s}","{a} {alt} {space} {alt} {c}"]},e.keyboard.layouts["french-bepo-V1.0rc2"]={"default":['$ " « » ( ) @ + - / * = % {b}',"{t} b é p o è ˆ v d l j z w","a u i e , c t s r n m ç {enter}","{s} ê à y x . k ' q g h f {s}","{a} {alt} {space} {alt} {c}"],shift:["# 1 2 3 4 5 6 7 8 9 0 ° ` {b}","{t} B É P O È ! V D L J Z W","A U I E ; C T S R N M Ç {enter}","{s} Ê À Y X : K ? Q G H F {s}","{a} {alt} {space} {alt} {c}"],alt:["– — < > [ ] ^ ± − ÷ × ≠ ‰ {b}","{t} | ´ & œ ` ¡ ˇ ð / ĳ ə ˘","æ ù ¨ € ’ © þ ß ® ~ ¯ ¸ {enter}","{s} / \\ { } … ~ ¿ ° µ † ˛ {s}","{a} {alt} {space} {alt} {c}"],"alt-shift":["¶ „ “ ” ≤ ≥ {empty} ¬ ¼ ½ ¾ ′ ″ {b}","{t} ¦ ˝ § Œ ` ¡ {empty} Ð {empty} Ĳ Ə ˘","Æ Ù ˙ ¤ ̛ ſ Þ ẞ ™ {empty} º , {enter}","{s} {empty} {empty} ‘ ’ · {empty} ̉ ̣ {empty} ‡ ª {s}","{a} {alt} {space} {alt} {c}"]},"undefined"==typeof e.keyboard.language&&(e.keyboard.language={}),e.keyboard.language.french={display:{a:"✔:Valider (Shift-Enter)",accept:"Valider:Valider (Shift-Enter)",alt:"AltGr:Charactère alternatif",b:"←:Suppr arrière",bksp:"←Suppr:Suppr arrière",c:"✖:Annuler",cancel:"Annuler:Annuler (Échap)",clear:"C:Effacer",combo:"ö:Bacsuler les touches combo",dec:".:Decimal",e:"↵:Entrée",enter:"Entrée:Entrée",lock:"⇪ Verr Mag:Verouillage majuscule",s:"⇧:Majuscule",shift:"Maj:Majuscule",sign:"±:Change de signe",space:"&nbsp;:Espace",t:"⇥:Tabulation",tab:"⇥ Tab:Tabulation"},wheelMessage:"Utiliser la molette de la souris pour voir les autres lettres"}}),function(e){"function"==typeof define&&define.amd?define("common/keyboard/german",["jquery","common/jquery.keyboard"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){e.keyboard.layouts["german-qwertz-1"]={"default":["̂ 1 2 3 4 5 6 7 8 9 0 ß ́ {bksp}","{tab} q w e r t z u i o p ü +","a s d f g h j k l ö ä # {enter}","{shift} < y x c v b n m , . - {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:['° ! " § $ % & / ( ) = ? ̀ {bksp}',"{tab} Q W E R T Z U I O P Ü *","A S D F G H J K L Ö Ä ' {enter}","{shift} > Y X C V B N M ; : _ {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["̂ 1 ² ³ 4 5 6 { [ ] } \\ ́ {bksp}","{tab} @ w € r t z u i o p ü ̃","a s d f g h j k l ö ä # {enter}","{shift} | y x c v b n µ , . - {shift}","{accept} {alt} {space} {alt} {cancel}"]},e.keyboard.layouts["german-qwertz-2"]={"default":["§ 1 2 3 4 5 6 7 8 9 0 ' ̂ {bksp}","{tab} q w e r t z u i o p ü ̈","a s d f g h j k l ö ä $ {enter}","{shift} < y x c v b n m , . - {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:['° + " * ç % & / ( ) = ? ̀ {bksp}',"{tab} Q W E R T Z U I O P è !","A S D F G H J K L é à £ {enter}","{shift} > Y X C V B N M ; : _ {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["§ | @ # 4 5 ¬ ¦ ¢ 9 0 ́ ̃ {bksp}","{tab} q w € r t z u i o p [ ]","a s d f g h j k l ö { } {enter}","{shift} \\ y x c v b n m , . - {shift}","{accept} {alt} {space} {alt} {cancel}"]},"undefined"==typeof e.keyboard.language&&(e.keyboard.language={}),e.keyboard.language.german={display:{a:"✔:Accept (Shift-Enter)",accept:"Best.:Accept (Shift-Enter)",alt:"Alt Gr:Alternate Graphemes",b:"←:Backspace",bksp:"Rück:Backspace",c:"✖:Cancel (Esc)",cancel:"Abbr.:Cancel (Esc)",clear:"C:Clear",combo:"ö:Toggle Combo Keys",dec:".:Decimal",e:"↵:Enter",enter:"Enter:Enter",lock:"⇪ Lock:Caps Lock",s:"⇧:Shift",shift:"Shift:Shift",sign:"±:Change Sign",space:"&nbsp;:Space",t:"⇥:Tab",tab:"⇥ Tab:Tab"},wheelMessage:"Use mousewheel to see other keys"}}),function(e){"function"==typeof define&&define.amd?define("common/keyboard/japanese",["jquery","common/jquery.keyboard"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){e.keyboard.layouts["japanese-kana"]={"default":["あ か さ た な は ま や ら わ {bksp}","い き し ち に ひ み ゆ り を {tab}","う く す つ ぬ ふ む よ る ん {enter}","え け せ て ね へ め ! れ ゙ {shift}","お こ そ と の ほ も ? ろ ゚ {alt}","{accept} {space} {cancel}"],shift:["1 2 3 4 5 6 7 8 9 0 {bksp}","ぁ ぃ ぅ ぇ ぉ ､ ｡ ･ ー ~ {tab}","ゃ ゅ ょ っ $ ｢ ｣ … ( ) {enter}","♪ ￥ {empty} {empty} {empty} {empty} {empty} {empty} {empty} {empty} {shift}","{empty} {empty} {empty} {empty} {empty} {empty} {empty} {empty} {empty} {empty} {alt}","{accept} {space} {cancel}"],alt:["1 2 3 4 5 6 7 8 9 0 {bksp}","q w e r t y u i o p {tab}","a s d f g h j k l ;  {enter}","z x c v b n m , . / {shift}","` - = [ ] \\ ' {empty} {empty} {empty} {alt}","{accept} {space} {cancel}"],"alt-shift":["! @ # $ % ^ & * ( ) {bksp}","Q W E R T Y U I O P {tab}","A S D F G H J K L :  {enter}","Z X C V B N M < > ? {shift}",'~ _ + { } | " {empty} {empty} {empty} {alt}',"{accept} {space} {cancel}"]},e.keyboard.layouts["japanese-qwerty"]={"default":["1 2 3 4 5 6 7 8 9 0 - ^ ¥ {bksp}","{tab} q w e r t y u i o p @ [","a s d f g h j k l ; : ] {enter}","{shift} z x c v b n m , . / \\ {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["! \" # $ % & ' ( ) ́ = ~ | {bksp}","{tab} Q W E R T Y U I O P ` {","A S D F G H J K L + * } {enter}","{shift} Z X C V B N M < > ? _ {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["ぬ ふ あ う え お や ゆ よ わ ほ へ ｰ {bksp}","{tab} た て い す か ん な に ら せ ﾞ ﾟ","ち と し は き く ま の り れ け む {enter}","{shift} つ さ そ ひ こ み も ね る め ろ {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":["́ ́ ぁ ぅ ぇ ぉ ゃ ゅ ょ を ́ ́ ́ {bksp}","{tab} ́ ́ ぃ ́ ́ ́ ́ ́ ́ ́ ́ ｢","́ ́ ́ ́ ́ ́ ́ ́ ́ ́ ヶ ｣ {enter}","{shift} っ ́ ́ ́ ́ ́ ́ ､ ｡ ･ ¦ {shift}","{accept} {alt} {space} {alt} {cancel}"]},"undefined"==typeof e.keyboard.language&&(e.keyboard.language={}),e.keyboard.language.japanese={display:{a:"✔:Accept (Shift-Enter)",accept:"OK:Accept (Shift-Enter)",alt:"Alt:Roma-ji | Hiragana/Kana",b:"←:Backspace",bksp:"Bksp:Backspace",c:"✖:Cancel (Esc)",cancel:"Cancel:Cancel (Esc)",clear:"C:Clear",combo:"ö:Toggle Combo Keys",dec:".:Decimal",e:"↵:Enter",enter:"Enter:Enter",lock:"⇪ Lock:Caps Lock",s:"⇧:Shift",shift:"Shift:Katakana |Hiragana",sign:"±:Change Sign",space:"&nbsp;:Space",t:"⇥:Tab",tab:"⇥ Tab:Tab"},wheelMessage:"マウスホイールで他のキーを表示"}}),function(e){"function"==typeof define&&define.amd?define("common/keyboard/polish",["jquery","common/jquery.keyboard"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){e.keyboard.layouts["polish-qwerty"]={"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] °","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w ę r t y € i ó p [ ] °",'ą ś d f g h j k ł : " {enter}',"{shift} ż ź ć v b ń m , . / {shift}","{accept} {alt} {space} {alt} {cancel}"]},"undefined"==typeof e.keyboard.language&&(e.keyboard.language={}),e.keyboard.language.polish={display:{a:"✔:Akceptuj (Shift-Enter)",accept:"Akc.:Akceptuj (Shift-Enter)",alt:"Alt:Polskie znaki",b:"←:Cofnij",bksp:"Bksp:Cofnij",c:"✖:Anuluj (Esc)",cancel:"Anul.:Anuluj (Esc)",clear:"C:Czyść",combo:"ö:Klawisze kombo",dec:".:Dziesiętny",e:"↵:Enter",enter:"Enter:Enter",lock:"⇪ Lock:Caps Lock",s:"⇧:Shift",shift:"Shift:Shift",sign:"±:Zmień znak",space:"&nbsp;:Spacja",t:"⇥:Tab",tab:"⇥ Tab:Tab"},wheelMessage:"Użyj rolki aby zobaczyć pozozstałe klawisze"}}),function(e){"function"==typeof define&&define.amd?define("common/keyboard/portuguese",["jquery","common/jquery.keyboard"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){e.keyboard.layouts["portuguese-qwerty"]={"default":["\\ 1 2 3 4 5 6 7 8 9 0 ' « {bksp}","{tab} q w e r t y u i o p + ´","a s d f g h j k l ç º ~ {enter}","{shift} < z x c v b n m , . - {shift}","{cancel} {space} {alt} {accept}"],shift:['| ! " # $ % & / ( ) = ? » {bksp}',"{tab} Q W E R T Y U I O P * `","A S D F G H J K L Ç ª ^ {enter}","{shift} > Z X C V B N M ; : _ {shift}","{cancel} {space} {alt} {accept}"],alt:["\\ 1 @ £ § € 6 { [ ] } ' « {bksp}","{tab} q w € r t y u i o p ̈ ´","a s d f g h j k l ç º ~ {enter}","{shift} < z x c v b n m , . - {shift}","{cancel} {space} {alt} {accept}"],"alt-shift":['| ! " # $ % & / ( ) = ? » {bksp}',"{tab} Q W € R T Y U I O P ̈ `","A S D F G H J K L Ç ª ^ {enter}","{shift} > Z X C V B N M ; : _ {shift}","{cancel} {space} {alt} {accept}"]},e.extend(!0,e.keyboard.defaultOptions.combos,{"´":{a:"á",A:"Á",e:"é",E:"É",i:"í",I:"Í",o:"ó",O:"Ó",u:"ú",U:"Ú",y:"ý",Y:"Ý"}}),e.keyboard.defaultOptions.combos["'"]={},e.keyboard.comboRegex=/([`\'~\^\"ao\u00b4])([a-z])/gim,"undefined"==typeof e.keyboard.language&&(e.keyboard.language={}),e.keyboard.language.portuguese={display:{a:"✔:Aceite (Shift-Enter)",accept:"Aceit:Concluir (Shift-Enter)",alt:"AltGr:Carateres Adicionais/CTRL+ALT",b:"←:Retroceder",bksp:"Bksp:Retroceder",c:"✖:Cancelar/Escape (Esc)",cancel:"Anule:Cancelar/Escape(Esc)",clear:"C:Limpar",combo:"ö:Acentuação Automática",dec:".:Decimal",e:"↵:Introduzir/Mudar de Linha",enter:"Enter:Introduzir/Mudar de Linha",lock:"⇪ Lock:CapsLock/Maiúsculas",s:"⇧:Shift/Maiúsculas",shift:"Shift:Maiúsculas-Minúsculas",sign:"±:Mudar Sinal",space:"&nbsp;:Espaço",t:"⇥:Tab/Tabela/Avançar",tab:"⇥ Tab:Tabela/Avançar"},wheelMessage:"Use a roda do rato/navegador para ver mais teclas"}
}),function(e){"function"==typeof define&&define.amd?define("common/keyboard/russian",["jquery","common/jquery.keyboard"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){e.keyboard.layouts["russian-qwerty"]={"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["ё 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} й ц у к е н г ш щ з х ъ \\","ф ы в а п р о л д ж э {enter}","{shift} я ч с м и т ь б ю . {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":['Ё ! " № ; € : ? * ( ) _ + {bksp}',"{tab} Й Ц У К Е Н Г Ш Щ З Х Ъ /","Ф Ы В А П Р О Л Д Ж Э {enter}","{shift} Я Ч С М И Т Ь Б Ю , {shift}","{accept} {alt} {space} {alt} {cancel}"]},"undefined"==typeof e.keyboard.language&&(e.keyboard.language={}),e.keyboard.language.russian={display:{a:"✔:Accept (Shift-Enter)",accept:"Принять:Accept (Shift-Enter)",alt:"AltGr:Alternate Graphemes",b:"←:Backspace",bksp:"Bksp:Backspace",c:"✖:Cancel (Esc)",cancel:"Отмена:Cancel (Esc)",clear:"C:Clear",combo:"ö:Toggle Combo Keys",dec:".:Decimal",e:"↵:Enter",enter:"Enter:Enter",lock:"⇪ Lock:Caps Lock",s:"⇧:Shift",shift:"Shift:Shift",sign:"±:Change Sign",space:"&nbsp;:Space",t:"⇥:Tab",tab:"⇥ Tab:Tab"},wheelMessage:"Use mousewheel to see other keys"}}),function(e){"function"==typeof define&&define.amd?define("common/keyboard/spanish",["jquery","common/jquery.keyboard"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){e.keyboard.layouts["spanish-qwerty"]={"default":["| 1 2 3 4 5 6 7 8 9 0 ' ¿ {bksp}","{tab} q w e r t y u i o p ́ +","a s d f g h j k l ñ { } {enter}","{shift} < z x c v b n m , . - {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:['° ! " # $ % & / ( ) = ? ¡ {bksp}',"{tab} Q W E R T Y U I O P ̈ *","A S D F G H J K L Ñ [ ] {enter}","{shift} > Z X C V B N M ; : _ {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["¬ 1 2 3 4 5 6 7 8 9 0 \\ ¿ {bksp}","{tab} @ w e r t y u i o p ́ ̃","a s d f g h j k l ñ ̂ ̀ {enter}","{shift} < z x c v b n m , . - {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":['° ! " # $ % & / ( ) = ? ¡ {bksp}',"{tab} Q W E R T Y U I O P ̈ *","A S D F G H J K L Ñ [ ] {enter}","{shift} > Z X C V B N M ; : _ {shift}","{accept} {alt} {space} {alt} {cancel}"]},e.keyboard.layouts["spanish-qwerty-sp"]={"default":["º 1 2 3 4 5 6 7 8 9 0 ' ¡ {bksp}","{tab} q w e r t y u i o p ̀ +","a s d f g h j k l ñ ́ ç {enter}","{shift} < z x c v b n m , . - {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:['ª ! " · $ % & / ( ) = ? ¿ {bksp}',"{tab} Q W E R T Y U I O P ^ *","A S D F G H J K L Ñ ̈ Ç {enter}","{shift} > Z X C V B N M ; : _ {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["\\ | @ # 4 5 ¬ 7 8 9 0 ' ¡ {bksp}","{tab} q w e r t y u i o p [ ]","a s d f g h j k l ñ { } {enter}","{shift} | z x c v b n m , . - {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":['ª ! " · $ % & / ( ) = ? ¿ {bksp}',"{tab} Q W E R T Y U I O P [ ]","A S D F G H J K L Ñ { } {enter}","{shift} > Z X C V B N M ; : _ {shift}","{accept} {alt} {space} {alt} {cancel}"]},"undefined"==typeof e.keyboard.language&&(e.keyboard.language={}),e.keyboard.language.spanish={display:{a:"✔:Accept (Shift-Enter)",accept:"Acep.:Accept (Shift-Enter)",alt:"Alt:Alternate Graphemes",b:"←:Backspace",bksp:"Borrar:Backspace",c:"✖:Cancel (Esc)",cancel:"Cancel.:Cancel (Esc)",clear:"C:Clear",combo:"ö:Toggle Combo Keys",dec:".:Decimal",e:"↵:Enter",enter:"Enter:Enter",lock:"⇪ Lock:Caps Lock",s:"⇧:Shift",shift:"Shift:Shift",sign:"±:Change Sign",space:"&nbsp;:Space",t:"⇥:Tab",tab:"⇥ Tab:Tab"},wheelMessage:"Utilice la rueda del mouse para ver otras teclas"}}),function(e){"function"==typeof define&&define.amd?define("common/keyboard/italian",["jquery","common/jquery.keyboard"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){e.keyboard.layouts["standard-italian"]={"default":["\\ 1 2 3 4 5 6 7 8 9 0 ́ ì ù {bksp}","{tab} q w e r t y u i o p è +","a s d f g h j k l ò à {enter}","{shift} z x c v b n m , . - {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:['| ! " £ $ % & / ( ) = ? ‸ § {bksp}',"{tab} Q W E R T Y U I O P é *","A S D F G H J K L ç ° {enter}","{shift} Z X C V B N M ; : _ {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["\\ 1 2 3 4 € 6 7 8 9 0 ́ ì ù {bksp}","{tab} q w € r t y u i o p [ ]","a s d f g h j k l @ # {enter}","{shift} z x c v b n m , . - {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":['| ! " £ $ % & / ( ) = ? ‸ § {bksp}',"{tab} Q W E R T Y U I O P { }","A S D F G H J K L ç ° {enter}","{shift} Z X C V B N M ; : _ {shift}","{accept} {alt} {space} {alt} {cancel}"]},"undefined"==typeof e.keyboard.language&&(e.keyboard.language={}),e.keyboard.language.italian={display:{a:"✔:Accept (Shift-Enter)",accept:"Conferma:Accept (Shift-Enter)",alt:"Alt:Alternate Graphemes",b:"←:Backspace",bksp:"Bksp:Backspace",c:"✖:Cancel (Esc)",cancel:"Annulla:Cancel (Esc)",clear:"C:Clear",combo:"ö:Toggle Combo Keys",dec:".:Decimal",e:"↵:Enter",enter:"Invio:Enter",lock:"⇪ Lock:Caps Lock",s:"⇧:Shift",shift:"Maiusc:Shift",sign:"±:Change Sign",space:"&nbsp;:Space",t:"⇥:Tab",tab:"⇥ Tab:Tab"},wheelMessage:"Usa la rotella del mouse per vedere altri tasti"}}),function(e){"function"==typeof define&&define.amd?define("common/keyboard/korean",["jquery","common/jquery.keyboard"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){e.keyboard.layouts["standard-2-beolsik"]={"default":["~ 1 2 3 4 5 6 7 8 9 0 - = \\ {bksp}","{tab} ㅂ ㅈ ㄷ ㄱ ㅅ ㅛ ㅕ ㅑ ㅐ ㅔ [ ]","ㅁ ㄴ ㅇ ㄹ ㅎ ㅗ ㅓ ㅏ ㅣ ; ' {enter}","{shift} ㅋ ㅌ ㅊ ㅍ ㅠ ㅜ ㅡ , . / {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["ˋ ! @ # $ % ^ & * ( ) _ + | {bksp}","{tab} ㅃ ㅉ ㄲ ㄲ ㅆ ㅅ ㅛ ㅕ ㅒ ㅖ { }",'ㅁ ㄴ ㅇ ㄹ ㅎ ㅗ ㅓ ㅏ ㅣ : " {enter}',"{shift} ㅋ ㅌ ㅊ ㅍ ㅠ ㅜ ㅡ < > ? {shift}","{accept} {alt} {space} {alt} {cancel}"]},"undefined"==typeof e.keyboard.language&&(e.keyboard.language={}),e.keyboard.language.korean={display:{a:"✔:Accept (Shift-Enter)",accept:"확인:Accept (Shift-Enter)",alt:"Alt:Alternate Graphemes",b:"←:Backspace",bksp:"Bksp:Backspace",c:"✖:Cancel (Esc)",cancel:"취소:Cancel (Esc)",clear:"C:Clear",combo:"ö:Toggle Combo Keys",dec:".:Decimal",e:"↵:Enter",enter:"Enter:Enter",lock:"⇪ Lock:Caps Lock",s:"⇧:Shift",shift:"Shift:Shift",sign:"±:Change Sign",space:"&nbsp;:Space",t:"⇥:Tab",tab:"⇥ Tab:Tab"},wheelMessage:"다른 키를 보려면 마우스 휠을 이용하십시오"}}),function(e){"function"==typeof define&&define.amd?define("common/keyboard/mexican",["jquery","common/jquery.keyboard"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){e.keyboard.layouts["mexican-qwerty"]={"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} x x x r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {space} {cancel}"]},"undefined"==typeof e.keyboard.language&&(e.keyboard.language={}),e.keyboard.language.mexican={display:{a:"✔:Accept (Shift-Enter)",accept:"Acep.:Accept (Shift-Enter)",alt:"Alt:Alternate Graphemes",b:"←:Backspace",bksp:"Retr:BKsp",c:"✖:Cancel (Esc)",cancel:"Anular:Cancel (Esc)",clear:"C:Clear",combo:"ö:Toggle Combo Keys",dec:".:Decimal",e:"↵:Enter",enter:"Enter:Enter",lock:"⇪ Lock:Caps Lock",s:"⇧:Shift",shift:"Shift:Shift",sign:"±:Change Sign",space:"&nbsp;:Space",t:"⇥:Tab",tab:"⇥ Tab:Tab"},wheelMessage:"Utilice la rueda del mouse para ver otras teclas"}}),function(e){"function"==typeof define&&define.amd?define("common/jquery.keyboard.extension-autocomplete",["jquery","jquery-ui","common/jquery.keyboard"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){e.fn.addAutocomplete=function(){return this.each(function(){var t=e(this).data("keyboard");t&&(t.autocomplete_new_version=function(e){return e[0]=parseInt(e[0],10),e[0]>1||1===e[0]&&parseInt(e[1],10)>=9}(e.ui.version.split(".")),t.autocomplete_init=function(){t.options.alwaysOpen&&t.isVisible()&&t.autocomplete_setup(),t.$el.bind("visible.keyboard",function(){t.autocomplete_setup()}).bind("change.keyboard",function(){t.hasAutocomplete&&t.isVisible()&&t.$el.val(t.$preview.val()).trigger("keydown.autocomplete")}).bind("hidden.keyboard",function(){t.$el.autocomplete("close")}).bind("autocompleteopen",function(){t.hasAutocomplete&&t.$autocomplete.menu.element.position({of:t.$keyboard,my:"right top",at:"left top",collision:"flip"})}).bind("autocompleteselect",function(e,n){var i=n.item.value;t.hasAutocomplete&&""!==i&&(t.$preview.val(i).focus(),t.lastCaret={start:i.length,end:i.length})})},t.autocomplete_setup=function(){t.$autocomplete=t.$el.data("autocomplete")||t.$el.data("uiAutocomplete"),t.hasAutocomplete="undefined"==typeof t.$autocomplete?!1:t.$autocomplete.options.disabled?!1:!0,t.hasAutocomplete&&(t.$preview.bind("keydown",function(e){return t.autocomplete_input(e)}),t.$allKeys.bind("mouseup mousedown mouseleave touchstart touchend touchcancel",function(e){t.autocomplete_input(e)}))},t.autocomplete_input=function(n){var i,a=e.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:t.$autocomplete._move("previousPage",n),n.preventDefault();break;case a.PAGE_DOWN:t.$autocomplete._move("nextPage",n),n.preventDefault();break;case a.UP:t.$autocomplete._move("previous",n),n.preventDefault();break;case a.DOWN:t.$autocomplete._move("next",n),n.preventDefault();break;case a.ENTER:case a.NUMPAD_ENTER:i=t.$autocomplete.menu.element.find("#ui-active-menuitem,.ui-state-focus").text()||"",""!==i&&t.$preview.val(i),t.autocomplete_new_version&&t.$autocomplete.menu.select(n);break;default:clearTimeout(t.$autocomplete.searching),t.$autocomplete.searching=setTimeout(function(){t.$autocomplete.term!==t.$autocomplete.element.val()&&(t.$autocomplete.selectedItem=null,t.$autocomplete.search(null,n))},t.$autocomplete.options.delay)}},t.origEscClose=t.escClose,t.escClose=function(n){(!t.hasAutocomplete||"ui-active-menuitem"!==n.target.id&&!e(n.target).closest("ul").hasClass("ui-autocomplete"))&&t.origEscClose(n)},t.autocomplete_init())})}}),define("common/virtualKeyboard",["utils","underscore","common/keyboard/chinese","common/keyboard/french","common/keyboard/german","common/keyboard/japanese","common/keyboard/polish","common/keyboard/portuguese","common/keyboard/russian","common/keyboard/spanish","common/keyboard/italian","common/keyboard/korean","common/keyboard/mexican","common/jquery.keyboard","common/jquery.keyboard.extension-autocomplete"],function(e,t){function n(){var e=$.data(document.body,"virtualKeyboard");return void 0!=e?e:!1}function i(e,t){e?l.showVirtualKeyboard(t):l.closeVirtualKeyboard()}function a(e){return e.hasClass("ui-autocomplete-input")}function r(e){var t=null;return"recaptcha_response_field"==e.attr("id")&&$("body").hasClass("launcher")&&(t="#recaptcha_challenge_image"),t}function o(){var e=t.find(l.langConfig,function(e){return e.id==globals.titlelang});if("undefined"!=typeof e&&"undefined"!=typeof $.keyboard.language[e.name]){l.layout=e.layout;var n=$.keyboard.language[e.name];$.extend(!0,$.keyboard.defaultOptions,n)}}function s(e){o(),void 0==e?e=n():l.setInputElement(e);var t=a(e),i="focus",s={layout:l.layout,position:{of:r(e),my:"left top",at:t?"right top":"left bottom",at2:t?"right top":"left bottom"},initialFocus:!0,usePreview:!1,autoAccept:!0,enterNavigation:!0,tabNavigation:!0,openOn:i,css:{input:"ui-widget-content ui-corner-all",container:"ui-widget-content ui-widget ui-corner-all ui-helper-clearfix",buttonDefault:"ui-state-default ui-corner-all",buttonHover:"ui-state-hover",buttonAction:"ui-state-active",buttonDisabled:"ui-state-disabled"}};t&&$(document).one("beforeVisible.keyboard",function(e,t,n){$(n).addAutocomplete()}),e.on("initialized.keyboard",function(){$(this).trigger(i+".keyboard")}),e.keyboard(s)}var l={layout:"qwerty",langConfig:[{id:"en-US",name:"english",layout:"qwerty"},{id:"de-DE",name:"german",layout:"german-qwertz-1"},{id:"es-MX",name:"mexican",layout:"mexican-qwerty"},{id:"es-ES",name:"spanish",layout:"spanish-qwerty"},{id:"fr-FR",name:"french",layout:"french-azerty-1"},{id:"ja-JP",name:"japanese",layout:"qwerty"},{id:"pl-PL",name:"polish",layout:"polish-qwerty"},{id:"pt-BR",name:"portuguese",layout:"portuguese-qwerty"},{id:"ru-RU",name:"russian",layout:"russian-qwerty"},{id:"zh-TW",name:"chinese",layout:"qwerty"},{id:"it-IT",name:"italian",layout:"standard-italian"},{id:"ko-KR",name:"korean",layout:"standard-2-beolsik"}]};return l.setInputElement=function(e){$.data(document.body,"virtualKeyboard",e)},l.isActive=function(){var e=n();return 0!=e&&e.getkeyboard()&&e.getkeyboard().isVisible()},l.showVirtualKeyboard=function(e){void 0==e&&(e=n()),e&&void 0==e.getkeyboard()&&s(e)},l.closeVirtualKeyboard=function(){var e=n();e&&e.getkeyboard()&&e.getkeyboard().close()},l.destroyKeyboard=function(){var e=n();if(void 0!=e){var t=e.getkeyboard();void 0!=t&&e.getkeyboard().destroy()}},l.setFocusedInput=function(t){var n=$(document.activeElement);(n.is("input")||n.is("textarea"))&&n.val(t),e.pubsub.trigger("virtualKeyboard:keyboardResult",n)},e.pubsub.on("virtualKeyboard",i),l}),define("common/localize",["require","common/xhr","underscore","common/baseUtils","xmlToJson"],function(e){function t(e,n,a,r){var l="";n.indexOf(s.baseAssetUrl)<0&&(n=s.baseAssetUrl+n);var c=getLocalizationKey(e,n),u=getLocalizationCache();return i.has(u,c)?l=u[c]:r||(o.getLocalizedTextXML(n),l=t(e,n,a,!0)),l.length||null==a||(l=a),l}var n=e("common/xhr"),i=e("underscore"),a=e("common/baseUtils"),r=e("xmlToJson"),o={};"undefined"==typeof window.globals&&(window.globals={});var s=window.globals;return window.getLocalizationKey=function(e,t){return t.toLowerCase()+":"+e},window.isLocalizationFileCached=function(e){var t=window.getLocalizationCache();if("undefined"==typeof t)return!1;var n=e.toLowerCase(),a=i.find(t,function(e,t){return 0==t.toLowerCase().indexOf(n)});return"undefined"!=typeof a},window.getLocalizationCache=function(){var e=s.localizationCache;return"undefined"!=typeof e?e:{}},window.setLocalizationCache=function(e){s.localizationCache=e},window.appendLocalizationCache=function(e,t){if(!isLocalizationFileCached(t)){var n=i.map(e,function(e,n){return[getLocalizationKey(n,t),e]});e=i.object(n);var a=getLocalizationCache(),r=i.extend({},a,e);setLocalizationCache(r)}},o.getLocalizationCacheForContext=function(e){e.indexOf(s.baseAssetUrl)<0&&(e=s.baseAssetUrl+e);var t=window.getLocalizationCache(),n=window.getLocalizationKey("",e);return i.pick(t,function(e,t){return 0===t.indexOf(n)})},o.getLocalizedTextXML=function(e){e.indexOf(s.baseAssetUrl)<0&&(e=s.baseAssetUrl+e),n.ajax({url:e,type:"GET",async:!1,dataType:"xml",timeout:5e3,silentFail:!0,success:function(t){if("undefined"!=typeof t&&t){var n=r(t);appendLocalizationCache(n,e)}}})},o.getText=function(e,n,i,a){return a=a||"Shared",t(e,"xml/"+a+"/"+n+s.titlelang+".xml",i)},o.getError=function(e,t){return o.getText(e,"Errors",t)},o.getRequestDescription=function(e,t){if(void 0!=e&&e.length){var n=o.getError("request_"+e);if(void 0!=n&&n.length)return" ("+n+")"}if(window.debugLog){var i=t;if(void 0!=i&&i.length>20)return i=i.substr(-20)," (debug: "+i+")"}return""},o.getErrorWithCode=function(e,t){"string"==typeof e&&e.length||(e=a.errorCode("1000.1"));var n,i=void 0,r=e.split(".")[0],s=a.isScDownError(r);s?n=o.getError("SC_Down"):(n=o.getError(a.errorCodeLocKey(e)),""==n&&(n=o.getError(a.errorCodeLocKey(r)))),(s||"1002"==r)&&(i=o.getError("ErrorSupport")),""==n&&(n=o.getError("GenericServerError"));var l=o.getError("Code")+":"+e+o.getRequestDescription(t);return{Message:n,SupportText:i,CodeDescription:l}},o}),define("common/storage",[],function(){var e={},t=function(){var e="test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch(t){return!1}},n=window.localStorage,i=void 0,a=function(){return"undefined"!=typeof i?i:i=t()},r=function(e,t){return e+"."+t},o=function(e){return"undefined"!=typeof e?e:null===globals.account||"undefined"==typeof globals.account?"anon":globals.account.RockstarId};return e.getItem=function(t,i){if(!a())return"";i=o(i);var s=n.getItem(r(t,i));if(null!==s)return s;var l=n.getItem(t);return null!==l?(n.removeItem(t),e.setItem(t,l,i),l):null},e.setItem=function(e,t,i){return a()?(i=o(i),n.setItem(r(e,i),t)):!1},e}),define("common/am/socialCount",["require","common/storage"],function(e){function t(e){var t=new Date;t.setDate(t.getDate()-globals.expireSocialCountsDays);var n="friendCountSaveDate";e&&(n="crewCountSaveDate");var a=i.getItem(n);return a=null!==a?new Date(a):null,null!==a&&t>a}function n(e,t){var n=a.getSocialCountTotals(),i="FriendCount";t&&(i="CrewCount");var r=-1;"undefined"!=typeof n&&"undefined"!=typeof n[i]&&null!==n[i]&&(r=n[i]),"subtract"==e&&r>0?r--:"add"==e&&r>-1&&r++,t?a.setSocialCountTotals(r,-1):a.setSocialCountTotals(-1,r)}var i=e("common/storage"),a={};return a.setSocialCountTotals=function(e,t){e>-1&&(i.setItem("crewCount",e),i.setItem("crewCountSaveDate",new Date)),t>-1&&(i.setItem("friendCount",t),i.setItem("friendCountSaveDate",new Date))},a.getSocialCountTotals=function(){var e=t(!0)?-1:i.getItem("crewCount"),n=t()?-1:i.getItem("friendCount"),a={CrewCount:null!==e?e:-1,FriendCount:null!==n?n:-1};return a},a.updateFriendCount=function(e){n(e,!1)},a.updateCrewCount=function(e){n(e,!0)},a}),define("common/auth",["require"],function(){function e(){return globals.authToken}function t(){var e=void 0,t=document.getElementById("Auth");return null!==t&&"object"==typeof t&&t.value&&(e=t.value),e}var n={};return n.storeAuthValue=function(e){globals.authToken=e},n.getAuthToken=function(){return t()||e()},n.clearAuthValue=function(){delete globals.authToken},n.storeLanAuthValue=function(e){globals.authTokenLan=e},n.getLanAuthValue=function(){return globals.authTokenLan},n.wrapAuthHeader=function(e){return{Authorization:'SCAUTH val="'+e+'"'}},n.wrapAuthHeaderV8=function(e){return{Authorization:'SCAUTH8 val="'+e+'"'}},n}),define("common/sdk",["require","jquery","underscore","utils","common/baseUtils"],function(e){function t(e){return window[e]}function n(e){return"string"==typeof e&&(e=t(e)),"function"==typeof e}function i(e,t,n){var i={EventId:e,Data:{Action:t}};"undefined"!=typeof n&&(i.Data.Parameter=n);var a=JSON.stringify(i);return a=a.replace(/","/gi,'", "'),h.CallGameMethod("RGSC_RAISE_UI_EVENT",a,"RGSC_RAISE_UI_EVENT_DEMO")}function a(e){if(e.resolutionEnum!==h.resolutionEnum[e.resolutionEnum])throw new Error("invalid resolution enum: "+e.resolutionEnum);return{fileName:e.filename,resolution:e.resolutionEnum}}function r(){var e=["RGSC_COMMERCE_GET_PURCHASE_FLOW_TELEMETRY","RGSC_IS_COMMERCE_DATA_VALID","RGSC_IS_COMMERCE_IN_ERROR_STATE","RGSC_GET_ACHIEVEMENT_LIST","RGSC_GET_COMMERCE_CATALOG","RGSC_GET_GAME_INVITE_LIST","RGSC_GET_NETWORK_INFO","RGSC_GET_PROFILE_LIST","RGSC_GET_ROS_CREDENTIALS","RGSC_GET_STATS_DATA","RGSC_GET_STEAM_PERSONA","RGSC_GET_TITLE_ID","RGSC_GET_USER_STORE_AGE_APPROPRIATE_INFO","RGSC_GET_VERSION_INFO","RGSC_INTERNET_CONNECTED_STATE","RGSC_REQUEST_CHECKOUT_URL","RGSC_START_STEAM_PURCHASE","RGSC_GET_CLOUD_SAVE_ENABLED","RGSC_SET_CLOUD_SAVE_ENABLED"];c.each(e,function(e,t){var n=f.jsToDll(t);window[n]=function(e){return l(n,e)}})}function o(e){"undefined"==typeof m[e.fn]&&(m[e.fn]=[]),m[e.fn].push(e.dfd)}function s(e){return void 0==m||"undefined"==typeof e||"undefined"==typeof m[e]||0===m[e].length?!1:m[e].shift()}function l(e,t){d.WriteDllLog(e,"data",t,d.logType.debug);var n=s(e);if("object"!=typeof n||!n.resolve)return d.WriteDebugLog(e,"failed to resolve","",d.logType.error,d.logController[p.titleName]),d.WriteDllLog(e,"failed to resolve",t),t;if(d.WriteDebugLog(e,"resolved",t.toString(),d.logType.debug),"string"==typeof t)try{t=JSON.parse(t)}catch(i){e===f.jsToDll("RGSC_GET_ROS_CREDENTIALS")&&t&&d.WriteDebugLog(f.jsToDll("RGSC_GET_ROS_CREDENTIALS"),"JSON.parse exception",t,d.logType.error,d.logController[p.titleName])}return void n.resolve(t)}var c=e("jquery"),u=e("underscore"),d=e("utils"),f=e("common/baseUtils"),h={};"undefined"==typeof window.globals&&(window.globals={});var p=window.globals;h.CallGameMethod=function(e,i,a,r){null!=i&&"object"==typeof i&&(i=JSON.stringify(i)),d.WriteDllLog(e,"json",i);var o,s=t(e);if(n(s))try{return"RGSC_UI_STATE_RESPONSE"!=e||1==p.waitingResponse?("RGSC_UI_STATE_RESPONSE"==e&&(d.WriteDebugLog(e,"waitingResponse",p.waitingResponse),p.waitingResponse=!1),o=s(i),c.parseJSON(o||"null")):o}catch(l){return"RGSC_GET_AVATAR"!==e&&d.WriteDebugLog(e,"error "+l.name,l.message,d.logType.error,d.logController[p.titleName]),o}else if(null!=a){if(s=t(a),n(s)){if("RGSC_GET_PROFILE_LIST"==a)i=null,d.WriteDebugLog("fallback1:"+a,"jsonData",i),o=s(i),"string"==typeof o&&(o=JSON.parse(o));else if(d.WriteDebugLog("fallback1:"+a,"jsonData",i),o=s(i),"string"==typeof o)try{o=JSON.parse(o)}catch(l){return o}return o}if(null!=r&&(s=t(r),n(s)))return d.WriteDebugLog("fallback2:"+r,"jsonData",i),o=s(i),"string"==typeof o&&(o=JSON.parse(o)),o}return o},h.CallGameMethodAsync=function(e,t,n,i){var a=new c.Deferred,r=!1,s=e;if(p.asyncEnabled&&(s+="_ASYNC",r=!0,"function"!=typeof window[s]&&(s=e,r=!1)),r){var l=f.jsToDll(e),u={fn:l,dfd:a};o(u)}var d=h.CallGameMethod(s,t,n,i);return r||a.resolve(d),a.promise()},h.quitGame=function(){return d.WriteDebugLog("Desktop.quitGame"),h.launcherWindowsEvent("Close")},h.minimizeUi=function(){return d.WriteDebugLog("Desktop.minimizeUi"),h.launcherWindowsEvent("Minimize")},h.launcherWindowsEvent=function(e){return i(1,e)},h.launcherUiEvent=function(e){return i(2,"LauncherButton",e)},h.launcherNotifyEvent=function(e){return p.receiveMsgEnabled=!0,i(3,e)},h.launcherData=function(e,t){return i(4,e,t)},h.resolutionEnum={useLocal:"useLocal",useCloud:"useCloud",ignore:"ignore",cancel:"cancel",useCurrent:"useCurrent",useLocalBackup1:"useLocalBackup1",useLocalBackup2:"useLocalBackup2"},h.getCloudSavesEnabledSetting=function(){return h.CallGameMethodAsync("RGSC_GET_CLOUD_SAVE_ENABLED",{RosTitleName:p.titleName},"RGSC_GET_CLOUD_SAVE_ENABLED_DEMO")},h.updateCloudSavesEnabledSetting=function(e){return h.CallGameMethodAsync("RGSC_SET_CLOUD_SAVE_ENABLED",{Enabled:e,RosTitleName:p.titleName},"RGSC_SET_CLOUD_SAVE_ENABLED_DEMO")},h.resolveCloudConflict=function(e){if(null==e||"object"!=typeof e)return void 0;var t=[];if(Array.isArray(e))t=u.map(e,a);else{if(!e.resolutionEnum)return void 0;t.push(a(e))}return i(3,"ResolveCloudConflict",t)},h.resolveLocalBackup=function(e){if(null==e||"object"!=typeof e)return void 0;var t=[];if(Array.isArray(e))t=u.map(e,a);else{if(!e.resolutionEnum)return void 0;t.push(a(e))}return i(3,"ResolveLocalBackup",t)},h.sendCloudState=function(e){var t={state:e};return i(3,"CloudState",t)},h.debugEvent=function(e){var t=3,n="Debug",a="RGSC_DEBUG_EVENT";if("string"==typeof e&&e.length>4e3&&(e=e.substr(0,3997)+"..."),"function"!=typeof window[a])return i(t,n,e),!1;var r={EventId:t,Data:{Action:n}};"undefined"!=typeof e&&(r.Data.Parameter=e);var o=JSON.stringify(r);return h.CallGameMethod(a,o,"RGSC_RAISE_UI_EVENT_DEMO")};var m=[];return h.clearAsyncFnInvocation=function(e){void 0!=m&&"undefined"!=typeof e&&"undefined"!=typeof m[e]&&0!==m[e].length&&(m[e]=[])},d.pubsub.on("sdk:launcherDebugEvent",h.debugEvent),r(),h}),define("common/hbs/handlebars",[],function(){var e=function(){var e=function(){function e(e){this.string=e}var t;return e.prototype.toString=function(){return""+this.string},t=e}(),t=function(e){function t(e){return s[e]||"&amp;"}function n(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}function i(e){return e instanceof o?e.toString():e||0===e?(e=""+e,c.test(e)?e.replace(l,t):e):""}function a(e){return e||0===e?f(e)&&0===e.length?!0:!1:!0}var r={},o=e,s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},l=/[&<>"'`]/g,c=/[&<>"'`]/;r.extend=n;var u=Object.prototype.toString;r.toString=u;var d=function(e){return"function"==typeof e};d(/x/)&&(d=function(e){return"function"==typeof e&&"[object Function]"===u.call(e)});var d;r.isFunction=d;var f=Array.isArray||function(e){return e&&"object"==typeof e?"[object Array]"===u.call(e):!1};return r.isArray=f,r.escapeExpression=i,r.isEmpty=a,r}(e),n=function(){function e(e,t){var i;t&&t.firstLine&&(i=t.firstLine,e+=" - "+i+":"+t.firstColumn);for(var a=Error.prototype.constructor.call(this,e),r=0;r<n.length;r++)this[n[r]]=a[n[r]];i&&(this.lineNumber=i,this.column=t.firstColumn)}var t,n=["description","fileName","lineNumber","message","name","number","stack"];return e.prototype=new Error,t=e}(),i=function(e,t){function n(e,t){this.helpers=e||{},this.partials=t||{},i(this)}function i(e){e.registerHelper("helperMissing",function(e){if(2===arguments.length)return void 0;throw new s("Missing helper: '"+e+"'")}),e.registerHelper("blockHelperMissing",function(t,n){var i=n.inverse||function(){},a=n.fn;return f(t)&&(t=t.call(this)),t===!0?a(this):t===!1||null==t?i(this):d(t)?t.length>0?e.helpers.each(t,n):i(this):a(t)}),e.registerHelper("each",function(e,t){var n,i=t.fn,a=t.inverse,r=0,o="";if(f(e)&&(e=e.call(this)),t.data&&(n=g(t.data)),e&&"object"==typeof e)if(d(e))for(var s=e.length;s>r;r++)n&&(n.index=r,n.first=0===r,n.last=r===e.length-1),o+=i(e[r],{data:n});else for(var l in e)e.hasOwnProperty(l)&&(n&&(n.key=l,n.index=r,n.first=0===r),o+=i(e[l],{data:n}),r++);return 0===r&&(o=a(this)),o}),e.registerHelper("if",function(e,t){return f(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||o.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}),e.registerHelper("with",function(e,t){return f(e)&&(e=e.call(this)),o.isEmpty(e)?void 0:t.fn(e)}),e.registerHelper("log",function(t,n){var i=n.data&&null!=n.data.level?parseInt(n.data.level,10):1;e.log(i,t)})}function a(e,t){m.log(e,t)}var r={},o=e,s=t,l="1.3.0";r.VERSION=l;var c=4;r.COMPILER_REVISION=c;var u={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};r.REVISION_CHANGES=u;var d=o.isArray,f=o.isFunction,h=o.toString,p="[object Object]";r.HandlebarsEnvironment=n,n.prototype={constructor:n,logger:m,log:a,registerHelper:function(e,t,n){if(h.call(e)===p){if(n||t)throw new s("Arg not supported with multiple helpers");o.extend(this.helpers,e)}else n&&(t.not=n),this.helpers[e]=t},registerPartial:function(e,t){h.call(e)===p?o.extend(this.partials,e):this.partials[e]=t}};var m={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){if(m.level<=e){var n=m.methodMap[e];"undefined"!=typeof console&&console[n]&&console[n].call(console,t)}}};r.logger=m,r.log=a;var g=function(e){var t={};return o.extend(t,e),t};return r.createFrame=g,r}(t,n),a=function(e,t,n){function i(e){var t=e&&e[0]||1,n=f;if(t!==n){if(n>t){var i=h[n],a=h[t];throw new d("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+a+").")}throw new d("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function a(e,t){if(!t)throw new d("No environment passed to template");var n=function(e,n,i,a,r,o){var s=t.VM.invokePartial.apply(this,arguments);if(null!=s)return s;if(t.compile){var l={helpers:a,partials:r,data:o};return r[n]=t.compile(e,{data:void 0!==o},t),r[n](i,l)}throw new d("The partial "+n+" could not be compiled when running in runtime-only mode")},i={escapeExpression:u.escapeExpression,invokePartial:n,programs:[],program:function(e,t,n){var i=this.programs[e];return n?i=o(e,t,n):i||(i=this.programs[e]=o(e,t)),i},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n={},u.extend(n,t),u.extend(n,e)),n},programWithDepth:t.VM.programWithDepth,noop:t.VM.noop,compilerInfo:null};return function(n,a){a=a||{};var r,o,s=a.partial?a:t;a.partial||(r=a.helpers,o=a.partials);var l=e.call(i,s,n,r,o,a.data);return a.partial||t.VM.checkRevision(i.compilerInfo),l}}function r(e,t,n){var i=Array.prototype.slice.call(arguments,3),a=function(e,a){return a=a||{},t.apply(this,[e,a.data||n].concat(i))};return a.program=e,a.depth=i.length,a}function o(e,t,n){var i=function(e,i){return i=i||{},t(e,i.data||n)};return i.program=e,i.depth=0,i}function s(e,t,n,i,a,r){var o={partial:!0,helpers:i,partials:a,data:r};if(void 0===e)throw new d("The partial "+t+" could not be found");return e instanceof Function?e(n,o):void 0}function l(){return""}var c={},u=e,d=t,f=n.COMPILER_REVISION,h=n.REVISION_CHANGES;return c.checkRevision=i,c.template=a,c.programWithDepth=r,c.program=o,c.invokePartial=s,c.noop=l,c}(t,n,i),r=function(e,t,n,i,a){var r,o=e,s=t,l=n,c=i,u=a,d=function(){var e=new o.HandlebarsEnvironment;return c.extend(e,o),e.SafeString=s,e.Exception=l,e.Utils=c,e.VM=u,e.template=function(t){return u.template(t,e)},e},f=d();return f.create=d,r=f}(i,e,n,t,a),o=function(e){function t(e){e=e||{},this.firstLine=e.first_line,this.firstColumn=e.first_column,this.lastColumn=e.last_column,this.lastLine=e.last_line}var n,i=e,a={ProgramNode:function(e,n,i,r){var o,s;3===arguments.length?(r=i,i=null):2===arguments.length&&(r=n,n=null),t.call(this,r),this.type="program",this.statements=e,this.strip={},i?(s=i[0],s?(o={first_line:s.firstLine,last_line:s.lastLine,last_column:s.lastColumn,first_column:s.firstColumn},this.inverse=new a.ProgramNode(i,n,o)):this.inverse=new a.ProgramNode(i,n),this.strip.right=n.left):n&&(this.strip.left=n.right)},MustacheNode:function(e,n,i,r,o){if(t.call(this,o),this.type="mustache",this.strip=r,null!=i&&i.charAt){var s=i.charAt(3)||i.charAt(2);this.escaped="{"!==s&&"&"!==s}else this.escaped=!!i;this.sexpr=e instanceof a.SexprNode?e:new a.SexprNode(e,n),this.sexpr.isRoot=!0,this.id=this.sexpr.id,this.params=this.sexpr.params,this.hash=this.sexpr.hash,this.eligibleHelper=this.sexpr.eligibleHelper,this.isHelper=this.sexpr.isHelper},SexprNode:function(e,n,i){t.call(this,i),this.type="sexpr",this.hash=n;var a=this.id=e[0],r=this.params=e.slice(1),o=this.eligibleHelper=a.isSimple;this.isHelper=o&&(r.length||n)},PartialNode:function(e,n,i,a){t.call(this,a),this.type="partial",this.partialName=e,this.context=n,this.strip=i},BlockNode:function(e,n,a,r,o){if(t.call(this,o),e.sexpr.id.original!==r.path.original)throw new i(e.sexpr.id.original+" doesn't match "+r.path.original,this);this.type="block",this.mustache=e,this.program=n,this.inverse=a,this.strip={left:e.strip.left,right:r.strip.right},(n||a).strip.left=e.strip.right,(a||n).strip.right=r.strip.left,a&&!n&&(this.isInverse=!0)},ContentNode:function(e,n){t.call(this,n),this.type="content",this.string=e},HashNode:function(e,n){t.call(this,n),this.type="hash",this.pairs=e},IdNode:function(e,n){t.call(this,n),this.type="ID";for(var a="",r=[],o=0,s=0,l=e.length;l>s;s++){var c=e[s].part;if(a+=(e[s].separator||"")+c,".."===c||"."===c||"this"===c){if(r.length>0)throw new i("Invalid path: "+a,this);".."===c?o++:this.isScoped=!0}else r.push(c)}this.original=a,this.parts=r,this.string=r.join("."),this.depth=o,this.isSimple=1===e.length&&!this.isScoped&&0===o,this.stringModeValue=this.string},PartialNameNode:function(e,n){t.call(this,n),this.type="PARTIAL_NAME",this.name=e.original},DataNode:function(e,n){t.call(this,n),this.type="DATA",this.id=e},StringNode:function(e,n){t.call(this,n),this.type="STRING",this.original=this.string=this.stringModeValue=e},IntegerNode:function(e,n){t.call(this,n),this.type="INTEGER",this.original=this.integer=e,this.stringModeValue=Number(e)},BooleanNode:function(e,n){t.call(this,n),this.type="BOOLEAN",this.bool=e,this.stringModeValue="true"===e},CommentNode:function(e,n){t.call(this,n),this.type="comment",this.comment=e}};return n=a
}(n),s=function(){var e,t=function(){function e(e,t){return{left:"~"===e.charAt(2),right:"~"===t.charAt(0)||"~"===t.charAt(1)}}function t(){this.yy={}}var n={trace:function(){},yy:{},symbols_:{error:2,root:3,statements:4,EOF:5,program:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,sexpr:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,partial_option0:27,sexpr_repetition0:28,sexpr_option0:29,dataName:30,param:31,STRING:32,INTEGER:33,BOOLEAN:34,OPEN_SEXPR:35,CLOSE_SEXPR:36,hash:37,hash_repetition_plus0:38,hashSegment:39,ID:40,EQUALS:41,DATA:42,pathSegments:43,SEP:44,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",32:"STRING",33:"INTEGER",34:"BOOLEAN",35:"OPEN_SEXPR",36:"CLOSE_SEXPR",40:"ID",41:"EQUALS",42:"DATA",44:"SEP"},productions_:[0,[3,2],[3,1],[6,2],[6,3],[6,2],[6,1],[6,1],[6,0],[4,1],[4,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,4],[7,2],[17,3],[17,1],[31,1],[31,1],[31,1],[31,1],[31,1],[31,3],[37,1],[39,3],[26,1],[26,1],[26,1],[30,2],[21,1],[43,3],[43,1],[27,0],[27,1],[28,0],[28,2],[29,0],[29,1],[38,1],[38,2]],performAction:function(t,n,i,a,r,o){var s=o.length-1;switch(r){case 1:return new a.ProgramNode(o[s-1],this._$);case 2:return new a.ProgramNode([],this._$);case 3:this.$=new a.ProgramNode([],o[s-1],o[s],this._$);break;case 4:this.$=new a.ProgramNode(o[s-2],o[s-1],o[s],this._$);break;case 5:this.$=new a.ProgramNode(o[s-1],o[s],[],this._$);break;case 6:this.$=new a.ProgramNode(o[s],this._$);break;case 7:this.$=new a.ProgramNode([],this._$);break;case 8:this.$=new a.ProgramNode([],this._$);break;case 9:this.$=[o[s]];break;case 10:o[s-1].push(o[s]),this.$=o[s-1];break;case 11:this.$=new a.BlockNode(o[s-2],o[s-1].inverse,o[s-1],o[s],this._$);break;case 12:this.$=new a.BlockNode(o[s-2],o[s-1],o[s-1].inverse,o[s],this._$);break;case 13:this.$=o[s];break;case 14:this.$=o[s];break;case 15:this.$=new a.ContentNode(o[s],this._$);break;case 16:this.$=new a.CommentNode(o[s],this._$);break;case 17:this.$=new a.MustacheNode(o[s-1],null,o[s-2],e(o[s-2],o[s]),this._$);break;case 18:this.$=new a.MustacheNode(o[s-1],null,o[s-2],e(o[s-2],o[s]),this._$);break;case 19:this.$={path:o[s-1],strip:e(o[s-2],o[s])};break;case 20:this.$=new a.MustacheNode(o[s-1],null,o[s-2],e(o[s-2],o[s]),this._$);break;case 21:this.$=new a.MustacheNode(o[s-1],null,o[s-2],e(o[s-2],o[s]),this._$);break;case 22:this.$=new a.PartialNode(o[s-2],o[s-1],e(o[s-3],o[s]),this._$);break;case 23:this.$=e(o[s-1],o[s]);break;case 24:this.$=new a.SexprNode([o[s-2]].concat(o[s-1]),o[s],this._$);break;case 25:this.$=new a.SexprNode([o[s]],null,this._$);break;case 26:this.$=o[s];break;case 27:this.$=new a.StringNode(o[s],this._$);break;case 28:this.$=new a.IntegerNode(o[s],this._$);break;case 29:this.$=new a.BooleanNode(o[s],this._$);break;case 30:this.$=o[s];break;case 31:o[s-1].isHelper=!0,this.$=o[s-1];break;case 32:this.$=new a.HashNode(o[s],this._$);break;case 33:this.$=[o[s-2],o[s]];break;case 34:this.$=new a.PartialNameNode(o[s],this._$);break;case 35:this.$=new a.PartialNameNode(new a.StringNode(o[s],this._$),this._$);break;case 36:this.$=new a.PartialNameNode(new a.IntegerNode(o[s],this._$));break;case 37:this.$=new a.DataNode(o[s],this._$);break;case 38:this.$=new a.IdNode(o[s],this._$);break;case 39:o[s-2].push({part:o[s],separator:o[s-1]}),this.$=o[s-2];break;case 40:this.$=[{part:o[s]}];break;case 43:this.$=[];break;case 44:o[s-1].push(o[s]);break;case 47:this.$=[o[s]];break;case 48:o[s-1].push(o[s])}},table:[{3:1,4:2,5:[1,3],8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[3]},{5:[1,16],8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[2,2]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{4:20,6:18,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{4:20,6:22,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{17:23,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:29,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:30,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:31,21:24,30:25,40:[1,28],42:[1,27],43:26},{21:33,26:32,32:[1,34],33:[1,35],40:[1,28],43:26},{1:[2,1]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{10:36,20:[1,37]},{4:38,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,7],22:[1,13],23:[1,14],25:[1,15]},{7:39,8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,6],22:[1,13],23:[1,14],25:[1,15]},{17:23,18:[1,40],21:24,30:25,40:[1,28],42:[1,27],43:26},{10:41,20:[1,37]},{18:[1,42]},{18:[2,43],24:[2,43],28:43,32:[2,43],33:[2,43],34:[2,43],35:[2,43],36:[2,43],40:[2,43],42:[2,43]},{18:[2,25],24:[2,25],36:[2,25]},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],35:[2,38],36:[2,38],40:[2,38],42:[2,38],44:[1,44]},{21:45,40:[1,28],43:26},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],42:[2,40],44:[2,40]},{18:[1,46]},{18:[1,47]},{24:[1,48]},{18:[2,41],21:50,27:49,40:[1,28],43:26},{18:[2,34],40:[2,34]},{18:[2,35],40:[2,35]},{18:[2,36],40:[2,36]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{21:51,40:[1,28],43:26},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,3],22:[1,13],23:[1,14],25:[1,15]},{4:52,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,5],22:[1,13],23:[1,14],25:[1,15]},{14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]},{18:[2,45],21:56,24:[2,45],29:53,30:60,31:54,32:[1,57],33:[1,58],34:[1,59],35:[1,61],36:[2,45],37:55,38:62,39:63,40:[1,64],42:[1,27],43:26},{40:[1,65]},{18:[2,37],24:[2,37],32:[2,37],33:[2,37],34:[2,37],35:[2,37],36:[2,37],40:[2,37],42:[2,37]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,66]},{18:[2,42]},{18:[1,67]},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],25:[1,15]},{18:[2,24],24:[2,24],36:[2,24]},{18:[2,44],24:[2,44],32:[2,44],33:[2,44],34:[2,44],35:[2,44],36:[2,44],40:[2,44],42:[2,44]},{18:[2,46],24:[2,46],36:[2,46]},{18:[2,26],24:[2,26],32:[2,26],33:[2,26],34:[2,26],35:[2,26],36:[2,26],40:[2,26],42:[2,26]},{18:[2,27],24:[2,27],32:[2,27],33:[2,27],34:[2,27],35:[2,27],36:[2,27],40:[2,27],42:[2,27]},{18:[2,28],24:[2,28],32:[2,28],33:[2,28],34:[2,28],35:[2,28],36:[2,28],40:[2,28],42:[2,28]},{18:[2,29],24:[2,29],32:[2,29],33:[2,29],34:[2,29],35:[2,29],36:[2,29],40:[2,29],42:[2,29]},{18:[2,30],24:[2,30],32:[2,30],33:[2,30],34:[2,30],35:[2,30],36:[2,30],40:[2,30],42:[2,30]},{17:68,21:24,30:25,40:[1,28],42:[1,27],43:26},{18:[2,32],24:[2,32],36:[2,32],39:69,40:[1,70]},{18:[2,47],24:[2,47],36:[2,47],40:[2,47]},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],41:[1,71],42:[2,40],44:[2,40]},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],35:[2,39],36:[2,39],40:[2,39],42:[2,39],44:[2,39]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{36:[1,72]},{18:[2,48],24:[2,48],36:[2,48],40:[2,48]},{41:[1,71]},{21:56,30:60,31:73,32:[1,57],33:[1,58],34:[1,59],35:[1,61],40:[1,28],42:[1,27],43:26},{18:[2,31],24:[2,31],32:[2,31],33:[2,31],34:[2,31],35:[2,31],36:[2,31],40:[2,31],42:[2,31]},{18:[2,33],24:[2,33],36:[2,33],40:[2,33]}],defaultActions:{3:[2,2],16:[2,1],50:[2,42]},parseError:function(e){throw new Error(e)},parse:function(e){function t(){var e;return e=n.lexer.lex()||1,"number"!=typeof e&&(e=n.symbols_[e]||e),e}var n=this,i=[0],a=[null],r=[],o=this.table,s="",l=0,c=0,u=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var d=this.lexer.yylloc;r.push(d);var f=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,p,m,g,v,b,C,S,y,w={};;){if(m=i[i.length-1],this.defaultActions[m]?g=this.defaultActions[m]:((null===h||"undefined"==typeof h)&&(h=t()),g=o[m]&&o[m][h]),"undefined"==typeof g||!g.length||!g[0]){var _="";if(!u){y=[];for(b in o[m])this.terminals_[b]&&b>2&&y.push("'"+this.terminals_[b]+"'");_=this.lexer.showPosition?"Parse error on line "+(l+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+y.join(", ")+", got '"+(this.terminals_[h]||h)+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(_,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:d,expected:y})}}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+m+", token: "+h);switch(g[0]){case 1:i.push(h),a.push(this.lexer.yytext),r.push(this.lexer.yylloc),i.push(g[1]),h=null,p?(h=p,p=null):(c=this.lexer.yyleng,s=this.lexer.yytext,l=this.lexer.yylineno,d=this.lexer.yylloc,u>0&&u--);break;case 2:if(C=this.productions_[g[1]][1],w.$=a[a.length-C],w._$={first_line:r[r.length-(C||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(C||1)].first_column,last_column:r[r.length-1].last_column},f&&(w._$.range=[r[r.length-(C||1)].range[0],r[r.length-1].range[1]]),v=this.performAction.call(w,s,c,l,this.yy,g[1],a,r),"undefined"!=typeof v)return v;C&&(i=i.slice(0,-1*C*2),a=a.slice(0,-1*C),r=r.slice(0,-1*C)),i.push(this.productions_[g[1]][0]),a.push(w.$),r.push(w._$),S=o[i[i.length-2]][i[i.length-1]],i.push(S);break;case 3:return!0}}return!0}},i=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var a=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[a[0],a[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,i,a;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),o=0;o<r.length&&(n=this._input.match(this.rules[r[o]]),!n||t&&!(n[0].length>t[0].length)||(t=n,i=o,this.options.flex));o++);return t?(a=t[0].match(/(?:\r\n?|\n).*/g),a&&(this.yylineno+=a.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:a?a[a.length-1].length-a[a.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,r[i],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e?e:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return"undefined"!=typeof e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)}};return e.options={},e.performAction=function(e,t,n,i){function a(e,n){return t.yytext=t.yytext.substr(e,t.yyleng-n)}switch(n){case 0:if("\\\\"===t.yytext.slice(-2)?(a(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(a(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return a(0,4),this.popState(),15;case 4:return 35;case 5:return 36;case 6:return 25;case 7:return 16;case 8:return 20;case 9:return 19;case 10:return 19;case 11:return 23;case 12:return 22;case 13:this.popState(),this.begin("com");break;case 14:return a(3,5),this.popState(),15;case 15:return 22;case 16:return 41;case 17:return 40;case 18:return 40;case 19:return 44;case 20:break;case 21:return this.popState(),24;case 22:return this.popState(),18;case 23:return t.yytext=a(1,2).replace(/\\"/g,'"'),32;case 24:return t.yytext=a(1,2).replace(/\\'/g,"'"),32;case 25:return 42;case 26:return 34;case 27:return 34;case 28:return 33;case 29:return 40;case 30:return t.yytext=a(1,2),40;case 31:return"INVALID";case 32:return 5}},e.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:-?[0-9]+(?=([~}\s)])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],e.conditions={mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},INITIAL:{rules:[0,1,32],inclusive:!0}},e}();return n.lexer=i,t.prototype=n,n.Parser=t,new t}();return e=t}(),l=function(e,t){function n(e){return e.constructor===r.ProgramNode?e:(a.yy=r,a.parse(e))}var i={},a=e,r=t;return i.parser=a,i.parse=n,i}(s,o),c=function(e){function t(){}function n(e,t,n){if(null==e||"string"!=typeof e&&e.constructor!==n.AST.ProgramNode)throw new r("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);t=t||{},"data"in t||(t.data=!0);var i=n.parse(e),a=(new n.Compiler).compile(i,t);return(new n.JavaScriptCompiler).compile(a,t)}function i(e,t,n){function i(){var i=n.parse(e),a=(new n.Compiler).compile(i,t),r=(new n.JavaScriptCompiler).compile(a,t,void 0,!0);return n.template(r)}if(null==e||"string"!=typeof e&&e.constructor!==n.AST.ProgramNode)throw new r("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);t=t||{},"data"in t||(t.data=!0);var a;return function(e,t){return a||(a=i()),a.call(this,e,t)}}var a={},r=e;return a.Compiler=t,t.prototype={compiler:t,disassemble:function(){for(var e,t,n,i=this.opcodes,a=[],r=0,o=i.length;o>r;r++)if(e=i[r],"DECLARE"===e.opcode)a.push("DECLARE "+e.name+"="+e.value);else{t=[];for(var s=0;s<e.args.length;s++)n=e.args[s],"string"==typeof n&&(n='"'+n.replace("\n","\\n")+'"'),t.push(n);a.push(e.opcode+" "+t.join(" "))}return a.join("\n")},equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;t>n;n++){var i=this.opcodes[n],a=e.opcodes[n];if(i.opcode!==a.opcode||i.args.length!==a.args.length)return!1;for(var r=0;r<i.args.length;r++)if(i.args[r]!==a.args[r])return!1}if(t=this.children.length,e.children.length!==t)return!1;for(n=0;t>n;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=t;var n=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},n)for(var i in n)this.options.knownHelpers[i]=n[i];return this.accept(e)},accept:function(e){var t,n=e.strip||{};return n.left&&this.opcode("strip"),t=this[e.type](e),n.right&&this.opcode("strip"),t},program:function(e){for(var t=e.statements,n=0,i=t.length;i>n;n++)this.accept(t[n]);return this.isSimple=1===i,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t,n=(new this.compiler).compile(e,this.options),i=this.guid++;this.usePartial=this.usePartial||n.usePartial,this.children[i]=n;for(var a=0,r=n.depths.list.length;r>a;a++)t=n.depths.list[a],2>t||this.addDepth(t-1);return i},block:function(e){var t=e.mustache,n=e.program,i=e.inverse;n&&(n=this.compileProgram(n)),i&&(i=this.compileProgram(i));var a=t.sexpr,r=this.classifySexpr(a);"helper"===r?this.helperSexpr(a,n,i):"simple"===r?(this.simpleSexpr(a),this.opcode("pushProgram",n),this.opcode("pushProgram",i),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousSexpr(a,n,i),this.opcode("pushProgram",n),this.opcode("pushProgram",i),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(e){var t,n,i=e.pairs;this.opcode("pushHash");for(var a=0,r=i.length;r>a;a++)t=i[a],n=t[1],this.options.stringParams?(n.depth&&this.addDepth(n.depth),this.opcode("getContext",n.depth||0),this.opcode("pushStringParam",n.stringModeValue,n.type),"sexpr"===n.type&&this.sexpr(n)):this.accept(n),this.opcode("assignToHash",t[0]);this.opcode("popHash")},partial:function(e){var t=e.partialName;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.name),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){this.sexpr(e.sexpr),this.opcode(e.escaped&&!this.options.noEscape?"appendEscaped":"append")},ambiguousSexpr:function(e,t,n){var i=e.id,a=i.parts[0],r=null!=t||null!=n;this.opcode("getContext",i.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("invokeAmbiguous",a,r)},simpleSexpr:function(e){var t=e.id;"DATA"===t.type?this.DATA(t):t.parts.length?this.ID(t):(this.addDepth(t.depth),this.opcode("getContext",t.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,n){var i=this.setupFullMustacheParams(e,t,n),a=e.id.parts[0];if(this.options.knownHelpers[a])this.opcode("invokeKnownHelper",i.length,a);else{if(this.options.knownHelpersOnly)throw new r("You specified knownHelpersOnly, but used the unknown helper "+a,e);this.opcode("invokeHelper",i.length,a,e.isRoot)}},sexpr:function(e){var t=this.classifySexpr(e);"simple"===t?this.simpleSexpr(e):"helper"===t?this.helperSexpr(e):this.ambiguousSexpr(e)},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0];t?this.opcode("lookupOnContext",e.parts[0]):this.opcode("pushContext");for(var n=1,i=e.parts.length;i>n;n++)this.opcode("lookup",e.parts[n])},DATA:function(e){if(this.options.data=!0,e.id.isScoped||e.id.depth)throw new r("Scoped data references are not supported: "+e.original,e);this.opcode("lookupData");for(var t=e.id.parts,n=0,i=t.length;i>n;n++)this.opcode("lookup",t[n])},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("pushLiteral",e.integer)},BOOLEAN:function(e){this.opcode("pushLiteral",e.bool)},comment:function(){},opcode:function(e){this.opcodes.push({opcode:e,args:[].slice.call(arguments,1)})},declare:function(e,t){this.opcodes.push({opcode:"DECLARE",name:e,value:t})},addDepth:function(e){0!==e&&(this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e)))},classifySexpr:function(e){var t=e.isHelper,n=e.eligibleHelper,i=this.options;if(n&&!t){var a=e.id.parts[0];i.knownHelpers[a]?t=!0:i.knownHelpersOnly&&(n=!1)}return t?"helper":n?"ambiguous":"simple"},pushParams:function(e){for(var t,n=e.length;n--;)t=e[n],this.options.stringParams?(t.depth&&this.addDepth(t.depth),this.opcode("getContext",t.depth||0),this.opcode("pushStringParam",t.stringModeValue,t.type),"sexpr"===t.type&&this.sexpr(t)):this[t.type](t)},setupFullMustacheParams:function(e,t,n){var i=e.params;return this.pushParams(i),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.hash(e.hash):this.opcode("emptyHash"),i}},a.precompile=n,a.compile=i,a}(n),u=function(e,t){function n(e){this.value=e}function i(){}var a,r=e.COMPILER_REVISION,o=e.REVISION_CHANGES,s=e.log,l=t;i.prototype={nameLookup:function(e,t){var n,a;return 0===e.indexOf("depth")&&(n=!0),a=/^[0-9]+$/.test(t)?e+"["+t+"]":i.isValidJavaScriptVariableName(t)?e+"."+t:e+"['"+t+"']",n?"("+e+" && "+a+")":a},compilerInfo:function(){var e=r,t=o[e];return"this.compilerInfo = ["+e+",'"+t+"'];\n"},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":{appendToBuffer:!0,content:e,toString:function(){return"buffer += "+e+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,t,n,i){this.environment=e,this.options=t||{},s("debug",this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.compileChildren(e,t);var a,r=e.opcodes;this.i=0;for(var o=r.length;this.i<o;this.i++)a=r[this.i],"DECLARE"===a.opcode?this[a.name]=a.value:this[a.opcode].apply(this,a.args),a.opcode!==this.stripNext&&(this.stripNext=!1);if(this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new l("Compile completed with content left on stack");return this.createFunctionContext(i)},preamble:function(){var e=[];if(this.isChild)e.push("");else{var t=this.namespace,n="helpers = this.merge(helpers, "+t+".helpers);";this.environment.usePartial&&(n=n+" partials = this.merge(partials, "+t+".partials);"),this.options.data&&(n+=" data = data || {};"),e.push(n)}e.push(this.environment.isSimple?"":", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=e},createFunctionContext:function(e){var t=this.stackVars.concat(this.registers.list);if(t.length>0&&(this.source[1]=this.source[1]+", "+t.join(", ")),!this.isChild)for(var n in this.context.aliases)this.context.aliases.hasOwnProperty(n)&&(this.source[1]=this.source[1]+", "+n+"="+this.context.aliases[n]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.pushSource("return buffer;");for(var i=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],a=0,r=this.environment.depths.list.length;r>a;a++)i.push("depth"+this.environment.depths.list[a]);var o=this.mergeSource();if(this.isChild||(o=this.compilerInfo()+o),e)return i.push(o),Function.apply(this,i);var l="function "+(this.name||"")+"("+i.join(",")+") {\n  "+o+"}";return s("debug",l+"\n\n"),l},mergeSource:function(){for(var e,t="",n=0,i=this.source.length;i>n;n++){var a=this.source[n];a.appendToBuffer?e=e?e+"\n    + "+a.content:a.content:(e&&(t+="buffer += "+e+";\n  ",e=void 0),t+=a+"\n  ")}return t},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e),this.replaceStack(function(t){return e.splice(1,0,t),"blockHelperMissing.call("+e.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e);var t=this.topStack();e.splice(1,0,t),this.pushSource("if (!"+this.lastHelper+") { "+t+" = blockHelperMissing.call("+e.join(", ")+"); }")},appendContent:function(e){this.pendingContent&&(e=this.pendingContent+e),this.stripNext&&(e=e.replace(/^\s+/,"")),this.pendingContent=e},strip:function(){this.pendingContent&&(this.pendingContent=this.pendingContent.replace(/\s+$/,"")),this.stripNext="strip"},append:function(){this.flushInline();var e=this.popStack();this.pushSource("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupOnContext:function(e){this.push(this.nameLookup("depth"+this.lastContext,e,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(e){return"typeof "+e+" === functionType ? "+e+".apply(depth0) : "+e})},lookup:function(e){this.replaceStack(function(t){return t+" == null || "+t+" === false ? "+t+" : "+this.nameLookup(t,e,"context")})},lookupData:function(){this.pushStackLiteral("data")},pushStringParam:function(e,t){this.pushStackLiteral("depth"+this.lastContext),this.pushString(t),"sexpr"!==t&&("string"==typeof e?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.push("{}"),this.push("{}"))},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.options.stringParams&&(this.push("{"+e.contexts.join(",")+"}"),this.push("{"+e.types.join(",")+"}")),this.push("{\n    "+e.values.join(",\n    ")+"\n  }")},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},push:function(e){return this.inlineStack.push(e),e},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){this.pushStackLiteral(null!=e?this.programExpression(e):null)},invokeHelper:function(e,t,n){this.context.aliases.helperMissing="helpers.helperMissing",this.useRegister("helper");var i=this.lastHelper=this.setupHelper(e,t,!0),a=this.nameLookup("depth"+this.lastContext,t,"context"),r="helper = "+i.name+" || "+a;i.paramsInit&&(r+=","+i.paramsInit),this.push("("+r+",helper ? helper.call("+i.callParams+") : helperMissing.call("+i.helperMissingParams+"))"),n||this.flushInline()},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(n.name+".call("+n.callParams+")")},invokeAmbiguous:function(e,t){this.context.aliases.functionType='"function"',this.useRegister("helper"),this.emptyHash();var n=this.setupHelper(0,e,t),i=this.lastHelper=this.nameLookup("helpers",e,"helper"),a=this.nameLookup("depth"+this.lastContext,e,"context"),r=this.nextStack();n.paramsInit&&this.pushSource(n.paramsInit),this.pushSource("if (helper = "+i+") { "+r+" = helper.call("+n.callParams+"); }"),this.pushSource("else { helper = "+a+"; "+r+" = typeof helper === functionType ? helper.call("+n.callParams+") : helper; }")},invokePartial:function(e){var t=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"];this.options.data&&t.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+t.join(", ")+")")},assignToHash:function(e){var t,n,i=this.popStack();this.options.stringParams&&(n=this.popStack(),t=this.popStack());var a=this.hash;t&&a.contexts.push("'"+e+"': "+t),n&&a.types.push("'"+e+"': "+n),a.values.push("'"+e+"': ("+i+")")},compiler:i,compileChildren:function(e,t){for(var n,i,a=e.children,r=0,o=a.length;o>r;r++){n=a[r],i=new this.compiler;var s=this.matchExistingProgram(n);null==s?(this.context.programs.push(""),s=this.context.programs.length,n.index=s,n.name="program"+s,this.context.programs[s]=i.compile(n,t,this.context),this.context.environments[s]=n):(n.index=s,n.name="program"+s)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;n>t;t++){var i=this.context.environments[t];if(i&&i.equals(e))return t}},programExpression:function(e){if(this.context.aliases.self="this",null==e)return"self.noop";for(var t,n=this.environment.children[e],i=n.depths.list,a=[n.index,n.name,"data"],r=0,o=i.length;o>r;r++)t=i[r],a.push(1===t?"depth0":"depth"+(t-1));return(0===i.length?"self.program(":"self.programWithDepth(")+a.join(", ")+")"},register:function(e,t){this.useRegister(e),this.pushSource(e+" = "+t+";")},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},pushStackLiteral:function(e){return this.push(new n(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=void 0),e&&this.source.push(e)},pushStack:function(e){this.flushInline();var t=this.incrStack();return e&&this.pushSource(t+" = "+e+";"),this.compileStack.push(t),t},replaceStack:function(e){var t,i,a,r="",o=this.isInline();if(o){var s=this.popStack(!0);if(s instanceof n)t=s.value,a=!0;else{i=!this.stackSlot;var l=i?this.incrStack():this.topStackName();r="("+this.push(l)+" = "+s+"),",t=this.topStack()}}else t=this.topStack();var c=e.call(this,t);return o?(a||this.popStack(),i&&this.stackSlot--,this.push("("+r+c+")")):(/^stack/.test(t)||(t=this.nextStack()),this.pushSource(t+" = ("+r+c+");")),t},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;if(e.length){this.inlineStack=[];for(var t=0,i=e.length;i>t;t++){var a=e[t];a instanceof n?this.compileStack.push(a):this.pushStack(a)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),i=(t?this.inlineStack:this.compileStack).pop();if(!e&&i instanceof n)return i.value;if(!t){if(!this.stackSlot)throw new l("Invalid stack pop");this.stackSlot--}return i},topStack:function(e){var t=this.isInline()?this.inlineStack:this.compileStack,i=t[t.length-1];
return!e&&i instanceof n?i.value:i},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(e,t,n){var i=[],a=this.setupParams(e,i,n),r=this.nameLookup("helpers",t,"helper");return{params:i,paramsInit:a,name:r,callParams:["depth0"].concat(i).join(", "),helperMissingParams:n&&["depth0",this.quotedString(t)].concat(i).join(", ")}},setupOptions:function(e,t){var n,i,a,r=[],o=[],s=[];r.push("hash:"+this.popStack()),this.options.stringParams&&(r.push("hashTypes:"+this.popStack()),r.push("hashContexts:"+this.popStack())),i=this.popStack(),a=this.popStack(),(a||i)&&(a||(this.context.aliases.self="this",a="self.noop"),i||(this.context.aliases.self="this",i="self.noop"),r.push("inverse:"+i),r.push("fn:"+a));for(var l=0;e>l;l++)n=this.popStack(),t.push(n),this.options.stringParams&&(s.push(this.popStack()),o.push(this.popStack()));return this.options.stringParams&&(r.push("contexts:["+o.join(",")+"]"),r.push("types:["+s.join(",")+"]")),this.options.data&&r.push("data:data"),r},setupParams:function(e,t,n){var i="{"+this.setupOptions(e,t).join(",")+"}";return n?(this.useRegister("options"),t.push("options"),"options="+i):(t.push(i),"")}};for(var c="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),u=i.RESERVED_WORDS={},d=0,f=c.length;f>d;d++)u[c[d]]=!0;return i.isValidJavaScriptVariableName=function(e){return!i.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e)?!0:!1},a=i}(i,n),d=function(e,t,n,i,a){var r,o=e,s=t,l=n.parser,c=n.parse,u=i.Compiler,d=i.compile,f=i.precompile,h=a,p=o.create,m=function(){var e=p();return e.compile=function(t,n){return d(t,n,e)},e.precompile=function(t,n){return f(t,n,e)},e.AST=s,e.Compiler=u,e.JavaScriptCompiler=h,e.Parser=l,e.parse=c,e};return o=m(),o.create=m,r=o}(r,o,l,c,u);return d}();return e}),define("hbs",[],function(){return{get:function(){return Handlebars},write:function(e,t,n){if(t+customNameExtension in buildMap){var i=buildMap[t+customNameExtension];n.asModule(e+"!"+t,i)}},version:"0.8.0",load:function(){}}}),define("common/templates/helpers/ifequals",["common/hbs/handlebars"],function(e){function t(e,t,n){return void 0!==e&&void 0!==t&&isNaN(e)&&isNaN(t)?e.toLowerCase()==t.toLowerCase()?n.fn(this):n.inverse(this):e==t?n.fn(this):n.inverse(this)}return e.registerHelper("ifequals",t),t}),define("hbs!common/templates/settings/visibilitySettings",["hbs","common/hbs/handlebars","common/templates/helpers/ifequals"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e,t){var i,a,r,s="";return s+='\r\n<a href="#" class="first ',a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:p.noop,fn:p.program(2,o,t)},i=a?a.call(e,e&&e.visibility,"none",r):m.call(e,"ifequals",e&&e.visibility,"none",r),(i||0===i)&&(s+=i),s+='">\r\n    <input type="radio" name="',(a=n.settingName)?i=a.call(e,{hash:{}}):(a=e&&e.settingName,i=typeof a===g?a.call(e,{hash:{}}):a),s+=v(i)+'" value="None">\r\n    <span rel="localize[No]">No</span>\r\n</a>\r\n<a href="#" class="last ',a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:p.noop,fn:p.program(2,o,t)},i=a?a.call(e,e&&e.visibility,"everyone",r):m.call(e,"ifequals",e&&e.visibility,"everyone",r),(i||0===i)&&(s+=i),s+='">\r\n    <input type="radio" name="',(a=n.settingName)?i=a.call(e,{hash:{}}):(a=e&&e.settingName,i=typeof a===g?a.call(e,{hash:{}}):a),s+=v(i)+'" value="Everyone">\r\n    <span rel="localize[Yes]">Yes</span>\r\n</a>\r\n'}function o(){return" selected"}function s(e,t){var i,a,r,s="";return s+='\r\n<a href="#" class="first ',a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:p.noop,fn:p.program(2,o,t)},i=a?a.call(e,e&&e.visibility,"none",r):m.call(e,"ifequals",e&&e.visibility,"none",r),(i||0===i)&&(s+=i),s+='">\r\n    <input type="radio" name="',(a=n.settingName)?i=a.call(e,{hash:{}}):(a=e&&e.settingName,i=typeof a===g?a.call(e,{hash:{}}):a),s+=v(i)+'" value="None">\r\n    <span rel="localize[MeOnly]">Me Only</span>\r\n</a>\r\n\r\n<a href="#" class="',a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:p.noop,fn:p.program(2,o,t)},i=a?a.call(e,e&&e.visibility,"friends",r):m.call(e,"ifequals",e&&e.visibility,"friends",r),(i||0===i)&&(s+=i),s+=" ",a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:p.noop,fn:p.program(5,l,t)},i=a?a.call(e,e&&e.minor,!0,r):m.call(e,"ifequals",e&&e.minor,!0,r),(i||0===i)&&(s+=i),s+='">\r\n    <input type="radio" name="',(a=n.settingName)?i=a.call(e,{hash:{}}):(a=e&&e.settingName,i=typeof a===g?a.call(e,{hash:{}}):a),s+=v(i)+'" value="Friends">\r\n    <span rel="localize[FriendsOnly]">Friends</span>\r\n</a>\r\n\r\n',a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:p.noop,fn:p.program(7,c,t)},i=a?a.call(e,e&&e.minor,!1,r):m.call(e,"ifequals",e&&e.minor,!1,r),(i||0===i)&&(s+=i),s+="\r\n"}function l(){return" last"}function c(e,t){var i,a,r,s="";return s+='\r\n<a href="#" class="',a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:p.noop,fn:p.program(2,o,t)},i=a?a.call(e,e&&e.visibility,"friendsandcrews",r):m.call(e,"ifequals",e&&e.visibility,"friendsandcrews",r),(i||0===i)&&(s+=i),s+='">\r\n    <input type="radio" name="',(a=n.settingName)?i=a.call(e,{hash:{}}):(a=e&&e.settingName,i=typeof a===g?a.call(e,{hash:{}}):a),s+=v(i)+'" value="FriendsAndCrews">\r\n    <span rel="localize[FriendsandCrew]">Friends & Crews</span>\r\n</a>\r\n\r\n<a href="#" class="last ',a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:p.noop,fn:p.program(2,o,t)},i=a?a.call(e,e&&e.visibility,"everyone",r):m.call(e,"ifequals",e&&e.visibility,"everyone",r),(i||0===i)&&(s+=i),s+='">\r\n    <input type="radio" name="',(a=n.settingName)?i=a.call(e,{hash:{}}):(a=e&&e.settingName,i=typeof a===g?a.call(e,{hash:{}}):a),s+=v(i)+'" value="Everyone">\r\n    <span rel="localize[Everyone]">Everyone</span>\r\n</a>\r\n'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var u,d,f,h="",p=this,m=n.helperMissing,g="function",v=this.escapeExpression;return d=n.ifequals||t&&t.ifequals,f={hash:{},inverse:p.program(4,s,a),fn:p.program(1,r,a)},u=d?d.call(t,t&&t.settingName,"profile_location",f):m.call(t,"ifequals",t&&t.settingName,"profile_location",f),(u||0===u)&&(h+=u),h+='\r\n<span class="privacyChangeAlert"></span>'});return n}),define("setup.environment.utils",["require","jquery","common/xhr","underscore","utils","common/baseUtils","common/virtualKeyboard","common/localize","common/am/socialCount","common/auth","common/sdk","hbs!common/templates/settings/visibilitySettings"],function(e){function t(e,t,n,i,a,r){if(L.isLauncher)e.css(t),"function"==typeof a&&a.call(e);else{if("undefined"!=typeof r&&!w.isScuiVisible())return r||e.css(t),void("function"==typeof a&&a.call(e));e.animate(t,n,i,a)}}function n(){var e=b("#activation").hasClass("pending");L.isLauncher&&!e&&A.quitGame(),A.clearActivePanel(function(){b("#serverError").removeClass("active"),e?(b("#activation").removeClass("pending"),b("#buttonCancel").is(":visible")?b("#buttonCancel").click():L.isLauncher?A.quitGame():A.requestUiState(!1)):A.requestUiState(!1)})}function i(e){A.toggleContentOff(e.find("#headerLogin"),{bottom:L.headerHeightBtm},200,"easeInQuart",function(){t(b("#headerLoginOptions"),{top:"24px"},200,"easeOutQuart"),t(b("#mainNav span"),{top:"0",opacity:1},200)}),e.find("#headerLoginUser").show()}function a(e){A.toggleContentOff(e.find("#headerLoginOptions"),{top:"-35px"},200,"easeInQuart",function(){A.toggleContentOn(b("#headerLogin"),{bottom:"12px"},200,"easeOutQuart")}),e.find("span.username").empty(),b("#signedInUser, #deleteProfileNickname, #headerLoginUser span.username").html(""),b("img.largeAvatar").attr("src",y.getAvatarUrlFromUrl()),b("img.smallAvatar").attr("src",y.getAvatarUrlFromUrl("",32))}function r(){return C.ajax({url:L.localUrl+"?_="+(new Date).getTime(),type:"HEAD",async:!1,silentFail:!0})}function o(e){function t(){L.hasConnection=!1,L.hasInternet=!1,e.reject("NoInternet","1004.1")}function n(){L.hasConnection=!1,L.hasInternet=!0,e.reject("SC_Down","2000.43")}var i=document,a="script",r=L.amUrl+"?_="+(new Date).getTime(),o=i.createElement(a),s=i.getElementsByTagName(a)[0];o.onerror=t,o.onload=n,o.src=r,s.parentNode.insertBefore(o,s)}function s(){b("#launcherStyle").show(function(){y.isGameSupported()&&e(["common/games/"+L.titleName],l)})}function l(e){var t=e.GetLauncherConfig?e.GetLauncherConfig():{};if(t.images&&t.imgInterval&&t.images.length){e.displayGameLogo&&e.displayGameLogo();var n=b("#launcherPics").empty();b(t.images).each(function(){n.append(b("<li>").append(b("<img>",{src:L.baseUrl+this})))}),c(t.imgInterval)}}function c(e){var t=b("#launcherPics"),n=t.find("li:first").addClass("active"),i=setInterval(function(){return A.isLauncherUiActive()?(n.removeClass("active"),n=n.next(),n.length||(n=t.find("li:first")),void n.addClass("active")):void clearInterval(i)},e)}function u(e,t){var n=b("#achievementsData2");if(n.html(""),e){if(e.NumAchievements>0){b("#awardsOverview").html(e.NumAchievementsAwarded+" / "+e.NumAchievements),b("#awardsPoints").html(e.NumPointsAwarded),b("#statsPanel .totalPts").html(e.NumPointsAwarded);var i=S.reduce(e.Achievements,function(e,i,a){var r=d(t,i.Id),o=f(a,i,r);return 0===a?A.removeLoading("statsPanel"):a%10===0&&(n.append(e),e=""),e+o},"");i.length&&n.append(i)}else y.WriteDebugLog("LoadGameAchievements","achievementsList","achievementsList.NumAchievements = 0");A.hideStats()||(b("#statsLink2").removeClass("disabled"),b("#onlineStatsLink").removeClass("disabled"))}n=null,A.initHeaderMenu(!0),b("body").css("cursor","default"),A.resetScrollbar("#statsPanel"),t=null,A.removeLoading("statsPanel")}function d(e,t){var n="";if(e&&e.find("Achievement[Id='"+t+"']").length){var i=e.find("Achievement[Id='"+t+"']").attr("DateAchieved");y.WriteDebugLog("getDateAchieved","compareDateAchieved id, date",t+","+i),n=i.split("T")[0],n=y.localizedDate(n,"YYYY-MM-DD")}return n}function f(e,t,n){var i="";t.DateAchieved>0&&(i=y.localizedDateFromUnix(t.DateAchieved,"YYYY-MM-DD"));var a,r="";t.Achieved?a=t.Description:(a=t.HowTo,r=t.Visible?" class='dimLayer'":" class='dimLayer dimLayerHidden'");var o=[];if(" class='dimLayer dimLayerHidden'"==r)o.push("<tr"+r+">"),o.push("<td class='image'><img class='avatar' src='"+L.baseUrl+"images/hidden.png' alt='' width='48' height='48'/></td>"),o.push("<td><h6>"+A.getText("HiddenAccomplishment","HomeSignin")+"</h6><p>????</p></td>"),o.push("<td class='pointsFriend'></td><td class='points'></td></tr>");else{var s;try{s=A.GetAchievementImage(t.Id)}catch(l){s=L.baseUrl+"images/temp-achievements-icon.gif"}o.push("<tr"+r+">"),o.push("<td class='image'><img class='avatar' src='"+s+"' alt='' width='48' height='48'/></td>"),o.push("<td><h6>"+t.Name+"</h6><p>"+a+"</p></td>"),o.push("<td class='pointsFriend'><span"+(n?" class='unlocked'":"")+"></span>"),o.push("<p>"+n+"</p></td>"),o.push("<td class='points'><span"+(i?" class='unlocked'":"")+"></span>"),o.push("<p>"+i+"</p></td></tr>")}return o.join("")}function h(e){var t={HasFocus:e.hasFocus,Text:void 0!=e.text?e.text:"",ForwardToGame:void 0!=e.forwardToGame?e.forwardToGame:!0,IsPassword:void 0!=e.isPassword?e.isPassword:void 0!=e.$el&&"password"==e.$el.attr("type")};void 0==e.maxLength&&void 0!=e.$el&&(e.maxLength=Number(e.$el.attr("maxlength")),isNaN(e.maxLength)&&(e.maxLength=0)),t.MaxNumChars=e.maxLength||255,void 0!=e.prompt&&(t.Prompt=e.prompt),A.CallGameMethod("RGSC_SET_TEXT_BOX_HAS_FOCUS",JSON.stringify(t),"RGSC_SET_TEXT_BOX_HAS_FOCUS_DEMO")}function p(e,t){var n="RGSC_GET_USER_STORE_AGE_APPROPRIATE_INFO",i=A.CallGameMethodAsync(n,null,"RGSC_GET_USER_STORE_AGE_APPROPRIATE_INFO_DEMO");i.done(function(n){"string"==typeof n&&(n=JSON.parse(n)),y.WriteDebugLog("checkStoreAgeAppropriate","ageCheckResp",JSON.stringify(n)),n.Valid?(clearInterval(t),D=!1,n.AgeAppropriate?"function"==typeof e.ofAgeCallbkFn&&e.ofAgeCallbkFn():"function"==typeof e.underAgeCallbkFn&&e.underAgeCallbkFn()):m(e,t)}),i.fail(function(){m(e,t)}),i.always(function(){I.clearAsyncFnInvocation(n)})}function m(e,t){if("undefined"==typeof P){var n=t;P=setTimeout(function(){g(e,n)},3e3)}}function g(e,t){clearInterval(t),D&&"function"==typeof e.errorCallbkFn&&e.errorCallbkFn()}function v(e){var t=document.createElement("a");return t.href=e,t.hostname}var b=e("jquery"),C=e("common/xhr"),S=e("underscore"),y=e("utils"),w=e("common/baseUtils"),_=e("common/virtualKeyboard"),E=e("common/localize"),k=e("common/am/socialCount"),T=e("common/auth"),I=e("common/sdk"),R=e("hbs!common/templates/settings/visibilitySettings"),A={};"undefined"==typeof window.globals&&(window.globals={});var L=window.globals;A.CallGameMethod=function(e,t,n,i){return I.CallGameMethod(e,t,n,i)},A.CallGameMethodAsync=function(e,t,n,i){return I.CallGameMethodAsync(e,t,n,i)},A.clearForms=function(e){var t=b("form");t.find(":input[type=text]").not(e).val(""),t.find(":input[type=password]").not(e).val(""),t.find(":input[type=hidden]").not(e).val("")},A.requestUiState=function(e){if(void 0==e&&(e=!1),e||!L.isLauncher){var t={Visible:e};A.CallGameMethod("RGSC_REQUEST_UI_STATE",JSON.stringify(t),"RGSC_REQUEST_UI_STATE_DEMO")}},A.resetCommerceStyling=function(e,t){("COMMERCE"!==e||"COMMERCE"===e&&""!==t)&&(b("#storePanel").removeAttr("style").removeClass("loaded"),b("#scuiPanelInstruction").removeAttr("class style"))},A.initStyling=function(e){y.WriteDebugLog("initStyling","isVisible",e),e?(L.isScuiVisible=!0,b("html").css("background-color","rgba(0, 0, 0, 0.6)"),A.isHeaderRequired()?A.showHeaderMenu():A.hideHeaderMenu()):(L.isScuiVisible=!1,b("html").removeAttr("style"),A.hideHeaderMenu())},A.closeModalsAndHideMenu=function(){"undefined"!=typeof window.amd.modals.ConfirmModalView&&window.amd.modals.ConfirmModalView.cancel(),"undefined"!=typeof window.amd.store.ProductInfoView&&window.amd.store.ProductInfoView.onClose(),b("#headerLoginOptionsDrop").hide(),b("#headerLoginOptionsButton").removeClass("active")},A.hideUI=function(){var e=b("div.panel.active");e.length&&e.stop().css("top",""),A.hideHeaderMenu(),b("html").removeAttr("style"),b("#notificationPanel").css("top",0),b("#scuiPanelInstruction").removeAttr("style"),A.closeModalsAndHideMenu(),y.pubsub.trigger("virtualKeyboard",!1),"undefined"!=typeof window.amd.store.StoreView&&window.amd.store.StoreView.onClose(),y.WriteDebugLog("setupEnvUtils.hideUI","UI now hidden")},A.PrePopulateData=function(){A.LoadLocalizedValues()},A.toggleContentOn=function(e,n,i,a,r){t(e,n,i,a,r,!0)},A.toggleContentOff=function(e,n,i,a,r){t(e,n,i,a,r,!1)},A.setBodyClass=function(e){e+=" current",b("body").addClass(e)},A.loadHomeFeed=function(){var e="html/"+L.size+"/homefeed.htm";if(y.isGameSupported()){var t="/homefeed.min.css";b("<link>",{rel:"stylesheet",type:"text/css",href:L.cssBase+"/"+L.size+"/"+L.titleName+t}).appendTo("head"),e="html/"+L.size+"/"+L.titleName+"/homefeed.htm"}b("#homefeedPanel").load(e,function(){b("a.closeButton").click(function(e){e.preventDefault(),A.clearActivePanel(function(){b(this).parents(".panel").removeClass("active"),A.CloseUI()})}),b("#homefeedPanel [rel*=localize], #intro [rel*=localize]").localize("HomeSignin",{language:L.titlelang,pathPrefix:L.baseAssetUrl+"xml/Shared"}),y.isGameSupported()&&b("#homefeedPanel [rel*=localize], #signUpConfirm [rel*=localize]").localize("General",{language:L.titlelang,pathPrefix:L.baseAssetUrl+"xml/"+L.titleName})})},A.setupTextInputGameNotifications=function(e){e.off("focusin.textEntry").on("focusin.textEntry",function(){var e=b(this),t=b("label[for="+e.attr("id")+"]"),n=void 0;t.length&&(n=t.text());var i={hasFocus:!0,text:e.val(),prompt:n,$el:e};A.setupTextEntry(i)}).off("focusout.textEntry").on("focusout.textEntry",function(){var e=b(this);h({hasFocus:!1,text:e.val(),$el:e,forwardToGame:!0})})},A.setupInputElementEvents=function(){A.setupTextInputGameNotifications(b("input:text, input:password, textarea"))},A.clearActivePanel=function(e){b("#headerLoginOptionsDrop").is(":visible")&&b("#headerLoginOptionsButton").click();var t=b("div.panel.active");if(t.filter("#launcherStyle").length&&b("body").removeClass(L.launcherClass),t.length){var n=t.height()+4;A.toggleContentOff(t,{top:"-"+n+"px"},200,"easeInQuart",function(){y.WriteDebugLog("toggleContentOff","complete",b(this).attr("id")),b(this).removeClass("active").css("top",""),"function"==typeof e&&e()})}else b("#signupPanelsWrapper").hasClass("active")?A.toggleContentOff(b("#signupPanelsWrapper"),{top:L.top},200,"easeInQuart",function(){b(this).removeClass("active").css("top",""),b("#signupPanels > div").hide(),"function"==typeof e&&e()}):"function"==typeof e&&e()},A.showFatalError=function(e){y.WriteDebugLog("showFatalError",e.errorCode,e.message),w.isScuiVisible()&&b.when(A.checkConnectionAsync()).fail(function(t,n){"NoInternet"==t&&e.codeDesc.indexOf("1000.1")>=0&&(e.message=A.getErrorWithCode(n).Message),n=y.errorCode(n),e.codeDesc=A.getError("Error")+":"+n,e.message=(e.message||"")+"<br><br>"+A.getError(t),e.message=e.message.replace(/1000.1/,n)}).always(function(t){return"NoInternet"!==t&&"SC_Down"!==t&&void 0!==e.errorFunction?void e.errorFunction({errorCode:e.errorCode,message:e.message,contentEl:e.contentEl,supportText:e.supportText,errorCodeDesc:e.codeDesc,responseText:e.responseText}):void A.loadErrorPanel(e)})},A.loadErrorPanel=function(e){A.clearActivePanel(function(){e=e||{},b("#confirmModal").find(".statusbar").remove(),w.pubsub.publish("modal.hide"),A.closeModalsAndHideMenu();var t=b("#serverError");A.setUpLoadingPanel("#serverError"),A.initErrorText(t,e),t.find(".errorContainer").data("antiscroll").refresh(),t.find(".content").show(),L.isLauncher?(b("#buttonServerErrorHome").hide(),b("#buttonServerErrorClose").unbind("click").click(n)):b("#buttonServerErrorClose").unbind("click").click(n),L.waitingResponse&&(y.WriteDebugLog("showFatalError","calling RGSC_UI_STATE_RESPONSE",""),A.CallGameMethod("RGSC_UI_STATE_RESPONSE",'{ "Visible": true }',"RGSC_UI_STATE_RESPONSE_DEMO"))})},A.initErrorText=function(e,t){if(e.find(".serverErrorTitle").html(void 0!=t.title&&t.title.length?t.title:A.getError("ServerError")),e.find(".serverErrorSubTitle").html("undefined"!=typeof t.subtitle&&t.subtitle.length?t.subtitle:A.getError("ErrorHasOccurred")),e.find(".errorDescription").html(void 0!=t.message&&t.message.length?t.message:""),e.find(".errorSubMessage").html(void 0!=t.supportText&&t.supportText.length?t.supportText:""),!t.codeDesc){var n="";t.errorCode&&(n=A.getErrorWithCode(t.errorCode).CodeDescription),t.codeDesc=n}e.find(".errorCodeDescription").html(t.codeDesc)},A.showGenericFatalError=function(e,t,n,i){var a={errorCode:e,message:t,supportText:n,codeDesc:i};A.showFatalError(a)},A.showMaintenancePage=function(e,t){var n=y.errorCode("1002.24"),i=A.getErrorWithCode(n,"");t=t?t:e?A.getError(e):void 0;var a={errorCode:n,message:i.Message,codeDesc:i.CodeDescription,title:A.getError("Maintenance"),subtitle:A.getError("FeatureDisabled"),supportText:t};A.showFatalError(a)},A.setUpLoadingPanel=function(e,t){var n=b(e);b("#headerLoginOptionsDrop").is(":visible")&&b("#headerLoginOptionsButton").click(),n.hasClass("active")?A.setUpLoading(e,t):(A.setUpLoading(e),A.showPanel(n,t))},A.setUpLoading=function(e,t){var n=b(e);n.find(".loadingMask:first").show(),y.initSpinner(n.find("span.loading:first")).fadeIn(),"function"==typeof t&&t()},A.showPanel=function(e,t){A.clearActivePanel(function(){e.addClass("active"),b("#launcherStyle").hasClass("active")&&(b("body").addClass(L.launcherClass),y.initDownloaderLauncher());var n=e.height()>L.panelHeight+4?"0px":L.headerHeight;y.WriteDebugLog("setupEnvUtils.showPanel","active added, topPx",e.attr("id")+" "+n),A.toggleContentOn(e,{top:n},400,"easeOutQuart",function(){"function"==typeof t&&t()})})},A.removeLoading=function(e){y.removeLoading(e)},A.isHeaderRequired=function(){var e=b("#storePanel").hasClass("active");return!e},A.isActivation=function(){return b("#activation").hasClass("active")},A.isEditProfile=function(){return b("#editProfile").hasClass("active")},A.isSignInOrSignUpOrMissingDetails=function(){return b("#signupPanelsWrapper").hasClass("active")},A.resetScrollbar=function(e){var t=b(b(e+" .box-wrap").length?e+" .box-wrap":e+".box-wrap");t.length&&t.data("antiscroll")&&t.each(function(){b(this).data("antiscroll").refresh();var e=b("#friendsList"),t=b("#friendInvitesList"),n=b("#blockListPlayercards");if(e.is(":visible")||t.is(":visible")||n.is(":visible")){var i=0,a=e.find("div.profileButton").length,r=t.find("div.profileButton").length,o=n.find("div.profileButton").length;a%20==0&&a--,r%20==0&&r--,o%20==0&&o--,"block"==e.css("display")?i=parseInt(a/20,10):"block"==t.css("display")?i=parseInt(r/20,10):"block"==n.css("display")&&(i=parseInt(o/20,10));var s=490*i*(1+(.016-2e-4*i)*i);b(this).data("antiscroll")&&b(this).data("antiscroll").vertical&&(b(this).data("antiscroll").vertical.innerEl.scrollTop=s)}if(!b("input").is(":focus")){var l=b(this).closest(".panel"),c=l.scrollTop();b(this).find(".antiscroll-inner").attr("tabindex","-1").css("position","fixed").focus().css("position",""),l.scrollTop(c)}})},A.CloseUI=function(){y.WriteDebugLog("CloseUI()","",""),A.setupTextEntry({hasFocus:!1}),A.requestUiState(!1)},A.showMessagePanel=function(e,t,n,i){return A.clearActivePanel(function(){i?b("#buttonOkMessage").show().bind("click",i):b("#buttonOkMessage").hide().unbind("click"),b("#messagePanel #messageTitle").html(e),b("#messagePanel #messageShortDesc").html(t),b("#messagePanel #messageLongDesc").html(n),A.setUpLoadingPanel("#messagePanel")}),!1},A.forceLoginForm=function(e){var t=e||b("#signInProfile");t.data("forceLoginForm",!0)},A.resetForceLoginForm=function(e){var t=e||b("#signInProfile");t.removeData("forceLoginForm")},A.isForceLoginForm=function(e){var t=e||b("#signInProfile");return t.data("forceLoginForm")===!0},A.CreateAccountSuccessSetup=function(e){y.stopSpinner(b("#submitAvatarWrapper span.loading")),b("#submitAvatarWrapper span, #onlinePolicies, .previousPanel, #termsTextContainer").hide(),y.pubsub.trigger("captcha.hide"),b("#avatarPanelInner").empty();var t=b("#signUpConfirm");e?(t.find("#signUpConfirmGreeting span.nickname").html(b("#signUpNickname").val()),t.find("h1").text(A.getText("Success","Register")),t.find("#signUpConfirmText, #signUpConfirmGreeting").show(),t.find("#signUpConfirmButton").show(),t.find(".pagination").show(),b("#avatar").hide(),A.updatePlayerListCounts("","","","")):(t.find("h1").text(A.getText("ServerError","Errors")),t.find("#signUpConfirmText, #signUpConfirmGreeting").hide(),t.find("#signUpConfirmButton").hide(),t.find(".pagination").hide()),t.fadeIn(),t.find("#signUpConfirmButton").focus()},A.setSelected=function(e){b("#mainNav .on").removeClass("on"),b(".sideMenu").find(".on").removeClass("on"),b(e).addClass("on")},A.setSelectedSide=function(e){var t=b(e);t.parents(".sideMenu").find(".on").removeClass("on"),t.addClass("on")},A.EnableSendMessageButton=function(e){var t=b("#newMessageName");e>0&&void 0!=t.attr("data-rockstarId")&&""!=t.attr("data-rockstarId")?b(".sendMessage").removeClass("disabled"):b(".sendMessage").addClass("disabled")},A.messagesListQuery=function(){var e=b("#messagesPanel");A.closeModalsAndHideMenu(),e.find("div.content").removeAttr("style"),b("#messagesHeader").show(),A.setUpLoadingPanel("#messagesPanel",function(){e.attr("class","panel active messages");var t=b("#messagesList").data("PageIndex");void 0===t&&(t=0,b("#messagesList").data("PageIndex",t)),y.pubsub.trigger("setup:GetMessages",t)})},A.setVersionNum=function(e){if(b("span.version").html(L.versionNum),y.WriteDebugLog("SetGameTitle","Version",L.versionNum),e&&"undefined"!=typeof e.Version){L.sdkVersion=e.Version;var t=e.Version;"dev"===L.rosEnvironment&&(t+=":D",b("body").addClass("dev"),b(".scui_ver:first").clone().prependTo("#header")),b("span.versionSDK").html(t)}},A.clearSelectedTabsAndPages=function(){b(".on").removeClass("on")},A.setupSignedInOptionsLauncher=function(){A.clearActivePanel(function(){y.WriteDebugLog("setupSignedInOptionsLauncher"),L.receiveMsgEnabled=!0,A.showLauncherUi(),w.pubsub.publish("launcher.launcherCommand",{command:"SetSpinnerText",parameter:{text:A.getError("Loading"),toggleMode:!0}})})},A.setUpSignedInOptions=function(e,t){y.WriteDebugLog("setUpSignedInOptions","signedIn,local",e+","+t);var n=b("#header");if(n.find("#headerLoginOptionsDrop").is(":visible")&&n.find("#headerLoginOptionsButton").click(),w.isSignedIn(e),L.isLauncher)return A.setupSignedInOptionsLauncher();if(e){A.initHeaderMenu(!0),i(n),n.find("#menuSettings").hide(),n.find("#menuDeleteProfile").hide(),n.find("#socialButton").hide(),n.find("#storeButton").hide(),n.find("#menuMessages").parent().hide(),w.isLocal(t);var r=n.find("#headerLoginOptions i.status").removeClass("SCOnline SCOffline Local");if(t)return n.find("#menuDeleteProfile").show(),r.addClass("Local"),!0;if(w.isLogoutDisabled()?n.find("#menuSignOut").hide():n.find("#menuSignOut").show(),A.isOffline())n.find("#menuDeleteProfile").show(),r.addClass("SCOffline");else{if(n.find("#menuSettings").show(),!y.isLegacyServiceLayer()){if(y.isStoreV2Enabled()){var o=function(){n.find("#storeButton").show()},s=null,l=function(){n.find("#storeButton").show()},c={ofAgeCallbkFn:o,underAgeCallbkFn:s,errorCallbkFn:l};y.pubsub.trigger("setupEnvUtils:checkStoreAgeAppropriate",c)}n.find("#socialButton").show(),n.find("#menuMessages").parent().show(),b("#compareStats").css("display","inherit"),b("#menuMessages").attr("countRetrieved",!1),b("#friendsPanel").attr("countsRetrieved",!1)}r.addClass("SCOnline")}}else a(n),b("#compareStats").hide(),b("table.overview tbody").empty(),A.isOnline()&&(y.isLegacyServiceLayer()||n.find("#socialButton").show(),b("#profileSettings").find("form")[0].reset(),b("#friendsPanel").find(".sideMenu .count").empty(),b("#landingFriendsList").empty());return!0},A.isOffline=function(e){return w.isOffline(e)},A.isOnline=function(e){return w.isOnline(e)},A.isLoadedInOnlineMode=function(){return w.isLoadedInOnlineMode()},A.isLoadedInOfflineMode=function(){return w.isLoadedInOfflineMode()},A.checkConnectionAsync=function(){var e=new b.Deferred;if(L.hasConnection||void 0==L.connectionCheckTimeout){L.connectionCheckTimeout=setTimeout(function(){L.connectionCheckTimeout=void 0},3e4);var t=r();t.done(e.resolve),t.fail(function(){o(e)})}else L.hasInternet?e.reject("SC_Down","2000.43"):e.reject("NoInternet","1004.1");return e.promise()},A.isLocal=function(e){return w.isLocal(e)},A.isSignedIn=function(e){return w.isSignedIn(e)},A.isScuiVisible=function(){return w.isScuiVisible()},A.isHeaderMenuVisible=function(){var e=b("#headerWrapper");return e.length>0&&e.position().top>=0&&e.is(":visible")},A.showHeaderMenu=function(e,t){return w.isScuiVisible()?(y.WriteDebugLog("showHeaderMenu","headerWrapper","showing #headerWrapper since SCUI is visible"),void(e?b("#headerWrapper").show().animate({top:"0"},400,"easeOutQuart",function(){"function"==typeof t&&t()}):b("#headerWrapper").show().css({top:"0"}))):void y.WriteDebugLog("showHeaderMenu","skipped","SCUI not visible")},A.hideHeaderMenu=function(){y.WriteDebugLog("hideHeaderMenu","headerWrapper","hiding #headerWrapper"),b("#headerWrapper").hide().css({top:"-80px;"})},A.initHeaderMenu=function(e,t){y.WriteDebugLog("initHeaderMenu","showNavigation, enableSignIn",e+","+t);var n=w.isScuiVisible(),i=b("#headerWrapper");if(n&&!A.isHeaderMenuVisible()&&A.showHeaderMenu(),L.isLauncher&&(e=!1),e){if(y.pubsub.trigger("setCloseInstructions"),n&&b("#scuiPanelInstruction").delay(1e3).fadeIn("slow"),b("#mainNav").hide(),w.isSignedIn()&&(L.account.Minor&&b("#storeButton").hide(),"gta5"!==L.titleName&&b("#headerLoginOptionsDrop #menuQuitGame").parent().remove(),!A.pendingAccountCompletion())){var a=i.find("#header");a.find("li:not(.social)").removeClass("disabled dimLayer"),a.find("h1").removeClass("disabled dimLayer"),i.find("#headerLogin").find("a").removeClass("disabled dimLayer"),i.find("#headerLoginOptionsButton").removeClass("disabled dimLayer"),!A.isOffline()&&!y.isLegacyServiceLayer()&&L.scsServiceEnabled&&L.accountsServiceEnabled&&i.find("#headerLoginUser").removeClass("disabled"),n&&A.isOnline()&&(y.isLegacyServiceLayer()||a.find("li.social").show()),n&&b("#mainNav").show()}}else b("#mainNav").hide(),t?i.find("#headerLogin").find("a").removeClass("disabled dimLayer"):(i.find("#headerLogin").find("a").addClass("disabled dimLayer"),b("#scuiPanelInstruction").removeAttr("style")),i.find("#header").find("h1").addClass("disabled dimLayer"),i.find("#headerLoginOptionsButton").addClass("disabled dimLayer"),i.find("#headerLoginUser").addClass("disabled")},A.pendingAccountCompletion=function(){return b("#dob").hasClass("DOBUpdate")||b("#dob").hasClass("countryUpdate")||b("#dob").hasClass("DOBAndCountryUpdate")},A.quitGame=function(){y.WriteDebugLog("Desktop.quitGame"),A.launcherWindowsEvent("Close")},A.minimizeUi=function(){y.WriteDebugLog("Desktop.minimizeUi"),A.launcherWindowsEvent("Minimize")},A.launcherWindowsEvent=function(e){I.launcherWindowsEvent(e)},A.launcherUiEvent=function(e){I.launcherUiEvent(e)},A.launcherNotifyEvent=function(e){I.launcherNotifyEvent(e)},A.launcherData=function(e,t){I.launcherData(e,t)},A.debugEvent=function(e){I.debugEvent(e)},A.showLauncherUi=function(){if(!L.receiveMsgEnabled||A.isLauncherUiActive())return void y.WriteDebugLog("showLauncherUi","aborted",(!L.receiveMsgEnabled).toString()+" || "+A.isLauncherUiActive().toString());b("body").addClass(L.launcherClass),y.initDownloaderLauncher();var e=b("#launcherStyle");A.wasLauncherQuickLaunched()?(e.removeClass("quick"),s()):e.show(function(){A.showHeaderMenu(),A.setUpLoadingPanel("#launcherStyle"),s()})},A.quickShowLauncherUi=function(){return y.WriteDebugLog("quickShowLauncherUi"),!L.receiveMsgEnabled||A.isAnyPanelActive()?void y.WriteDebugLog("quickShowLauncherUi","aborted"):(L.isScuiVisible=!0,b("body").addClass(L.launcherClass),y.initDownloaderLauncher(),void A.setUpLoading("#selectProfile",function(){var e=b("#launcherStyle"),t=e.height()>L.panelHeight+4?"0px":L.headerHeight;e.css({top:t}).show().addClass("active quick"),A.showHeaderMenu()}))},A.isLauncherUiActive=function(){return b("#launcherStyle").hasClass("active")&&!A.wasLauncherQuickLaunched()},A.wasLauncherQuickLaunched=function(){return b("#launcherStyle").hasClass("quick")},A.isAnyPanelActive=function(){return b("div.panel.active").length},A.setPrivacyAndGameOptions=function(e,t){A.setPrivacyOptions(e),A.setCloudSave(t),b("#gameSettings").addClass("loaded"),A.removeLoading("editProfile")},A.setPrivacyOptions=function(e){if("undefined"==typeof e||!e.Privacy)return void y.WriteDebugLog("setPrivacyOptions","invalid data param");var t=e.Privacy;y.WriteDebugLog("setPrivacyOptions","data",t);var n={visibility:t.ProfileVisibility.toLowerCase(),minor:L.account.Minor,settingName:"sc"},i=y.renderCompiledTemplate(R,n);b("#togglePrivacyProfile").html(i).find("[rel*=localize]").localize("Settings",{language:L.titlelang,pathPrefix:L.baseAssetUrl+"xml/Shared"}),n.visibility=t.ProfileLocation.toLowerCase(),n.settingName="profile_location";var a=y.renderCompiledTemplate(R,n);b("#togglePrivacyCountry").html(a).find("[rel*=localize]").localize("Settings",{language:L.titlelang,pathPrefix:L.baseAssetUrl+"xml/Shared"}),n.visibility=t.GamePlayVisibility.toLowerCase(),n.settingName="gameplay_visibility";var r=y.renderCompiledTemplate(R,n);b("#togglePrivacyStats").html(r).find("[rel*=localize]").localize("Settings",{language:L.titlelang,pathPrefix:L.baseAssetUrl+"xml/Shared"}),n.visibility=t.PresenceVisibility.toLowerCase(),n.settingName="presencevisibility";var o=y.renderCompiledTemplate(R,n);b("#togglePresenceVisibility").html(o).find("[rel*=localize]").localize("Settings",{language:L.titlelang,pathPrefix:L.baseAssetUrl+"xml/Shared"})},A.setCloudSave=function(e){var t=b("#gameSettings"),n="undefined"==typeof e||"undefined"==typeof e.Enabled||"unknown"===e.Enabled;
if(!y.isCloudSaveEnabled()||n)t.find("fieldset.cloudsave").remove();else{var i=t.find('input:radio[name="radioCloudSave"]'),a=i.filter('[value="'+e.Enabled+'"]').closest("a");a.closest("span.toggleOptions").children("a").removeClass("selected"),a.addClass("selected")}},A.GetAuthHeaderAsync=function(e){var t=new b.Deferred;if(void 0==e){y.WriteDebugLog("GetAuthHeaderAsync");var n=A.getCredsAsync();n.done(function(e){var n="";if(y.WriteDebugLog("GetAuthHeaderAsync","promise done",n),"undefined"!=typeof e&&"undefined"!=typeof e.Ticket&&null!==e.Ticket&&e.Ticket.length)t.resolve(T.wrapAuthHeader(e.Ticket));else{var i={iss:w.isSteam(),l:L.titlelang,f:""};"undefined"!=typeof L.ticket&&null!=L.ticket&&L.ticket.length?(i.f="fallback",y.WriteDebugLog("GetAuthHeaderAsync","creds undefined or missing ticket",JSON.stringify(i)+L.debugLog,y.logType.error,y.logController[L.titleName]),L.debugLog="",t.resolve(T.wrapAuthHeader(L.ticket))):(y.WriteDebugLog("GetAuthHeaderAsync","creds undefined or missing ticket",JSON.stringify(i)+L.debugLog,y.logType.error,y.logController[L.titleName]),L.debugLog="",t.reject())}}),n.fail(function(){y.WriteDebugLog("GetAuthHeaderAsync","getCredsAsync rejected","",y.logType.error,y.logController[L.titleName]),t.reject()})}else t.resolve(T.wrapAuthHeader(e));return t.promise()},A.GetAuthHeaderAsyncV8=function(e){var t=new b.Deferred;if(void 0==e){var n=A.getCredsAsync();n.done(function(e){if("undefined"!=typeof e&&"undefined"!=typeof e.Ticket&&null!==e.Ticket&&e.Ticket.length)t.resolve(T.wrapAuthHeaderV8(e.Ticket));else{var n={iss:w.isSteam(),l:L.titlelang,f:""};"undefined"!=typeof L.ticket&&null!=L.ticket&&L.ticket.length?(n.f="fallback",y.WriteDebugLog("GetAuthHeaderAsyncV8","creds undefined or missing ticket",JSON.stringify(n)+L.debugLog,y.logType.error,y.logController[L.titleName]),L.debugLog="",t.resolve(T.wrapAuthHeaderV8(L.ticket))):(y.WriteDebugLog("GetAuthHeaderAsyncV8","creds undefined or missing ticket",JSON.stringify(n)+L.debugLog,y.logType.error,y.logController[L.titleName]),L.debugLog="",t.reject())}}),n.fail(function(){y.WriteDebugLog("GetAuthHeaderAsyncV8","getCredsAsync rejected","",y.logType.error,y.logController[L.titleName]),t.reject()})}else t.resolve(T.wrapAuthHeaderV8(e));return t.promise()},A.getSyncHeader=function(){var e=T.getAuthToken();return"undefined"!=typeof e&&e.length?{Sync:e}:(y.WriteDebugLog("getSyncHeader","Sync header missing","",y.logType.error,y.logController[L.titleName]),{})},A.appendLanAuthHeader=function(e){var t=T.getLanAuthValue();return"undefined"!=typeof t&&t.length||y.WriteDebugLog("getLanAuthHeader","Auth header missing","",y.logType.error,y.logController[L.titleName]),e.Auth=t,e},A.getCombinedSyncHeaders=function(e){var t=A.getSyncHeader();return{Sync:t.Sync,AuthVal:e}},A.getCredsAsync=function(){y.WriteDebugLog("getCredsAsync");var e=A.CallGameMethodAsync("RGSC_GET_ROS_CREDENTIALS",null,"RGSC_GET_ROS_CREDENTIALS_DEMO");return e},A.getLocalizationCacheForContext=function(e){return E.getLocalizationCacheForContext(e)},A.LoadLocalizedValues=function(){y.WriteDebugLog("LoadLocalizedValues","globals.titleName",L.titleName);var e=["shared/Errors","shared/HomeSignin","shared/Notifications","shared/Register"],t=L.titlelang+".xml";S.each(e,function(e){E.getLocalizedTextXML("xml/"+e+t)}),b("[rel*=localize]").localize("Register",{language:L.titlelang,pathPrefix:L.baseAssetUrl+"xml/Shared"}),y.isGameSupported()&&b("#signUpConfirm [rel*=localize]").localize("General",{language:L.titlelang,pathPrefix:L.baseAssetUrl+"xml/"+L.titleName}),b("#dob").addClass("localized")},A.GetLocalizedTextXML=function(e){return E.getLocalizedTextXML(e)},A.getText=function(e,t,n,i){return E.getText(e,t,n,i)},A.getError=function(e){return E.getError(e)},A.getRequestDescription=function(e,t){return E.getRequestDescription(e,t)},A.getErrorWithCode=function(e,t){return E.getErrorWithCode(e,t)},A.initLocalization=function(e,t){b(".localized").removeClass("localized"),b("[rel*=localize]").localize("HomeSignin",{language:t,pathPrefix:L.baseAssetUrl+"xml/Shared"}),b("#header").addClass("localized"),b("#serverError [rel*=localize]").localize("Errors",{language:t,pathPrefix:L.baseAssetUrl+"xml/Shared"}).addClass("localized"),b("html").attr("lang",t)},A.LoadGameAchievements=function(e,t){y.WriteDebugLog("LoadGameAchievements","achievementsList, $compareAchievementsXml",e+","+t),b("#statsPanel #achievementsHeader").show(),b("body").css("cursor","progress");var n;if(null==e)n=A.CallGameMethodAsync("RGSC_GET_ACHIEVEMENT_LIST",null,"RGSC_GET_ACHIEVEMENT_LIST_DEMO");else{var i=b.Deferred();n=i.promise(),i.resolve(e)}n.done(function(e){u(e,t)}),n.fail(function(){u(e,t)})},A.GetAchievementImage=function(e){if("demo"==w.getUrlVars("mode"))return L.baseUrl+"images/temp-achievements-icon.png";if(y.isLegacyServiceLayer()){var t=RGSC_GET_ACHIEVEMENT_IMAGE('{ "AchievementId": '+e+" }");return null!=t&&t.length>0?y.GetBase64AvatarSrc(t):L.baseUrl+"images/temp-achievements-icon.gif"}return"http://RGSC/RGSC_GET_ACHIEVEMENT_IMAGE/"+e},A.getAvatarSource=function(e,t,n){var i=!0;32==t&&(i=!1);var a=A.CallGameMethod("RGSC_GET_AVATAR",'{ "AvatarUrl": "'+e+'", "LargeVersion": '+i+" }",null);return 128==t?(n.on("error",function(){return A.isOffline()?void n.attr("src","ext/scui/images/avatars/128x128/default.png"):(n.attr("src",y.GetBase64AvatarSrc(a)),void n.unbind("error"))}),y.getAvatarUrlFromUrl(e,128)):(n.on("error",function(){return A.isOffline()?void n.attr("src","ext/scui/images/avatars/default.png"):(n.attr("src",y.getAvatarUrlFromUrl(e,t)),void n.unbind("error"))}),void 0!=a?y.GetBase64AvatarSrc(a):y.getAvatarUrlFromUrl(e,t))},A.setProfileHtml=function(e){y.WriteDebugLog("setProfileHtml","account.Nickname, account.RockstarId",L.account.Nickname+","+L.account.RockstarId),L.account&&(b("#signedInUser, #deleteProfileNickname, #headerLoginUser span.username").html(L.account.Nickname),!e&&L.avatarServiceEnabled?(b("img.largeAvatar").attr("src",y.getAvatarUrlFromNickname(L.account.Nickname,64)),b("img.extraLargeAvatar").attr("src",y.getAvatarUrlFromNickname(L.account.Nickname,128)),b("img.smallAvatar").attr("src",y.getAvatarUrlFromNickname(L.account.Nickname,32))):null==L.account.AvatarUrl||""==L.account.AvatarUrl||L.account.AvatarUrl.match(/blank.gif$/)||L.account.AvatarUrl.match(/default.png$/)?(b("img.largeAvatar").attr("src",y.getAvatarUrlFromUrl()),b("img.extraLargeAvatar").attr("src",y.getAvatarUrlFromUrl("",128)),b("img.smallAvatar").attr("src",y.getAvatarUrlFromUrl("",32))):(b("img.largeAvatar").attr("src",A.getAvatarSource(L.account.AvatarUrl,64,b("img.largeAvatar"))),b("img.extraLargeAvatar").attr("src",A.getAvatarSource(L.account.AvatarUrl,128,b("img.extraLargeAvatar"))),b("img.smallAvatar").attr("src",A.getAvatarSource(L.account.AvatarUrl,32,b("img.smallAvatar")))),b("#editRockstarId").val(void 0!=L.account.RockstarId&&null!=L.account.RockstarId&&L.account.RockstarId.length>0?L.account.RockstarId:void 0!=L.account.Nickname&&null!=L.account.Nickname&&L.account.Nickname.length>0?L.account.Nickname:""))},A.launchExternalBrowserForUrl=function(e){if("pcros"!=L.platform)return void y.WriteDebugLog("RSGC_LAUNCH_EXTERNAL_WEB_BROWSER","Error","platform: "+w.getGamePlatform());try{A.CallGameMethod("RSGC_LAUNCH_EXTERNAL_WEB_BROWSER",'{ "Url":"'+e+'"}',"RGSC_LAUNCH_EXTERNAL_WEB_BROWSER_DEMO")}catch(t){y.WriteDebugLog("RSGC_LAUNCH_EXTERNAL_WEB_BROWSER","Error",t.message,y.logType.error,y.logController[L.titleName])}},A.launchExternalBrowser=function(e){return e.preventDefault(),"pcros"==L.platform&&b(this).hasClass("RGSCLoadExt")?(A.launchExternalBrowserForUrl(this.href),!1):(y.WriteDebugLog("RSGC_LAUNCH_EXTERNAL_WEB_BROWSER","Error","platform: "+w.getGamePlatform()+", has RGSCLoadExt class:"+!b(this).hasClass("RGSCLoadExt")),!1)},A.launchExternalBrowserWithScAuth=function(e,t){if(e&&e.preventDefault(),"pcros"!=L.platform||"undefined"==typeof t&&!b(this).hasClass("RGSCLoadExtAuth"))return y.WriteDebugLog("RSGC_LAUNCH_EXTERNAL_WEB_BROWSER","Error","platform: "+w.getGamePlatform()+", has RGSCLoadExtAuth class:"+!b(this).hasClass("RGSCLoadExtAuth")),!1;var n="undefined"==typeof t?this.href:t,i=A.GetAuthHeaderAsync();return i.done(function(e){C.ajax({type:"POST",url:y.getApiUrl("/api/profile/getscauthtoken"),headers:e,services:["accounts"],contentType:"application/json; charset=utf-8",dataType:"xml",cache:!0,success:function(e){var t=b(e),i=t.find("Status");if(i.length&&"true"==i.text()){var a=t.find("ScAuthToken").text(),r="ScAuthToken="+encodeURIComponent(a),o=-1!==n.indexOf("?");n+=o?"&"+r:"?"+r,A.launchExternalBrowserForUrl(n)}}})}),!1},A.setupTextEntry=function(e){e.forwardToGame=void 0!=e.forwardToGame?e.forwardToGame:!0,_.isActive()||h(e),e.hasFocus&&_.setInputElement(e.$el),e.hasFocus&&w.inGamePadMode()&&!e.forwardToGame?y.pubsub.trigger("virtualKeyboard",!0):e.hasFocus&&!w.inGamePadMode()?_.destroyKeyboard():e.hasFocus||y.pubsub.trigger("virtualKeyboard",!1)},A.isMyProfileVisible=function(){var e=b("#friendProfilePanel");return e.hasClass("active")&&e.find("#user").is(":visible")&&e.find(".user-data h3").length&&e.find(".user-data h3").html()==L.account.Nickname},A.mapTitleDisplayName=function(e){var t=e;switch(e){case"GTA V":case"GTA5":t="Grand Theft Auto V"}return t},A.setTitleDisplayName=function(e){y.WriteDebugLog("setTitleDisplayName","TitleDisplayName",e),b(".titleDisplayName").html(e)},A.setCloseInstructions=function(){var e=w.inGamePadMode()?"QuitMessageGamePad":"QuitMessage",t=A.getText(e,"HomeSignin");b("#scuiPanelInstruction").html(t),b("#storePanel").find(".quitMessage").html(t)},A.setOffline=function(e){y.WriteDebugLog("setOffline","offline",e);var t=b("#homefeedPanel"),n=b("#header");if(e){if(b("#menuMessages").parent().hide(),b("#offlineHomeImage").attr("src",L.baseUrl+"/images/rstar_logo.jpg"),w.isOffline(!0),L.OfflineOnly){var i=t.find(".offlineMode");i.find(".offlineMessage").html(A.getText("offlineOnlyHome","HomeSignin")),i.find("#retryConnection").hide()}if(t.addClass("offline"),b("body").addClass("offline"),L.localProfileCreation?(n.find("#headerLogin .headerLoginText").hide(),n.find("#headerLogin .headerLoginTextOffline").show()):(n.find("#joinClub").hide(),n.find("#headerLogin .headerLoginText").find('[rel="localize[Or]"]').hide()),t.find(".trends").hide(),t.find(".newsRow").hide(),!L.scsServiceEnabled){var a=A.getText("NoServicesSignin","HomeSignin");b("#signInProfile").find("div.offlineMode .offlineMsg").html(a),b("#selectProfile").find("div.offlineMode .offlineMsg").html(a),b("#homefeedPanel").find("div.offlineMode p.offlineMessage").text(A.getText("OnlineDisabled","Errors"))}A.hideStats(),b("#landingFriends").find("h3").hide(),b("#landingFriends").find("#noFriends").hide()}else y.isLegacyServiceLayer()||n.find("#socialButton").show(),w.isOnline(!0),t.removeClass("offline"),b("body").removeClass("offline"),n.find("#headerLogin .headerLoginText, #joinClub").removeAttr("style"),n.find("#headerLogin .headerLoginText").find('[rel="localize[Or]"]').removeAttr("style"),n.find("#headerLogin .headerLoginTextOffline").hide(),t.find(".contentWrapper").show(),t.find(".trends").show(),t.find(".newsRow").length>0&&t.find(".newsRow").html().length>0&&t.find(".newsRow").show(),b("#statsLink2").parent("li").show()},A.retryConnection=function(e){var t=b("#messagePanel");t.find("[rel*=localize]").localize("Register",{language:L.titlelang,pathPrefix:L.baseAssetUrl+"xml/Shared"}),A.showMessagePanel(A.getError("NoCon"),A.getError("UnableConnect"),e),b("#buttonCancelMessage").hide(),t.find(".closeCurrentPanel").off("click").on("click",function(){b("#activationCode").prop("disabled")?A.requestUiState(!0):L.isLauncher?(y.pubsub.trigger("entitlements.activateCode",3),A.clearActivePanel(function(){y.pubsub.trigger("signin.signOut")})):y.pubsub.trigger("entitlements.activateCode",3)})},A.cancelAndCloseMsgPanel=function(e){var t=b("div.panel.active");if(t.length>0)switch(t.attr("id")){case"confirmPanel":var n=!1;if(b("#confirmPanel .buttonCancelConfirm").each(function(){return b(this).is(":visible")?(n=!0,b(this).click(),!1):void 0}),n)break;if(b("#confirmPanelNo").is(":visible")){b("#confirmPanelNo").click();break}if(b("#confirmPanelOk").is(":visible")){b("#confirmPanelOk").click();break}break;case"messagePanel":if(b("#buttonCancelMessage").is(":visible")){b("#buttonCancelMessage").click();break}if(b("#buttonCloseMessage").is(":visible")){b("#buttonCloseMessage").click();break}break;case"activation":if(t.hasClass("redemption"))break;if(b("#buttonCancel").is(":visible")){b("#activation").removeClass("pending"),b("#buttonCancel").click();break}case"serverError":b("#activation").hasClass("pending")&&(b("#activation").removeClass("pending"),b("#buttonCancel").is(":visible")&&b("#buttonCancel").click())}else A.setOffline(!e.Online);A.clearActivePanel(function(){A.requestUiState(!1)})},A.reloadActiveStatsPage=function(){var e=b("div.panel.active");"statsPanel"===e.attr("id")?(e.removeClass("active"),b("#statsButton").click()):"achievementsPanel"===e.attr("id")&&(e.removeClass("active"),b("#achievementsButton").click())},A.updatePlayerListCounts=function(e,t,n,i){b("#myFriendsLink").find("span.count").html(e),b("#friendInvitesLink").find("span.count").html(t),b("#gameInvitesLink").find("span.count").html(n),b("#blockListLink").find("span.count").html(i)},A.updateUIAFterFriendInviteSent=function(e,t,n){y.WriteDebugLog("updateUIAFterFriendInviteSent","rockstarId",e);var i=A.getText("FriendRequestSent","Social").replace("[PlayerNickname]","<strong><em> "+t+" </em></strong>");w.pubsub.publish("notificationFn.infoMessage",i);var a=n.find(".friend.remove.cancelFriendInvite");a.length>0||(y.pubsub.trigger("gameFnFriends:UpdateFriendStatus_"+e,{RockstarId:e,Relationship:4}),A.UpdateSocialSideMenuCount("add","#myFriendsLink",!1))},A.updateUIAFterFriendCancelInviteSent=function(e,t){y.WriteDebugLog("updateUIAFterFriendCancelInviteSent","rockstarId",e),y.pubsub.trigger("gameFnFriends:UpdateFriendStatus_"+e,{RockstarId:e,Relationship:0}),b("#friendsList").find("div.profileButton[data-id='"+e+"']").remove();var n=A.getText("InviteDeleted","Social").replace("[PlayerNickname]","<strong><em> "+t+" </em></strong>");w.pubsub.publish("notificationFn.infoMessage",n),A.UpdateSocialSideMenuCount("subtract","#myFriendsLink",!1)},A.UpdateSocialSideMenuCount=function(e,t,n){var i=b(t),a=i.find(".count"),r=0;return a.text()&&(r=parseInt(a.text(),10)),r="add"===e?r+1:r-1,y.WriteDebugLog("UpdateSocialSideMenuCount","tab: numFriends",t+": "+r),a.text(r>0?r:""),i.data("total",r),("#myFriendsLink"===t||"#friendInvitesLink"===t)&&b("#friendsList").data("total",r),!n||"#myFriendsLink"!==t&&"#friendInvitesLink"!==t||k.updateFriendCount(e),r},A.TabIsActive=function(e){return e.hasClass("on")},A.isActivePanel=function(e){var t=b(e);return t.length?t.hasClass("active"):!1},A.hideStats=function(){var e="lanoire"!==L.titleName&&A.isOffline()||"lanoire"!==L.titleName&&!L.statsServiceEnabled;return e&&(b("#statsLink2").parent("li").hide(),b("#onlineStatsLink").parent("li").hide()),e};var P,D;return A.checkStoreAgeAppropriate=function(e){D=!0,P=void 0;var t=setInterval(function(){p(e,t)},300)},A.InternetConnectedStateAsync=function(){var e=new b.Deferred,t=A.CallGameMethodAsync("RGSC_INTERNET_CONNECTED_STATE",null,"RGSC_INTERNET_CONNECTED_STATE_DEMO");return t.done(function(t){var n=void 0;"undefined"!=typeof t&&(n=t.Result),e.resolve(n)}),t.fail(function(){e.resolve(void 0)}),e.promise()},A.LandingFriendsHaveBeenRetrieved=function(){var e=b("#landingFriends").find("#noFriends.emptySocial"),t=b("#landingFriendsList").find("li");return e.is(":visible")||t.length>0},A.isUrlWhitelisted=function(e){var t=L.redirectUrlWhitelist.split(","),n=v(e),i=n.replace(/^\w*\.(?!\w+\s*\n)/i,"");return b.inArray(n,t)>-1||b.inArray(i,t)>-1},A.activePanelId=function(){var e=b(".panel.active");return e.length?e.attr("id"):void 0},A.showCustomAvatarInfoContainer=function(){b("#customAvatarContainer").show(),b("#customAvatarInfo").hide(),b("#customAvatar a").removeClass("open").addClass("close")},A.hideCustomAvatarInfoContainer=function(){b("#customAvatarContainer").hide(),b("#customAvatar a").removeClass("open").addClass("close")},y.pubsub.on("setCloseInstructions",A.setCloseInstructions),y.pubsub.on("setupEnvUtils:launcherDebugEvent",A.debugEvent),y.pubsub.on("setupEnvUtils:checkStoreAgeAppropriate",A.checkStoreAgeAppropriate),y.pubsub.on("setupEnvUtils:launchExternalBrowserForUrl",A.launchExternalBrowserForUrl),y.pubsub.on("setupEnvUtils.showFatalError",A.showFatalError),A}),define("common/validation",[],function(){var e={};return e.hasStringValue=function(e){return"string"==typeof e&&e.length>0},e.email=function(t){if(!e.hasStringValue(t))return!1;var n=/^[A-Za-z0-9_\-\+]+([.'][A-Za-z0-9_\-\+]+)*@[A-Za-z0-9]+([-.][A-Za-z0-9]+)*\.[A-Za-z]{2,}$/;return t=t.trim(),n.test(t)},e.nicknameLength=function(t){return e.hasStringValue(t)?t.length>=6&&t.length<=16:!1},e.nicknameForSearch=function(t){return e.hasStringValue(t)?/^([a-zA-Z0-9_\.\-]{3,16})$/.test(t):!1},e.nickname=function(t){return e.hasStringValue(t)?/^([a-zA-Z0-9_\.\-]{6,16})$/.test(t):!1},e.equals=function(e,t){return e===t},e.passwordForSignin=function(t){return e.hasStringValue(t)?t.length>0&&t.length<=globals.passMax:!1},e.password=function(t,n){if(!e.hasStringValue(t))return!1;var i=/^(?=.*[0-9])(?=.*[A-Z])^(.+)$/;return(n||i).test(t)},e.getPasswordError=function(e){return"string"==typeof e&&(e=e.replace(/\[min\]/gi,globals.passMin).replace(/\[max\]/gi,globals.passMax)),e},e.isDate=function(e,t,n){var i=new Date(e+"/"+t+"/"+n);return i.getFullYear()===Number(n)&&i.getDate()===Number(t)&&i.getMonth()+1===Number(e)},e.dob=function(t,n,i,a){var r;return""===t||""===n||""===i?r="emptyInput":e.isDate(t,n,i)?a&&e.calculateAge(t,n,i)<13&&(r="tooYoung"):r="invalidDate",{status:"undefined"==typeof r,reason:r}},e.calculateAge=function(e,t,n){var i=new Date,a=i.getFullYear(),r=i.getMonth(),o=i.getDate(),s=a-n;return e-1>r&&s--,e-1===r&&t>o&&s--,s},e}),define("common/reCaptcha",["jquery","utils","setup.environment.utils"],function(e,t,n){function i(n){function i(){f()&&(clearInterval(a),g(n.publicKey,n.elementId,{tabindex:n.tabIndex,theme:n.theme,lang:n.lang,callback:n.callback})),setTimeout(function(){clearInterval(a)},3e3)}if(null===n||void 0===n||void 0===n.publicKey||void 0===n.elementId)return void t.WriteDebugLog("reCaptcha.init","ERROR","failed due to missing required options");void 0!==n.theme&&""!=n.theme&&e.inArray(n.theme,w)||(n.theme=y),void 0===n.tabIndex&&(n.tabIndex=1),(void 0===n.lang||2!=n.lang.length)&&(n.lang="en"),S=n;var a=setInterval(i,300)}function a(){if("undefined"==typeof C.$element)return"signin";switch(C.$element.attr("id")){case l().attr("id"):return"signin";case c().attr("id"):return"signup";default:return"editEmail"}}function r(e){switch(e){case"signin":C.$element=l();break;case"signup":C.$element=c();break;case"editEmail":C.$element=u()}}function o(e){var t="";"undefined"!=typeof e?t=a():e="",t!==e&&(C.remove(),C.initCaptcha(e))}function s(e){return"undefined"!=typeof e&&e.length?e.val():""}function l(){return e("#signInReCaptchaInput")}function c(){return e("#signUpReCaptchaInput")}function u(){return e("#editEmailCaptcha")}function d(){return e("#emailForm")}function f(e){return"object"!=typeof window.Recaptcha||null==window.Recaptcha?(t.WriteDebugLog("isRecaptchaLoaded","ERROR","Google ReCaptcha property not available on window object"),!1):"string"==typeof e&&"function"!=typeof window.Recaptcha[e]?(t.WriteDebugLog("isRecaptchaLoaded","ERROR","Google ReCaptcha function ("+e+") not available on window.ReCaptcha object"),!1):"object"==typeof e?(t.WriteDebugLog("isRecaptchaLoaded","ERROR","func parameter is invalid: object passed rather than a string"),!1):!0}function h(e){var t=document.getElementById("recaptcha_response_field");null!==t&&"undefined"!=typeof t&&(t.style.border=e?_:E)}function p(e){var t;switch(e){case"incorrect-captcha-sol":t=n.getText("ReCaptchaError1","HomeSignin");break;case"captcha-timeout":t=n.getText("ReCaptchaError2","HomeSignin");break;case"recaptcha-not-reachable":t=n.getText("ReCaptchaError3","HomeSignin");break;default:t=n.getText("ReCaptchaError4","HomeSignin")}return t}function m(){f("destroy")&&window.Recaptcha.destroy()}function g(e,t,n){f("create")&&window.Recaptcha.create(e,t,n)}function v(e,t,n){f("reload")&&window.Recaptcha.reload(e,t,n)}function b(){f("focus_response_field")&&window.Recaptcha.focus_response_field()}var C={},S={},y="clean",w=["red","white","blackglass","clean"],_="1px solid rgb(255, 0, 0)",E="1px solid #3C3C3C";return C.initCaptchaSignin=function(){C.initCaptcha(l(),4)},C.initCaptchaSignup=function(){C.initCaptcha(c(),14,C.getSignUpContainerElement())},C.initCaptchaEditEmail=function(){C.initCaptcha(u(),56,d())},C.initCaptcha=function(t,o,s){var f;if("string"==typeof t&&(f=t,r(f),t=void 0),"undefined"==typeof t)switch(f=a()){case"signin":t=l(),o=4,s=void 0;break;case"signup":t=c(),o=14,s=C.getSignUpContainerElement();break;case"editEmail":t=u(),o=56,s=d()}var h=t.attr("id");C.elementId=h,i({publicKey:globals.reCaptchaPublicKey,elementId:h,tabIndex:o,lang:globals.titlelang,callback:function(){"signUpReCaptchaInput"==h&&(s.show(),t.parent().show()),e("#recaptcha_privacy").find("a").addClass("RGSCLoadExt"),e("#recaptcha_response_field").attr("placeholder",n.getText("RecaptchaResponsePlaceholder","Register")),e("#recaptcha_privacy a").text(n.getText("RecaptchaTerms","Register"))}})},C.getResponseFieldId=function(){return"recaptcha_response_field"},C.getChallengeFieldId=function(){return"recaptcha_challenge_field"},C.getChallengeValue=function(){return s(e("#recaptcha_challenge_field"))},C.getResponseValue=function(){return s(e("#recaptcha_response_field"))},C.clearResponseValue=function(){e("#recaptcha_challenge_field").val("")},C.remove=function(){globals.showSignInRecaptcha=!1,l().empty().hide(),e("#signInProfile").removeClass("verify"),m()},C.hideError=function(){e("#recaptcha_response_field_error").html("").hide(),h(!1)},C.isError=function(){var e=document.getElementById("recaptcha_response_field");return null===e||"undefined"==typeof e?!1:e.style.border===_},C.showError=function(t){var n=e("#recaptcha_response_field"),i=e("#recaptcha_response_field_error");(!i||i.length<1)&&n.before("<p id='recaptcha_response_field_error' style='color: red;'></p>"),e("#recaptcha_response_field_error").html(p(t)).fadeIn("fast"),h(!0),setTimeout(function(){e("#recaptcha_response_field_error").fadeOut("slow")},5e3),b()},C.forceSignInCaptcha=function(){globals.showSignInRecaptcha=!0;var t=l(),n=!1;return e("#recaptcha_area").length?C.isVisible()?(C._reload("signin"),t.show(),n=!0):(C.hideError(),C._reload("signin"),t.show()):C.initCaptchaSignin(),n},C.isSignUpVisible=function(){var e=c();return e.is(":visible")&&e.html().length},C.isVisible=function(){var e=l();return e.is(":visible")&&e.html().length},C._reload=function(n){return o(n),"undefined"==typeof S||"undefined"==typeof S.publicKey||"undefined"==typeof S.elementId?void t.WriteDebugLog("reCaptcha._reload","ERROR","failed due to missing required options"):e("#recaptcha_challenge_field").length?void v(S.publicKey,S.elementId,{tabindex:S.tabIndex,theme:S.theme,lang:S.lang}):(t.WriteDebugLog("reCaptcha._reload","ERROR","challenge field does not exist, attempting re-init"),m(),void C.initCaptcha(n))},C.handleSignUpFailed=function(t){e("#signUpReCaptchaInputForm").is(":visible")?(C._reload("signup"),C.showError(t)):C.initCaptchaSignup()},C.handleFailed=function(e){C._reload(),C.showError(e)},C.initTextEntryForCaptcha=function(){e("div.reCaptchaContainer").off("focusin.textEntry",'#recaptcha_area input[type="text"]').on("focusin.textEntry",'#recaptcha_area input[type="text"]',function(){var t=e(this),i=t.attr("placeholder");i.length||(i=void 0);var a=!1,r={hasFocus:!0,text:t.val(),prompt:i,$el:t,forwardToGame:a};n.setupTextEntry(r)}).off("focusout.textEntry",'#recaptcha_area input[type="text"]').on("focusout.textEntry",'#recaptcha_area input[type="text"]',function(){var t=!1,i=e(this),a={hasFocus:!1,text:i.val(),$el:i,forwardToGame:t};n.setupTextEntry(a)})},C.getSignUpContainerElement=function(){return e("#signUpReCaptchaContainer")},C}),define("common/visualCaptcha.localization",["underscore","common/localize"],function(e,t){return{getLangOptions:function(){var n=void 0,i=globals.baseAssetUrl+"xml/shared/VCaptcha"+globals.titlelang+".xml";t.getLocalizedTextXML(i);var a=t.getText("explanation","VCaptcha");if("undefined"==typeof a||!a.length)return n;var r=t.getLocalizationCacheForContext(i);return n=e.each(r,function(e,t,n){return n.renameProperty(t,t.replace(new RegExp(i+":","i"),""))})},getErrorMsg:function(e){var n;switch(e){case"incorrect-captcha-sol":n=t.getText("VisualCaptchaError1","HomeSignin");break;case"captcha-timeout":n=t.getText("VisualCaptchaError2","HomeSignin");break;case"recaptcha-not-reachable":n=t.getText("VisualCaptchaError3","HomeSignin");break;default:n=t.getText("VisualCaptchaError4","HomeSignin")}return n},getLoadErrorMsg:function(){return t.getText("error","VCaptcha")}}}),function(e,t){"function"==typeof define&&define.amd?define("common/visualcaptcha.jquery",["jquery"],t):t(e.jQuery)}(this,function(e){var t,n,i;!function(e){function a(e,t){return S.call(e,t)}function r(e,t){var n,i,a,r,o,s,l,c,u,d,f,h=t&&t.split("/"),p=b.map,m=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=e.split("/"),o=e.length-1,b.nodeIdCompat&&w.test(e[o])&&(e[o]=e[o].replace(w,"")),e=h.concat(e),u=0;u<e.length;u+=1)if(f=e[u],"."===f)e.splice(u,1),u-=1;else if(".."===f){if(1===u&&(".."===e[2]||".."===e[0]))break;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||m)&&p){for(n=e.split("/"),u=n.length;u>0;u-=1){if(i=n.slice(0,u).join("/"),h)for(d=h.length;d>0;d-=1)if(a=p[h.slice(0,d).join("/")],a&&(a=a[i])){r=a,s=u;break}if(r)break;!l&&m&&m[i]&&(l=m[i],c=u)}!r&&l&&(r=l,s=c),r&&(n.splice(0,s,r),e=n.join("/"))}return e}function o(t,n){return function(){return h.apply(e,y.call(arguments,0).concat([t,n]))}}function s(e){return function(t){return r(t,e)}}function l(e){return function(t){g[e]=t}}function c(t){if(a(v,t)){var n=v[t];delete v[t],C[t]=!0,f.apply(e,n)}if(!a(g,t)&&!a(C,t))throw new Error("No "+t);return g[t]}function u(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return function(){return b&&b.config&&b.config[e]||{}}}var f,h,p,m,g={},v={},b={},C={},S=Object.prototype.hasOwnProperty,y=[].slice,w=/\.js$/;p=function(e,t){var n,i=u(e),a=i[0];return e=i[1],a&&(a=r(a,t),n=c(a)),a?e=n&&n.normalize?n.normalize(e,s(t)):r(e,t):(e=r(e,t),i=u(e),a=i[0],e=i[1],a&&(n=c(a))),{f:a?a+"!"+e:e,n:e,pr:a,p:n}},m={require:function(e){return o(e)},exports:function(e){var t=g[e];return"undefined"!=typeof t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:d(e)}}},f=function(t,n,i,r){var s,u,d,f,h,b,S=[],y=typeof i;if(r=r||t,"undefined"===y||"function"===y){for(n=!n.length&&i.length?["require","exports","module"]:n,h=0;h<n.length;h+=1)if(f=p(n[h],r),u=f.f,"require"===u)S[h]=m.require(t);else if("exports"===u)S[h]=m.exports(t),b=!0;else if("module"===u)s=S[h]=m.module(t);else if(a(g,u)||a(v,u)||a(C,u))S[h]=c(u);else{if(!f.p)throw new Error(t+" missing "+u);f.p.load(f.n,o(r,!0),l(u),{}),S[h]=g[u]}d=i?i.apply(g[t],S):void 0,t&&(s&&s.exports!==e&&s.exports!==g[t]?g[t]=s.exports:d===e&&b||(g[t]=d))}else t&&(g[t]=i)},t=n=h=function(t,n,i,a,r){if("string"==typeof t)return m[t]?m[t](n):c(p(t,n).f);if(!t.splice){if(b=t,b.deps&&h(b.deps,b.callback),!n)return;n.splice?(t=n,n=i,i=null):t=e}return n=n||function(){},"function"==typeof i&&(i=a,a=r),a?f(e,t,n,i):setTimeout(function(){f(e,t,n,i)},4),h},h.config=function(e){return h(e)},t._defined=g,i=function(e,t,n){t.splice||(n=t,t=[]),!a(g,e)&&!a(v,e)&&(v[e]=[e,t,n])},i.amd={jQuery:!0}}(),i("almond",function(){}),i("visualcaptcha/core",[],function(){var e,t,n,i,a,r,o,s;return e=function(e,t,n){return n=n||[],e.namespace&&e.namespace.length>0&&n.push(e.namespaceFieldName+"="+e.namespace),n.push(e.randomParam+"="+e.randomNonce),t+"?"+n.join("&")},t=function(e){var t,i=this;e.applyRandomNonce(),e.isLoading=!0,e.hasLoaded=!1,t=n(e),e.callbacks.loading&&e.callbacks.loading(i),e.request(t,function(t){t.audioFieldName&&(e.audioFieldName=t.audioFieldName),t.imageFieldName&&(e.imageFieldName=t.imageFieldName),t.imageName&&(e.imageName=t.imageName),t.values&&(e.imageValues=t.values),e.isLoading=!1,e.hasLoaded=!0,e.callbacks.loaded&&e.callbacks.loaded(i)},function(){e.isLoading=!1,e.hasLoaded=!1})},n=function(t){var n=["key="+t.numberOfImages],i=t.url+t.routes.start;return e(t,i,n)},i=function(t,n){var i="",a=["key="+t.numberOfImages,"index="+n];return 0>n||n>=6?i:(this.isRetina()&&a.push("retina=1"),i=t.url+t.routes.image,e(t,i,a))},a=function(t,n){var i=t.url+t.routes.audio;return n&&(i+="/ogg"),e(t,i)},r=function(e,t){return t>=0&&6>t?e.imageValues[t]:""},o=function(){return void 0!==window.devicePixelRatio&&window.devicePixelRatio>1},s=function(){return!1},function(e){var n,l,c,u,d,f,h,p,m,g,v,b,C,S;return l=function(){return t.call(this,e)},c=function(){return e.isLoading},u=function(){return e.hasLoaded},d=function(){return e.imageValues.length},S=function(){return e.loadErrorEvent},f=function(){return e.imageName},h=function(t){return r.call(this,e,t)},p=function(t){return i.call(this,e,t)},m=function(t){return a.call(this,e,t)},g=function(){return e.imageFieldName},v=function(){return e.audioFieldName},b=function(){return e.namespace},C=function(){return e.namespaceFieldName},n={refresh:l,isLoading:c,hasLoaded:u,numberOfImages:d,loadErrorEvent:S,imageName:f,imageValue:h,imageUrl:p,audioUrl:m,imageFieldName:g,audioFieldName:v,namespace:b,namespaceFieldName:C,isRetina:o,supportsAudio:s},e.autoRefresh&&n.refresh(),n}}),i("visualcaptcha/xhr-request",[],function(){var e=window.XMLHttpRequest;return function(t,n,i){var a=new e;a.open("GET",t,!0),a.onreadystatechange=function(){var e;return 429===a.status?i():void(4===a.readyState&&200===a.status&&(e=JSON.parse(a.responseText),n(e)))},a.onerror=function(){i()},a.send()}}),i("visualcaptcha/config",["visualcaptcha/xhr-request"],function(e){return function(t){var n=window.location.href.split("/");n[n.length-1]="";var i={request:e,url:n.join("/").slice(0,-1),namespace:"",namespaceFieldName:"namespace",routes:{start:"/start",image:"/image",audio:"/audio"},isLoading:!1,hasLoaded:!1,autoRefresh:!0,numberOfImages:6,loadErrorEvent:"imgErr",randomNonce:"",randomParam:"r",audioFieldName:"",imageFieldName:"",imageName:"",imageValues:[],callbacks:{}};return i.applyRandomNonce=function(){return i.randomNonce=Math.random().toString(36).substring(2)},t.request&&(i.request=t.request),t.url&&(i.url=t.url),t.namespace&&(i.namespace=t.namespace),t.namespaceFieldName&&(i.namespaceFieldName=t.namespaceFieldName),"undefined"!=typeof t.autoRefresh&&(i.autoRefresh=t.autoRefresh),t.numberOfImages&&(i.numberOfImages=t.numberOfImages),t.loadErrorEvent&&(i.loadErrorEvent=t.loadErrorEvent),t.routes&&(t.routes.start&&(i.routes.start=t.routes.start),t.routes.image&&(i.routes.image=t.routes.image),t.routes.audio&&(i.routes.audio=t.routes.audio)),t.randomParam&&(i.randomParam=t.randomParam),t.callbacks&&(t.callbacks.loading&&(i.callbacks.loading=t.callbacks.loading),t.callbacks.loaded&&(i.callbacks.loaded=t.callbacks.loaded)),i}}),i("visualcaptcha",["require","visualcaptcha/core","visualcaptcha/config"],function(e){var t=e("visualcaptcha/core"),n=e("visualcaptcha/config");return function(e){return e=e||{},t(n(e))}}),i("visualcaptcha/templates",[],function(){var e,t,n,i,a,r,o,s;return e=function(e,t){for(var n in t)e=e.replace(new RegExp("{"+n+"}","g"),t[n]);return e},t=function(t,n,i){var a,r,o,s;return a='<div class="visualCaptcha-accessibility-button"><img src="{path}accessibility{retinaExtra}.png" title="{accessibilityTitle}" alt="{accessibilityAlt}" /></div>',r='<div class="visualCaptcha-refresh-button"><img src="{path}refresh{retinaExtra}.png" title="{refreshTitle}" alt="{refreshAlt}" /></div>',o='<div class="visualCaptcha-button-group">'+r+(t.supportsAudio()?a:"")+"</div>",s={path:i||"",refreshTitle:n.refreshTitle,refreshAlt:n.refreshAlt,accessibilityTitle:n.accessibilityTitle,accessibilityAlt:n.accessibilityAlt,retinaExtra:t.isRetina()?"@2x":""},e(o,s)
},n=function(t,n){var i,a;return t.supportsAudio()?(i='<div class="visualCaptcha-accessibility-wrapper visualCaptcha-hide"><div class="accessibility-description">{accessibilityDescription}</div><audio preload="preload"><source src="{audioURL}" type="audio/ogg" /><source src="{audioURL}" type="audio/mpeg" /></audio></div>',a={accessibilityDescription:n.accessibilityDescription,audioURL:t.audioUrl(),audioFieldName:t.audioFieldName()},e(i,a)):""},i=function(t,n){for(var i,a,r="",o=0,l=t.numberOfImages();l>o;o++)i='<div class="img"><img src="{imageUrl}" id="visualCaptcha-img-{i}" data-index="{i}" alt="" title="" onerror="this.dispatchEvent(new CustomEvent(\''+t.loadErrorEvent()+"', {'bubbles':true}))\" /></div>",a={imageUrl:t.imageUrl(o),i:o},r+=e(i,a);return i='<p class="visualCaptcha-explanation">{explanation}</p><div class="visualCaptcha-possibilities">{images}</div>',a={imageFieldName:t.imageFieldName(),explanation:s(t,n),images:r},e(i,a)},s=function(e,t){var n=e.imageName(),i=n.replace(/[ \-]*/gi,""),a=t[i];return"undefined"!=typeof a&&a.length||(a=n),t.explanation.replace(/\[answer\]/,a)},a=function(t){var n,i;return n='<input class="form-control audioField" type="text" name="{audioFieldName}" value="" autocomplete="off" />',i={audioFieldName:t.audioFieldName()},e(n,i)},r=function(t,n){var i,a;return i='<input class="form-control imageField" type="hidden" name="{imageFieldName}" value="{value}" readonly="readonly" />',a={imageFieldName:t.imageFieldName(),value:t.imageValue(n)},e(i,a)},o=function(t){var n,i,a=t.namespace();return a&&0!==a.length?(n='<input type="hidden" name="{fieldName}" value="{value}" />',i={fieldName:t.namespaceFieldName(),value:a},e(n,i)):""},{buttons:t,accessibility:n,images:i,audioInput:a,imageInput:r,namespaceInput:o}}),i("visualcaptcha/language",[],function(){return{accessibilityAlt:"Sound icon",accessibilityTitle:"Accessibility option: listen to a question and answer it!",accessibilityDescription:"Type below the <strong>[answer]</strong> to what you hear. Numbers or words:",explanation:"You must click the <strong>[answer]</strong> to continue",refreshAlt:"Refresh/reload icon",refreshTitle:"Refresh/reload: get new images!"}}),i("visualcaptcha.jquery",["jquery","visualcaptcha","visualcaptcha/templates","visualcaptcha/language"],function(e,t,n,i){var a,r,o,s,l,c,u;a=function(t,n){return e.get(t,n,"json")},r=function(){},o=function(e,t,i){var a;a=n.namespaceInput(i)+n.accessibility(i,e.language)+n.images(i,e.language)+n.buttons(i,e.language,e.imgPath),t.html(a)},s=function(){var t,i=e(this).closest(".visualCaptcha"),a=i.find(".visualCaptcha-accessibility-wrapper"),r=i.find(".visualCaptcha-possibilities"),o=i.find(".visualCaptcha-explanation"),s=a.find("audio");a.hasClass("visualCaptcha-hide")?(r.toggleClass("visualCaptcha-hide"),o.toggleClass("visualCaptcha-hide"),r.find(".img").removeClass("visualCaptcha-selected"),o.find("input").val(""),t=n.audioInput(i.data("captcha")),e(t).insertBefore(s),a.toggleClass("visualCaptcha-hide"),s[0].load(),s[0].play()):(s[0].pause(),a.toggleClass("visualCaptcha-hide"),a.find("input").remove(),o.toggleClass("visualCaptcha-hide"),r.toggleClass("visualCaptcha-hide"))},l=function(){var t,i,a,r=e(this),o=r.closest(".visualCaptcha"),s=o.find(".visualCaptcha-possibilities"),l=o.find(".visualCaptcha-explanation");i=l.find("input"),i&&(i.remove(),s.find(".img").removeClass("visualCaptcha-selected")),r.addClass("visualCaptcha-selected"),t=r.find("img").data("index"),a=n.imageInput(o.data("captcha"),t),l.append(e(a))},c=function(){var t=e(this).closest(".visualCaptcha");t.data("captcha").refresh()},u=function(e){var t=e.find(".imageField"),n=e.find(".audioField"),i=!!t.val()||!!n.val();return i?{valid:i,name:t.val()?t.attr("name"):n.attr("name"),value:t.val()?t.val():n.val()}:{valid:i}},e.fn.visualCaptcha=function(n){var d;return d=e.extend({imgPath:"/",language:i,captcha:{request:a,loading:r}},n),this.addClass("visualCaptcha").on("click",".visualCaptcha-accessibility-button",s).on("click",".visualCaptcha-refresh-button",c).on("click",".visualCaptcha-possibilities .img",l),this.each(function(){var n,i,a=e(this);i=e.extend(d.captcha,{callbacks:{loading:d.captcha.loading.bind(null,d,a),loaded:o.bind(null,d,a)}}),"undefined"!=typeof a.data("namespace")&&(i.namespace=a.data("namespace")),n=t(i),n.getCaptchaData=u.bind(null,a),a.data("captcha",n)})}}),i("jquery",function(){return e}),n("visualcaptcha.jquery")}),define("common/visualCaptcha",["jquery","underscore","utils","common/visualCaptcha.localization","common/visualcaptcha.jquery"],function(e,t,n,i){function a(){if("undefined"==typeof S.$element)return"signin";switch(S.$element.attr("id")){case m().attr("id"):return"signin";case g().attr("id"):return"signup";default:return"editEmail"}}function r(e){switch(e){case"signin":S.$element=m();break;case"signup":S.$element=g();break;case"editEmail":S.$element=v()}}function o(){S.$element.on(w,"img",c),S.isImgErrorHandlingEnabled=!0}function s(){return S.imgErrorCount>=_}function l(){S.$element.off(w,"img"),S.isImgErrorHandlingEnabled=!1}function c(){S.isImgErrorHandlingEnabled&&(l(),S.isVisible()&&(S.imgErrorCount++,setTimeout(function(){if(S._reload(),!s()){var e=S.$element;e.show()}},200)))}function u(){y=setInterval(d,100)}function d(){if(null==S.$element)return void f();var e=S.$element.data("captcha");return"undefined"==typeof e?void f():e.hasLoaded()?void clearInterval(y):void(e.isLoading()||f())}function f(){clearInterval(y),null!=S.$element&&S.$element.html("<p>"+i.getLoadErrorMsg()+"</p>")}function h(e){var t="";"undefined"!=typeof e?t=a():e="",t!==e&&(S.remove(),S.initCaptcha(e))}function p(e){e=e||S.$element.attr("id"),"signUpReCaptchaInput"===e&&S.$container.show(),S.$element.show(),o()}function m(){return e("#signInReCaptchaInput")}function g(){return e("#signUpReCaptchaInput")}function v(){return e("#editEmailCaptcha")}function b(){return"visualCaptcha-error"}function C(){return e("#emailForm")}var S={},y=null,w="vcaptcha_imgErr",_=5;return S.initCaptchaSignin=function(){S.initCaptcha(m(),4)},S.initCaptchaSignup=function(){S.initCaptcha(g(),14,S.getSignUpContainerElement())},S.initCaptchaEditEmail=function(){S.initCaptcha(v(),56,C())},S.initCaptcha=function(e,t,a){var o;if("string"==typeof e&&(o=e,r(o),e=void 0),"undefined"==typeof e)switch(o){case"signin":e=m(),a=void 0;break;case"signup":e=g(),a=S.getSignUpContainerElement();break;case"editEmail":e=v(),a=C()}clearInterval(y),S.$element=e,S.$container=a;var s=e.attr("id");e.visualCaptcha({imgPath:globals.baseUrl+"images/captcha/img/",captcha:{url:n.getApiUrl("/api/captcha"),numberOfImages:globals.reCaptchaPublicKey,loading:u,loadErrorEvent:w},language:i.getLangOptions()}),S.imgErrorCount=0,p(s)},S.getResponseFieldId=function(){return null==S.$element?"recaptcha_response_field":S.$element.data("captcha").imageFieldName()},S.getChallengeFieldId=function(){return"key"},S.getChallengeValue=function(){return S.isVisible()?globals.reCaptchaPublicKey:""},S.getResponseValue=function(){return null==S.$element?"":S.$element.find("input[name='"+S.$element.data("captcha").imageFieldName()+"']").val()},S.clearResponseValue=function(){},S.remove=function(){globals.showAltSignInRecaptcha=!1,m().empty().hide(),e("#signInProfile").removeClass("verify")},S.hideError=function(){e("."+b()).html("").hide()},S.isError=function(){return e("."+b()).is(":visible")},S.showError=function(t){if(null!=S.$element){var n="."+b(),a=e(n);a&&a.length||S.$element.after("<p class='"+b()+"' style='color: red;'></p>"),a=e(n),a.html(i.getErrorMsg(t)).fadeIn("fast"),setTimeout(function(){a.fadeOut("slow")},5e3)}},S.forceSignInCaptcha=function(){globals.showAltSignInRecaptcha=!0;var e=m(),t=!1;return"undefined"!=typeof S.$element&&S.$element.data("captcha")?S.isVisible()?(S._reload("signin"),e.show(),t=!0):(S.hideError(),S._reload("signin"),e.show()):S.initCaptchaSignin(),t},S.isSignUpVisible=function(){return S.isVisible()},S.isVisible=function(){return null==S.$element?!1:S.$element.is(":visible")&&S.$element.html().length>0},S._reload=function(e){return s()?void f():(h(e),clearInterval(y),S.$element.data("captcha").refresh(),u(),void p())},S.handleSignUpFailed=function(t){e("#signUpReCaptchaInputForm").is(":visible")?(S._reload("signup"),S.showError(t)):S.initCaptchaSignup()},S.handleFailed=function(e){S._reload(),S.showError(e)},S.initTextEntryForCaptcha=e.noop,S.getSignUpContainerElement=function(){return e("#signUpReCaptchaContainer")},S}),define("common/captcha-utils",["require","common/baseUtils"],function(e){var t=e("common/baseUtils"),n={isAltCaptchaEnabled:globals.signInAltReCaptchaEnabled||globals.signUpAltReCaptchaEnabled,isShowSignInCaptcha:globals.signInReCaptchaEnabled&&(globals.showSignInRecaptcha||globals.showAltSignInRecaptcha)};return n.getSigninInputSelector=function(){return"#signInReCaptchaInput input"},n.getSignupInputSelector=function(){return"#signUpReCaptchaInput input"},n.isCaptchaRequired=function(e){if(!globals.signInReCaptchaEnabled)return!1;if("undefined"==typeof e)return!1;var t=e.getResponseHeader("signinCaptcha");if(null!=t&&"undefined"!=typeof t){if("1"===t)return!0;if("0"===t)return!1}var n=e.responseJSON,i=n&&!n.Status&&n.Error&&"incorrect-captcha-sol"===n.Error.Code;return i},n.isTooManyLoginAttempts=function(e){var n=e&&e.responseJSON&&e.responseJSON.Message,i=t.splitErrorCode(n).codeEx;return t.errorCodeExIs(i,"LoginAttempts")},n.isCaptchaInvalid=function(e){return e&&!e.Status&&e.Error&&"incorrect-captcha-sol"===e.Error.Code},n}),define("common/captcha",["jquery","underscore","utils","common/reCaptcha","common/visualCaptcha","common/captcha-utils"],function(e,t,n,i,a,r){var o={};return o.isShowSignInCaptcha=r.isShowSignInCaptcha,o.getSigninInputSelector=function(){return r.getSigninInputSelector()},o.isCaptchaRequired=function(e){return r.isCaptchaRequired(e)},o.hide=function(){e("#signUpReCaptchaContainer").hide()},o.getCaptchaData=function(){var e=o.getChallengeValue(),t={captchaChallengeFieldId:o.getChallengeFieldId(),recaptchaChallenge:e,captchaResponseFieldId:o.getResponseFieldId(),recaptchaResponse:o.getResponseValue(),isCaptcha:e.length>0};return o.clearResponseValue(),t},o=r.isAltCaptchaEnabled?t.defaults(o,a):t.defaults(o,i),n.pubsub.on("captcha.hide",o.hide),o}),define("common/formvalidation",["jquery","underscore","utils","setup.environment.utils","common/validation","common/captcha","common/localize"],function(e,t,n,i,a,r,o){function s(n,i){t.each(n,function(t){var n=e(".errors ."+t+"error");if(n.length)n.html("");else{var a=i.closest("form").find(".errors."+t+"error");a.remove()}})}function l(t){t.parents("form").one("click",function(n){n.preventDefault(),e("#altNicksContainer").remove(),t.attr("placeholder",o.getText("EnterNickname","HomeSignin"))})}function c(t){return e("#"+t+"Checked").val()!=e("#"+t).val()}function u(){var t=e("#signUpEmailConfirm");d("signUpEmail")&&(t.val(""),e(".emailerror").remove(),e(".confirmemailerror").remove(),t.closest(".error").remove(),e(".emailvalid").remove())}function d(t){return e("#"+t+"Checked").val()!=e("#"+t).val()}var f={};return f.SignInValidation=function(){var t=!0;f.clearErrorClasses();var i=e.trim(e("#signInEmailProfile").val());return n.isLegacyServiceLayer()||!globals.isNLE||i.indexOf("@")>-1?f.EmailValidation("signInEmailProfile")||(t=!1):f.NicknameValidation("signInEmailProfile",!0)||(t=!1),f.PasswordValidation("signInPasswordProfile","")||(t=!1),f.signinCaptchaValidation()||(t=!1),t},f.signinCaptchaValidation=function(){var e=globals.showSignInRecaptcha||globals.showAltSignInRecaptcha;if(!e)return!0;var t=r.getResponseValue();return"undefined"!=typeof t&&t.length?!0:(r.showError("incorrect-captcha-sol"),!1)},f.CreateAccountValidation=function(){var t=!0;return f.NicknameValidation("signUpNickname")?0==e(".nickvalid").length&&(t=!1):t=!1,f.EmailValidation("signUpEmail")?0==e(".emailvalid").length&&(t=!1):t=!1,f.ConfirmEmail(e("#signUpEmailConfirm"))?0==e(".emailvalid").length&&(t=!1):t=!1,f.PostalCodeValidation("signUpZip")||(t=!1),f.PasswordValidation("signUpPassword","signUpPasswordConf")||(t=!1),e(".pwerror").length>0&&(t=!1),0===e("#signUpCountry").children().length&&(t=!1),f.DOBValidation(!0)||(t=!1),t&&f.clearErrorClasses(),t},f.DOBValidation=function(t){var n="",i=e("#monthOfBirth").find(":selected").val(),r=e("#dayOfBirth").find(":selected").val(),s=e("#yearOfBirth").find(":selected").val(),l=a.dob(i,r,s,t);if(l.status)return f.showValidTick(e("#yearOfBirth").parent(),"dob"),!0;switch(l.reason){case"emptyInput":n=o.getError("EntryDOB");break;case"invalidDate":n=o.getError("ValidDOB");break;case"tooYoung":return f.handleUnderAgeError(),!1}return f.showError("dob",e("#yearOfBirth").parent(),n),!1},f.handleUnderAgeError=function(){f.clearErrorClasses(),globals.underage=!0,e("#dk_container_monthOfBirth").addClass("disabled"),e("#dk_container_dayOfBirth").addClass("disabled"),e("#dk_container_yearOfBirth").addClass("disabled"),e("#signupDobContainer, #signupMailingListContainer, #signupDetailsContainer .clearfix, #signupCountryContainer, #dob p.intro").hide();var t=o.getText("GenericError1","Errors").replace("[url]","http://www.rockstargames.com/privacy/?locale="+globals.titlelang.split("-")[0]);f.showError("dob",e("#yearOfBirth").parent(),t),e("#submitAccount").addClass("disabled")},f.EmailValidation=function(t,n){var i,r=e("#"+t),s=!1,l=!1,c="",d=e.trim(r.val());return e(".emailvalid").remove(),r.parent().find(".error").remove(),e(".errors .emailerror").remove(),u(),""==d?(c=o.getError("EntryEmail"),s=!0):a.email(d)||(c=o.getError("ValidEmail"),s=!0),s||void 0==n||(i=e("#"+n),i.length&&!i.val().length&&(l=!0,c=o.getError("ErrorUpdate"))),1==s?(f.showError("email",r,c),e("#"+t+"Checked").val(e("#"+t).val()),!1):1==l&&void 0!=i?(f.showError("pw",i,c),!1):("signUpEmail"==t&&e("#signUpEmailChecked").val(e("#signUpEmail").val()),e(".errors .emailerror").length?!1:("signInEmailProfile"!==t&&f.showValidTick(r,"email"),!0))},f.ConfirmEmail=function(t){var n=e("#formAccountDetails").find(".emailerror ");if(n.length)return!1;var i=e.trim(e("#formAccountDetails #signUpEmail").val()),a=e.trim(t.val());if(a.toLowerCase()===i.toLowerCase())return""!=i&&(f.showValidTick(t,"email"),e(".confirmemailerror").remove()),!0;var r=o.getError("EmailDoesNotMatch");return f.showError(["confirmemail","email"],t,r),!1},f.PasswordValidation=function(t,n,r){if(i.isOffline())return!0;var l=!1,c=e("#"+t),u=c.val(),d="",h="pw";if(0===u.length)d=o.getError("EntryPassword"),l=!0;else if("string"==typeof r&&u===e("#"+r).val())d=o.getError("PasswordSame"),l=!0;else if(s(["signUpPasswordConf","pw"],c),"signUpPassword"!=t&&"editNewPassword"!=t||!(u.length<globals.passMin||u.length>globals.passMax))if(a.passwordForSignin(u)){if("signInPasswordProfile"!=t)if(void 0!==n&&e("#"+n).length&&c.val()!=e("#"+n).val())d=f.getPasswordError("ConfirmMatch"),f.showErrorCross(e("#"+n)),h="signUpPasswordConf",l=!0;else{var p=globals.pattern;"object"!=typeof p||"string"!=typeof globals.passChars||a.password(u,p)?a.password(u)||(d=f.getPasswordError("InvalidPasswordNew"),l=!0):(d=f.getPasswordError("InvalidPassPattern").format(globals.passChars),l=!0)}}else d=f.getPasswordError("SignInPasswordCount"),l=!0;else d=f.getPasswordError("PasswordCount"),l=!0;return 1==l?(f.showError(h,c,d),!1):("editNewPassword"==t&&f.showValidTick(c,"pw"),!0)},f.getPasswordError=function(e){var t=o.getError(e);return a.getPasswordError(t)},f.ConfirmPassword=function(t){var n=e("#formAccountDetails").find(".pwerror ");if(n.length)return!1;var i=e("#formAccountDetails #signUpPassword").val();if(""===i)return!0;var a=t.val();if(a===i)return f.showValidTick(t,"pw"),e(".signUpPasswordConferror").remove(),!0;var r=o.getError("ConfirmMatch");return f.showError(["signUpPasswordConf","pw"],t,r),!1},f.AvatarValidation=function(t){f.clearErrorClasses();var n=e("#"+t).attr("src");return n.match(/blank.gif$/)||n.match(/default.png$/)?(e("#lblAvatarError").after('<span class="errorText">'+o.getError("SelectAvatar")+"</span>"),e("#signUpAvatarForm").find("span.errorText").after('<span class="error"></span>'),!1):!0},f.NicknameValidation=function(t,n,i){var r,s=e("#"+t),l=!1,u=!1,d=s.val(),h="";return"boolean"==typeof n&&"undefined"==typeof i&&(i=n,n=void 0),e(".nickvalid").remove(),s.parent().find(".error").remove(),e(".errors .nickerror").remove(),e("#altNicksContainer").is(":visible")&&!c(t)?!1:(""==d?(h=o.getError("EnterNick"),l=!0):a.nicknameLength(d)?a.nickname(d)||(h=o.getError("NickInvalid"),l=!0):(h=o.getError("NickChar"),l=!0),l||"undefined"==typeof n||(r=e("#"+n),r.length&&!r.val().length&&(u=!0,h=o.getError("ErrorUpdate"))),e("#"+t+"Checked").val(e("#"+t).val()),1==l?(f.showError("nick",s,h),!1):1==u&&"undefined"!=typeof r?(f.showError("pw",r,h),!1):e(".errors .nickerror").length?!1:(f.showValidTick(s,"nick",i),!0))},f.SearchNicknameRegExValidation=function(e){return a.nicknameForSearch(e)},f.LocalNicknameValidation=function(){var t=e("#createProfileNickname"),n=t.closest("form").find(".errors"),i=e.trim(t.val().toLowerCase()),a=!1;return e("#existingProfiles").children().each(function(){var t=e(this).find("span.profilenickname");t.length&&t.html().toLowerCase()==i&&(a=!0)}),1==a?(n.append('<span class="errorText">'+o.getError("NickExists")+"</span>"),t.after('<span class="error"></span>'),!1):!0},f.NicknameExists=function(t,n,i,a){var r=e("#"+t);n?(f.showError("nick",r,o.getError("NickExists")),f.DisplayAltNicknames(i,t,a)):f.showValidTick(r,"nick")},f.DisplayAltNicknames=function(t,n,i){var a,r="",s=e("#"+n);t.forEach(function(e){r+='<li><a href="#" title="Select name">'+e+"</a></li>"}),a='<div id="altNicksContainer"><h3>'+o.getText("Alternatives","Register")+':</h3><div><ul id="altNicks">',a+=r+"</ul></div></div>",i?s.on("click",function(t){t.stopPropagation(),e("#altNicksContainer").length||(s.parent().append(a),s.attr("placeholder",o.getText("EnterNickname","HomeSignin")),l(s))}):(s.parent().append(a),s.val(""),s.attr("placeholder",o.getText("WhyNotTry","Register")),l(s)),s.parent().on("click","#altNicks li a",function(t){t.preventDefault(),s.val(e(t.currentTarget).text()),e("#altNicksContainer").remove(),s.attr("placeholder",o.getText("EnterNickname","HomeSignin")),f.showValidTick(s,"nick")})},f.PasswordInvalid=function(t,n){var i=e("#"+t);n?f.showError("pw",i,f.getPasswordError("InvalidPasswordNew")):"editNewPassword"==t&&f.showValidTick(i,"pw")},f.EmailExists=function(t,n){var i=e("#"+t);n&&f.showError("email",i,o.getError("EmailExists"))},f.UpdateProfileValidation=function(){var t=!0;return f.clearErrorClasses(),f.EmailValidation("editEmail","editEmailPassword")||(t=!1),e("#editNewPassword").val()&&(e("#editOldPassword").val()?f.PasswordValidation("editNewPassword","editNewPasswordConf")||(t=!1):(e("#editOldPassword").before('<span class="errorText">'+o.getError("EntryPassword")+"</span>"),e("#editOldPassword").after('<span class="error"></span>'),t=!1)),t},f.UpdateEmailValidation=function(){var e=!0;return f.clearErrorClasses(),f.EmailValidation("editEmail","editEmailPassword")||(e=!1),e},f.UpdateNicknameValidation=function(){var t=!0;return f.clearErrorClasses(),f.NicknameValidation("editName","editNamePassword")||(t=!1),e("#nameForm span.error").length>0&&e("#nameForm span.error").is(":visible")&&(t=!1),t},f.clearPasswordConfirmationInput=function(){var t=e("#signUpPasswordConf");t.val(""),t.closest(".error").remove(),e(".pwerror, .pwvalid, .signUpPasswordConferror").remove()},f.UpdatePasswordValidation=function(){var t=!0;return f.clearErrorClasses(),e("#editOldPassword").val()?f.PasswordValidation("editNewPassword","editNewPasswordConf","editOldPassword")||(t=!1):(e("#passwordForm .errors").append('<span class="errorText">'+o.getError("EntryPassword")+"</span>"),e("#editOldPassword").after('<span class="error"></span>'),t=!1),t&&e("span.error, span.errorText").remove(),t},f.ActivationCodeValidation=function(t,n){if(f.clearErrorClasses(),e("div.errorText:not(.emailerror, .nickerror, div.errorCode)").remove(),n){var i=e("#legalActivation"),a=e("#formActivation").find("input:checkbox:checked");if(void 0!=a&&!a.length)return i.find(".legal").after('<span class="errorText">'+o.getError("ActivationLegalCheck")+"</span>").after('<span class="error"></span>'),i.focus(),!1}var r=e("#activationCode"),s=e.trim(r.val());return 0==s.length?(r.after(t?'<span class="errorText">'+o.getError("EnterRedemption")+"</span>":'<span class="errorText">'+o.getError("EnterActivation")+"</span>"),r.after('<span class="error"></span>').focus(),!1):s.match(/^[a-zA-Z0-9-]+$/)?!0:(r.after(t?'<span class="errorText">'+o.getText("i39","Activation")+"</span>":'<span class="errorText">'+o.getText("i33","Activation")+"</span>"),r.after('<span class="error"></span>').focus(),!1)},f.PostalCodeValidation=function(t){var n=e("#"+t);if(n.length&&n.val().length){var i=/^.{1,10}$/,a=e.trim(n.val());if(-1==a.search(i)){var r=o.getError("InvalidZip");return n.before('<span class="errorText">'+r+"</span>"),n.after('<span class="error" title="'+r+'"></span>'),!1}}return!0},f.clearErrorClasses=function(){e("span.error:not(.emailerror,.nickerror,.pwerror,.doberror)").remove(),globals.underage?e("span.errorText:not(.doberror)").remove():e("span.errorText").remove()},f.showError=function(n,i,a){"string"==typeof n&&(n=[n]),t.each(n,function(e){i.parent().find("."+e+"valid").remove()});var r=t.first(n),o=e(".errors ."+r+"error");if(o.length)o.html(a);else{var s=i.closest("form").find(".errors");s.append('<span class="'+r+'error errorText">'+a+"</span>")}f.showErrorCross(i)},f.showErrorCross=function(t){var n=t.parent().find(".error");if(!n.length)switch(t.attr("id")){case"signUpEmail":e("#signUpEmailConfirm").after('<span class="error"></span>');break;case"signUpPassword":e("#signUpPasswordConf").after('<span class="error"></span>');break;default:t.after('<span class="error"></span>')}},f.showValidTick=function(t,n,i){e(".errors ."+n+"error").remove(),t.parent().find(".error").remove();var a=e("."+n+"valid");if(!a.length&&!i){var r='<span class="'+n+'valid tick"></span>';switch(t.attr("id")){case"signUpEmail":e("#signUpEmailConfirm").after(r);break;case"signUpPassword":e("#signUpPasswordConf").after(r);break;default:t.after(r)}}f.EnableSubmit()},f.EnableSubmit=function(){var t=!!e(".dobvalid").length,n=!!e(".nickvalid").length,i=!!e(".emailvalid").length,a=!!e(".emailvalid").length,r=!!(t&&n&&i&&a);r&&e("#submitAccount").removeClass("disabled")},f}),define("common/gamefunctions",["require","common/baseUtils"],function(e){var t=e("common/baseUtils"),n={};return n.RGSC_JS_PING=function(){t.pubsub.publish("SDK.RGSC_JS_PING")},n.RGSC_JS_READY_TO_ACCEPT_COMMANDS=function(){t.pubsub.publish("SDK.RGSC_JS_READY_TO_ACCEPT_COMMANDS")},n.RGSC_JS_SIGN_IN=function(e){t.pubsub.publish("SDK.RGSC_JS_SIGN_IN",e)},n.RGSC_JS_FINISH_SIGN_IN=function(e){t.pubsub.publish("SDK.RGSC_JS_FINISH_SIGN_IN",e)},n.RGSC_JS_SIGN_OUT=function(e){t.pubsub.publish("SDK.RGSC_JS_SIGN_OUT",e)},n.RGSC_JS_REQUEST_UI_STATE=function(e,n){t.pubsub.publish("SDK.RGSC_JS_REQUEST_UI_STATE",{request:e,noResponse:n})},n.RGSC_JS_UI_STATE_RESPONSE=function(e){t.pubsub.publish("SDK.RGSC_JS_UI_STATE_RESPONSE",e)},n.RGSC_JS_INTERNET_CONNECTED_STATE_CHANGED=function(){t.pubsub.publish("SDK.RGSC_JS_INTERNET_CONNECTED_STATE_CHANGED")},n.RGSC_JS_NETWORK_CHANGE=function(e){t.pubsub.publish("SDK.RGSC_JS_NETWORK_CHANGE",e)},n.RGSC_JS_FINISH_MODIFY_PROFILE=function(e){t.pubsub.publish("SDK.RGSC_JS_FINISH_MODIFY_PROFILE",e)},n.RGSC_JS_RECEIVE_MESSAGE=function(e){t.pubsub.publish("SDK.RGSC_JS_RECEIVE_MESSAGE",e)},n.RGSC_JS_CHECKOUT_URL_REQUEST_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_CHECKOUT_URL_REQUEST_RESULT",e)},n.RGSC_JS_PLAYER_MULTIPLAYER_PRESENCE_INFO_RESPONSE=function(e){t.pubsub.publish("SDK.RGSC_JS_PLAYER_MULTIPLAYER_PRESENCE_INFO_RESPONSE",e)},n.RGSC_JS_SET_INPUT_METHOD=function(e){t.pubsub.publish("SDK.RGSC_JS_SET_INPUT_METHOD",e)},n.RGSC_JS_SHOW_VIRTUAL_KEYBOARD=function(){t.pubsub.publish("SDK.RGSC_JS_SHOW_VIRTUAL_KEYBOARD")},n.RGSC_JS_VIRTUAL_KEYBOARD_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_VIRTUAL_KEYBOARD_RESULT",e)},n.RGSC_JS_PRESENCE_MESSAGE_RECEIVED=function(e){t.pubsub.publish("SDK.RGSC_JS_PRESENCE_MESSAGE_RECEIVED",e)},n.RGSC_JS_REFRESH_STEAM_TICKET_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_REFRESH_STEAM_TICKET_RESULT",e)},n.RGSC_JS_INSTALL_PRODUCT_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_INSTALL_PRODUCT_RESULT",e)},n.RGSC_JS_IME_EVENT=function(e){t.pubsub.publish("SDK.RGSC_JS_IME_EVENT",e)},n.RGSC_JS_GET_AVATAR_URL=function(e){t.pubsub.publish("SDK.RGSC_JS_GET_AVATAR_URL",e)},n.RGSC_JS_GET_AVATAR_LAYOUT_URL=function(e){t.pubsub.publish("SDK.RGSC_JS_GET_AVATAR_LAYOUT_URL",e)},n.RGSC_JS_COMMERCE_MANIFEST_REQUEST_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_COMMERCE_MANIFEST_REQUEST_RESULT",e)},n.RGSC_JS_ACTIVATION_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_ACTIVATION_RESULT",e)},n.RGSC_JS_LICENSE_EXPIRATION_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_LICENSE_EXPIRATION_RESULT",e)},n.RGSC_JS_LICENSE_RECOVERY_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_LICENSE_RECOVERY_RESULT",e)},n.RGSC_JS_REDEMPTION_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_REDEMPTION_RESULT",e)},n.RGSC_JS_VOUCHER_CONTENT_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_VOUCHER_CONTENT_RESULT",e)},n.RGSC_JS_VOUCHER_CONSUME_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_VOUCHER_CONSUME_RESULT",e)},n.RGSC_JS_NOTIFICATION=function(e){t.pubsub.publish("SDK.RGSC_JS_NOTIFICATION",e)},n.init=function(){window.RGSC_JS_READY_TO_ACCEPT_COMMANDS=n.RGSC_JS_READY_TO_ACCEPT_COMMANDS,window.RGSC_JS_SIGN_IN=n.RGSC_JS_SIGN_IN,window.RGSC_JS_FINISH_SIGN_IN=n.RGSC_JS_FINISH_SIGN_IN,window.RGSC_JS_SIGN_OUT=n.RGSC_JS_SIGN_OUT,window.RGSC_JS_REQUEST_UI_STATE=n.RGSC_JS_REQUEST_UI_STATE,window.RGSC_JS_UI_STATE_RESPONSE=n.RGSC_JS_UI_STATE_RESPONSE,window.RGSC_JS_NETWORK_CHANGE=n.RGSC_JS_NETWORK_CHANGE,window.RGSC_JS_FINISH_MODIFY_PROFILE=n.RGSC_JS_FINISH_MODIFY_PROFILE,window.RGSC_JS_RECEIVE_MESSAGE=n.RGSC_JS_RECEIVE_MESSAGE,window.RGSC_JS_CHECKOUT_URL_REQUEST_RESULT=n.RGSC_JS_CHECKOUT_URL_REQUEST_RESULT,window.RGSC_JS_PLAYER_MULTIPLAYER_PRESENCE_INFO_RESPONSE=n.RGSC_JS_PLAYER_MULTIPLAYER_PRESENCE_INFO_RESPONSE,window.RGSC_JS_SET_INPUT_METHOD=n.RGSC_JS_SET_INPUT_METHOD,window.RGSC_JS_SHOW_VIRTUAL_KEYBOARD=n.RGSC_JS_SHOW_VIRTUAL_KEYBOARD,window.RGSC_JS_PRESENCE_MESSAGE_RECEIVED=n.RGSC_JS_PRESENCE_MESSAGE_RECEIVED,window.RGSC_JS_VIRTUAL_KEYBOARD_RESULT=n.RGSC_JS_VIRTUAL_KEYBOARD_RESULT,window.RGSC_JS_REFRESH_STEAM_TICKET_RESULT=n.RGSC_JS_REFRESH_STEAM_TICKET_RESULT,window.RGSC_JS_INSTALL_PRODUCT_RESULT=n.RGSC_JS_INSTALL_PRODUCT_RESULT,window.RGSC_JS_INTERNET_CONNECTED_STATE_CHANGED=n.RGSC_JS_INTERNET_CONNECTED_STATE_CHANGED,window.RGSC_JS_IME_EVENT=n.RGSC_JS_IME_EVENT,window.RGSC_JS_GET_AVATAR_URL=n.RGSC_JS_GET_AVATAR_URL,window.RGSC_JS_GET_AVATAR_LAYOUT_URL=n.RGSC_JS_GET_AVATAR_LAYOUT_URL,window.RGSC_JS_COMMERCE_MANIFEST_REQUEST_RESULT=n.RGSC_JS_COMMERCE_MANIFEST_REQUEST_RESULT,window.RGSC_JS_ACTIVATION_RESULT=n.RGSC_JS_ACTIVATION_RESULT,window.RGSC_JS_LICENSE_EXPIRATION_RESULT=n.RGSC_JS_LICENSE_EXPIRATION_RESULT,window.RGSC_JS_LICENSE_RECOVERY_RESULT=n.RGSC_JS_LICENSE_RECOVERY_RESULT,window.RGSC_JS_REDEMPTION_RESULT=n.RGSC_JS_REDEMPTION_RESULT,window.RGSC_JS_VOUCHER_CONTENT_RESULT=n.RGSC_JS_VOUCHER_CONTENT_RESULT,window.RGSC_JS_VOUCHER_CONSUME_RESULT=n.RGSC_JS_VOUCHER_CONSUME_RESULT,window.RGSC_JS_NOTIFICATION=n.RGSC_JS_NOTIFICATION,void 0!=globals.awaitingJsLoad&&globals.awaitingJsLoad&&(globals.awaitingJsLoad=!1,n.RGSC_JS_READY_TO_ACCEPT_COMMANDS()),window.RGSC_JS_PING=n.RGSC_JS_PING},n.init(),n}),define("common/gamefunctions.friends",["require","common/baseUtils"],function(e){var t=e("common/baseUtils"),n={};return n.RGSC_JS_PLAYER_LIST_RESPONSE=function(e){t.pubsub.publish("SDK.RGSC_JS_PLAYER_LIST_RESPONSE",e)},n.RGSC_JS_PLAYER_LIST_MINI_RESPONSE=function(e){t.pubsub.publish("SDK.RGSC_JS_PLAYER_LIST_MINI_RESPONSE",e)},n.RGSC_JS_FRIEND_SEND_INVITE_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_FRIEND_SEND_INVITE_RESULT",e)},n.RGSC_JS_FRIEND_DECLINE_INVITE_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_FRIEND_DECLINE_INVITE_RESULT",e)},n.RGSC_JS_FRIEND_ACCEPT_INVITE_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_FRIEND_ACCEPT_INVITE_RESULT",e)},n.RGSC_JS_GAME_INVITE_SEND_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_GAME_INVITE_SEND_RESULT",e)},n.RGSC_JS_JOIN_VIA_PRESENCE_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_JOIN_VIA_PRESENCE_RESULT",e)},n.RGSC_JS_FRIEND_DELETE_FRIEND_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_FRIEND_DELETE_FRIEND_RESULT",e)},n.RGSC_JS_FRIEND_CANCEL_INVITE_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_FRIEND_CANCEL_INVITE_RESULT",e)},n.RGSC_JS_FRIEND_BLOCK_PLAYER_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_FRIEND_BLOCK_PLAYER_RESULT",e)},n.RGSC_JS_FRIEND_UNBLOCK_PLAYER_RESULT=function(e){t.pubsub.publish("SDK.RGSC_JS_FRIEND_UNBLOCK_PLAYER_RESULT",e)},n.RGSC_JS_PLAYER_LIST_COUNTS_RESPONSE=function(e){t.pubsub.publish("SDK.RGSC_JS_PLAYER_LIST_COUNTS_RESPONSE",e)},n.RGSC_JS_PLAYER_INFO_RESPONSE=function(e){t.pubsub.publish("SDK.RGSC_JS_PLAYER_INFO_RESPONSE",e)},window.RGSC_JS_PLAYER_LIST_RESPONSE=n.RGSC_JS_PLAYER_LIST_RESPONSE,window.RGSC_JS_PLAYER_LIST_MINI_RESPONSE=n.RGSC_JS_PLAYER_LIST_MINI_RESPONSE,window.RGSC_JS_FRIEND_SEND_INVITE_RESULT=n.RGSC_JS_FRIEND_SEND_INVITE_RESULT,window.RGSC_JS_FRIEND_DECLINE_INVITE_RESULT=n.RGSC_JS_FRIEND_DECLINE_INVITE_RESULT,window.RGSC_JS_FRIEND_ACCEPT_INVITE_RESULT=n.RGSC_JS_FRIEND_ACCEPT_INVITE_RESULT,window.RGSC_JS_GAME_INVITE_SEND_RESULT=n.RGSC_JS_GAME_INVITE_SEND_RESULT,window.RGSC_JS_JOIN_VIA_PRESENCE_RESULT=n.RGSC_JS_JOIN_VIA_PRESENCE_RESULT,window.RGSC_JS_FRIEND_DELETE_FRIEND_RESULT=n.RGSC_JS_FRIEND_DELETE_FRIEND_RESULT,window.RGSC_JS_FRIEND_CANCEL_INVITE_RESULT=n.RGSC_JS_FRIEND_CANCEL_INVITE_RESULT,window.RGSC_JS_FRIEND_BLOCK_PLAYER_RESULT=n.RGSC_JS_FRIEND_BLOCK_PLAYER_RESULT,window.RGSC_JS_FRIEND_UNBLOCK_PLAYER_RESULT=n.RGSC_JS_FRIEND_UNBLOCK_PLAYER_RESULT,window.RGSC_JS_PLAYER_LIST_COUNTS_RESPONSE=n.RGSC_JS_PLAYER_LIST_COUNTS_RESPONSE,window.RGSC_JS_PLAYER_INFO_RESPONSE=n.RGSC_JS_PLAYER_INFO_RESPONSE,n}),define("am",["require"],function(){function e(){return n.isSessionSetup}function t(){n.isSessionControlSet&&(window.ga("set","sessionControl"),n.isSessionControlSet=!1)}var n={},i={};return i.isEnabled=function(){var e=window.globals||{isAm:!1};return e.isAm},i.isSetup=function(e){var t=window.globals||{isSetupAnalytics:!1};return void 0!=e&&(t.isSetupAnalytics=e),t.isSetupAnalytics},i.setup=function(e){i.isEnabled()&&(!function(t,n,i,a,r,o,s){t.GoogleAnalyticsObject=r,t[r]=t[r]||function(){(t[r].q=t[r].q||[]).push(arguments)},t[r].l=1*new Date,o=n.createElement(i),s=n.getElementsByTagName(i)[0],o.async=1,o.src=a,s.parentNode.insertBefore(o,s),t[r]("create",globals.amTracker,"auto"),t[r]("require","displayfeatures"),t[r]("set","forceSSL",e||!1)}(window,document,"script",globals.amUrl,"ga"),i.isSetup(!0))},i.trackPage=function(e,n){if(i.isEnabled()){var a={};void 0!=e&&(a.page=e),void 0!=n&&"function"==typeof n&&(a.hitCallback=n),window.ga("send","pageview",a),t()}},i.trackEvent=function(e,n,a,r,o,s){if(i.isEnabled()&&void 0!=e&&void 0!=n){var l;void 0!=o&&(l={nonInteraction:o?1:0}),void 0!=s&&"function"==typeof s&&(void 0==l&&(l={}),l.hitCallback=s),window.ga("send","event",e,n,a,r,l),t()}},i.startSession=function(){i.isEnabled()&&(e()||(i.isSetup()||i.setup(),window.ga("set","sessionControl","start"),n.isSessionSetup=!0,n.isSessionControlSet=!0))},i.endSession=function(){i.isEnabled()&&(window.ga("set","sessionControl","end"),n.isSessionSetup=!1,n.isSessionControlSet=!0,window.ga("set","userId"),i.trackEvent(i.category.profile,i.action.profile_sign_out))},i.setUserId=function(e){i.isEnabled()&&void 0!=e&&e.length&&window.ga("set","userId",e)},i.category={profile:"Profile",settings:"Settings",store:"Store",activation:"Activation",message:"Message",friend:"Friend",crew:"Crew",game:"Game",advert:"Advert"},i.action={profile_sign_in:"Sign In",profile_sign_out:"Sign Out",profile_sign_up:"Sign Up",profile_sign_in_failure_steam_already_linked:"Sign In Failure - Steam Already Linked",profile_sign_in_failure_other_steam_error:"Sign In Failure - Other Steam Error",profile_sign_in_recaptcha_failure:"Sign In Failure - Invalid ReCaptcha",profile_sign_in_failure_banned:"Sign In Failure - Banned",profile_sign_in_auth_failed:"Sign In Failure - Auth Failed",profile_sign_in_failure:"Sign In Failure - Unknown Error",profile_sign_in_failure_too_many_login_attempts:"Sign In Failure - Too Many Login Attempts",profile_sign_in_offline:"Sign In Offline",settings_profile_edit_nickname:"Edit Nickname",settings_profile_edit_email:"Edit Email",settings_profile_edit_password:"Edit Password",settings_profile_edit_country:"Edit Country",settings_profile_edit_auto_sign_in:"Edit Auto Sign In",settings_profile_edit_hide_notifications:"Edit Hide Notifications",settings_privacy_change_platform_visibility:"Change Platform Visibility",settings_privacy_change_profile_visibility:"Change Profile Visibility",settings_privacy_change_country_visibility:"Change Country Visibility",settings_privacy_change_stats_visibility:"Change Stats Visibility",settings_game_change_presence_visibility:"Change Game Presence Visibility",settings_game_change_cloud_save_enabled:"Change Cloud Save Enabled Status",settings_account_linking_link:"Link Account",settings_account_linking_unlink:"UnLink Account",settings_block_list_unblock:"Unblock Player",settings_change_avatar:"Change Avatar",friend_delete:"Delete Friend",friend_invite_accept:"Accept Friend Invite",friend_invite_decline:"Decline Friend Invite",friend_search:"Search for Player",friend_invite_send:"Send Friend Invite",friend_cancel_invite:"Cancel Friend Invite",crew_leave:"Leave Crew",crew_make_active:"Make Active Crew",crew_members_search:"Search for Crew Member",crew_invite_accept:"Accept Crew Invite",crew_invite_decline:"Decline Crew Invite",crew_invite_sent:"Sent Crew Invite",crew_delete_request:"Delete Crew Join Request",crew_search:"Search for Crew",crew_join:"Join Crew",crew_request_invite:"Request Crew Invite",game_invite_accept:"Accept Game Invite",game_invite_decline:"Decline Game Invite",store_start_purchase:"Start Purchase",store_select_item:"Item Selected",store_product_scroll:"Product List Scroll",activation_check_success:"Check Code Success",activation_check_failed:"Check Code Fail",activation_redeem_success:"Redeem Code Success",activation_redeem_failed:"Redeem Code Fail",message_send:"Send Message",message_reply:"Send Reply",message_delete:"Delete Message",advert_storeWithSearch:"Advert Clicked - Store with Search",advert_storeWithCategory:"Advert Clicked - Store with Category",advert_storeDefault:"Advert Clicked - Default Store",advert_findCrew:"Advert Clicked - Find Crew",advert_goToUrl:"Advert Clicked - Go to Url"},i.paymentType={creditcard:"CreditCard",paypal:"PayPal",undefined:"Undefined"},i
}),function(e){var t=e(window);e.fn.visible=function(e,n,i,a){if(!(this.length<1)){var r="undefined"!=typeof a;if("undefined"==typeof n&&(n=!0),"undefined"==typeof e&&(e=!0),r)var o=a.offset(),s=o.top,l=a.height()+s;var c=this.length>1?this.eq(0):this,u=c.get(0),d=t.width(),f=t.height(),h=i?i:"both",p=n===!0?u.offsetWidth*u.offsetHeight:!0;if("function"==typeof u.getBoundingClientRect){var m,g,v=u.getBoundingClientRect(),b=v.left>=0&&v.left<d,C=v.right>0&&v.right<=d;r?(m=v.top>=0&&v.top<f&&v.top>=s&&v.top<l,g=v.bottom>0&&v.bottom<=f&&v.bottom>s&&v.bottom<=l):(m=v.top>=0&&v.top<f,g=v.bottom>0&&v.bottom<=f);var S=e?m||g:m&&g,y=e?b||C:b&&C;if("both"===h)return p&&S&&y;if("vertical"===h)return p&&S;if("horizontal"===h)return p&&y}else{var w=t.scrollTop(),_=w+f,E=t.scrollLeft(),k=E+d,T=c.offset(),I=T.top,R=I+c.height(),A=T.left,L=A+c.width(),P=e===!0?R:I,D=e===!0?I:R,x=e===!0?L:A,N=e===!0?A:L;if(r){if("both"===h)return!!p&&_+s>=D&&P>=w+s&&k>=N&&x>=E;if("vertical"===h)return!!p&&_+s>=D&&P>=w+s;if("horizontal"===h)return!!p&&k>=N&&x>=E}else{if("both"===h)return!!p&&_>=D&&P>=w&&k>=N&&x>=E;if("vertical"===h)return!!p&&_>=D&&P>=w;if("horizontal"===h)return!!p&&k>=N&&x>=E}}}}}(jQuery),define("common/jquery.visible",function(){}),define("common/profile/profile-utils",["require","jquery","utils","setup.environment.utils","common/formvalidation","common/captcha","am","common/jquery.visible"],function(e){var t=e("jquery"),n=e("utils"),i=e("setup.environment.utils"),a=e("common/formvalidation"),r=e("common/captcha"),o=e("am");e("common/jquery.visible");var s={};s.ShowCountryOrDobPrompt=function(){if(n.WriteDebugLog("ShowCountryOrDobPrompt","Visible:",globals.isScuiVisible?"true":"false"),globals.isScuiVisible){var e,a=s.isDobMissing(),r=s.isCountryMissing();e=a&&r?"DOBAndCountryUpdate":a?"DOBUpdate":"countryUpdate",t("#dob").addClass(e),i.requestUiState(!0),s.showDOBPrompt()}},s.isDobMissing=function(){return globals.account&&("undefined"==typeof globals.account.Age||isNaN(globals.account.Age)||globals.account.Age<1)},s.isCountryMissing=function(){return globals.account&&("undefined"==typeof globals.account.CountryCode||""===globals.account.CountryCode)},s.showDOBPrompt=function(){var e=t("#dob");if(!e.visible()){n.WriteDebugLog("showDOBPrompt"),i.showHeaderMenu();var a="MissingRequiredData";(e.hasClass("DOBUpdate")||e.hasClass("DOBAndCountryUpdate"))&&n.loadDateDropdowns(),e.hasClass("DOBUpdate")&&(a="MissingDOB",t("#dob .intro").text(i.getText("EnterDOB2","Register","Please enter your date of birth."))),e.hasClass("countryUpdate")&&(a="MissingCountry",e.find(".intro").text(i.getText("EnterCountry","Register","Please enter your country."))),e.hasClass("DOBAndCountryUpdate")&&(a="MissingDOBandCountry",e.find(".intro").text(i.getText("EnterDOBAndCountry","Register","Please enter your date of birth and country."))),e.find("#submitAccount").text(i.getText("Submit","Register","Submit")).removeClass("disabled"),e.find("p.intro, #signupCountryContainer").show(),t("span.errorText").remove(),t("#signupPanelsWrapper").hasClass("active")||s.showDobForm(),i.initHeaderMenu(!1),o.trackPage("/"+a)}},s.showDobForm=function(){var e=t("#dob");return s.clearSignUpForms(),(e.hasClass("countryUpdate")||e.hasClass("DOBAndCountryUpdate"))&&n.pubsub.trigger("settingsFn.getCountriesAsync"),i.clearActivePanel(function(){t("#signUpConfirm").hide(),t("#dob, #AccountDetailsForm").show(),t("#signupPanels").css({left:"0"}),(e.hasClass("DOBUpdate")||e.hasClass("DOBAndCountryUpdate"))&&n.loadDateDropdowns(),i.setUpLoadingPanel("#signupPanelsWrapper",function(){(e.hasClass("DOBUpdate")||e.hasClass("DOBAndCountryUpdate"))&&(s.signupDropkick(),s.signupClickOnEnter()),i.removeLoading("signupPanelsWrapper")})}),!1},s.navigatePendingSignIn=function(e){"function"==typeof e?globals.navAfterSigninCallback=e:(delete globals.navAfterSigninCallback,t("#mainNav, #headerLoginOptions, .sideMenu").find(".pendingSignIn").removeClass("pendingSignIn").end().find(e).addClass("pendingSignIn")),t("#headerLoginButton").click()},s.CaptchaSelector=function(){var e="";return globals.signInReCaptchaEnabled&&(globals.showSignInRecaptcha||globals.showAltSignInRecaptcha)&&(e=r.getSigninInputSelector()),e},s.isSignupCaptchaEnabled=function(){return globals.signUpReCaptchaEnabled&&(globals.showSignUpRecaptcha||globals.showAltSignUpRecaptcha)},s.setSignUpStepText=function(e){if(t.isNumeric(e))switch(!s.isSignupCaptchaEnabled()&&e>1&&e--,e){case 1:e="One";break;case 2:e="Two";break;case 3:e="Three";break;case 4:e="Four"}t("#signUpSteps").find(".signUpStepCount").text(i.getText("NewStep"+e,"Register"))},s.clearSignUpForms=function(){l();var e=t("#AccountDetailsForm");e.find("span.nickvalid").remove(),e.find("span.emailvalid").remove(),e.find("span.confirmemailvalid").remove(),e.find("span.pwvalid").remove(),e.find("span.dobvalid").remove(),t("#altNicksContainer").remove(),t("#signUpNickname").attr("placeholder",i.getText("EnterNickname","HomeSignIn"));var n=globals.showSignUpRecaptcha||globals.showAltSignUpRecaptcha?4:3;s.setSignUpStepText("One"),t("#signUpSteps").find(".totalSignUpSteps").text(n),globals.underage||t("#signupDetailsContainer .clearfix, #signupCountryContainer, #dob p.intro").show(),a.clearErrorClasses(),globals.signUpreCaptchaValidated=!1},s.signupDropkick=function(){var e=t("#dayOfBirth"),n=t("#monthOfBirth"),i=t("#yearOfBirth");e.dropkick().hide(),n.dropkick().hide(),i.addClass("ignoreChange"),i.dropkick().hide(),e.dropkick("setValue","1"),n.dropkick("setValue","1"),i.dropkick("setValue","")},s.signupClickOnEnter=function(){t("#onlinePoliciesContainer").find("a").keydown(function(e){var n=t(e.currentTarget);13==e.which&&n.visible()&&t(this).click()})},s.resetSigninButtonText=function(){var e=t("#buttonSignInProfile");void 0!=e.attr("title")&&e.text(e.attr("title"))},s.setAutoSignInValues=function(e){t("#editAutoSignInInput").prop("checked",e),t("#editAutoSignInDisplay").text(e?i.getText("Yes","HomeSignin"):i.getText("No","HomeSignin"))};var l=function(){var e=s.CaptchaSelector();i.clearForms(e)};return s}),define("common/launcher/cloudSave-utils",["require","underscore","common/baseUtils","common/sdk","common/localize","moment"],function(e){function t(e){var t=g.sortBy(g.pairs(JSON.parse(decodeURI(e.metadata))),r);return{lastModified:e.lastModified,metadataRaw:t.map(i),metadata:t.map(n)}}function n(e){var t=i(e);return Array.isArray(e)&&e.length>1?l(t):v.htmlEncode(t)}function i(e){if(!(Array.isArray(e)&&e.length>1))return e;switch(globals.titleName){case"gta5":return s(e);default:return a(e[0],e[1],!0)}}function a(e,t,n,i,a){return{key:e,value:t,isVisible:n,rawKey:"undefined"!=typeof i?i:e,rawValue:"undefined"!=typeof a?a:t}}function r(e,t,n){switch(globals.titleName){case"gta5":return o(e,t,n);default:return t}}function o(e,t){return g.isArray(e)?e[0]:t}function s(e){var t=e[0],n=e[1],i=t,r=n,o=!0,s=t.toLowerCase();switch(s){case"completionpct":t=C.getText("CloudSaveMeta"+t,"General","Completion","gta5"),n=Number(n).toFixed(2)+"%";break;case"playercharacterindex":switch(t=C.getText("CloudSaveMeta"+t,"General","Character","gta5"),n){case 0:n="Michael";break;case 1:n="Franklin";break;case 2:n="Trevor"}break;case"autosave":n=1===n||n===!0?C.getText("Yes","Social","Yes"):C.getText("No","Social","No"),o=!1;break;case"slot":o=!1;break;case"posixtime":return"";default:t=C.getText("CloudSaveMeta"+t,"General",t,"gta5")}return t.length||(t=e[0]),a(t,n,o,i,r)}function l(e){if(!e||!e.key||!e.isVisible)return"";var t="undefined"!=typeof e.key&&e.key.toString?e.key.toString():e.key,n="undefined"!=typeof e.value&&e.value.toString?e.value.toString():e.value;return v.htmlEncode(t)+": "+v.htmlEncode(n)}function c(){b.resolveCloudConflict(y.getSavedResolutions()),v.pubsub.publish("cloudSave.destroy")}function u(e,t){if(!e||"object"!=typeof e||0===e.length||g.all(e,function(e){return!e.metadataRaw}))return t;var n=g.map(e,d),i=g.find(n,function(e){return"undefined"!=typeof e.slot});return"undefined"==typeof i&&(i=n[0]),"undefined"==typeof i&&(i={}),i.autosave?C.getText("CloudSaveAutoSaveSlot","HomeSignin","Auto Save Slot"):"undefined"!=typeof i.slot?C.getText("CloudSaveSlot","HomeSignin","Save Slot {0}").format(i.slot):t}function d(e){var t=void 0,n=void 0;return"undefined"!=typeof e&&"undefined"!=typeof e.metadataRaw&&(n=g.find(e.metadataRaw,function(e){return"Autosave"===e.rawKey&&1===e.rawValue}),n||(t=g.find(e.metadataRaw,function(e){return"Slot"===e.rawKey}),t&&(t=t.value))),{autosave:n,slot:t}}function f(e,t,n){var i={title:C.getText("LocalBackupTitle","HomeSignin","Restore Local Backup"),statusMessage:"",subMessage:C.getText("CloudSaveModalMsgEnd","HomeSignin","Are you sure you are happy with your selections?"),pubsubKey:"localBackup.confirmSelection"};if(t||!n)i.statusMessage=C.getText("LocalBackupAllCurrent","HomeSignin","You have not selected any Backup Saves to restore."),i.subMessage="",i.btn1Text="OK";else{var a=g.filter(e,function(e){return e.resolutionEnum===b.resolutionEnum.useLocalBackup1}),r=g.filter(e,function(e){return e.resolutionEnum===b.resolutionEnum.useLocalBackup2});i.statusMessage+=a.length||r.length?" "+C.getText("LocalBackupModalMsg","HomeSignin","Your Current Saves will be backed up before the selected Backup Files are restored."):" "+C.getText("LocalBackupNoBackupsSelected","HomeSignin","You have not selected any Backup Files to restore.")}v.pubsub.publish("modal.showConfirmModal",i)}function h(){b.resolveLocalBackup(y.getSavedResolutions()),v.pubsub.publish("cloudSave.destroy")}function p(){_=[]}function m(){p()}var g=e("underscore"),v=e("common/baseUtils"),b=e("common/sdk"),C=e("common/localize"),S=e("moment"),y={};y.isCloudSavesUnknown=function(e){return null==e||"undefined"==typeof e||"undefined"==typeof e.Enabled||"unknown"===e.Enabled};var w;y.setCloudSaveDecision=function(e){w=e},y.getCloudSaveDecision=function(){return w},y.sanitizeConflicts=function(e){var n={fileName:v.htmlEncode(e.fileName),local:e.local,cloud:e.cloud};return y.isDeleted(e.local)||(n.local=t(e.local)),y.isDeleted(e.cloud)||(n.cloud=t(e.cloud)),n},y.processCloudSaveDecision=function(){var e=y.getCloudSaveDecision();"undefined"!=typeof e&&(v.pubsub.publish("cloudSave.destroy"),b.updateCloudSavesEnabledSetting(e),b.sendCloudState(e))},y.showCloudDisabledConfirmModal=function(){var e={title:C.getText("CloudSaveDisabledModalTitle","HomeSignin","Cloud Saves Disabled"),statusMessage:C.getText("CloudSaveDisabledModalMsg","HomeSignin","Are you sure you want to disable cloud saves on this machine?"),subMessage:C.getText("CloudSaveDisabledModalSubMsg","HomeSignin","Cloud saves can be enabled later from the in-game Social Club settings menu."),pubsubKey:"cloudSave.confirmDisable"};v.pubsub.publish("modal.showConfirmModal",e)},y.showConfirmModal=function(e,t){var n={title:C.getText("CloudSaveModalTitle","HomeSignin","Cloud Save Conflict"),statusMessage:"",subMessage:C.getText("CloudSaveModalMsgEnd","HomeSignin","Are you sure you are happy with your selections?"),pubsubKey:"cloudSave.confirmSelection"},i=y.getSavedResolutions(),a=e||g.some(i,function(e){return e.resolutionEnum===b.resolutionEnum.ignore}),r=!e&&g.some(i,function(e){return e.resolutionEnum!==b.resolutionEnum.ignore});if(t)return void f(i,e,r);if(r){var o,s=g.filter(i,function(e){return e.resolutionEnum===b.resolutionEnum.useLocal}),l=g.filter(i,function(e){return e.resolutionEnum===b.resolutionEnum.useCloud}),c=g.every(i,function(e){return e.resolutionEnum===b.resolutionEnum.useLocal}),u=g.every(i,function(e){return e.resolutionEnum===b.resolutionEnum.useCloud});n.statusMessage=C.getText("CloudSaveModalMsg","HomeSignin","Your selections are final, overwritten save files are not able to be recovered."),s.length&&(c?n.statusMessage+=" "+C.getText("CloudSaveModalAllLocal","HomeSignin","All conflicts will be replaced with local versions."):(o=g.map(s,function(e){return e.filename}),n.statusMessage+=" "+C.getText("CloudSaveModalSomeLocal","HomeSignin","One or more local files are being kept ({0}).").format(o.join(", ")))),l.length&&(u?n.statusMessage+=" "+C.getText("CloudSaveModalAllCloud","HomeSignin","All conflicts will be replaced with cloud versions."):(o=g.map(l,function(e){return e.filename}),n.statusMessage+=" "+C.getText("CloudSaveModalSomeCloud","HomeSignin","One or more cloud files are being kept ({0}).").format(o.join(", "))))}a&&(n.statusMessage+=" "+C.getText("CloudSaveModalSomeIgnore","HomeSignin","Ignored conflicts will still be conflicted next time.")),v.pubsub.publish("modal.showConfirmModal",n)},y.formatResolution=function(e,t){if(t!==b.resolutionEnum[t])throw new Error("invalid resolution enum: "+t);return{filename:e,resolutionEnum:t}},y.isDeleted=function(e){return"boolean"==typeof e},y.getDescData=function(e,t,n,i){if(n||(i=t?e.cloud:e.local),y.isDeleted(i))return{isDeleted:!0};var a=S(i.lastModified),r=a.fromNow();if(n)return r=S(i.lastModified).format("lll"),{date:r,metadata:g.without(i.metadata,""),metadataRaw:i.metadataRaw};var o=t?e.local:e.cloud,s=S(o.lastModified),l=s.fromNow();return r===l&&(r=S(i.lastModified).format("lll")),{date:r,isNewer:a.isAfter(s),metadata:g.without(i.metadata,""),metadataRaw:i.metadataRaw}},y.getRowTitle=function(e,t){switch(globals.titleName){case"gta5":return u(e,t);default:return t}},y.sanitizeLocalBackupFiles=function(e){var n={fileName:v.htmlEncode(e.fileName)};return e.current&&(n.current=t(e.current)),e.localbackup1&&(n.localbackup1=t(e.localbackup1)),e.localbackup2&&(n.localbackup2=t(e.localbackup2)),n};var _=[];return y.getSavedResolutions=function(){return _},y.addSavedResolution=function(e){_.push(e)},y.updateSavedResolution=function(e,t){_[t]=e},v.pubsub.subscribe("cloudSave.confirmSelection",c),v.pubsub.subscribe("cloudSave.destroy",m),v.pubsub.subscribe("localBackup.confirmSelection",h),y}),function(e){function t(t,n){this.el=e(t),this.options=n||{},this.padding=void 0==this.options.padding?2:this.options.padding,this.autoHide=!1!==this.options.autoHide,this.inner=this.el.find(".antiscroll-inner"),this.inner.css({width:"+="+a(),height:"+="+a()}),this.refresh()}function n(t){this.pane=t,this.pane.el.append(this.el),this.innerEl=this.pane.inner.get(0),this.dragging=!1,this.enter=!1,this.shown=!1,this.pane.el.mouseenter(e.proxy(this,"mouseenter")),this.pane.el.mouseleave(e.proxy(this,"mouseleave")),this.el.mousedown(e.proxy(this,"mousedown")),this.pane.inner.scroll(e.proxy(this,"scroll")),this.pane.inner.bind("mousewheel",e.proxy(this,"mousewheel"));var n=this.pane.options.initialDisplay;n!==!1&&(this.show(),this.pane.autoHide&&(this.hiding=setTimeout(e.proxy(this,"hide"),parseInt(n,10)||3e3)))}function i(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n}function a(){if(!r){var t=e('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div>');e("body").append(t);var n=e("div",t).innerWidth();t.css("overflow-y","scroll");var i=e("div",t).innerWidth();e(t).remove(),r=n-i}return r}e.fn.antiscroll=function(t){return this.each(function(){e(this).data("antiscroll")&&e(this).data("antiscroll").destroy(),e(this).data("antiscroll",new e.Antiscroll(this,t))})},e.Antiscroll=t,t.prototype.refresh=function(){var e=this.inner.get(0).scrollWidth>this.el.width(),t=this.inner.get(0).scrollHeight>this.el.outerHeight();!this.horizontal&&e?this.horizontal=new n.Horizontal(this):this.horizontal&&!e&&(this.horizontal.destroy(),this.horizontal=null),!this.vertical&&t?this.vertical=new n.Vertical(this):this.vertical&&!t&&(this.vertical.destroy(),this.vertical=null)},t.prototype.destroy=function(){return this.horizontal&&this.horizontal.destroy(),this.vertical&&this.vertical.destroy(),this},t.prototype.rebuild=function(){return this.destroy(),this.inner.attr("style",""),t.call(this,this.el,this.options),this},n.prototype.destroy=function(){return this.el.remove(),this},n.prototype.mouseenter=function(){this.enter=!0,this.show()},n.prototype.mouseleave=function(){this.enter=!1,this.dragging||this.pane.autoHide&&this.hide()},n.prototype.scroll=function(){this.shown||(this.show(),this.enter||this.dragging||this.pane.autoHide&&(this.hiding=setTimeout(e.proxy(this,"hide"),1500))),this.update()},n.prototype.mousedown=function(t){t.preventDefault(),this.dragging=!0,this.startPageY=t.pageY-parseInt(this.el.css("top"),10),this.startPageX=t.pageX-parseInt(this.el.css("left"),10),document.onselectstart=function(){return!1};var n=(this.pane,e.proxy(this,"mousemove")),i=this;e(document).mousemove(n).mouseup(function(){i.dragging=!1,document.onselectstart=null,e(document).unbind("mousemove",n),i.enter||i.hide()})},n.prototype.show=function(){this.shown||(this.update(),this.el.addClass("antiscroll-scrollbar-shown"),this.hiding&&(clearTimeout(this.hiding),this.hiding=null),this.shown=!0)},n.prototype.hide=function(){this.pane.autoHide!==!1&&this.shown&&(this.el.removeClass("antiscroll-scrollbar-shown"),this.shown=!1)},n.Horizontal=function(t){this.el=e('<div class="antiscroll-scrollbar antiscroll-scrollbar-horizontal">'),n.call(this,t)},i(n.Horizontal,n),n.Horizontal.prototype.update=function(){var e=this.pane.el.width(),t=e-2*this.pane.padding,n=this.pane.inner.get(0);this.el.css("width",t*e/n.scrollWidth).css("left",t*n.scrollLeft/n.scrollWidth)},n.Horizontal.prototype.mousemove=function(e){var t=this.pane.el.width()-2*this.pane.padding,n=e.pageX-this.startPageX,i=this.el.width(),a=this.pane.inner.get(0),r=Math.min(Math.max(n,0),t-i);a.scrollLeft=(a.scrollWidth-this.pane.el.width())*r/(t-i)},n.Horizontal.prototype.mousewheel=function(e,t,n){return 0>n&&0==this.pane.inner.get(0).scrollLeft||n>0&&this.innerEl.scrollLeft+this.pane.el.width()==this.innerEl.scrollWidth?(e.preventDefault(),!1):void 0},n.Vertical=function(t){this.el=e('<div class="antiscroll-scrollbar antiscroll-scrollbar-vertical">'),n.call(this,t)},i(n.Vertical,n),n.Vertical.prototype.update=function(){var e=this.pane.el.height(),t=e-2*this.pane.padding,n=this.innerEl;this.el.css("height",t*e/n.scrollHeight).css("top",t*n.scrollTop/n.scrollHeight)},n.Vertical.prototype.mousemove=function(e){var t=this.pane.el.height(),n=t-2*this.pane.padding,i=e.pageY-this.startPageY,a=this.el.height(),r=this.innerEl,o=Math.min(Math.max(i,0),n-a);r.scrollTop=(r.scrollHeight-t)*o/(n-a)},n.Vertical.prototype.mousewheel=function(t,n,i,a){return!e(t.target).closest(".dk_options").length&&(a>0&&0==this.innerEl.scrollTop||0>a&&this.innerEl.scrollTop+this.pane.el.height()==this.innerEl.scrollHeight)?(t.preventDefault(),!1):void 0};var r}(jQuery),define("common/antiscroll",["jquery"],function(e){return function(){var t;return t||e.$}}(this)),define("common/launcher/cloudSave",["require","jquery","underscore","common/baseUtils","common/sdk","common/localize","moment","am","common/launcher/cloudSave-utils","common/antiscroll"],function(e){function t(){var e=w("#cloudSave");e.find(".buttonActions a.ignore").css("display","none"),e.find(".buttonActions .right p").addClass("hide"),e.find(".preamble").addClass("hide"),e.find(".localBackupPreamble").addClass("hide"),e.find(".choicePreamble").removeClass("hide"),e.find(".buttonActions .confirm").addClass("disabled");var t=w("#cloudSave .choice");t.removeClass("hide"),w("#cloudSave .chooseMulti").addClass("hide"),w("#cloudSave div.chooseSave").addClass("hide"),t.on("click","div.enable",i).on("click","div.disable",a),w("#cloudSave").on("click","a.confirm",function(e){e&&e.preventDefault(),A.processCloudSaveDecision()}),o(),R.trackPage("/CloudSave/Decide")}function n(e){return A.isCloudSavesUnknown(e)||"enabled"!==e.Enabled?(E.pubsub.publish("cloudSave.destroy"),void k.sendCloudState(!1)):(o(),void w("#cloudSave").on("click","a.confirm",function(e){e&&e.preventDefault(),E.pubsub.publish("cloudSave.destroy"),k.sendCloudState(!0)}))}function i(e){e&&e.preventDefault(),w("#cloudSave .choice>div").removeClass("active").addClass("inactive"),w("#cloudSave .buttonActions .confirm").removeClass("disabled"),w(e.currentTarget).removeClass("inactive").addClass("active"),A.setCloudSaveDecision(!0)}function a(e){e&&e.preventDefault(),A.showCloudDisabledConfirmModal()}function r(){w("#cloudSave .choice>div").removeClass("active").addClass("inactive"),w("#cloudSave .buttonActions .confirm").removeClass("disabled"),w("#cloudSave .choice div.disable").removeClass("inactive").addClass("active"),A.setCloudSaveDecision(!1)}function o(){w("#launcherStyle").css("top","-450px"),w("#cloudSave").css("top","63px").css("display","block")}function s(e){var t=w("#cloudSave .chooseSave.cloudSave");t.removeClass("hide"),w("#cloudSave .chooseMulti").addClass("hide"),w("#cloudSave .choice").addClass("hide"),p(t,e),t.on("click","div.useCloud",function(t){u(t,e.fileName,k.resolutionEnum.useCloud)}).on("click","div.useLocal",function(t){u(t,e.fileName,k.resolutionEnum.useLocal)}),w("#cloudSave .binary div.antiscroll-wrap").antiscroll(),h(e,!1),R.trackPage("/CloudSave/Conflict/Single")}function l(e,t){var n=w("#cloudSave .chooseMulti");w("#cloudSave div.chooseSave").addClass("hide"),w("#cloudSave .choice").addClass("hide"),n.find("table.optionDetails").find("tr").remove(),n.removeClass("hide"),t&&C(e,n);var i=c(e,t);n.find("table.optionDetails").append(i),w("#cloudSave.panel .optionDetailsWrapper").antiscroll(),w("#cloudSave").on("click","input[name=radioAll]",function(t){var n=w(t.currentTarget),i=n.hasClass("active");return w("#cloudSave input[name=radioAll]").removeClass("active").prop("checked",!1),i?(w("#cloudSave input[type=reset]").click(),void d(e,k.resolutionEnum.ignore)):(n.addClass("active").prop("checked",!0),d(e,t.currentTarget.value),void w("#cloudSave input[name^=chk]").val([t.currentTarget.value]))}),w("#cloudSave").on("click","input[name^=chk]",function(t){var n=t.currentTarget.name.substr("chk".length),i=e[n].fileName,a=t.currentTarget.value;u(t,i,a)}),h(e,t),R.trackPage("/CloudSave/Conflict/Multi/"+e.length)}function c(e,t){return t?_.reduce(e,function(e,n,i){var a=A.getDescData(n,!1,t,n.current),r=A.getDescData(n,!1,t,n.localbackup1),o=A.getDescData(n,!1,t,n.localbackup2),s=A.getRowTitle([a,r,o],n.fileName),l='<td><label><span><h3 class="delete"><i class="scicon-nav_notifications"></i> '+T.getText("LocalBackupNoBackup","HomeSignin","no backup")+"</h3></label></td>",c=e+'<tr class="saveSlot"><td colspan="3"><p>{0}</p><span style="right:66%" class="local">{1}</span><span style="right:33%" class="cloud">{2}</span><span style="right:0" class="cloud">{3}</span></td></tr>'.format(s,n.fileName,T.getText("LocalBackupCurrent","HomeSignin","current"),T.getText("LocalBackup1","HomeSignin","backup 1"),T.getText("LocalBackup2","HomeSignin","backup 2")),u=n.current?'<td><input type="radio" name="chk{0}" value="{1}" id="localcheck{0}" /><label class="current" for="localcheck{0}"><span class="localBackup">{2}</span><i class="scicon-localsave"></i></label></td>'.format(i,k.resolutionEnum.useCurrent,g(n,!1,t,n.current)):l,d=n.localbackup1?'<td><input type="radio" name="chk{0}" value="{1}" id="backup1check{0}" /><label class="localBackup1" for="backup1check{0}"><span class="localBackup">{2}</span><i class="scicon-localsave-restore"></i></label></td>'.format(i,k.resolutionEnum.useLocalBackup1,g(n,!1,t,n.localbackup1)):l,f=n.localbackup2?'<td><input type="radio" name="chk{0}" value="{1}" id="backup2check{0}" /><label class="localBackup2" for="backup2check{0}"><span class="localBackup">{2}</span><i class="scicon-localsave-restore"></i></label></td>'.format(i,k.resolutionEnum.useLocalBackup2,g(n,!1,t,n.localbackup2)):l;return c+"<tr>"+u+d+f+"</tr>"},""):_.reduce(e,function(e,n,i){var a=A.getDescData(n,!1,t,n.current),r=A.getDescData(n,!0,t,n.current),o=A.getRowTitle([a,r],n.fileName);return e+'<tr class="saveSlot"><td colspan="2"><p>{0}</p><span class="local">{6}</span><span class="cloud">{7}</span></td></tr><tr><td><input type="radio" name="chk{1}" value="{2}" id="localcheck{1}" /><label for="localcheck{1}"><span>{3}</span><i class="scicon-localsave"></i></label></td><td><input type="radio" name="chk{1}" value="{4}" id="cloudcheck{1}" /><label for="cloudcheck{1}"><span>{5}</span><i class="scicon-cloud"></i></label></td></tr>'.format(o,i,k.resolutionEnum.useLocal,g(n,!1),k.resolutionEnum.useCloud,g(n,!0),T.getText("Local","HomeSignin","local"),T.getText("Cloud","HomeSignin","cloud"))},"")}function u(e,t,n){var i=w(e.currentTarget);i.hasClass("disabled")||(w("input[name=radioAll]").prop("checked",!1).removeClass("active"),i.hasClass("active")?f(t,k.resolutionEnum.ignore):f(t,n))}function d(e,t){t===k.resolutionEnum.ignore&&w("input[name=radioAll]").prop("checked",!1).removeClass("active"),_.forEach(e,function(e){f(e.fileName,t)})}function f(e,t){var n=_.findIndex(A.getSavedResolutions(),function(t){return t.filename===e}),i=w("input[name=chk"+n+"]"),a=i.filter("[value="+t+"]");if(i.length)i.addClass("inactive").removeClass("active").prop("checked",!1),t==k.resolutionEnum.useLocal||t==k.resolutionEnum.useCloud||t==k.resolutionEnum.useCurrent||t==k.resolutionEnum.useLocalBackup1||t==k.resolutionEnum.useLocalBackup2?(a.addClass("active").removeClass("inactive").prop("checked",!0),a.parents("tr").removeClass("useLocal useCloud useCurrent useLocalBackup1 useLocalBackup2").addClass(t)):(a.prop("checked",!1),i.parents("tr").removeClass("useLocal useCloud useCurrent useLocalBackup1 useLocalBackup2"));else{var r=w("#cloudSave div.chooseSave>div");a=r.filter("."+t),r.removeClass("active").addClass("inactive"),(t==k.resolutionEnum.useLocal||t==k.resolutionEnum.useCloud||t==k.resolutionEnum.useCurrent||t==k.resolutionEnum.useLocalBackup1||t==k.resolutionEnum.useLocalBackup2)&&a.addClass("active").removeClass("inactive")}n>-1?A.updateSavedResolution(A.formatResolution(e,t),n):A.addSavedResolution(A.formatResolution(e,t))}function h(e,t){w("#cloudSave").on("click","a.confirm",function(e){e&&e.preventDefault(),E.isOnline()?A.showConfirmModal(!1,t):E.pubsub.publish("cloudSave.confirmSelection")}).on("click","a.ignore",function(n){n&&n.preventDefault(),Array.isArray(e)?d(e,k.resolutionEnum.ignore):f(e.fileName,k.resolutionEnum.ignore),A.showConfirmModal(!0,t)})}function p(e,t){e.find(".useLocal strong").html(g(t,!1)),e.find(".useCloud strong").html(g(t,!0)),A.isDeleted(t.cloud)?w("#cloudSave .useCloud > h3, #cloudSave .useCloud > p:first").addClass("hide"):m(w("#cloudSave .useCloud > div")),A.isDeleted(t.local)?w("#cloudSave .useLocal > h3, #cloudSave .useLocal > p:first").addClass("hide"):m(w("#cloudSave .useLocal > div"))}function m(e){e.wrap('<div class="box-wrap antiscroll-wrap"></div>').wrap('<div class="box"></div>').wrap('<div class="antiscroll-inner"></div>')}function g(e,t,n,i){var a=A.getDescData(e,t,n,i);if(a.isDeleted){var r=t?"CloudSaveDeletedCloud":"CloudSaveDeletedLocal",o='<h3 class="delete"><i class="scicon-nav_notifications"></i> {0}</h3>'.format(T.getText("CloudSaveDeleted","HomeSignin","Deleted")),s="This item has been deleted from {0}. Selecting it will also delete the save file from {1}".format(t?"the Cloud":"your local machine",t?"your local machine":"the Cloud");return o+T.getText(r,"HomeSignin",s)}var l=a.date;return"undefined"==typeof a.metadata||a.metadata.length<=0?"{0}<br/>{1}".format(l,T.getText("CloudSaveNoMetaData","HomeSignin","Unable to load file metadata")):"{0}<br/>{1}".format(l,_.reduce(a.metadata,function(e,t){return"{0}<br/>{1}".format(e,t)}))}function v(){var e=w("#cloudSave");e.find("h1.online").text(T.getText("LocalBackupTitle","HomeSignin","Restore Local Backup")),e.find(".localBackupPreamble").removeClass("hide"),e.find("#cloudSaveWarning").addClass("hide")}function b(e){var t=w("#cloudSave .chooseSave.localBackup");t.removeClass("hide"),w("#cloudSave .chooseMulti").addClass("hide"),w("#cloudSave .choice").addClass("hide"),t.find("div").removeClass("active").addClass("inactive"),S(t,e),t.on("click","div.useCurrent",function(t){u(t,e.fileName,k.resolutionEnum.useCurrent)}).on("click","div.useLocalBackup1",function(t){u(t,e.fileName,k.resolutionEnum.useLocalBackup1)}).on("click","div.useLocalBackup2",function(t){u(t,e.fileName,k.resolutionEnum.useLocalBackup2)}),w("#cloudSave .triple div.antiscroll-wrap").antiscroll(),h(e,!0),R.trackPage("/LocalBackup/Single")}function C(e,t){t.find(".optionSummary").addClass("hide"),t.find(".optionSummary.localBackup").removeClass("hide"),_.some(e,function(e){return e.localbackup1})||t.find("#radioAllLocalBackup1").attr("disabled",!0),_.some(e,function(e){return e.localbackup2})||t.find("#radioAllLocalBackup2").attr("disabled",!0)}function S(e,t){var n='<label><span><h3 class="delete"><i class="scicon-nav_notifications"></i> '+T.getText("LocalBackupNoBackup","HomeSignin","no backup")+"</h3></label>";t.current&&e.find(".useCurrent strong").html(g(t,!1,!0,t.current)),t.localbackup1?e.find(".useLocalBackup1 strong").html(g(t,!1,!0,t.localbackup1)):e.find(".useLocalBackup1").html(n).addClass("disabled"),t.localbackup2?e.find(".useLocalBackup2 strong").html(g(t,!1,!0,t.localbackup2)):e.find(".useLocalBackup2").html(n).addClass("disabled"),m(w("#cloudSave .useCurrent > div")),m(w("#cloudSave .useLocalBackup1 > div")),m(w("#cloudSave .useLocalBackup2 > div"))}function y(){var e=w("#cloudSave");e.off().find(".active").removeClass("active"),e.find("h1.online").text(T.getText("CloudSaves","HomeSignin","Cloud Saves")),e.find("input[type=reset]").click(),e.find(".buttonActions a.ignore").css("display","inline-block"),e.find(".buttonActions .right p").removeClass("hide"),e.find(".choicePreamble").addClass("hide"),e.find(".preamble").removeClass("hide"),e.find(".buttonActions .confirm").removeClass("disabled"),e.find(".useCloud > h3, #cloudSave .useCloud > p:first").removeClass("hide"),e.find(".useLocal > h3, #cloudSave .useLocal > p:first").removeClass("hide"),e.find("#cloudSaveWarning").removeClass("hide"),e.find(".chooseMulti .optionSummary").removeClass("hide"),e.find(".localBackupPreamble").addClass("hide"),e.find(".chooseSave.localBackup").addClass("hide"),e.find(".chooseMulti .optionSummary.localBackup").addClass("hide")}var w=e("jquery"),_=e("underscore"),E=e("common/baseUtils"),k=e("common/sdk"),T=e("common/localize"),I=e("moment"),R=e("am"),A=e("common/launcher/cloudSave-utils");e("common/antiscroll");var L={};return L.requestCloudConflictResolution=function(e){if("undefined"!=typeof e){o(),w("#cloudSave h1.online").text(T.getText("CloudSaveConflict","HomeSignin","Cloud Sync Conflict")),I.lang(globals.titlelang);var t=e.conflicts.map(A.sanitizeConflicts);d(t,k.resolutionEnum.ignore),0!==t.length&&(1===t.length?s(t[0]):l(t,!1))}},L.checkCloudSaveEnabled=function(){var e=Promise.resolve(k.getCloudSavesEnabledSetting());e.then(function(e){return E.isOffline()?void n(e):void(A.isCloudSavesUnknown(e)?t():k.sendCloudState("enabled"===e.Enabled))})},L.requestLocalBackupResolution=function(e){if("undefined"!=typeof e){o(),v(),I.lang(globals.titlelang);var t=e.conflicts.map(function(e){return A.sanitizeLocalBackupFiles(e)});d(t,k.resolutionEnum.ignore),0!==t.length&&(1===t.length?b(t[0]):l(t,!0))}},E.pubsub.subscribe("cloudSave.confirmDisable",r),E.pubsub.subscribe("cloudSave.destroy",y),L}),define("common/launcher/launcher",["require","jquery","utils","common/baseUtils","setup.environment.utils","common/sdk","common/launcher/cloudSave","common/jquery.visible"],function(t){var n=t("jquery"),i=t("utils"),a=t("common/baseUtils"),r=t("setup.environment.utils"),o=t("common/sdk"),s=t("common/launcher/cloudSave");t("common/jquery.visible");var l={};l.init=function(){n("#launcherStyle").on("click",".buttons a",f).on("keyup",".buttons a"),function(){var t=n(e.currentTarget);13==e.which&&t.visible()&&f()},n("#launcherControls").on("click",".minimise",o.minimizeUi).on("click",".close",o.quitGame)},l.initLauncher=function(e){e&&a.isLauncherV2Enabled()&&(i.WriteDebugLog("initLauncher","isLauncher","true"),globals.isLauncher=!0,globals.receiveMsgEnabled=!0,r.quickShowLauncherUi(),c(),u())};var c=function(){try{"string"==typeof globals.cc&&o.launcherData("Geo",globals.cc)}catch(e){}try{"string"==typeof globals.ip&&o.launcherData("ExternIP",globals.ip)
}catch(e){}},u=function(){n("body").addClass("launcher"),n("#launcherStyle").addClass(globals.titleName)},d=function(e,t){if(!globals.receiveMsgEnabled)return void i.WriteDebugLog("launcherCommand","aborted","false");var n=t.command,a=t.parameter;switch(r.showLauncherUi(),i.WriteDebugLog("launcherCommand",n,JSON.stringify(a)),n){case"SetText":h(a);break;case"SetButtons":p(a);break;case"SetHeaderText":m(a);break;case"SetSpinnerText":g(a);break;case"SetProgressText":b(a);break;case"SetVersionText":v(a);break;case"SetProgress":S(a);break;case"GetCloudSaveState":s.checkCloudSaveEnabled();break;case"RequestLocalBackupResolution":y("cloudSave"),s.requestLocalBackupResolution(a);break;case"RequestCloudConflictResolution":y("cloudSave"),s.requestCloudConflictResolution(a);break;case"ShowDebugLog":window.debugLog&&window.RGSC_JS_SHOW_DEBUG_LOG&&window.RGSC_JS_SHOW_DEBUG_LOG();break;default:throw"Error: Unsupported command: "+n}},f=function(e){e&&e.preventDefault(),i.WriteDebugLog("launcherButtonClicked");var t=n(e.currentTarget).attr("data"),a=Number(t);isNaN(a)&&(a=t),o.launcherUiEvent(a)},h=function(e){var t=n("#launcherStyle").find(".dialogue");y("dialogue"),t.find("p").html(i.processLauncherText(e)),t.fadeIn()},p=function(e){for(var t="",a=e.length-1;a>-1;a--){var r="btnPurple",o=void 0;0==a&&(r="btnGrey",o="btnCancel"),t+=i.getButtonHtml(r,e[a],a,o)}var s=n("#launcherStyle").find(".buttons");s.html(t),s.is(":visible")||s.fadeIn()},m=function(e){n("#launcherStyle").find(".headerText").html(i.processLauncherText(e))},g=function(e){var t=n("#launcherStyle");y("loading");var a;"object"==typeof e&&"string"==typeof e.text?(a=e.text,e.toggleMode&&C(!0,!0)):a=e,t.find(".loading p").html(i.processLauncherText(a));var r=(new Date).getTime()+864e5;i.initSpinner(t.find(".loadingSpinner"),{endTime:r}).fadeIn(),t.find(".loading").fadeIn()},v=function(e){n("#launcherStyle").find(".ver").html(i.processLauncherText(e)).fadeIn()},b=function(e){var t=n("#launcherStyle").find(".progressBar");y("progressBar"),t.find("p").html(i.processLauncherText(e)),t.fadeIn()},C=function(e,t){e=void 0==e?!0:e;var i=e?"downloader":"",a=n("#launcherStyle").css("background"),r=function(){globals.launcherClass=i,e?n("body").addClass("downloader"):n("body").removeClass("downloader"),n("launcherStyle").fadeTo({background:a},"slow"),n("#launcherStyleContent").fadeIn("slow")};t?r():n.when(n("#launcherStyleContent").fadeOut("slow"),n("launcherStyle").fadeTo({background:"#fff"},"slow")).then(r)},S=function(e){var t=n("#launcherStyle").find(".progressBarTotal"),i=t.find("span");n("body").hasClass("downloader")||C(!0,!0),i.width(100*e+"%")},y=function(e){var t=n("#launcherStyle");if(i.stopSpinner(t.find(".loadingSpinner")),"dialogue"!==e){var a=t.find(".dialogue");a.find("p").text(""),a.hide()}if("progressBar"!==e){var r=t.find(".progressBar");r.find("p").text(""),r.find(".progressBarTotal span").width("0%"),r.hide()}if("loading"!==e){var o=t.find(".loading");o.find("p").text(""),o.hide()}"cloudSave"!==e&&(t.css("top","63px"),n("#cloudSave").css("top","-450px").css("display","none"))};return a.pubsub.subscribe("launcher.launcherCommand",d),l}),define("common/modals/modal-models",["backbone"],function(e){var t={};return t.ModalModel=e.Model.extend({defaults:{NameWrapper:'<span class="name">{name}</span>',Btn1Text:"ConfirmButtonText",Btn2Text:"Cancel"}}),t}),define("hbs!common/templates/common/confirm_modal",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e){var t,i,a="";return a+='\r\n      <p class="title">',(i=n.Title)?t=i.call(e,{hash:{}}):(i=e&&e.Title,t=typeof i===h?i.call(e,{hash:{}}):i),a+=p(t)+"</p>\r\n      "}function o(e){var t,i,a="";return a+="\r\n      <p>\r\n      ",(i=n.SubMessage)?t=i.call(e,{hash:{}}):(i=e&&e.SubMessage,t=typeof i===h?i.call(e,{hash:{}}):i),(t||0===t)&&(a+=t),a+="\r\n      </p>\r\n      "}function s(e,t){var i,a="";return a+='\r\n      <span class="options">\r\n          ',i=n["if"].call(e,e&&e.btn2Text,{hash:{},inverse:m.noop,fn:m.program(6,l,t)}),(i||0===i)&&(a+=i),a+="\r\n          ",i=n["if"].call(e,e&&e.btn1Text,{hash:{},inverse:m.noop,fn:m.program(8,c,t)}),(i||0===i)&&(a+=i),a+="\r\n      </span>\r\n      "}function l(e){var t,i,a="";return a+='\r\n          <a class="btn btnGrey btnRounded btnSmall no cancel" href="#">',(i=n.btn2Text)?t=i.call(e,{hash:{}}):(i=e&&e.btn2Text,t=typeof i===h?i.call(e,{hash:{}}):i),a+=p(t)+"</a>\r\n          "}function c(e){var t,i,a="";return a+='\r\n          <a class="btn btnRed btnRounded btnSmall yes confirm" data-type="',(i=n.ModalType)?t=i.call(e,{hash:{}}):(i=e&&e.ModalType,t=typeof i===h?i.call(e,{hash:{}}):i),a+=p(t)+'" href="#">',(i=n.btn1Text)?t=i.call(e,{hash:{}}):(i=e&&e.btn1Text,t=typeof i===h?i.call(e,{hash:{}}):i),a+=p(t)+"</a>\r\n          "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var u,d,f="",h="function",p=this.escapeExpression,m=this;return f+='<div class="statusbar bold" style="bottom: 0px;">\r\n  <div class="clearfix">\r\n      ',u=n["if"].call(t,t&&t.Title,{hash:{},inverse:m.noop,fn:m.program(1,r,a)}),(u||0===u)&&(f+=u),f+="\r\n      <p>\r\n      ",(d=n.Message)?u=d.call(t,{hash:{}}):(d=t&&t.Message,u=typeof d===h?d.call(t,{hash:{}}):d),(u||0===u)&&(f+=u),f+="\r\n      </p>\r\n      ",u=n["if"].call(t,t&&t.SubMessage,{hash:{},inverse:m.noop,fn:m.program(3,o,a)}),(u||0===u)&&(f+=u),f+="\r\n      ",u=n["if"].call(t,t&&t.ShowButtons,{hash:{},inverse:m.noop,fn:m.program(5,s,a)}),(u||0===u)&&(f+=u),f+="\r\n  </div>\r\n</div>"});return n}),define("common/modals/modal-views",["jquery","backbone","underscore","utils","common/baseUtils","common/localize","common/modals/modal-models","hbs!common/templates/common/confirm_modal"],function(e,t,n,i,a,r,o,s){function l(e,t){return c.ShowConfirmModal(t.statusMessage,t.playerNickname,t.pubsubKey,t.pubsubParams,t.btn1Text,t.btn2Text,t.title,t.subMessage)}var c={};return c.showModal=function(){e("body").addClass("modal")},c.hideModal=function(){e("body").removeClass("modal")},c.ShowConfirmModal=function(e,t,n,r,o,s,l,u){i.WriteDebugLog("ShowConfirmModal","statusMessage, playerNickname",+e+","+t),a.isScuiVisible()&&(window.amd.modals.ConfirmModalView=new c.ConfirmModalView({Message:e,Name:t,pubsubKey:n,pubsubParams:r,Btn1Text:o,Btn2Text:s,Title:l,SubMessage:u,FocusBtn:"cancel"}))},c.ShowErrorModal=function(t){var n=t.message,i=t.supportText,o=t.errorCodeDesc,s=t.title;a.isScuiVisible()&&(e("#confirmModal").find(".statusbar").length>0||(s=s||r.getError("ErrorHasOccurred"),"object"==typeof n&&(o=n.CodeDescription,n=n.Message),o&&(n=(n||"")+" "+o),c.ShowConfirmModal(n,null,null,null,"Close",null,s,i)))},c.ShowFeatureDisabledModal=function(e,t,n,i,a){var o=r.getError("FeatureDisabled");"undefined"!=typeof t&&t.length||(t=r.getError("FeatureDisabledDesc")),c.ShowErrorModal({errorCode:e,message:t,contentEl:n,supportText:i,errorCodeDesc:a,title:o})},c.ConfirmModalView=t.View.extend({el:"#confirmModal",events:{"click .cancel":"cancel","click .confirm":"confirm","keydown .cancel":"setBtnFocus","keydown .confirm":"setBtnFocus"},render:function(){c.showModal();var e={Message:this.getMessage(),Name:this.model.get("Name"),ShowButtons:!0,btn1Text:r.getText(this.model.get("Btn1Text"),"HomeSignin"),btn2Text:r.getText(this.model.get("Btn2Text"),"HomeSignin"),Title:this.model.get("Title"),SubMessage:this.getSubMessage()},t=i.renderCompiledTemplate(s,e);this.$el.append(t);var n=this.$(".statusbar");n.show().css({top:globals.headerHeight}),n.find("div").animate({"margin-top":"150px"},300,"easeOutQuart");var a=void 0!==this.model.get("FocusBtn")?this.model.get("FocusBtn"):"cancel";return this.$el.find("."+a).focus(),this},getMessage:function(){var e=this.model.get("Message");if(void 0==e)return e;var t=this.model.get("Name"),n=this.model.get("NameWrapper");t=n.replace(/{name}/,i.jhtmlEncode(t));var a=this.extractWhitelistedAnchorTags(e),r=a.anchortags;return e=a.msg,e=i.jhtmlEncode(i.stripHTMLNewLine(e)),e.indexOf("[")>=0?(e=e.replace(/\[PlayerNickname\]/gi,t),e=e.replace(/\[CrewName\]/gi,t),e.indexOf("[anchortag]")>=0&&(e=this.replaceAnchorTags(r,e))):e+=" "+t,e},getSubMessage:function(){var e=this.model.get("SubMessage");if(void 0==e)return e;var t=this.extractWhitelistedAnchorTags(e),n=t.anchortags;return e=t.msg,e=i.jhtmlEncode(i.stripHTMLNewLine(e)),e.indexOf("[anchortag]")>=0&&(e=this.replaceAnchorTags(n,e)),e},extractWhitelistedAnchorTags:function(t){var n=t.match(/\<a[^>]*>([^<]+)<\/a>/g);if(null==n||0==n.length)return{anchortags:void 0,msg:t};for(var i=n.slice(),a=globals.redirectUrlWhitelist.split(","),r=n.length-1;r>-1;r--){var o=n[r],s=this.getAnchorTagHostName(o),l=s.replace(/^www./i,""),c=e.inArray(s,a)>-1||e.inArray(l,a)>-1;c?t=t.replace(o,"[anchortag]"):i.splice(r,1)}return{anchortags:i,msg:t}},getAnchorTagHostName:function(t){var n=e(document.createElement("div"));n.append(t);var i=n.find("a");return i[0].hostname},replaceAnchorTags:function(e,t){return e.forEach(function(e){t=t.replace("[anchortag]",e)}),t},confirm:function(e){e.preventDefault(),this.closeConfirmationDialog(),i.pubsub.trigger(this.model.get("pubsubKey"),this.model.get("pubsubParams")),a.pubsub.publish(this.model.get("pubsubKey"),this.model.get("pubsubParams"))},cancel:function(){void 0!=this.model.get("cancelPubsubKey")&&(i.pubsub.trigger(this.model.get("cancelPubsubKey"),this.model.get("cancelPubsubParams")),a.pubsub.publish(this.model.get("cancelPubsubKey"),this.model.get("cancelPubsubParams"))),this.closeConfirmationDialog()},closeConfirmationDialog:function(){c.hideModal();var e=this.$(".statusbar");e.find("div").animate({"margin-top":"-200px"},200,"easeInQuart",function(){e.css({top:"-100%"}),e.remove()}),this.onClose()},onClose:function(){this.$el.find(".statusbar").remove(),this.undelegateEvents()},setBtnFocus:function(e){var t=e.keyCode||e.which;if(9==t){e.preventDefault();var n=this.$el.find(".cancel"),i=this.$el.find(".confirm");i.is(":focus")?n.focus():i.focus()}},initialize:function(e){n.bindAll(this,"render","setBtnFocus"),this.model=new o.ModalModel(e),this.render()}}),a.pubsub.subscribe("modal.hide",c.hideModal),a.pubsub.subscribe("modal.showConfirmModal",l),c}),define("common/am/customDimensions",["require","am","setup.environment.utils","common/am/socialCount","utils","common/xhr"],function(e){function t(){var e=window.globals||{isAmCd:!1};return e.isAmCd}function n(e){if(d.setCustomDimension(d.dimension.loginState,e.LoginState),e.LoginState){var t=e.FriendCount,n=e.CrewCount;l.setSocialCountTotals(n,t),d.setCustomDimension(d.dimension.memberId,e.MemberId),d.setCustomDimension(d.dimension.validationStatus,e.ValidationStatus),d.setCustomDimension(d.dimension.creationPath,e.CreationPath),d.setCustomDimension(d.dimension.platformsOwned,e.PlatformsOwned),d.setCustomDimension(d.dimension.gamesOwned,e.GamesOwned),d.setCustomDimension(d.dimension.linkedAccounts,e.LinkedAccounts),d.setCustomDimension(d.dimension.friendCount,(t>0).toString()),d.setCustomDimension(d.dimension.crewCount,(n>0).toString()),d.setCustomDimension(d.dimension.creationDate,e.CreationDate),d.setCustomMetric(d.metric.friendCount,t),d.setCustomMetric(d.metric.crewCount,n),d.setCustomMetric(d.metric.daysOfMembership,e.DaysOfMembership)}}function i(e){var t=f[e.toLowerCase()];return"undefined"==typeof t&&(t="unknown"),t}function a(e){var t=e;return t||h.pc}function r(e,t){return e+"_"+t}var o=e("am"),s=e("setup.environment.utils"),l=e("common/am/socialCount"),c=e("utils"),u=e("common/xhr"),d={};d.startSession=function(){if(o.isEnabled()){o.startSession(),d.setCustomDimension(d.dimension.loginState,"false");var e=location.hostname.replace(/.ros.rockstargames.com/gi,"");e=e.replace(/.scui/gi,"")+".scui",d.setCustomDimension(d.dimension.environment,e)}},d.setUserId=function(e){o.isEnabled()&&void 0!=e&&e.length&&(o.setUserId(e),d.setCustomDimension(d.dimension.memberId,e))},d.setCustomDimension=function(e,n){o.isEnabled()&&t()&&window.ga("set","dimension"+e,n)},d.setCustomMetric=function(e,n){o.isEnabled()&&t()&&window.ga("set","metric"+e,n)},d.getCustomDimensionData=function(){if(o.isEnabled()&&t()){var e,i,a=l.getSocialCountTotals();c.isLegacyServiceLayer()?(i=s.GetAuthHeaderAsyncV8(),e=c.getApiUrl("/api/profile/getanalyticsdataLan"),a.Nickname=globals.account.Nickname):(i=s.GetAuthHeaderAsync(),e=c.getApiUrl("/api/profile/getanalyticsdata")),i.done(function(t){c.isLegacyServiceLayer()&&(t=s.appendLanAuthHeader(t)),u.ajax({type:"POST",cache:!1,async:!0,services:["accounts"],url:e,headers:t,data:a,silentFail:!0,disableSlowMsg:!0,success:n,dataType:"json"})})}},d.dimension={environment:1,validationStatus:2,memberId:3,loginState:4,creationDate:5,creationPath:6,platformsOwned:7,gamesOwned:8,friendCount:9,crewCount:10,linkedAccounts:11,currentlyPlaying:12,game:13,platform:14,previousPurchase:16,lastPurchaseDate:17,score:18,paymentType:19,offerRedeemed:20,pia1:15,pia2:21,pia3:22,pia4:23,pia5:24,pia6:25},d.metric={friendCount:1,crewCount:2,daysOfMembership:3,offlineSigninCount:4},d.setCurrentlyPlaying=function(e,t){var n=i(e),o=a(t);d.setCustomDimension(d.dimension.game,n),d.setCustomDimension(d.dimension.platform,o),d.setCustomDimension(d.dimension.currentlyPlaying,r(n,o))},d.getCreationPath=function(e,t){return r(i(e),a(t))};var f={mp3:"mp3",lanoire:"lanoire",gta5:"gta5"},h={pc:"pcros"};return d}),define("common/datafunctions",["require","common/xhr","utils","common/baseUtils","underscore","setup.environment.utils","common/captcha","common/launcher/launcher","common/modals/modal-views","common/am/customDimensions","common/sdk"],function(e){function t(){return{platform:v.platform,env:v.rosEnvironment,title:v.titleName,version:v.RosTitleVersion,gamePlatform:l.getGamePlatform(),RosVersion:v.RosTitleVersion}}function n(e){var t={IsCaptcha:e.isCaptcha};return t[e.captchaChallengeFieldId]=e.recaptchaChallenge,t[e.captchaResponseFieldId]=e.recaptchaResponse,t}function i(e){return null===e||"undefined"==typeof e?(s.WriteDebugLog("validateTitleInfo","Load error","titleInfo is null or undefined",s.logType.error,s.logController[v.titleName]),!1):null==e.RosTitleName||"undefined"==typeof e.RosTitleName||null==e.RosTitleVersion||"undefined"==typeof e.RosTitleVersion?(m.CallGameMethod("RGSC_PAGE_LOAD_ERROR",'{ "Reason": "Missing RosTitleName or RosTitleVersion data from RGSC_GET_TITLE_ID response" }',"RGSC_PAGE_LOAD_ERROR_DEMO"),s.WriteDebugLog("validateTitleInfo","Load error","missing titlename/version",s.logType.error,s.logController.debug),!1):!0}function a(){v.isLauncher?(v.top=y,v.panelHeight=S):(v.top=C,v.panelHeight=b)}function r(e){""!=l.getUrlVars("lang")&&(s.WriteDebugLog("SetGameTitle","lang",l.getUrlVars("lang")),e=l.getUrlVars("lang"));var t=l.mapLanguage(e);if(e=t,null!=e){var n=v.titlelang;v.titlelang=e,u.initLocalization(n,e),s.WriteDebugLog("initLanguage","Language",v.titlelang)}}var o=e("common/xhr"),s=e("utils"),l=e("common/baseUtils"),c=e("underscore"),u=e("setup.environment.utils"),d=e("common/captcha"),f=e("common/launcher/launcher"),h=e("common/modals/modal-views"),p=e("common/am/customDimensions"),m=e("common/sdk"),g={};"undefined"==typeof window.globals&&(window.globals={});var v=window.globals;v.account=null,v.avatarXML=null,v.rosEnvironment="",v.titlelang="en-US",v.titleName="",v.titleVersion=2382.1,l.setGamePlatform(""),v.ticket="",v.platformId="9",v.titleDisplayName="",v.RosTitleVersion=0,v.localProfileCreation=!0,v.isLauncher=!1,v.steamAppId=0,v.steamAuthTicket="",v.hasConnection=!1,v.hasInternet=!1,v.inputMethod=0,v.localUrl="/robots.txt",v.isScuiVisible=!1,v.asyncEnabled=!0,v.launcherClass="",v.showLockedAccountCaptchaSignIn=!1,v.receiveMsgEnabled=!1;var b=416,C="-"+b+"px",S=537,y="-"+S+"px";return v.panelHeight=b,v.top=C,v.waitingResponse=!1,g.resolveEnvironment=function(e){return e.length>5?"prod":e},g.SetGameTitleAsync=function(){var e={};e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n});var t=Promise.resolve(m.CallGameMethodAsync("RGSC_GET_TITLE_ID",null,"RGSC_GET_TITLE_ID_DEMO"));return t.then(function(t){if(!i(t))return e.reject();var n=t.RosTitleName.toLowerCase();v.titleName=n,v.rosEnvironment=t.RosEnvironment,v.RosTitleVersion=t.RosTitleVersion,v.OfflineOnly=t.OfflineOnly;var o=m.CallGameMethodAsync("RGSC_GET_VERSION_INFO",null,"RGSC_GET_VERSION_INFO_DEMO");if(o.done(u.setVersionNum).fail(function(){s.WriteDebugLog("SetGameTitleAsync","Error","Get Version Info Failed",s.logType.error,s.logController[v.titleName])}),u.setBodyClass(n),l.isLegacyServiceLayer()||null!=t.EnableLocalProfiles&&t.EnableLocalProfiles?s.WriteDebugLog("SetGameTitle","localProfileCreation",v.localProfileCreation):v.localProfileCreation=!1,f.initLauncher(t.IsLauncher),a(),v.platform=t.RosPlatform,null!=t.RosPlatformId&&(v.platformId=t.RosPlatformId,s.WriteDebugLog("SetGameTitle","RosPlatformId",v.platformId)),s.WriteDebugLog("SetGameTitle","platform",v.platform),r(t.Language),u.loadHomeFeed(),void 0!=t.TitleVersion&&(v.titleVersion=parseFloat(t.TitleVersion),s.WriteDebugLog("SetGameTitle","TitleVersion",v.titleVersion)),void 0!=t.Platform&&(l.setGamePlatform(t.Platform),s.WriteDebugLog("SetGameTitle","GameEnvironment",l.getGamePlatform()),"macsteam"===l.getGamePlatform()&&l.setGamePlatform("steam"),g.isDesktopPlatform())){u.setupInputElementEvents(),d.initTextEntryForCaptcha();var c=l.getGamePlatform();("steam"===c||"nhn"===c||"macappstore"===c)&&(void 0!=t.SteamAppId&&(v.steamAppId=t.SteamAppId),void 0!=t.SteamAuthTicket?v.steamAuthTicket=t.SteamAuthTicket:"macappstore"===c&&void 0!=t.MacAppStoreReceipt&&(v.steamAuthTicket=t.MacAppStoreReceipt))}void 0!=t.TitleDisplayName&&(v.titleDisplayName=u.mapTitleDisplayName(t.TitleDisplayName),u.setTitleDisplayName(v.titleDisplayName));try{u.PrePopulateData()}catch(h){}try{p.startSession(),p.setCurrentlyPlaying(v.titleName,v.platform)}catch(h){}e.resolve()},function(){s.WriteDebugLog("dataFn.SetGameTitleAsync","RGSC_GET_TITLE_ID","failed",s.logType.error,s.logController[v.titleName])}),e.promise},g.signInAsync=function(e,i){var a="/login",r=void 0,u=v.ajaxTimeout,d=i.email,f=i.password,h=c.extend(t(),n(i.captchaData),{Lang:v.titlelang}),p={authTicket:v.steamAuthTicket};e?(h.userLogin=d||"",p.userPassword=f||"",p.ScAuthToken=e.ScAuthToken||"",p.Ticket=e.Ticket||""):(h.userLogin=d,p.userPassword=f);var m=JSON.stringify(h);s.WriteDebugLog("signInAsync","options",m);var g=JSON.stringify(c.extend(h,p));l.isSteam()&&(u=3*v.ajaxTimeout,r=2*v.slowAjaxMsgTimeout,!e||e.Email||e.Password||(a="/autologinsteam"));var b=o.ajax({type:"POST",url:s.getApiUrl("/api/"+v.titleName+a),data:g,contentType:"application/json; charset=utf-8",timeout:u,slowMsgTimeout:r,cache:!1,dataType:"json",silentFail:!0}),C=b.then(function(e,t,n){return{data:e,jqXhr:n}},function(e,t,n){return{jqXhr:e,errorThrown:n}});return Promise.resolve(C)},g.GetUserNetworks=function(e,t,n,i){s.WriteDebugLog("GetUserNetworks","rockstarId",e);var a='{ "env":"'+v.rosEnvironment+'","title":"'+v.titleName+'","version":'+v.RosTitleVersion+',"rockstarId":"'+e+'","email":"'+t+'","nickname":"'+n+'" }',r=u.GetAuthHeaderAsync();r.done(function(e){o.ajax({type:"POST",url:s.getApiUrl("/api/profile/getusernetworks"),services:["accounts"],headers:e,data:a,contentType:"application/json; charset=utf-8",dataType:"xml",requestDescription:"UserNetworks",async:!0,fatalError:h.ShowErrorModal,success:function(e){var t=i;"function"==typeof t&&t(e)}})})},g.createAccountAsync=function(e){var n=c.extend(t(),e,{avatarUrl:"default.png",lang:v.titlelang,zipCode:"",authTicket:v.steamAuthTicket});delete n.authValue;var i=o.ajax({type:"POST",headers:u.getCombinedSyncHeaders(e.authValue),url:s.getApiUrl("/api/profile/createprofile"),services:["accounts","registration"],data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json",cache:!1,silentFail:!0}),a=i.then(function(e,t,n){return{data:e,status:t,jqXhr:n}},function(e,t,n){return{jqXhr:e,textStatus:t,errorThrown:n}});return Promise.resolve(a)},g.checkPasswordAsync=function(e){var t={password:e,env:v.rosEnvironment,title:v.titleName,version:v.RosTitleVersion};return Promise.resolve(o.ajax({type:"POST",url:s.getApiUrl("/api/profile/checkpassword"),services:["accounts","registration"],data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,requestDescription:"CheckPassword"}))},g.resetPassword=function(e){var t='{ "env":"'+v.rosEnvironment+'","title":"'+v.titleName+'","version":'+v.RosTitleVersion+',"email":"'+e+'" }';return Promise.resolve(o.ajax({type:"POST",url:s.getApiUrl("/api/profile/resetpassword"),services:["accounts"],data:t,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,requestDescription:"ResetPassword",fatalError:h.ShowErrorModal}))},g.updatePassword=function(e,n,i,a){var r=Promise.resolve(u.GetAuthHeaderAsync());return r.then(function(r){var l=JSON.stringify(c.extend(t(),{userPassword:e,newUserPassword:n,editConfNewPassword:i}));return o.ajax({type:"POST",url:s.getApiUrl("/api/profile/UpdatePassword"),services:["accounts"],headers:r,data:l,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,fatalError:a,requestDescription:"UpdatePassword"})})},g.UpdateEmail=function(e,t,i,a){var r=Promise.resolve(u.GetAuthHeaderAsync());return r.then(function(r){var l=c.extend({Email:e,Password:t},n(a));return o.ajax({type:"POST",url:s.getApiUrl("/api/profile/UpdateEmail"),services:["accounts"],headers:r,data:JSON.stringify(l),contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,fatalError:i,requestDescription:"UpdateEmail"})})},g.resendValidation=function(){var e,t,n={};return l.isLegacyServiceLayer()?(e=s.getApiUrl("/api/profile/ResendValidationLan"),n={Nickname:v.account.Nickname},t=Promise.resolve(u.GetAuthHeaderAsyncV8())):(e=s.getApiUrl("/api/profile/ResendValidation"),t=Promise.resolve(u.GetAuthHeaderAsync())),t.then(function(t){return l.isLegacyServiceLayer()&&(t=u.appendLanAuthHeader(t)),o.ajax({data:JSON.stringify(n),type:"POST",url:e,services:["accounts"],headers:t,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,fatalError:h.ShowErrorModal,requestDescription:"ResendValidation"})})},g.updateNickname=function(e,t){var n={Nickname:e,Password:t},i=Promise.resolve(u.GetAuthHeaderAsync());return i.then(function(e){return o.ajax({type:"POST",url:s.getApiUrl("/api/profile/UpdateNickname"),services:["accounts"],headers:e,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,fatalError:h.ShowErrorModal,requestDescription:"UpdateNickname"})})},g.updateCountry=function(e){var t={CountryCode:e},n=Promise.resolve(u.GetAuthHeaderAsync());return n.then(function(e){return o.ajax({type:"POST",url:s.getApiUrl("/api/profile/UpdateCountry"),services:["accounts"],headers:e,data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,fatalError:h.ShowErrorModal,requestDescription:"UpdateCountry"})})},g.updateAvatar=function(e,t,n){var i=Promise.resolve(u.GetAuthHeaderAsync());return i.then(function(i){var a={AvatarUrl:e,AvatarId:t,AvatarContextId:n,CustomAvatar:"undefined"!=typeof n&&""!==n};return o.ajax({type:"POST",url:s.getApiUrl("/api/profile/UpdateAvatar"),services:["accounts"],headers:i,data:JSON.stringify(a),contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,fatalError:h.ShowErrorModal,requestDescription:"UpdateAvatar"})})},g.updateLegacyProfile=function(e,n,i,a,r,l,d,f,h){var p=Promise.resolve(u.GetAuthHeaderAsyncV8());return p.then(function(u){var p=JSON.stringify(c.extend(t(),{avatarUrl:e,countryCode:n,dob:i,email:a,oldEmail:r,nickname:l,password:d,oldPassword:f}));return o.ajax({type:"POST",url:s.getApiUrl("/api/profile/UpdateAccount"),headers:u,data:p,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,requestDescription:"UpdateProfile",fatalError:h})})},g.UpdateDOBAndCountry=function(e,t){var n=Promise.resolve(u.GetAuthHeaderAsync());return n.then(function(n){var i='{ "env":"'+v.rosEnvironment+'","title":"'+v.titleName+'","version":'+v.RosTitleVersion+',"dob":"'+e+'","countrycode":"'+t+'"}';return o.ajax({type:"POST",url:s.getApiUrl("/api/profile/UpdateDobAndCountry"),services:["accounts"],headers:n,data:i,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,requestDescription:"UpdateDobCountry"})})},g.updateDob=function(e){var t=Promise.resolve(u.GetAuthHeaderAsync());return t.then(function(t){var n='{ "env":"'+v.rosEnvironment+'","title":"'+v.titleName+'","version":'+v.RosTitleVersion+',"dob":"'+e+'"}';return o.ajax({type:"POST",url:s.getApiUrl("/api/profile/UpdateDob"),services:["accounts"],headers:t,data:n,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,requestDescription:"UpdateDob"})})},g.getCountriesAsync=function(){var e={env:v.rosEnvironment,title:v.titleName,version:v.RosTitleVersion,language:v.titlelang};return Promise.resolve(o.ajax({type:"POST",url:s.getApiUrl("/api/profile/getcountries"),data:e,dataType:"json",cache:!0,requestDescription:"GetCountries"}))},g.validateAccountDetails=function(e){var t=c.extend({},e,n(e.captchaData));return delete t.captchaData,Promise.resolve(o.ajax({type:"POST",url:s.getApiUrl("/api/profile/validateaccountdetails"),services:["accounts","registration"],data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",cache:!1,requestDescription:"ValidateAccountDetails",silentFail:!0}))},g.getPrivacyPolicy=function(){var e='{ "language":"'+v.titlelang.substring(0,2)+'", "env":"'+g.resolveEnvironment(v.rosEnvironment)+'", "version":"'+v.RosTitleVersion+'", "ticket":"" }';s.WriteDebugLog("getPrivacyPolicy","options",e);var t=o.ajax({type:"POST",url:s.getApiUrl("/api/"+v.titleName+"/getprivacypolicy"),data:e,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,requestDescription:"GetPrivacyPolicy",silentFail:!0});return Promise.resolve(t)},g.getTermsOfService=function(){var e='{ "language":"'+v.titlelang.substring(0,2)+'", "env":"'+g.resolveEnvironment(v.rosEnvironment)+'", "version":"'+v.RosTitleVersion+'", "ticket":"" }';s.WriteDebugLog("getTermsOfService","options",e);var t=o.ajax({type:"POST",url:s.getApiUrl("/api/"+v.titleName+"/gettos"),data:e,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,requestDescription:"GetTos",silentFail:!0});return Promise.resolve(t)},g.getAvatarGamesAsync=function(){return o.ajax({type:"POST",url:s.getApiUrl("/api/profile/GetAvatarXml"),contentType:"application/json; charset=utf-8",dataType:"xml",cache:!0,requestDescription:"GetAvatarXml"})},g.getAvatarsAsync=function(){return o.ajax({type:"POST",url:s.getApiUrl("/api/profile/GetAvatars"),contentType:"application/json; charset=utf-8",dataType:"json",cache:!0,requestDescription:"GetAvatars"})},g.getCustomAvatarsAsync=function(){var e=Promise.resolve(u.GetAuthHeaderAsync());return e.then(function(e){return o.ajax({type:"POST",headers:e,url:s.getApiUrl("/api/profile/GetCustomAvatars"),data:'{"Title":"'+v.titleName+'"}',contentType:"application/json; charset=utf-8",dataType:"json",cache:!0,requestDescription:"GetCustomAvatars",services:["accounts"]})})},g.isDesktopPlatform=function(){var e=l.getGamePlatform();return"pc"===e||"steam"===e||"nhn"===e||"macappstore"===e},g.GetCrewById=function(e,t){s.WriteDebugLog("GetCrewById","crewId",e);var n=u.GetAuthHeaderAsync();n.done(function(n){o.ajax({type:"POST",headers:n,url:s.getApiUrl("/api/crew/getcrewbyid"),data:'{"CrewId":'+e+"}",contentType:"application/json; charset=utf-8",dataType:"xml",cache:!0,requestDescription:"GetCrewById",success:function(e){"function"==typeof t&&t(e)}})})},g.ClearProxyCache=function(){var e='{ "env":"'+v.rosEnvironment+'","title":"'+v.titleName+'","version":'+v.RosTitleVersion+" }",t=u.GetAuthHeaderAsync();t.done(function(t){o.ajax({type:"POST",url:s.getApiUrl("/api/profile/clearproxycache"),headers:t,data:e,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,success:function(){s.WriteDebugLog("ClearProxyCache","Success","")},error:function(e,t,n){s.WriteDebugLog("ClearProxyCache","ERROR",n),s.WriteDebugLog("ClearProxyCache","ERROR status",t),s.WriteDebugLog("ClearProxyCache","ERROR responseText",e.responseText,s.logType.error,s.logController.profile)}})})},g.ClearCrewCache=function(e){var t='{ "env":"'+v.rosEnvironment+'","title":"'+v.titleName+'","version":'+v.RosTitleVersion+',"crewId":'+e+" }",n=u.GetAuthHeaderAsync();n.done(function(e){o.ajax({type:"POST",url:s.getApiUrl("/api/crew/clearcrewcache"),headers:e,data:t,contentType:"application/json; charset=utf-8",dataType:"xml",silentFail:!0,disableSlowMsg:!0,cache:!1,success:function(){s.WriteDebugLog("ClearCrewCache","Success","")},error:function(e,t,n){s.WriteDebugLog("ClearCrewCache","ERROR",n),s.WriteDebugLog("ClearCrewCache","ERROR status",t),s.WriteDebugLog("ClearCrewCache","ERROR responseText",e.responseText,s.logType.error,s.logController.crew)}})})},g.requestMultiplayerPresenceInfo=function(e){var t={RequestId:v.account.RockstarId,Players:e.map(function(e){return{RockstarId:e}})};m.CallGameMethod("RGSC_REQUEST_PLAYER_MULTIPLAYER_PRESENCE_INFO",t,"RGSC_REQUEST_PLAYER_MULTIPLAYER_PRESENCE_INFO_DEMO")},g}),define("common/profile/profile-models",["jquery","underscore","backbone","utils","setup.environment.utils"],function(e,t,n,i,a){var r={};return r.ProfileCard=n.Model.extend(),r.ProfileNav=n.Model.extend(),r.Friend=n.Model.extend({parse:function(e){var t=e.get("IsOnline"),n=e.get("ViewerMutualFriendCount"),i=a.getText("MutualFriends","Social").format(n),r=t?a.getText("PlayingGameOn","Social","Playing {0} on {1}").format(e.get("FriendlyGame"),e.get("FriendlyPlatform")):"";return e.set({MutualFriendText:i,OnlineStatus:t?"online":"offline",InviteMsg:e.get("InviteMsg"),PlayingGame:r}),e}}),r.FriendCollection=n.Collection.extend({model:r.Friend}),r.Crew=n.Model.extend(),r.CrewCollection=n.Collection.extend({model:r.Crew}),r.Game=n.Model.extend(),r.GameCollection=n.Collection.extend({model:r.Game}),r.Account=n.Model.extend(),r.AccountCollection=n.Collection.extend({model:r.Account}),r.BlockPlayerModel=n.Model.extend({url:i.getApiUrl("/api/friend/blockplayer"),block:function(e,t,n){var i=this,r=a.GetAuthHeaderAsync();r.done(function(a){i.save({blockeeRockstarId:e},{headers:a,success:t,fatalError:n,noRetryModal:!0})})}}),r}),define("backbone-cache",["jquery","backbone","underscore"],function(e,t,n){return t.Cache=function(){this.store={}},e.extend(t.Cache.prototype,t.Events,{set:function(e,t){this.trigger("set",e,t),this.store[e]=t},has:function(e){var t=!!this.store[e];return this.trigger("has",e,t),t},get:function(e){var t=this.store[e];return this.trigger("get",e,t),t},remove:function(e){var t=this.store[e];return this.trigger("remove",e,t),delete this.store[e],t},clear:function(){this.trigger("clear"),this.store={}}}),t.CachedCollection=t.Collection.extend({fetch:function(i){if(i=i?n.clone(i):{},void 0===i.parse&&(i.parse=!0),this.cacheKey&&this.cacheObject){var a=this.cacheObject,r=this.cacheKey;if(a.has(r)){var o=a.get(r),s=i.success,l=this;return i.success=function(e){var t=i.reset?"reset":"set";l[t](e,i),s&&s.call(i.context,l,e,i),l.trigger("sync",l,e,i)},i.success&&i.success.call(this,o,i),e.Deferred().resolve()}var s=i.success;return i.success=function(e,t,n){a.set(r,t),s&&s(e,t,n)},t.Collection.prototype.fetch.call(this,i)}return t.Collection.prototype.fetch.call(this,i)}}),t.CachedModel=t.Model.extend({fetch:function(n){if(this.cacheKey&&this.cacheObject){n=n||{};var i=this.cacheObject,a=this.cacheKey,r=n.success;if(i.has(a)){var o=i.get(a);return this.set(this.parse(o,n),n),r&&r(this,o,n),e.Deferred().resolve()}return n.success=function(e,t,n){i.set(a,t),r&&r(e,t,n)},t.Model.prototype.fetch.call(this,n)}return t.Model.prototype.fetch.call(this,n)}}),t}),define("common/crews/crews-models",["require","backbone","utils","underscore","setup.environment.utils","common/am/socialCount","backbone-cache"],function(e){var t=e("backbone"),n=e("utils"),i=e("underscore"),a=e("setup.environment.utils"),r=e("common/am/socialCount");
e("backbone-cache");var o={};return o.PrimaryCrewModel=t.Model.extend({url:n.getApiUrl("api/crew/primarycrew")}),o.Crew=t.Model.extend(),o.CrewCollection=t.CachedCollection.extend({model:o.Crew,url:n.getApiUrl("/api/crew/getcrews"),initialize:function(e,t){i.has(t,"cacheKey")&&(this.cacheKey=t.cacheKey),i.has(t,"cacheObject")&&(this.cacheObject=t.cacheObject)},parse:function(e){return void 0!=e&&void 0!=e.Crews?(r.setSocialCountTotals(e.Crews.length,-1),e.Crews):e}}),o.CrewMember=t.Model.extend({parse:function(e){return i.each(e.CrewMembers,function(e){var t=n.getAvatarUrl(e.AvatarUrl,e.Nickname);e.AvatarUrl=t,e.DateJoinedLocalized=n.localizedDate(e.DateJoined,"LL")}),e}}),o.CrewMemberCollection=t.CachedCollection.extend({initialize:function(e,t){this.game=t.game,i.has(t,"cacheKey")&&(this.cacheKey=t.cacheKey),i.has(t,"cacheObject")&&(this.cacheObject=t.cacheObject)},model:o.CrewMember,url:function(){return n.getApiUrl("/api/"+this.game+"/primarycrewmembers")}}),o.CrewMemberSearch=t.Model.extend({url:n.getApiUrl("/api/crew/searchmembers"),parse:function(e){return i.each(e.CrewMembers,function(e){var t=n.getAvatarUrl(e.AvatarUrl,e.Nickname);e.AvatarUrl=t}),e}}),o.CrewInvite=t.Model.extend(),o.CrewInviteCollection=t.Collection.extend({model:o.CrewInvite,url:n.getApiUrl("/api/crew/crewinvites"),getInvites:function(e){return this.at(e).get("CrewInvites")}}),o.Invites=t.Collection.extend(),o.CrewRequest=t.Model.extend(),o.CrewRequestCollection=t.Collection.extend({model:o.CrewRequest,url:n.getApiUrl("/api/crew/crewrequests"),getRequests:function(e){return this.at(e).get("CrewRequests")}}),o.Requests=t.Collection.extend(),o.CrewsWithManagePermissionCollection=t.Collection.extend({model:o.Crew,url:n.getApiUrl("/api/crew/crewswithmanagepermission"),parse:function(e){return e.Crews}}),o.UpdateCrewModel=t.Model.extend({url:n.getApiUrl("/api/crew/updatecrew"),leave:function(e,t,n){var i=this,r=a.GetAuthHeaderAsync();r.done(function(a){i.save({crewId:e,opName:"leave"},{headers:a,success:t,fatalError:n,noRetryModal:!0})})},makeActive:function(e,t,n){var i=this,r=a.GetAuthHeaderAsync();r.done(function(a){i.save({crewId:e,opName:"active"},{headers:a,success:t,fatalError:n,noRetryModal:!0})})},acceptInvite:function(e,t,n,i){var r=this,o=a.GetAuthHeaderAsync();o.done(function(a){r.save({crewId:e,inviteId:t,opName:"join"},{headers:a,success:n,fatalError:i,noRetryModal:!0})})},declineInvite:function(e,t,n,i){var r=this,o=a.GetAuthHeaderAsync();o.done(function(a){r.save({crewId:e,inviteId:t,opName:"del"},{headers:a,success:n,fatalError:i,noRetryModal:!0})})},joinCrew:function(e,t,n){var i=this,r=a.GetAuthHeaderAsync();r.done(function(a){i.save({crewId:e,opName:"join"},{headers:a,success:t,fatalError:n,noRetryModal:!0})})},requestInvite:function(e,t,n){var i=this,r=a.GetAuthHeaderAsync();r.done(function(a){i.save({crewId:e,opName:"requestInvite"},{headers:a,success:t,fatalError:n,noRetryModal:!0})})},sendInvite:function(e,t,n,i){var r=this,o=a.GetAuthHeaderAsync();o.done(function(a){r.save({targetRockstarId:e,crewId:t,opName:"sendInvite"},{headers:a,success:n,fatalError:i,noRetryModal:!0})})},deleteRequest:function(e,t,n,i){var r=this,o=a.GetAuthHeaderAsync();o.done(function(a){r.save({crewId:e,requestId:t,opName:"deleteRequest"},{headers:a,success:n,fatalError:i,noRetryModal:!0})})}}),o.SearchCrewsCollection=t.Collection.extend({model:o.Crew,url:n.getApiUrl("/api/crew/searchcrews"),initialize:function(){this.pageNumber=0,this.isLoading=!1},parse:function(e){return e&&0!=e.Status&&void 0!=e.Crews?(this.FetchFail=!1,this.Total=e.Total,this.HasMore=e.HasMore,this.HasMaxCrewMemberships=e.HasMaxCrewMemberships,this.pageNumber=e.PageIndex+1,this.isLoading=!1,e.Crews):null}}),o}),define("hbs!common/templates/profile/profile_report",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e){var t,i,a="";return a+='\r\n                            <li class="clearfix">\r\n                                <label>\r\n                                    <input type="radio" value="',(i=n.id)?t=i.call(e,{hash:{}}):(i=e&&e.id,t=typeof i===l?i.call(e,{hash:{}}):i),a+=c(t)+'" name="reportArea" />\r\n                                    <span>',(i=n.title)?t=i.call(e,{hash:{}}):(i=e&&e.title,t=typeof i===l?i.call(e,{hash:{}}):i),a+=c(t)+"</span>\r\n                                </label>\r\n                            </li>\r\n                            "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var o,s="",l="function",c=this.escapeExpression,u=this;return s+='<div class="statusbar reporting" id="profile-report-area">\r\n    <div class="modal-header">\r\n        <h3 rel="localize[ReportContent]">Report Content</h3>\r\n    </div>\r\n    <div class="modal-body">\r\n        <form class="form-stacked" id="formReportArea">\r\n            <fieldset>\r\n                <span class="clearfix">\r\n                    <label rel="localize[ReportLabel]">I am reporting this user\'s...</label>\r\n                    <span class="input">\r\n                        <ul class="inputs-list">\r\n                            ',o=n.each.call(t,t&&t.area,{hash:{},inverse:u.noop,fn:u.program(1,r,a)}),(o||0===o)&&(s+=o),s+='\r\n                        </ul>\r\n                    </span>\r\n                </span>\r\n            </fieldset>\r\n        </form>\r\n    </div>\r\n    <div class="modal-footer">\r\n        <span id="profile-report-choose" class="btn btnPurple btnRounded profile-report-choose" rel="localize[Select]">Select</span>\r\n        <span id="profile-report-cancel" class="btn btnLightGrey btnRounded" rel="localize[Cancel]">Cancel</span>\r\n    </div>\r\n</div>'});return n}),define("hbs!common/templates/profile/profile_reportreason",["hbs","common/hbs/handlebars","common/templates/helpers/ifequals"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e,t){var i,a,r,s="";return s+='\r\n                            <li class="clearfix"><label><input type="radio" value="'+d((i=e&&e.shortName,typeof i===u?i.apply(e):i))+'" name="reportReason" ',a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:f.noop,fn:f.program(2,o,t)},i=a?a.call(e,e&&e.nextAction,"block",r):h.call(e,"ifequals",e&&e.nextAction,"block",r),(i||0===i)&&(s+=i),s+=" /><span>"+d((i=e&&e.longName,typeof i===u?i.apply(e):i))+"</span></label></li>\r\n                            "}function o(){return' class="profile-report-confirm" '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s,l,c="",u="function",d=this.escapeExpression,f=this,h=n.helperMissing;return c+='<div id="profile-report-reason" class="statusbar reporting">\r\n    <div class="modal-header">\r\n        <h3 rel="localize[ReportContent]">Report content</h3>\r\n    </div>\r\n    <div class="modal-body">\r\n        <p rel="localize[ReportSelectReasonText]">\r\n            Please select the category that most closely reflects your concern.\r\n            We will review the content and determine whether it violates our <a href="http://www.rockstargames.com/legal/#4" target="_blank">Code of Conduct</a>\r\n            or is not appropriate for all our members.\r\n            Abusing the reporting feature is also a violation of the <a href="http://www.rockstargames.com/legal/#4" target="_blank">Code of Conduct</a>, so please do not do it.\r\n        </p>\r\n        <form class="form-stacked" id="formSpamReport">\r\n            <fieldset>\r\n                <span class="clearfix">\r\n                    <label id="optionsSpam" rel="localize[ReportThisContent]">This content ...</label>\r\n                    <span class="input">\r\n                        <ul class="inputs-list">\r\n                            ',s=n.each.call(t,(s=t&&t.reportingData,null==s||s===!1?s:s.reason),{hash:{},inverse:f.noop,fn:f.program(1,r,a)}),(s||0===s)&&(c+=s),c+='\r\n                        </ul>\r\n                    </span>\r\n                </span>\r\n                <input type="hidden" name="area" id="areaSelected" value="',(l=n.area)?s=l.call(t,{hash:{}}):(l=t&&t.area,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'" />\r\n                <input type="hidden" name="feedId" id="feedId" value="',(l=n.id)?s=l.call(t,{hash:{}}):(l=t&&t.id,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'" />\r\n                <input type="hidden" name="nickname" id="nickname" value="',(l=n.nickname)?s=l.call(t,{hash:{}}):(l=t&&t.nickname,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'" />\r\n            </fieldset>\r\n        </form>\r\n    </div>\r\n    <div class="modal-footer">\r\n        <span id="profile-report-confirm" data-ajaxid="',(l=n.id)?s=l.call(t,{hash:{}}):(l=t&&t.id,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'" class="btn btnPurple btnRounded profile-report-confirm" rel="localize[SubmitReport]">Submit Report</span>\r\n        <span id="profile-report-cancel" class="btn btnLightGrey btnRounded" rel="localize[Cancel]">Cancel</span>\r\n    </div>\r\n</div>'});return n}),define("hbs!common/templates/profile/profile_reportmoreinfo",["hbs","common/hbs/handlebars","common/templates/helpers/ifequals"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(){return'\r\n                    <p rel="localize[ReportUseIPForm]">\r\n                        To report unauthorized use of intellectual property, please continue to our IP infringement form.\r\n                    </p>\r\n\r\n                    '}function o(e,t){var i,a,r,o="";return o+="\r\n\r\n                    ",a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:E.noop,fn:E.program(4,s,t)},i=a?a.call(e,(i=e&&e.reportingData,null==i||i===!1?i:i.displayOptions),"true",r):k.call(e,"ifequals",(i=e&&e.reportingData,null==i||i===!1?i:i.displayOptions),"true",r),(i||0===i)&&(o+=i),o+='\r\n\r\n                    <span class="input">\r\n                        <ul class="inputs-list">\r\n                            ',a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:E.program(8,c,t),fn:E.program(6,l,t)},i=a?a.call(e,(i=e&&e.reportingData,null==i||i===!1?i:i.shortName),"privacy",r):k.call(e,"ifequals",(i=e&&e.reportingData,null==i||i===!1?i:i.shortName),"privacy",r),(i||0===i)&&(o+=i),o+="\r\n                        </ul>\r\n                    </span>\r\n                </span>\r\n                "}function s(){return'<label id="optionsSpam" rel="localize[ReportSelectOption]">Please select an option</label>'}function l(e){var t,n="";return n+='\r\n                            <span class="moreInfo">\r\n                                <label for="moreInfoText">'+_((t=e&&e.reportingData,t=null==t||t===!1?t:t.labelText,typeof t===w?t.apply(e):t))+'</label>\r\n                                <span rel="localize[ReportPrivacy]">How is this content violating your privacy?</span>\r\n                                <textarea name="moreInfoText" class="moreInfoText" value="" maxlength="500"></textarea>\r\n                            </span>\r\n                            '}function c(e,t){var i,a,r,o="";return o+="\r\n                            ",i=n.each.call(e,(i=e&&e.reportingData,null==i||i===!1?i:i.moreInfo),{hash:{},inverse:E.noop,fn:E.program(9,u,t)}),(i||0===i)&&(o+=i),o+="\r\n\r\n                            ",a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:E.noop,fn:E.program(17,m,t)},i=a?a.call(e,(i=e&&e.reportingData,null==i||i===!1?i:i.shortName),"harass",r):k.call(e,"ifequals",(i=e&&e.reportingData,null==i||i===!1?i:i.shortName),"harass",r),(i||0===i)&&(o+=i),o+="\r\n\r\n                            "}function u(e,t){var i,a,r,o="";return o+="\r\n                            ",i=n["if"].call(e,e&&e.optionText,{hash:{},inverse:E.noop,fn:E.program(10,d,t)}),(i||0===i)&&(o+=i),o+="\r\n\r\n                            ",a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:E.noop,fn:E.program(15,p,t)},i=a?a.call(e,e&&e.displayInput,"true",r):k.call(e,"ifequals",e&&e.displayInput,"true",r),(i||0===i)&&(o+=i),o+="\r\n                            "}function d(e,t){var i,a,r,o="";return o+='\r\n                            <li class="clearfix">\r\n                                <label>\r\n                                    <input type="radio" value="',(a=n.optionText)?i=a.call(e,{hash:{}}):(a=e&&e.optionText,i=typeof a===w?a.call(e,{hash:{}}):a),o+=_(i)+'" name="moreInfo" ',a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:E.program(13,h,t),fn:E.program(11,f,t)},i=a?a.call(e,e&&e.displayInput,"true",r):k.call(e,"ifequals",e&&e.displayInput,"true",r),(i||0===i)&&(o+=i),o+=" />\r\n                                    <span>",(a=n.optionText)?i=a.call(e,{hash:{}}):(a=e&&e.optionText,i=typeof a===w?a.call(e,{hash:{}}):a),o+=_(i)+"</span>\r\n                                </label>\r\n                            </li>\r\n                            "}function f(){return' class="profile-report-showMoreInfoText" '}function h(){return' class="profile-report-hideMoreInfoText" '}function p(e){var t,i,a="";return a+='\r\n                            <span class="moreInfo hide">\r\n                                <label for="moreInfoText">',(i=n.labelText)?t=i.call(e,{hash:{}}):(i=e&&e.labelText,t=typeof i===w?i.call(e,{hash:{}}):i),a+=_(t)+'</label>\r\n                                <input type="text" name="moreInfoText" class="moreInfoText" value="" maxlength="500" />\r\n                            </span>\r\n                            '}function m(){return'\r\n                            <p rel="localize[ReportDanger]">Are you, or your friend, in physical danger? If yes, report to local authority.</p>\r\n                            '}function g(){return'\r\n        <span id="profile-report-submitMoreInfo" class="btn btnPurple btnRounded" rel="localize[Continue]">Continue</span>\r\n        <span id="profile-report-cancel" class="btn btnLightGrey btnRounded" rel="localize[Cancel]">Cancel</span>\r\n        '}function v(e){var t,i,a="";return a+='\r\n        <span id="profile-report-submitMoreInfo" data-ajaxid="',(i=n.id)?t=i.call(e,{hash:{}}):(i=e&&e.id,t=typeof i===w?i.call(e,{hash:{}}):i),a+=_(t)+'" class="btn btnPurple btnRounded" rel="localize[SubmitReport]">Submit Report</span>\r\n        <span id="profile-report-cancel" class="btn btnLightGrey btnRounded" rel="localize[Cancel]">Cancel</span>\r\n        '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var b,C,S,y="",w="function",_=this.escapeExpression,E=this,k=n.helperMissing;return y+='<div id="profile-report-moreinfo" class="statusbar reporting">\r\n    <div class="modal-header">\r\n        <h3 rel="localize[ReportContent]">Report content</h3>\r\n    </div>\r\n    <div class="modal-body">\r\n        <h4>'+_((b=t&&t.reportingData,b=null==b||b===!1?b:b.longName,typeof b===w?b.apply(t):b))+'</h4>\r\n        <form class="form-stacked" id="formSpamReport">\r\n            <fieldset>\r\n                <span class="clearfix">\r\n\r\n                    ',C=n.ifequals||t&&t.ifequals,S={hash:{},inverse:E.program(3,o,a),fn:E.program(1,r,a)},b=C?C.call(t,(b=t&&t.reportingData,null==b||b===!1?b:b.shortName),"ipr",S):k.call(t,"ifequals",(b=t&&t.reportingData,null==b||b===!1?b:b.shortName),"ipr",S),(b||0===b)&&(y+=b),y+='\r\n\r\n                <input type="hidden" name="area" id="areaSelected" value="" />\r\n                <input type="hidden" name="reason" id="reasonSelected" value="" />\r\n                <input type="hidden" name="nickname" id="nickname" value="',(C=n.nickname)?b=C.call(t,{hash:{}}):(C=t&&t.nickname,b=typeof C===w?C.call(t,{hash:{}}):C),y+=_(b)+'" />\r\n                <input type="hidden" name="url" id="url" value="'+_((b=t&&t.url,typeof b===w?b.apply(t):b))+'" />\r\n            </fieldset>\r\n            <span class="help-inline" id="error"></span>\r\n        </form>\r\n    </div>\r\n    <div class="modal-footer">\r\n        ',C=n.ifequals||t&&t.ifequals,S={hash:{},inverse:E.program(21,v,a),fn:E.program(19,g,a)},b=C?C.call(t,(b=t&&t.reportingData,null==b||b===!1?b:b.shortName),"ipr",S):k.call(t,"ifequals",(b=t&&t.reportingData,null==b||b===!1?b:b.shortName),"ipr",S),(b||0===b)&&(y+=b),y+="\r\n    </div>\r\n</div>"});return n}),define("common/reporting/reporting",["jquery","underscore","utils","am","setup.environment.utils","common/modals/modal-views","hbs!common/templates/profile/profile_report","hbs!common/templates/profile/profile_reportreason","hbs!common/templates/profile/profile_reportmoreinfo"],function(e,t,n,i,a,r,o,s,l){var c={};return c.initializeReportData=function(){c.reportingData={area:[{title:a.getText("ReportAreaMemberName","Social"),id:"3"},{title:a.getText("ReportAreaAvatar","Social"),id:"5"}],reason:[{shortName:"hate",longName:a.getText("ReportReasonHate","Social"),nextAction:"submitReport",submitReport:"true"},{shortName:"harass",longName:a.getText("ReportReasonHarass","Social"),nextAction:"moreInfo",submitReport:"true",displayOptions:"true",moreInfo:[{optionText:a.getText("ReportMoreInfoHarassingMeOption","Social"),displayInput:"true",labelText:a.getText("ReportMoreInfoHarrasingMeLabel","Social")},{optionText:a.getText("ReportMoreInfoHarassingFriendOption","Social"),displayInput:"true",labelText:a.getText("ReportMoreInfoHarassingFriendLabel","Social")}]},{shortName:"explicit",longName:a.getText("ReportReasonExplicit","Social"),nextAction:"submitReport",submitReport:"true"},{shortName:"spam",longName:a.getText("ReportReasonSpam","Social"),nextAction:"submitReport",submitReport:"true"},{shortName:"impersonate",longName:a.getText("ReportReasonImpersonate","Social"),nextAction:"moreInfo",displayOptions:"true",submitReport:"true",moreInfo:[{optionText:a.getText("ReportMoreInfoImpersonatingMeOption","Social"),displayInput:"true",labelText:a.getText("ReportMoreInfoImpersonatingMeLabel","Social")},{optionText:a.getText("ReportMoreInfoImpersonatingOtherOption","Social"),displayInput:"true",labelText:a.getText("ReportMoreInfoImpersonatingOtherLabel","Social")}]},{shortName:"privacy",longName:a.getText("ReportReasonPrivacy","Social"),nextAction:"moreInfo",displayOptions:"false",submitReport:"true",moreInfo:[{optionText:"",displayInput:"true",labelText:a.getText("ReportMoreInfoPrivacyLabe","Social")}]},{shortName:"ipr",longName:a.getText("ReportReasonIpr","Social"),nextAction:"moreInfo",submitReport:"false",moreInfo:[{optionText:"",displayInput:"false",labelText:""}]}]}},c.reportProfile=function(e){this.initializeReportData();var t={nickname:e};this.initializeReportProfile(t)},c.initializeReportProfile=function(t){var i=this.reportingData.area,a=this.reportingData.reason,r=e.extend({},{area:i},{reason:a},t);e("#reportModal").html(n.renderCompiledTemplate(o,r)),e("#reportModal").find("[rel*=localize]:not(.localized)").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),e("#reportModal").show(),e("body").data("reportProfile",r.nickname),e("body").data("page",r.page),this.InitialiseReportEvents()},c.InitialiseReportEvents=function(){e(document).off("click","#profile-report-choose").on("click","#profile-report-choose",c.reportProfileChooseArea).off("click",".profile-report-confirm").on("click",".profile-report-confirm",c.reportProfileChooseReason).off("click","#profile-report-submitMoreInfo").on("click","#profile-report-submitMoreInfo",c.reportProfileSubmitMoreInfo).off("click",".profile-report-showMoreInfoText").on("click",".profile-report-showMoreInfoText",c.reportProfileShowMoreInfoText).off("click",".profile-report-hideMoreInfoText").on("click",".profile-report-hideMoreInfoText",c.reportProfileHideMoreInfoText).off("click","#profile-report-cancel").on("click","#profile-report-cancel",c.closeModal)},c.reportProfileChooseArea=function(t){t.preventDefault();var n=e("body").data("reportProfile");c.reportChooseArea(t,n)},c.reportProfileChooseReason=function(e){e.preventDefault(),c.reportChooseReason(e,"profile","/home/reportprofile","")},c.reportProfileSubmitMoreInfo=function(e){e.preventDefault(),c.reportSubmitMoreInfo(e,"profile","/home/reportprofile","")},c.reportProfileShowMoreInfoText=function(){c.reportShowMoreInfoText()},c.reportProfileHideMoreInfoText=function(){c.reportHideMoreInfoText()},c.reportChooseArea=function(t){var i=e(t.currentTarget),a=i.parents("#reportModal").find("input:checked").val(),r=e("body").data("reportProfile"),o=this.reportingData.reason,l=e.extend({},{reason:o});a&&(e("#profile-report-reason").remove(),e("#reportModal").html(n.renderCompiledTemplate(s,{area:a,section:"profile",nickname:r,reportingData:l})),e("#reportModal").find("[rel*=localize]:not(.localized)").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}))},c.reportChooseReason=function(i,a,r,o,s){var c=e("#areaSelected").val(),u=e("input[name=reportReason]:checked","#formSpamReport").val();if(void 0!=u){s||(s=this.reportingData.reason);var d=t.filter(s,function(e){return e.shortName===u}),f="",h="";switch(d.length>0&&(f=d[0].nextAction,h=e("body").data("reportProfile")),f){case"moreInfo":e("#profile-report-moreinfo").remove(),e("#reportModal").html(n.renderCompiledTemplate(l,{data:o,section:a,url:r,nickname:h,reportingData:d[0]})),e("#reportModal").find("[rel*=localize]:not(.localized)").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),e("#areaSelected").val(c),e("#reasonSelected").val(u);break;case"submitReport":this.submitProfileReport(a,r,c,d,"")}return d[0].longName}},c.reportSubmitMoreInfo=function(n,i,r,o,s){s||(s=c.reportingData.reason);var l=e("#areaSelected").val(),u=e("#reasonSelected").val(),d=e("input[name=moreInfo]:checked","#formSpamReport"),f=d.val(),h=d.closest("li").next("div").find(".moreInfoText"),p=t.filter(s,function(e){return e.shortName===u});h.length||(h=e(".moreInfoText")),"ipr"!=u?void 0==f?f=h.val():f+=" ("+h.val()+")":f="none",f?this.submitProfileReport(i,r,l,p,f):e("#error").text(a.getText("ReportProvideDetails","Social"))},c.reportShowMoreInfoText=function(){e(".moreInfo").removeClass("hide")},c.reportHideMoreInfoText=function(){e(".moreInfoText").each(function(){e(this).val("")}),e(".moreInfo").addClass("hide")},c.submitProfileReport=function(t,n,i,a,r){if(void 0==a||!a.length)return void c.closeModalError(e("#reportModal"));var o=e("body").data("reportProfile"),s={area:i,reason:a[0].longName,name:o,moreInfo:r,reportReasonShort:a[0].shortName};c.submitReport(s)},c.submitReport=function(t){var i=Promise.resolve(a.GetAuthHeaderAsync());return i.then(function(i){return e.ajax({type:"POST",cache:!1,async:!0,data:JSON.stringify(t),url:n.getApiUrl("/api/profile/ReportProfile"),services:["accounts"],headers:i,contentType:"application/json; charset=utf-8",dataType:"json",fatalError:r.ShowErrorModal,requestDescription:"SubmitProfileReport",success:function(t){t&&1==t.Status?t.RedirectToIprForm?(c.closeModal(e("#reportModal")),a.launchExternalBrowserWithScAuth(void 0,"https://dev.sc.rockstargames.com/reporting/ipinfringementform?reportType="+t.ReportType+"&contentId="+t.ContentId+"&contentOwner="+t.ContentOwnerId)):c.closeModalSuccess(e("#reportModal")):c.closeModalError(e("#reportModal"))},error:n.error})})},c.closeModal=function(){e("#reportModal").html(""),e("#reportModal").hide()},c.closeModalSuccess=function(e){e.find(".modal-body").html(a.getText("ReportSuccess","Social")),e.find(".modal-footer").html(""),setTimeout(function(){e.hide()},1e3)},c.closeModalError=function(e){e.find(".modal-body").html(a.getText("ReportError","Errors")),e.find(".modal-footer").html(""),setTimeout(function(){e.hide()},1500)},c}),define("common/templates/helpers/ifless",["common/hbs/handlebars"],function(e){function t(e,t,n){return t>e?n.fn(this):n.inverse(this)}return e.registerHelper("ifless",t),t}),define("hbs!common/templates/crew/crew_tag",["hbs","common/hbs/handlebars","common/templates/helpers/ifequals","common/templates/helpers/ifless"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(){return"private"}function o(){return"public"}function s(){return"Gold"}function l(e,t){var i,a,r,o="";return o+="<span ",a=n.ifequals||e&&e.ifequals,r={hash:{},inverse:w.noop,fn:w.program(8,c,t)},i=a?a.call(e,e&&e.IsMember,!1,r):_.call(e,"ifequals",e&&e.IsMember,!1,r),(i||0===i)&&(o+=i),o+="></span>"}function c(e){var t,i,a="";return a+='class="crewColor" style="background:',(i=n.CrewColour)?t=i.call(e,{hash:{}}):(i=e&&e.CrewColour,t=typeof i===S?i.call(e,{hash:{}}):i),a+=y(t)+';"'}function u(e,t){var i,a="";return a+="\n    ",i=n["if"].call(e,e&&e.IsPrivate,{hash:{},inverse:w.noop,fn:w.program(11,d,t)}),(i||0===i)&&(a+=i),a+="\r\n    "}function d(e,t){var i,a,r,o="";return o+='\n    <div class="hierarchy">\r\n        ',a=n.ifless||e&&e.ifless,r={hash:{},inverse:w.noop,fn:w.program(12,f,t)},i=a?a.call(e,e&&e.RankOrder,5,r):_.call(e,"ifless",e&&e.RankOrder,5,r),(i||0===i)&&(o+=i),o+="\r\n    </div>\r\n    "}function f(e,t){var i,a,r,o="";return o+="\r\n        ",a=n.ifless||e&&e.ifless,r={hash:{},inverse:w.noop,fn:w.program(13,h,t)},i=a?a.call(e,e&&e.RankOrder,4,r):_.call(e,"ifless",e&&e.RankOrder,4,r),(i||0===i)&&(o+=i),o+='\r\n        <span style="background:',(a=n.CrewColour)?i=a.call(e,{hash:{}}):(a=e&&e.CrewColour,i=typeof a===S?a.call(e,{hash:{}}):a),o+=y(i)+';"></span>\r\n        '}function h(e,t){var i,a,r,o="";return o+="\r\n        ",a=n.ifless||e&&e.ifless,r={hash:{},inverse:w.noop,fn:w.program(14,p,t)},i=a?a.call(e,e&&e.RankOrder,3,r):_.call(e,"ifless",e&&e.RankOrder,3,r),(i||0===i)&&(o+=i),o+='\r\n        <span style="background:',(a=n.CrewColour)?i=a.call(e,{hash:{}}):(a=e&&e.CrewColour,i=typeof a===S?a.call(e,{hash:{}}):a),o+=y(i)+';"></span>\r\n        '}function p(e,t){var i,a,r,o="";return o+="\r\n        ",a=n.ifless||e&&e.ifless,r={hash:{},inverse:w.noop,fn:w.program(15,m,t)},i=a?a.call(e,e&&e.RankOrder,2,r):_.call(e,"ifless",e&&e.RankOrder,2,r),(i||0===i)&&(o+=i),o+='\r\n        <span style="background:',(a=n.CrewColour)?i=a.call(e,{hash:{}}):(a=e&&e.CrewColour,i=typeof a===S?a.call(e,{hash:{}}):a),o+=y(i)+';"></span>\r\n        '}function m(e,t){var i,a,r,o="";return o+="\r\n        ",a=n.ifless||e&&e.ifless,r={hash:{},inverse:w.noop,fn:w.program(16,g,t)},i=a?a.call(e,e&&e.RankOrder,1,r):_.call(e,"ifless",e&&e.RankOrder,1,r),(i||0===i)&&(o+=i),o+='\r\n        <span style="background:',(a=n.CrewColour)?i=a.call(e,{hash:{}}):(a=e&&e.CrewColour,i=typeof a===S?a.call(e,{hash:{}}):a),o+=y(i)+';"></span>\r\n        '}function g(e){var t,i,a="";return a+='\r\n        <span style="background:',(i=n.CrewColour)?t=i.call(e,{hash:{}}):(i=e&&e.CrewColour,t=typeof i===S?i.call(e,{hash:{}}):i),a+=y(t)+';"></span>\r\n        '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var v,b,C="",S="function",y=this.escapeExpression,w=this,_=n.helperMissing;return C+='<div class="crewTag ',v=n["if"].call(t,t&&t.IsPrivate,{hash:{},inverse:w.program(3,o,a),fn:w.program(1,r,a)}),(v||0===v)&&(C+=v),v=n["if"].call(t,t&&t.IsFounderCrew,{hash:{},inverse:w.noop,fn:w.program(5,s,a)}),(v||0===v)&&(C+=v),C+='">\n    <span>',(b=n.CrewTag)?v=b.call(t,{hash:{}}):(b=t&&t.CrewTag,v=typeof b===S?b.call(t,{hash:{}}):b),C+=y(v)+"</span>\n\n    ",v=n["if"].call(t,t&&t.IsPrivate,{hash:{},inverse:w.noop,fn:w.program(7,l,a)}),(v||0===v)&&(C+=v),C+="\n\n    ",v=n["if"].call(t,t&&t.IsMember,{hash:{},inverse:w.noop,fn:w.program(10,u,a)}),(v||0===v)&&(C+=v),C+="\r\n\r\n</div>"});return t.registerPartial("common/templates/crew/crew_tag",n),n}),define("common/templates/helpers/emblemUrl",["common/hbs/handlebars"],function(e){function t(e,t){if(!e)return a.emblemDefault;t=t||"";var i=a["emblem"+t]||a.emblem;return i.length?i.format(n(e),e):a.emblemDefault}function n(e){e=String(e);for(var t=5381,n=0;n<e.length;n++)t=(t<<5)+t+e.charCodeAt(n);t>>>=0;var i=t.toString(2);if(i.length>32&&(t=parseInt(i.substr(0,32),2)),t%=1e4,t=String(t),t.length<4){var a=4-t.length;for(n=0;a>n;n++)t="0"+t}return t}var i=globals.crewEmblemUrl,a={emblemDefault:"",emblem:i.format("{0}","{1}","64"),emblem32:i.format("{0}","{1}","32"),emblem50:i.format("{0}","{1}","64"),emblem64:i.format("{0}","{1}","64"),emblem90:i.format("{0}","{1}","128"),emblem100:i.format("{0}","{1}","128"),emblem128:i.format("{0}","{1}","128"),emblem256:i.format("{0}","{1}","256"),emblem512:i.format("{0}","{1}","512")};return e.registerHelper("emblemUrl",t),t}),define("hbs!common/templates/crew/crew_card",["hbs","common/hbs/handlebars","hbs!common/templates/crew/crew_tag","common/templates/helpers/emblemUrl"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e){var t,i,a="";return a+='\n                <a class="leaveTrigger" data-id="',(i=n.CrewId)?t=i.call(e,{hash:{}}):(i=e&&e.CrewId,t=typeof i===m?i.call(e,{hash:{}}):i),a+=g(t)+'" href="#" rel="localize[LeaveCrew]">\n                    Leave Crew\n                </a>\n                '}function o(e){var t,i,a="";return a+='\n                <a class="makeActive" data-id="',(i=n.CrewId)?t=i.call(e,{hash:{}}):(i=e&&e.CrewId,t=typeof i===m?i.call(e,{hash:{}}):i),a+=g(t)+'" href="#" rel="localize[MakeActiveCrew]">\n                    Make Active Crew\n                </a>\n                '}function s(e){var t,i,a="";return a+='\n                <a class="join" data-id="',(i=n.CrewId)?t=i.call(e,{hash:{}}):(i=e&&e.CrewId,t=typeof i===m?i.call(e,{hash:{}}):i),a+=g(t)+'" href="#" rel="localize[Join]">\n                    Join\n                </a>\n                '}function l(e){var t,i,a="";return a+='\n                <a class="join disabled" href="#" rel="localize[Join]" title="',(i=n.MaxCrewsMsg)?t=i.call(e,{hash:{}}):(i=e&&e.MaxCrewsMsg,t=typeof i===m?i.call(e,{hash:{}}):i),a+=g(t)+'">\n                    Join\n                </a>\n                '}function c(e){var t,i,a="";return a+='\n                <a class="requestInvite" data-id="',(i=n.CrewId)?t=i.call(e,{hash:{}}):(i=e&&e.CrewId,t=typeof i===m?i.call(e,{hash:{}}):i),a+=g(t)+'" href="#" rel="localize[CrewRequestInvite]">\n                    Request Invite\n                </a>\n                '}function u(){return'\n                <span class="requestPending" rel="localize[CrewRequestPending]">\n                    Request Pending\n                </span>\n                '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=this.merge(i,e.partials);var d,f,h,p="",m="function",g=this.escapeExpression,v=n.helperMissing,b=this;return p+='<div class="crewCard featureCard lightCard">\n        <div class="',(f=n.CrewType)?d=f.call(t,{hash:{}}):(f=t&&t.CrewType,d=typeof f===m?f.call(t,{hash:{}}):f),p+=g(d)+' crewType">\n\n            <img class="avatar" src="'+g((f=n.emblemUrl||t&&t.emblemUrl,h={hash:{}},f?f.call(t,t&&t.CrewId,64,h):v.call(t,"emblemUrl",t&&t.CrewId,64,h)))+'" />\n\n            <h5>',(f=n.CrewName)?d=f.call(t,{hash:{}}):(f=t&&t.CrewName,d=typeof f===m?f.call(t,{hash:{}}):f),p+=g(d)+"</h5>\n\n            ",d=b.invokePartial(i["common/templates/crew/crew_tag"],"common/templates/crew/crew_tag",t,n,i),(d||0===d)&&(p+=d),p+='\n\n            <p><span class="memberCount">',(f=n.MemberCount)?d=f.call(t,{hash:{}}):(f=t&&t.MemberCount,d=typeof f===m?f.call(t,{hash:{}}):f),p+=g(d)+'</span> <span rel="localize[Members]">members</span></p>\n        </div>\n\n        <div class="actions">\n            <div class="actions clearfix">\n                ',d=n["if"].call(t,t&&t.CanLeave,{hash:{},inverse:b.noop,fn:b.program(1,r,a)}),(d||0===d)&&(p+=d),p+="\n                ",d=n["if"].call(t,t&&t.CanMakeActive,{hash:{},inverse:b.noop,fn:b.program(3,o,a)}),(d||0===d)&&(p+=d),p+="\n                ",d=n["if"].call(t,t&&t.CanJoin,{hash:{},inverse:b.noop,fn:b.program(5,s,a)}),(d||0===d)&&(p+=d),p+="\n                ",d=n["if"].call(t,t&&t.CanJoinDisabled,{hash:{},inverse:b.noop,fn:b.program(7,l,a)}),(d||0===d)&&(p+=d),p+="\n                ",d=n["if"].call(t,t&&t.CanRequestInvite,{hash:{},inverse:b.noop,fn:b.program(9,c,a)}),(d||0===d)&&(p+=d),p+="\n                ",d=n["if"].call(t,t&&t.IsJoinRequestPending,{hash:{},inverse:b.noop,fn:b.program(11,u,a)}),(d||0===d)&&(p+=d),p+="\n            </div>\n        </div>\n</div>"});return n}),define("hbs!common/templates/profile/profile_accounts",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e){var t,i,a="";
return a+='\r\n<div class="profileButton">\r\n	<img width="64" height="64" class="avatarImg" src="',(i=n.AvatarUrl)?t=i.call(e,{hash:{}}):(i=e&&e.AvatarUrl,t=typeof i===c?i.call(e,{hash:{}}):i),a+=u(t)+'">\r\n	<div class="text">\r\n		<h4 class="servicename">',(i=n.OnlineServiceDisplayName)?t=i.call(e,{hash:{}}):(i=e&&e.OnlineServiceDisplayName,t=typeof i===c?i.call(e,{hash:{}}):i),a+=u(t)+"</h4>\r\n		<h5>",(i=n.UserName)?t=i.call(e,{hash:{}}):(i=e&&e.UserName,t=typeof i===c?i.call(e,{hash:{}}):i),a+=u(t)+'</h5>\r\n		<span class="icon ',(i=n.OnlineServiceName)?t=i.call(e,{hash:{}}):(i=e&&e.OnlineServiceName,t=typeof i===c?i.call(e,{hash:{}}):i),a+=u(t)+'">',(i=n.OnlineServiceName)?t=i.call(e,{hash:{}}):(i=e&&e.OnlineServiceName,t=typeof i===c?i.call(e,{hash:{}}):i),a+=u(t)+"</span>\r\n	</div>\r\n</div>\r\n"}function o(){return'\r\n<span class="noaccounts" rel="localize[NoLinkedAccounts]">This user is not displaying any linked accounts</span>\r\n'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s,l="",c="function",u=this.escapeExpression,d=this;return s=n.each.call(t,t,{hash:{},inverse:d.noop,fn:d.program(1,r,a)}),(s||0===s)&&(l+=s),l+="\r\n",s=n.unless.call(t,t,{hash:{},inverse:d.noop,fn:d.program(3,o,a)}),(s||0===s)&&(l+=s),l});return n}),define("hbs!common/templates/profile/profile_card",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(){return'\r\n    <ul class="user-actions clearfix">\r\n        <li class="playerActions">\r\n            <span class="icon"></span>\r\n            <span class="icon"></span>\r\n            <span class="icon"></span>\r\n            <span rel="localize[PlayerActions]">Player Actions</span>\r\n        </li>\r\n    </ul>\r\n    <div><ul class="buttons clearfix"/></div>\r\n    '}function o(e){var t,i,a="";return a+='\r\n        <div class="crewTag private">\r\n            <span>',(i=n.PrimaryClanTag)?t=i.call(e,{hash:{}}):(i=e&&e.PrimaryClanTag,t=typeof i===u?i.call(e,{hash:{}}):i),a+=d(t)+"</span>\r\n            \r\n        </div>\r\n        "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s,l,c="",u="function",d=this.escapeExpression,f=this;return c+='<div class="clearfix">\r\n    <img class="avatar" src="',(l=n.AvatarUrl)?s=l.call(t,{hash:{}}):(l=t&&t.AvatarUrl,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'" alt=""/>\r\n    <div class="relationship">',(l=n.RelationshipDesc)?s=l.call(t,{hash:{}}):(l=t&&t.RelationshipDesc,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'</div>\r\n    <div class="user-data">\r\n        <h3>',(l=n.DisplayName)?s=l.call(t,{hash:{}}):(l=t&&t.DisplayName,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'</h3>\r\n        <span class="subText">\r\n            <i class="status ',(l=n.StatusClass)?s=l.call(t,{hash:{}}):(l=t&&t.StatusClass,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'"></i>\r\n            <span>',(l=n.PlayingGame)?s=l.call(t,{hash:{}}):(l=t&&t.PlayingGame,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+"</span>\r\n        </span>\r\n    </div>\r\n\r\n    ",s=n.unless.call(t,t&&t.IsMe,{hash:{},inverse:f.noop,fn:f.program(1,r,a)}),(s||0===s)&&(c+=s),c+='\r\n\r\n    <div id="cardInfoFooter" class="clearfix">\r\n        <div class="member-since clearfix">\r\n            <span class="Country ',(l=n.CountryCode)?s=l.call(t,{hash:{}}):(l=t&&t.CountryCode,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'"></span>\r\n            <span class="member-date"><b><span rel="localize[MemberSince]">Member since:</span></b> ',(l=n.CreatedDateStr)?s=l.call(t,{hash:{}}):(l=t&&t.CreatedDateStr,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+"</span>\r\n        </div>\r\n        ",s=n["if"].call(t,t&&t.PrimaryClanTag,{hash:{},inverse:f.noop,fn:f.program(3,o,a)}),(s||0===s)&&(c+=s),c+="\r\n    </div>\r\n</div>"});return n}),define("hbs!common/templates/profile/profile_crews_empty",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<span class="noaccounts" rel="localize[NoCrews]">This user is not a member of any crew yet</span>'});return n}),define("hbs!common/templates/profile/profile_friend",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e){var t,i,a="";return a+='\r\n        <span class="status tooltip">\r\n            <span>',(i=n.PlayingGame)?t=i.call(e,{hash:{}}):(i=e&&e.PlayingGame,t=typeof i===h?i.call(e,{hash:{}}):i),a+=p(t)+"</span>\r\n        </span>\r\n        "}function o(e,t){var i,a="";return a+='\r\n        <span class="infoWrap optionProfile tooltip">\r\n            ',i=n["if"].call(e,e&&e.ViewerMutualFriendCount,{hash:{},inverse:m.noop,fn:m.program(4,s,t)}),(i||0===i)&&(a+=i),a+="\r\n            ",i=n["if"].call(e,e&&e.InviteShortMsg,{hash:{},inverse:m.noop,fn:m.program(6,l,t)}),(i||0===i)&&(a+=i),a+="\r\n        </span>\r\n        "}function s(e){var t,i,a="";return a+="\r\n            ",(i=n.MutualFriendText)?t=i.call(e,{hash:{}}):(i=e&&e.MutualFriendText,t=typeof i===h?i.call(e,{hash:{}}):i),a+=p(t)+"\r\n            "}function l(e){var t,i,a="";return a+="\r\n            ",(i=n.InviteShortMsg)?t=i.call(e,{hash:{}}):(i=e&&e.InviteShortMsg,t=typeof i===h?i.call(e,{hash:{}}):i),a+=p(t)+'\r\n            <a href="#"><span>',(i=n.InviteMsg)?t=i.call(e,{hash:{}}):(i=e&&e.InviteMsg,t=typeof i===h?i.call(e,{hash:{}}):i),a+=p(t)+"</span></a>\r\n            "}function c(){return'\r\n    <div>\r\n      <ul class="playerOptions"/>\r\n    </div>\r\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var u,d,f="",h="function",p=this.escapeExpression,m=this;return f+='<div id="profileButton_',(d=n.RockstarId)?u=d.call(t,{hash:{}}):(d=t&&t.RockstarId,u=typeof d===h?d.call(t,{hash:{}}):d),f+=p(u)+'" class="profileButton gold ',(d=n.OnlineStatus)?u=d.call(t,{hash:{}}):(d=t&&t.OnlineStatus,u=typeof d===h?d.call(t,{hash:{}}):d),f+=p(u)+'" data-id="',(d=n.RockstarId)?u=d.call(t,{hash:{}}):(d=t&&t.RockstarId,u=typeof d===h?d.call(t,{hash:{}}):d),f+=p(u)+'">\r\n    <a class="optionProfile" href="#"><img width="64" height="64" class="avatarImg" src="',(d=n.AvatarUrl)?u=d.call(t,{hash:{}}):(d=t&&t.AvatarUrl,u=typeof d===h?d.call(t,{hash:{}}):d),f+=p(u)+'" /></a>\r\n    <div class="text">\r\n        <h5 class="profilenickname"><a class="optionProfile" href="#">',(d=n.DisplayName)?u=d.call(t,{hash:{}}):(d=t&&t.DisplayName,u=typeof d===h?d.call(t,{hash:{}}):d),f+=p(u)+"</a></h5>\r\n\r\n        ",u=n["if"].call(t,t&&t.IsOnline,{hash:{},inverse:m.noop,fn:m.program(1,r,a)}),(u||0===u)&&(f+=u),f+="\r\n\r\n        ",u=n.unless.call(t,t&&t.IsMe,{hash:{},inverse:m.noop,fn:m.program(3,o,a)}),(u||0===u)&&(f+=u),f+="\r\n    </div>\r\n\r\n    ",u=n.unless.call(t,t&&t.IsMe,{hash:{},inverse:m.noop,fn:m.program(8,c,a)}),(u||0===u)&&(f+=u),f+="\r\n</div>"});return n}),define("hbs!common/templates/profile/profile_friends_empty",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<span rel="localize[FriendsHidden]" class="noaccounts">This user is not showing friend information</span>'});return n}),define("hbs!common/templates/profile/profile_games",["hbs","common/hbs/handlebars","common/templates/helpers/ifless"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e,t){var i,a,r,c="";return c+='\r\n  <div id="gamesFlipWrapper">\r\n      <ul id="gamesFlip">\r\n        ',a=n.ifless||e&&e.ifless,r={hash:{},inverse:h.noop,fn:h.programWithDepth(2,o,t,e),data:t},i=a?a.call(e,(i=e&&e.games,null==i||i===!1?i:i.length),2,r):p.call(e,"ifless",(i=e&&e.games,null==i||i===!1?i:i.length),2,r),(i||0===i)&&(c+=i),c+="\r\n        ",i=n.each.call(e,e&&e.games,{hash:{},inverse:h.noop,fn:h.programWithDepth(4,s,t,e),data:t}),(i||0===i)&&(c+=i),c+="\r\n        ",a=n.ifless||e&&e.ifless,r={hash:{},inverse:h.noop,fn:h.programWithDepth(6,l,t,e),data:t},i=a?a.call(e,(i=e&&e.games,null==i||i===!1?i:i.length),3,r):p.call(e,"ifless",(i=e&&e.games,null==i||i===!1?i:i.length),3,r),(i||0===i)&&(c+=i),c+='\r\n      </ul>\r\n      <div id="gamesFlipMask"></div>\r\n  </div>\r\n'}function o(e,t,n){var i,a="";return a+='\r\n          <li class="g0"><img src="'+f((i=n&&n.cdnUrl,typeof i===d?i.apply(e):i))+'images/common/games-coverflow/default.png" alt="Rockstar" /></li>\r\n        '}function s(e,t,i){var a,r,o="";return o+='\r\n          <li class="g'+f((a=null==t||t===!1?t:t.index,typeof a===d?a.apply(e):a))+'"><img src="'+f((a=i&&i.cdnUrl,typeof a===d?a.apply(e):a))+"images/common/games-coverflow/",(r=n.Name)?a=r.call(e,{hash:{},data:t}):(r=e&&e.Name,a=typeof r===d?r.call(e,{hash:{},data:t}):r),o+=f(a)+'.png" alt="',(r=n.Name)?a=r.call(e,{hash:{},data:t}):(r=e&&e.Name,a=typeof r===d?r.call(e,{hash:{},data:t}):r),o+=f(a)+'" /></li>\r\n        '}function l(e,t,n){var i,a="";return a+='\r\n          <li class="g2"><img src="'+f((i=n&&n.cdnUrl,typeof i===d?i.apply(e):i))+'images/common/games-coverflow/default.png" alt="Rockstar" /></li>\r\n        '}function c(){return'\r\n  <div class="content" rel="localize[NoGamesPlayed]">\r\n      No games played yet!\r\n  </div>\r\n'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),a=a||{};var u,d="function",f=this.escapeExpression,h=this,p=n.helperMissing;return u=n["if"].call(t,t&&t.games,{hash:{},inverse:h.program(8,c,a),fn:h.program(1,r,a),data:a}),u||0===u?u:""});return n}),define("hbs!common/templates/profile/profile_nav",["hbs","common/hbs/handlebars","common/templates/helpers/ifequals"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(){return' class="active"'}function o(e,t){var i;return i=n["if"].call(e,e&&e.MutualFriendCount,{hash:{},inverse:p.noop,fn:p.program(4,s,t)}),i||0===i?i:""}function s(e){var t,i,a="";return a+=" <span>(",(i=n.MutualText)?t=i.call(e,{hash:{}}):(i=e&&e.MutualText,t=typeof i===f?i.call(e,{hash:{}}):i),a+=h(t)+")</span>"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var l,c,u,d="",f="function",h=this.escapeExpression,p=this,m=n.helperMissing;return d+="<li",c=n.ifequals||t&&t.ifequals,u={hash:{},inverse:p.noop,fn:p.program(1,r,a)},l=c?c.call(t,t&&t.Active,"crews",u):m.call(t,"ifequals",t&&t.Active,"crews",u),(l||0===l)&&(d+=l),d+='><a href="#" data-nav="crews"><span rel="localize[Crews]">crews</span></a></li>\r\n<li',c=n.ifequals||t&&t.ifequals,u={hash:{},inverse:p.noop,fn:p.program(1,r,a)},l=c?c.call(t,t&&t.Active,"friends",u):m.call(t,"ifequals",t&&t.Active,"friends",u),(l||0===l)&&(d+=l),d+='><a href="#" data-nav="friends"><span rel="localize[Friends]">friends</span>',l=n.unless.call(t,t&&t.IsMe,{hash:{},inverse:p.noop,fn:p.program(3,o,a)}),(l||0===l)&&(d+=l),d+="</a></li> \r\n<li",c=n.ifequals||t&&t.ifequals,u={hash:{},inverse:p.noop,fn:p.program(1,r,a)},l=c?c.call(t,t&&t.Active,"accounts",u):m.call(t,"ifequals",t&&t.Active,"accounts",u),(l||0===l)&&(d+=l),d+='><a href="#" data-nav="accounts"><span rel="localize[Accounts]">accounts</span></a></li>'});return n}),define("hbs!common/templates/profile/profile_blocker",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e){var t,i,a="";return a+='\r\n  		            <p class="desc">',(i=n.Message)?t=i.call(e,{hash:{}}):(i=e&&e.Message,t=typeof i===c?i.call(e,{hash:{}}):i),a+=u(t)+'</p>\r\n                    <div id="cardInfoVitalsHidden">\r\n		                <div class="user-actions-wrapper">\r\n		                    <div class="playerActions">\r\n			                    <a href="#">\r\n                                    <span class="icon"></span>\r\n                                    <span class="icon"></span>\r\n                                    <span class="icon"></span>\r\n                                    <span rel="localize[PlayerActions]">Player Actions</span>\r\n                                </a>\r\n                            </div>\r\n                        </div>\r\n                        <div><ul class="buttons clearfix"/></div>\r\n                    </div>\r\n                    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var o,s,l="",c="function",u=this.escapeExpression,d=this;return l+='<div class="inner">\r\n	<div class="wrapper">\r\n		<div class="content-wrapper">\r\n			<div class="content-inner clearfix">\r\n                <img width="128" height="128" class="avatar" src="',(s=n.AvatarUrl)?o=s.call(t,{hash:{}}):(s=t&&t.AvatarUrl,o=typeof s===c?s.call(t,{hash:{}}):s),l+=u(o)+'" alt=""/>\r\n			    <div class="content-column">\r\n			        <h1 rel="localize[ProfileNotAvailable]">Profile is not available</h1>\r\n                    ',o=n["if"].call(t,t&&t.ProfileFound,{hash:{},inverse:d.noop,fn:d.program(1,r,a)}),(o||0===o)&&(l+=o),l+="\r\n			    </div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>"});return n}),define("hbs!common/templates/profile/profile_actions",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e){var t,i,a="";return a+='\r\n    <li class="friend add addFriend">\r\n        <a href="#" class="',(i=n.AnchorClass)?t=i.call(e,{hash:{}}):(i=e&&e.AnchorClass,t=typeof i===g?i.call(e,{hash:{}}):i),a+=v(t)+'"><span rel="localize[Add]">Add</span></a>\r\n    </li>\r\n'}function o(e){var t,i,a="";return a+='\r\n    <li class="friend remove unfriend">\r\n        <a href="#" class="',(i=n.AnchorClass)?t=i.call(e,{hash:{}}):(i=e&&e.AnchorClass,t=typeof i===g?i.call(e,{hash:{}}):i),a+=v(t)+'"><span rel="localize[Unfriend]">Unfriend</span></a>\r\n    </li>\r\n'}function s(e){var t,i,a="";return a+='\r\n    <li class="friend add acceptInvite">\r\n        <a href="#" class="',(i=n.AnchorClass)?t=i.call(e,{hash:{}}):(i=e&&e.AnchorClass,t=typeof i===g?i.call(e,{hash:{}}):i),a+=v(t)+'"><span rel="localize[Accept]">Accept</span></a>\r\n    </li>\r\n'}function l(e){var t,i,a="";return a+='\r\n    <li class="friend remove declineInvite">\r\n        <a href="#" class="',(i=n.AnchorClass)?t=i.call(e,{hash:{}}):(i=e&&e.AnchorClass,t=typeof i===g?i.call(e,{hash:{}}):i),a+=v(t)+'"><span rel="localize[Decline]">Decline</span></a>\r\n    </li>\r\n'}function c(e){var t,i,a="";return a+='\r\n    <li class="friend remove cancelInvite">\r\n        <a href="#" class="',(i=n.AnchorClass)?t=i.call(e,{hash:{}}):(i=e&&e.AnchorClass,t=typeof i===g?i.call(e,{hash:{}}):i),a+=v(t)+'"><span rel="localize[CancelRequest]">Cancel Pending Friend Request</span></a>\r\n    </li>\r\n'}function u(e){var t,i,a="";return a+='\r\n    <li class="message">\r\n        <a href="#" class="',(i=n.AnchorClass)?t=i.call(e,{hash:{}}):(i=e&&e.AnchorClass,t=typeof i===g?i.call(e,{hash:{}}):i),a+=v(t)+'"><span rel="localize[MessageOption]">Message</span></a>\r\n    </li>\r\n'}function d(e){var t,i,a="";return a+='\r\n<li class="report">\r\n    <a href="#" class="',(i=n.AnchorClass)?t=i.call(e,{hash:{}}):(i=e&&e.AnchorClass,t=typeof i===g?i.call(e,{hash:{}}):i),a+=v(t)+'"><span rel="localize[Report]">Report</span></a>\r\n</li>\r\n'}function f(e){var t,i,a="";return a+='\r\n    <li class="block">\r\n        <a href="#" class="',(i=n.AnchorClass)?t=i.call(e,{hash:{}}):(i=e&&e.AnchorClass,t=typeof i===g?i.call(e,{hash:{}}):i),a+=v(t)+'"><span rel="localize[Block]">Block</span></a>\r\n    </li>\r\n'}function h(e){var t,i,a="";return a+='\r\n    <li class="unblock">\r\n        <a href="#" class="',(i=n.AnchorClass)?t=i.call(e,{hash:{}}):(i=e&&e.AnchorClass,t=typeof i===g?i.call(e,{hash:{}}):i),a+=v(t)+'"><span rel="localize[Unblock]">Unblock</span></a>\r\n    </li>\r\n'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var p,m="",g="function",v=this.escapeExpression,b=this;return p=n["if"].call(t,t&&t.ShowAddFriend,{hash:{},inverse:b.noop,fn:b.program(1,r,a)}),(p||0===p)&&(m+=p),m+="\r\n",p=n["if"].call(t,t&&t.ShowRemoveFriend,{hash:{},inverse:b.noop,fn:b.program(3,o,a)}),(p||0===p)&&(m+=p),m+="\r\n",p=n["if"].call(t,t&&t.ShowAcceptInvite,{hash:{},inverse:b.noop,fn:b.program(5,s,a)}),(p||0===p)&&(m+=p),m+="\r\n",p=n["if"].call(t,t&&t.ShowDeclineInvite,{hash:{},inverse:b.noop,fn:b.program(7,l,a)}),(p||0===p)&&(m+=p),m+="\r\n",p=n["if"].call(t,t&&t.ShowCancelnvite,{hash:{},inverse:b.noop,fn:b.program(9,c,a)}),(p||0===p)&&(m+=p),m+="\r\n",p=n["if"].call(t,t&&t.ShowMessage,{hash:{},inverse:b.noop,fn:b.program(11,u,a)}),(p||0===p)&&(m+=p),m+="\r\n",p=n["if"].call(t,t&&t.ShowReport,{hash:{},inverse:b.noop,fn:b.program(13,d,a)}),(p||0===p)&&(m+=p),m+="\r\n",p=n["if"].call(t,t&&t.ShowBlock,{hash:{},inverse:b.noop,fn:b.program(15,f,a)}),(p||0===p)&&(m+=p),m+="\r\n",p=n["if"].call(t,t&&t.ShowUnBlock,{hash:{},inverse:b.noop,fn:b.program(17,h,a)}),(p||0===p)&&(m+=p),m});return n}),define("hbs!common/templates/crew/crew_member",["hbs","common/hbs/handlebars","common/templates/helpers/ifequals"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e){var t,i,a="";return a+="\r\n        <span class='subText'>\r\n            <i class=\"onlineStatus SCOnline\" />\r\n            ",(i=n.PlayingGame)?t=i.call(e,{hash:{}}):(i=e&&e.PlayingGame,t=typeof i===u?i.call(e,{hash:{}}):i),a+=d(t)+"\r\n        </span>\r\n        "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var o,s,l,c="",u="function",d=this.escapeExpression,f=this,h=n.helperMissing;return c+='<div class="profileButton crewMember" data-id="',(s=n.RockstarId)?o=s.call(t,{hash:{}}):(s=t&&t.RockstarId,o=typeof s===u?s.call(t,{hash:{}}):s),c+=d(o)+'">\r\n    <img width="64" height="64" class="avatarImg" data-id="',(s=n.RockstarId)?o=s.call(t,{hash:{}}):(s=t&&t.RockstarId,o=typeof s===u?s.call(t,{hash:{}}):s),c+=d(o)+'" alt="" src="',(s=n.AvatarUrl)?o=s.call(t,{hash:{}}):(s=t&&t.AvatarUrl,o=typeof s===u?s.call(t,{hash:{}}):s),c+=d(o)+'" />\r\n    <div class="text">\r\n        <h5>\r\n            <a href="#" class="profilenickname" data-id="',(s=n.RockstarId)?o=s.call(t,{hash:{}}):(s=t&&t.RockstarId,o=typeof s===u?s.call(t,{hash:{}}):s),c+=d(o)+'">',(s=n.Nickname)?o=s.call(t,{hash:{}}):(s=t&&t.Nickname,o=typeof s===u?s.call(t,{hash:{}}):s),c+=d(o)+"</a>\r\n        </h5>\r\n\r\n        ",s=n.ifequals||t&&t.ifequals,l={hash:{},inverse:f.noop,fn:f.program(1,r,a)},o=s?s.call(t,t&&t.IsOnline,!0,l):h.call(t,"ifequals",t&&t.IsOnline,!0,l),(o||0===o)&&(c+=o),c+='\r\n\r\n        <span class="infoWrap rank" rel="localize[',(s=n.Rank)?o=s.call(t,{hash:{}}):(s=t&&t.Rank,o=typeof s===u?s.call(t,{hash:{}}):s),c+=d(o)+']">',(s=n.Rank)?o=s.call(t,{hash:{}}):(s=t&&t.Rank,o=typeof s===u?s.call(t,{hash:{}}):s),c+=d(o)+'</span>\r\n\r\n        <span class="infoWrap dateJoined"><span rel="localize[Joined]">Joined</span>: ',(s=n.DateJoinedLocalized)?o=s.call(t,{hash:{}}):(s=t&&t.DateJoinedLocalized,o=typeof s===u?s.call(t,{hash:{}}):s),c+=d(o)+"</span>\r\n    </div>\r\n</div>"});return n}),define("common/profile/profile-views",["jquery","backbone","underscore","utils","common/baseUtils","common/datafunctions","setup.environment.utils","common/profile/profile-models","common/crews/crews-models","common/modals/modal-views","am","common/reporting/reporting","hbs!common/templates/crew/crew_card","hbs!common/templates/profile/profile_accounts","hbs!common/templates/profile/profile_card","hbs!common/templates/profile/profile_crews_empty","hbs!common/templates/profile/profile_friend","hbs!common/templates/profile/profile_friends_empty","hbs!common/templates/profile/profile_games","hbs!common/templates/profile/profile_nav","hbs!common/templates/profile/profile_blocker","hbs!common/templates/profile/profile_actions","hbs!common/templates/crew/crew_member"],function(e,t,n,i,a,r,o,s,l,c,u,d,f,h,p,m,g,v,b,C,S,y,w){var _={};return _.ProfileView=t.View.extend({el:"#friendProfilePanel ul.nav",events:{"click a":"navigate"},navigate:function(t){t.preventDefault(),this.model.set("Active",e(t.currentTarget).data("nav"))},render:function(){var e=void 0!=globals.account&&this.model.get("RockstarId")==globals.account.RockstarId,t=this.model.get("MutualFriendCount"),n="";void 0!=t&&t>0&&(n=o.getText("Mutual","Social").format(t)),this.model.set({IsMe:e,MutualText:n},{silent:!0});var a=i.renderCompiledTemplate(C,this.model.toJSON());switch(this.$el.html(a),this.profileFriendsView.$el.hide(),this.profileCrewsView.$el.hide(),this.profileAccountsView.$el.hide(),this.model.get("Active")){case"friends":this.profileFriendsView.$el.show();break;case"crews":this.profileCrewsView.$el.show();break;case"accounts":this.profileAccountsView.$el.show()}return this.postRender(),this},renderAll:function(){return"undefined"!=typeof this.hiddenProfileView&&this.hiddenProfileView.close(),this.render(),this.profileCardView.render(),this.profileGamesView.render(),this.profileCrewsView.render(),this.profileAccountsView.render(),this.postRender(),this},postRender:function(){"en-US"!=globals.titlelang&&(e("#friendProfilePanel [rel*=localize]:not(.localized)").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}).addClass("localized"),e("#friendProfilePanel").addClass("friendProfilePanel")),e("#headerLoginUser").removeClass("disabled"),e("#userCrews").data("antiscroll").refresh(),e("#userAccounts").data("antiscroll").refresh(),e("#userFriends").data("antiscroll").refresh(),this.$("img.avatar").on("error",i.avatarImage404)},onClose:function(){"undefined"!=typeof this.hiddenProfileView&&this.hiddenProfileView.close(),this.profileCardView.close(),this.profileFriendsView.close(),this.profileCrewsView.close(),this.profileAccountsView.close()},reinitialize:function(e){var t=e.profileData;if(t.RockstarAccount.ProfileHidden)return void(this.hiddenProfileView?this.hiddenProfileView.model.clear().set(t.RockstarAccount):(this.hiddenProfileView=new _.HiddenProfileView({model:new s.ProfileCard(t.RockstarAccount)}),this.hiddenProfileView.render()));this.profileCardView?this.profileCardView.model.clear().set(t.RockstarAccount):this.profileCardView=new _.ProfileCardView({model:new s.ProfileCard(t.RockstarAccount)});var n=t.RockstarAccount.GamesOwned;if("undefined"!=typeof n&&(1===n.length&&n.push({Name:"default"}),n.length>1)){var i=n[0];n[0]=n[1],n[1]=i}this.profileGamesView?this.profileGamesView.collection.reset(n):this.profileGamesView=new _.ProfileGamesView({collection:new s.GameCollection(n)}),this.profileFriendsView?(this.profileFriendsView.collection.reset(t.Friends),this.profileFriendsView.model.clear().set(t.RockstarAccount)):this.profileFriendsView=new _.ProfileFriendsView({collection:new s.FriendCollection(t.Friends),model:new s.ProfileCard(t.RockstarAccount),el:"#userFriends .box .antiscroll-inner",activePanel:"friendProfilePanel"});var a=this,r=o.GetAuthHeaderAsync();r.done(function(){a.profileCrewsView?a.profileCrewsView.collection.reset(t.Crews):a.profileCrewsView=new _.ProfileCrewsView({collection:new s.CrewCollection(t.Crews)}),a.profileAccountsView?a.profileAccountsView.collection.reset(t.LinkedAccounts):a.profileAccountsView=new _.ProfileAccountsView({collection:new s.AccountCollection(t.LinkedAccounts)}),a.model?a.model.set({Active:"crews",MutualFriendCount:t.RockstarAccount.MutualFriendCount,RockstarId:t.RockstarAccount.RockstarId}):(a.model=new s.ProfileNav({Active:"crews",MutualFriendCount:t.RockstarAccount.MutualFriendCount,RockstarId:t.RockstarAccount.RockstarId}),a.model.on("change",a.render)),a.renderAll()})},initialize:function(e){n.bindAll(this,"render","renderAll","onClose","navigate","postRender"),this.reinitialize(e)}}),_.HiddenProfileView=t.View.extend({el:"#profileHidden",events:{"click .playerActions":"togglePlayerActions"},render:function(){"undefined"!=typeof this.userActionsView&&(this.userActionsView.close(),this.userActionsView=void 0),e("#user").hide();var t=i.getAvatarUrl(this.model.get("AvatarUrl"),this.model.get("DisplayName"),128);if(this.model.set("AvatarUrl",t),void 0!=this.model.get("DisplayName")&&""!=this.model.get("DisplayName")){var n=o.getText("ProfileNotAvailableDesc","Social");n=n.replace("[Nickname]",this.model.get("DisplayName")),this.model.set({Message:n,ProfileFound:!0},{silent:!0})}else this.model.set({ProfileFound:!1},{silent:!0});var a=globals.messagingServiceEnabled;this.model.set({ShowMessage:a},{silent:!0});var r=i.renderCompiledTemplate(S,this.model.toJSON());this.$el.html(r),this.$el.find("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),this.$el.addClass("localized"),this.$el.show(),o.removeLoading("friendProfilePanel"),this.$(".avatar").on("error",i.avatar404)},togglePlayerActions:function(){var e=this.$el.find(".buttons");if(e.is(":hidden"))if("undefined"==typeof this.userActionsView){var t=new Backbone.Model(n.pick(this.model.toJSON(),"AllowBlock","Relationship","RockstarId","ShowMessage","ViewerRelationship","DisplayName","AvatarUrl","IsOnline","AllowReport"));t.set({hideAfterClick:!0},{silent:!0}),this.userActionsView=new _.UserActionsView({model:t,el:"#profileHidden .buttons"}),this.userActionsView.render()}else this.userActionsView.showButtons();else this.userActionsView.hideButtons()},close:function(){e("#user").show(),this.$el.hide(),"undefined"!=typeof this.userActionsView&&this.userActionsView.close()},initialize:function(){n.bindAll(this,"render","togglePlayerActions"),this.model.on("change",this.render)}}),_.ProfileCardView=t.View.extend({el:"#cardInfoVitals",events:{"click .playerActions":"togglePlayerActions"},render:function(){"undefined"!=typeof this.userActionsView&&(this.userActionsView.close(),this.userActionsView=void 0);var e=i.getAvatarUrl(this.model.get("AvatarUrl"),this.model.get("DisplayName"));this.model.set("AvatarUrl",e);var t=i.localizedDate(this.model.get("CreatedDate"),"LL");this.model.set({CreatedDateStr:t},{silent:!0});var n=void 0!=globals.account&&this.model.get("RockstarId")==globals.account.RockstarId;this.model.set({IsMe:n},{silent:!0});var a=globals.messagingServiceEnabled;this.model.set({ShowMessage:a},{silent:!0}),this.setOnlineStatus();var r=o.getText(this.model.get("Relationship")+"_relDesc","Social");this.model.set({RelationshipDesc:r},{silent:!0});var s=i.renderCompiledTemplate(p,this.model.toJSON());return this.$el.html(s),o.removeLoading("friendProfilePanel"),this.$el.find("[rel*=localize]:not(.localized)").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),this.$el.attr("data-id",this.model.get("RockstarId")),this.$(".avatar").on("error",i.avatar404),this},togglePlayerActions:function(){var e=this.$el.find(".buttons");if(e.is(":hidden"))if("undefined"==typeof this.userActionsView){var t=new Backbone.Model(n.pick(this.model.toJSON(),"AllowBlock","Relationship","RockstarId","ShowMessage","ViewerRelationship","DisplayName","AvatarUrl","IsOnline","AllowReport"));t.set({checkMultiplayer:!this.model.get("IsMe"),hideAfterClick:!0},{silent:!0}),this.userActionsView=new _.UserActionsView({model:t,el:"#cardInfoVitals .buttons"}),this.userActionsView.render()}else this.userActionsView.showButtons();else this.userActionsView.hideButtons()},setOnlineStatus:function(){var e=this.model.get("IsOnline"),t=i.getOnlineTitle(e,this.model.get("OnlineGames")),n=e?t.game:null,a=e?t.platform:null,r=o.getText("PlayingGameOn","Social","Playing {0} on {1}"),s=e?r.format(n,a):o.getText("Offline","Social"),l=e?"SCOnline":"SCOffline";this.model.set({PlayingGame:s,StatusClass:l},{silent:!0})},onClose:function(){"undefined"!=typeof this.userActionsView&&this.userActionsView.onClose(),i.pubsub.off("profile:RenderGameJoinInviteButtons")},initialize:function(){n.bindAll(this,"render","togglePlayerActions","onClose","setOnlineStatus"),this.model.on("change",this.render)}}),_.ProfileGamesView=t.View.extend({el:"#gamesPanel",events:{},render:function(){var e=i.renderCompiledTemplate(b,{games:this.collection.toJSON(),cdnUrl:globals.baseUrl});return this.$el.html(e),this.$("#gamesFlip").fadeIn(),this},initialize:function(){n.bindAll(this,"render"),this.collection.on("reset",this.render)}}),_.ProfileFriendView=t.View.extend({events:{"click .optionProfile":"viewProfile"},render:function(){var e=i.getAvatarUrl(this.model.get("AvatarUrl"),this.model.get("DisplayName"));this.model.set("AvatarUrl",e);var t="crewMember"===this.model.get("cardType")?w:g,n=i.renderCompiledTemplate(t,this.model.toJSON());return this.$el.html(n),this.$el.addClass("profileButtonWrapper"),this.$(".avatarImg").on("error",i.avatar404),this},renderButtons:function(){var e="undefined"!=typeof globals.account&&this.model.get("RockstarId")===globals.account.RockstarId;if(!e){var t=new Backbone.Model(n.pick(this.model.toJSON(),"AllowBlock","Relationship","RockstarId","ShowMessage","ViewerRelationship","DisplayName","AvatarUrl","activePanel"));t.set({hideAfterClick:!1},{silent:!0}),this.userActionsView=new _.UserActionsView({model:t,el:this.$el.find("#profileButton_"+this.model.get("RockstarId")+" .playerOptions")}),this.userActionsView.render()}},viewProfile:function(e){e.preventDefault(),i.pubsub.trigger("datafnfriends:friendProfileView",this.model.get("RockstarId"))},onClose:function(){this.model.off(),"undefined"!=typeof this.userActionsView&&this.userActionsView.close()},initialize:function(){n.bindAll(this,"render","viewProfile","onClose","renderButtons"),this.model.parse(this.model)}}),_.ProfileFriendsView=t.View.extend({events:{},add:function(e){e.set({activePanel:this.collection.activePanel},{silent:!0});var t=new _.ProfileFriendView({tagName:"div",model:e});this._friendViews.push(t),this._rendered&&(this.$el.append(t.render().el),t.renderButtons())},reset:function(){this.closeAll(),this._rendered=!1,this._friendViews=[],this.collection.each(this.add),this.render(),o.resetScrollbar("#userFriends")},closeAll:function(){n.each(this._friendViews,function(e){e.close()})},render:function(){this._rendered=!0,this.$el.empty();var e=this;if(n.each(this._friendViews,function(t){e.$el.append(t.render().el),t.renderButtons()}),0===this.collection.length){var t=i.renderCompiledTemplate(v,this.model.toJSON());this.$el.html(t)}return this.$el.show(),this},initialize:function(e){n.bindAll(this,"render","add","closeAll","reset"),n.extend(this.collection,{activePanel:e.activePanel}),this._friendViews=[],this.collection.on("reset",this.reset),this.collection.on("add",this.add),this.reset()}}),_.ProfileCrewView=t.View.extend({events:{},render:function(){var e=i.renderCompiledTemplate(f,this.model.toJSON());return this.$el.html(e),this.$(".crewCard img").on("error",i.crewImage404),this},initialize:function(){n.bindAll(this,"render"),this.model.on("change",this.render)}}),_.ProfileCrewsView=t.View.extend({el:"#userCrews .box .antiscroll-inner",events:{},add:function(e){var t=new _.ProfileCrewView({tagName:"div",model:e});this._crewViews.push(t),this._rendered&&this.$el.prepend(t.render().el)},reset:function(){this.closeAll(),this._rendered=!1,this._crewViews=[],this.collection.each(this.add),this.render(),o.resetScrollbar("#userCrews")},closeAll:function(){n.each(this._crewViews,function(e){e.close()})},render:function(){this._rendered=!0,this.$el.empty();var t=this;if(n.each(this._crewViews,function(e){t.$el.append(e.render().el)}),0===this.collection.length){var a=i.renderCompiledTemplate(m);this.$el.html(a)}return"en-US"!=globals.titlelang&&e("#userCrews [rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),this},initialize:function(){n.bindAll(this,"render","add","closeAll","reset"),this.collection.on("reset",this.reset),this.reset()}}),_.ProfileAccountsView=t.View.extend({el:"#userAccounts .box .antiscroll-inner",events:{},render:function(){var t=i.renderCompiledTemplate(h,this.collection.toJSON());return this.$el.html(t),"en-US"!=globals.titlelang&&e("#userAccounts [rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),o.resetScrollbar("#userAccounts"),this},initialize:function(){n.bindAll(this,"render"),this.collection.on("reset",this.render)}}),_.UserActionsView=t.View.extend({events:{"click .message":"sendMessage","click .acceptInvite":"acceptFriendInvite","click .declineInvite":"declineFriendInvite","click .unfriend":"removeFriend","click .cancelInvite":"cancelInvite","click .addFriend":"addFriend","click .unblock":"unblock","click .block":"blockPlayerConfirm","click .sendJoinGame a":"sendJoinGame","click .sendGameInvite a":"sendGameInvite","click .report a":"reportProfile"},render:function(){var e=void 0!=globals.account&&this.model.get("RockstarId")==globals.account.RockstarId;
if(this.checkMultiplayerPresence()){var t=[this.model.get("RockstarId")];r.requestMultiplayerPresenceInfo(t)}var n=this.model.get("ViewerRelationship");"undefined"==typeof n&&(n=this.model.get("Relationship"));var a=!1,o=!1,s=!1,l=!1,c=!1,u=!1,d=!0,f=!1,h="";if(e)d=!1;else{var p=this.$el.parents(".profileButton");p.length&&(h="tooltip"),(1===n||"None"==n)&&(a=!0),(32===n||"Friend"==n)&&(o=!0),(8===n||"InvitedByMe"==n)&&(s=!0),(16===n||"InvitedByThem"==n)&&(c=!0,u=!0),(2===n||"BlockedByMe"==n)&&(l=!0,d=!1),globals.messagingServiceEnabled||(d=!1),2!==n&&"BlockedByMe"!==n&&(f=!0);var m=this.model.get("AllowReport")}this.model.set({ShowAddFriend:a,ShowRemoveFriend:o,ShowMessage:d,ShowCancelnvite:s,ShowUnBlock:l,ShowAcceptInvite:c,ShowDeclineInvite:u,ShowBlock:f,AnchorClass:h,ShowReport:m},{silent:!0});var g=i.renderCompiledTemplate(y,this.model.toJSON());return this.$el.html(g),"en-US"!=globals.titlelang&&this.$("[rel*=localize]:not(.localized)").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),this.$el.show(),this},showButtons:function(){this.$el.show()},hideButtons:function(){this.model.get("hideAfterClick")&&this.$el.hide()},updateFriendRelationship:function(e){switch(i.WriteDebugLog("UserActionsView.updateFriendRelationship","data.Relationship",e.Relationship),e.Relationship){case 0:this.model.set("ViewerRelationship","None");break;case 4:this.model.set("ViewerRelationship","InvitedByMe");break;case 6:this.model.set("ViewerRelationship","Friend");break;case 2:this.model.set("ViewerRelationship","BlockedByMe")}},acceptFriendInvite:function(e){e.preventDefault(),this.hideButtons(),i.pubsub.trigger("datafnfriends:SendFriendAccept",this.model.get("RockstarId"))},declineFriendInvite:function(e){e&&e.preventDefault(),this.hideButtons();var t=o.getText("DeclineInviteFrom","Social");return c.ShowConfirmModal(t,this.model.get("DisplayName"),"datafnfriends:SendFriendDeclineInvite",this.model.get("RockstarId")),!1},addFriend:function(t){t.preventDefault(),this.hideButtons();var n=e(t.currentTarget);return n.hasClass("disabled")?!1:(n.addClass("disabled"),i.pubsub.trigger("datafnfriends:SendFriendRequest",this.model.get("RockstarId")),!1)},cancelInvite:function(e){e.preventDefault(),this.hideButtons(),i.pubsub.trigger("datafnfriends:SendInviteCancel",this.model.get("RockstarId"))},removeFriend:function(e){e.preventDefault(),this.hideButtons();var t=o.getText("RemoveFriendName","Social");c.ShowConfirmModal(t,this.model.get("DisplayName"),"datafnfriends:SendFriendRemove",this.model.get("RockstarId"))},sendMessage:function(t){t.preventDefault(),this.hideButtons();var n=e(".panel.active").attr("id");"BlockedByMe"==this.model.get("ViewerRelationship")||2==this.model.get("ViewerRelationship")?i.pubsub.trigger("datafnfriends:RedirectToBlockList",this.model.get("DisplayName")):i.pubsub.trigger("msg.openNewMessage",this.model.get("RockstarId"),this.model.get("AvatarUrl"),this.model.get("DisplayName"),n)},unblock:function(e){e&&e.preventDefault(),i.WriteDebugLog("unblock","Nickname",this.model.get("DisplayName")),this.hideButtons();var t=o.getText("UnblockPlayer","Social");return c.ShowConfirmModal(t,this.model.get("DisplayName"),"datafnfriends:SendFriendUnblock",this.model.get("RockstarId")),!1},blockPlayerConfirm:function(e){e.preventDefault(),this.hideButtons();var t=o.getText("BlockUserText","Social"),n=o.getText("BlockUserTitle","Social");c.ShowConfirmModal(t,null,"userActions:BlockPlayerConfirmAgain_"+this.model.get("RockstarId"),n,"Block","DontBlock",n,null)},blockPlayerConfirmAgain:function(e){var t=o.getText("BlockUserConfirmText","Social");c.ShowConfirmModal(t,null,"userActions:BlockPlayer_"+this.model.get("RockstarId"),null,"Yes","No",e,null)},blockPlayer:function(){var e=new s.BlockPlayerModel;e.block(this.model.get("RockstarId"),this.blockPlayerSuccess,c.ShowErrorModal)},blockPlayerSuccess:function(){var e=o.getText("BlockSuccess","Social");e=e.replace("[Nickname]",this.model.get("DisplayName")),c.ShowConfirmModal(e,null,null,null,"Ok",null,null,null);var t;if(t="friendProfilePanel"===this.model.get("activePanel")?"friendProfile":i.ActiveFriendsMenuId(),"undefined"!=typeof t){var n=this.model.get("RockstarId");switch(t){case"findPlayerLink":case"crewMembersLink":case"friendProfile":i.pubsub.trigger("gameFnFriends:UpdateFriendStatus_"+n,{RockstarId:n,Relationship:2});break;case"myFriendsLink":case"friendInvitesLink":this.removePlayerCard(t);default:i.pubsub.trigger("gameFnFriends:UpdateFriendStatus_"+n,{RockstarId:n,Relationship:2})}}},reportProfile:function(e){e.preventDefault();var t=this.model.get("DisplayName");d.reportProfile(t)},removePlayerCard:function(t){this.$el.parents(".profileButtonWrapper").remove();var n,i,r,s;"myFriendsLink"===t?(n="#myFriendsLink",i="friendFn.showNoFriends",r=e("#friendsList"),s=!0):(n="#friendInvitesLink",i="friendFn.showNoFriendInvites",r=e("#friendInvitesList"),s=!1);var l=o.UpdateSocialSideMenuCount("subtract",n,s);0===l&&a.pubsub.publish(i,r)},sendGameInvite:function(e){e.preventDefault(),this.hideButtons(),i.pubsub.trigger("datafnfriends:SendGameInvite",this.model.get("RockstarId"))},sendJoinGame:function(e){e.preventDefault(),this.hideButtons(),i.pubsub.trigger("datafnfriends:SendJoinGame",this.model.get("RockstarId"))},acceptFriend:function(e){e.preventDefault(),this.hideButtons(),i.pubsub.trigger("datafnfriends:SendFriendAccept",this.model.get("RockstarId"))},checkMultiplayerPresence:function(){return this.model.get("IsOnline")&&this.model.get("checkMultiplayer")},setGameButtonVisibility:function(e){var t=e.Players[0],n=t.CanSendGameInvite,i=t.CanJoinGame;(n||i)&&this.renderGameButtons(n,i)},renderGameButtons:function(e,t){var n='<li class="sendGameInvite"><a href="#"><span>'+o.getText("InviteToGame","Social")+"</span></a></li>",i='<li class="sendJoinGame"><a href="#"><span>'+o.getText("JoinGame","Social")+"</span></a></li>",a="";e&&(a=n),t&&(a+=i),this.$el.append(a)},onClose:function(){i.pubsub.off("userActions:BlockPlayerConfirmAgain_"+this.model.get("RockstarId")),i.pubsub.off("userActions:BlockPlayer_"+this.model.get("RockstarId")),i.pubsub.off("gameFnFriends:UpdateFriendStatus_"+this.model.get("RockstarId")),i.pubsub.off("profile:SetGameButtonVisibility_"+this.model.get("RockstarId")),this.model.off(),this.$el.hide()},initialize:function(){n.bindAll(this,"render","acceptFriendInvite","declineFriendInvite","addFriend","cancelInvite","removeFriend","sendMessage","unblock","blockPlayerConfirm","blockPlayerConfirmAgain","blockPlayer","blockPlayerSuccess","removePlayerCard","updateFriendRelationship","onClose","showButtons","hideButtons","checkMultiplayerPresence","setGameButtonVisibility","renderGameButtons"),this.model.on("change",this.render),i.pubsub.on("userActions:BlockPlayerConfirmAgain_"+this.model.get("RockstarId"),this.blockPlayerConfirmAgain),i.pubsub.on("userActions:BlockPlayer_"+this.model.get("RockstarId"),this.blockPlayer),i.pubsub.on("gameFnFriends:UpdateFriendStatus_"+this.model.get("RockstarId"),this.updateFriendRelationship),i.pubsub.on("profile:SetGameButtonVisibility_"+this.model.get("RockstarId"),this.setGameButtonVisibility)}}),_}),define("hbs!common/templates/settings/linked_accounts_visibility",["hbs","common/hbs/handlebars","common/templates/helpers/ifequals"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(){return" selected"}function o(){return" last"}function s(e,t){var i,a,o,s="";return s+='\r\n        <a href="#" class="',a=n.ifequals||e&&e.ifequals,o={hash:{},inverse:f.noop,fn:f.program(1,r,t)},i=a?a.call(e,e&&e.visibility,"friendsandcrews",o):h.call(e,"ifequals",e&&e.visibility,"friendsandcrews",o),(i||0===i)&&(s+=i),s+='">\r\n            <input type="radio" name="',(a=n.settingName)?i=a.call(e,{hash:{}}):(a=e&&e.settingName,i=typeof a===p?a.call(e,{hash:{}}):a),s+=m(i)+'" value="FriendsAndCrews">\r\n            <span rel="localize[FriendsandCrew]">Friends & Crews</span>\r\n        </a>\r\n\r\n        <a href="#" class="last ',a=n.ifequals||e&&e.ifequals,o={hash:{},inverse:f.noop,fn:f.program(1,r,t)},i=a?a.call(e,e&&e.visibility,"everyone",o):h.call(e,"ifequals",e&&e.visibility,"everyone",o),(i||0===i)&&(s+=i),s+='">\r\n            <input type="radio" name="',(a=n.settingName)?i=a.call(e,{hash:{}}):(a=e&&e.settingName,i=typeof a===p?a.call(e,{hash:{}}):a),s+=m(i)+'" value="Everyone">\r\n            <span rel="localize[Everyone]">Everyone</span>\r\n        </a>\r\n        '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var l,c,u,d="",f=this,h=n.helperMissing,p="function",m=this.escapeExpression;return d+='<p class="clearfix">\r\n\r\n    <span class="accountIcon ',(c=n.icon)?l=c.call(t,{hash:{}}):(c=t&&t.icon,l=typeof c===p?c.call(t,{hash:{}}):c),d+=m(l)+'"></span>\r\n\r\n    <label class="mainLabel" for="',(c=n.settingId)?l=c.call(t,{hash:{}}):(c=t&&t.settingId,l=typeof c===p?c.call(t,{hash:{}}):c),d+=m(l)+'">',(c=n.label)?l=c.call(t,{hash:{}}):(c=t&&t.label,l=typeof c===p?c.call(t,{hash:{}}):c),(l||0===l)&&(d+=l),d+='</label>\r\n\r\n    <span id="',(c=n.settingName)?l=c.call(t,{hash:{}}):(c=t&&t.settingName,l=typeof c===p?c.call(t,{hash:{}}):c),d+=m(l)+'" class="toggleOptions ',(c=n.settingId)?l=c.call(t,{hash:{}}):(c=t&&t.settingId,l=typeof c===p?c.call(t,{hash:{}}):c),d+=m(l)+'" data-accountid="',(c=n.accountId)?l=c.call(t,{hash:{}}):(c=t&&t.accountId,l=typeof c===p?c.call(t,{hash:{}}):c),d+=m(l)+'">\r\n        <a href="#" class="first ',c=n.ifequals||t&&t.ifequals,u={hash:{},inverse:f.noop,fn:f.program(1,r,a)},l=c?c.call(t,t&&t.visibility,"none",u):h.call(t,"ifequals",t&&t.visibility,"none",u),(l||0===l)&&(d+=l),d+='">\r\n            <input type="radio" name="',(c=n.settingName)?l=c.call(t,{hash:{}}):(c=t&&t.settingName,l=typeof c===p?c.call(t,{hash:{}}):c),d+=m(l)+'" value="None">\r\n            <span rel="localize[MeOnly]">Me Only</span>\r\n        </a>\r\n\r\n        <a href="#" class="',c=n.ifequals||t&&t.ifequals,u={hash:{},inverse:f.noop,fn:f.program(1,r,a)},l=c?c.call(t,t&&t.visibility,"friends",u):h.call(t,"ifequals",t&&t.visibility,"friends",u),(l||0===l)&&(d+=l),d+=" ",c=n.ifequals||t&&t.ifequals,u={hash:{},inverse:f.noop,fn:f.program(3,o,a)},l=c?c.call(t,t&&t.minor,!0,u):h.call(t,"ifequals",t&&t.minor,!0,u),(l||0===l)&&(d+=l),d+='">\r\n            <input type="radio" name="',(c=n.settingName)?l=c.call(t,{hash:{}}):(c=t&&t.settingName,l=typeof c===p?c.call(t,{hash:{}}):c),d+=m(l)+'" value="Friends">\r\n            <span rel="localize[FriendsOnly]">Friends</span>\r\n        </a>\r\n\r\n        ',c=n.ifequals||t&&t.ifequals,u={hash:{},inverse:f.noop,fn:f.program(5,s,a)},l=c?c.call(t,t&&t.minor,!1,u):h.call(t,"ifequals",t&&t.minor,!1,u),(l||0===l)&&(d+=l),d+="\r\n    </span>\r\n</p>"});return n}),window.jQuery&&function(e){e.extend({xml2json:function(t,n){function i(t,o){if(!t)return null;{var s="",l=null,c=null;t.nodeType,a(t.localName||t.nodeName),t.text||t.nodeValue||""}t.childNodes&&t.childNodes.length>0&&e.each(t.childNodes,function(e,t){var n=t.nodeType,o=a(t.localName||t.nodeName),c=t.text||t.nodeValue||"";if(8!=n)if(3!=n&&4!=n&&o)l=l||{},l[o]?(l[o].length||(l[o]=r(l[o])),l[o]=r(l[o]),l[o][l[o].length]=i(t,!0),l[o].length=l[o].length):l[o]=i(t);else{if(c.match(/^\s+$/))return;s+=c.replace(/^\s+/,"").replace(/\s+$/,"")}}),t.attributes&&t.attributes.length>0&&(c={},l=l||{},e.each(t.attributes,function(e,t){var n=a(t.name),i=t.value;c[n]=i,l[n]?(l[cnn]=r(l[cnn]),l[n][l[n].length]=i,l[n].length=l[n].length):l[n]=i})),l&&(l=e.extend(""!=s?new String(s):{},l||{}),s=l.text?[l.text||""].concat([s]):s,s&&(l.text=s),s="");var u=l||s;return n&&(s&&(u={}),s=u.text||s||"",s&&(u.text=s),o||(u=r(u))),u}if(!t)return{};var a=function(e){return String(e||"").replace(/-/g,"_")},r=function(t){return e.isArray(t)||(t=[t]),t.length=t.length,t};if("string"==typeof t&&(t=e.text2xml(t)),t.nodeType){if(3==t.nodeType||4==t.nodeType)return t.nodeValue;var o=9==t.nodeType?t.documentElement:t,s=i(o,!0);return t=null,o=null,s}},text2xml:function(t){return e.parseXML(t)}})}(jQuery),define("xml2json",["jquery"],function(e){return function(){var t;return t||e.$}}(this)),function(e){var t;return t=function(e){return e=e.replace(/_/,"-").toLowerCase(),e.length>3&&(e=e.substring(0,3)+e.substring(3).toUpperCase()),e},e.defaultLanguage=t(navigator.language||navigator.userLanguage),e.localize=function(n,i){var a,r,o,s,l,c,u,d,f,h,p,m,g,v,b,C,S,y,w,_;return null==i&&(i={}),y=this,o={},r=i.fileExtension||"xml",w=function(){return"xml"===r},c=function(e,t,n){var a;switch(null==n&&(n=1),n){case 1:return o={},i.loadBase?(a=e+("."+r),s(a,e,t,n)):c(e,t,2);case 2:if(t.length>=2)return a=""+e+t+"."+r,s(a,e,t,n)}},s=function(t,n,a,r){var s,l,u;return null!=i.pathPrefix&&(t=""+i.pathPrefix+"/"+t),_=t,u=function(i,s,l,u){var d;return d=u===!0?i:w()?e.xml2json(i):i,e.extend(o,d),window.appendLocalizationCache(d,t),g(o),c(n,a,r+1)},l=function(){return i.fallback&&i.fallback!==a?c(n,i.fallback):void 0},s={url:t,dataType:i.fileExtension,async:!1,timeout:null!=i.timeout?i.timeout:3e3,success:u,error:l},"file:"===window.location.protocol&&(s.error=function(t){var n=w()?e.xml2json(t.responseText):t.responseText;return u(e.parseJSON(n||"null"))}),window.isLocalizationFileCached(t)?s.success(window.getLocalizationCache(),null,null,!0):e.ajax(s)},g=function(e){return null!=i.callback?i.callback(e,a):a(e)},a=function(t){return y.each(function(){var n,i,a;return n=e(this),i=n.data("localize"),i||(i=n.attr("rel").match(/localize\[(.*?)\]/)[1]),a=S(i,t),null!=a?u(n,i,a):void 0})},u=function(t,n,i){return t.is("input")||t.is("textarea")?p(t,n,i):t.is("img")?f(t,n,i):t.is("optgroup")?m(t,n,i):e.isPlainObject(i)||(h(t,n,i),t.html(i)),e.isPlainObject(i)?d(t,i):void 0},p=function(t,n,i){var a;return a=e.isPlainObject(i)?i.value:i,t.is("[placeholder]")?t.attr("placeholder",a):t.val(a)},d=function(e,t){return b(e,"title",t),C(e,"text",t)},m=function(e,t,n){return e.attr("label",n)},f=function(e,t,n){return b(e,"alt",n),b(e,"src",n)},h=function(e,t,n){return void 0==e.attr("title")?void 0:e.attr("title",n)},S=function(e,t){var n,i,a,r,o=null;for(n=e.split(/\./),i=t,a=0,r=n.length;r>a;a++)e=n[a],o=null!=i?i[e]:null,null==o&&(e=window.getLocalizationKey(n[a],_),o=i[e]);return o},b=function(e,t,n){return n=S(t,n),null!=n?e.attr(t,n):void 0},C=function(e,t,n){return n=S(t,n),null!=n?e.text(n):void 0},v=function(e){var t;return"string"==typeof e?"^"+e+"$":null!=e.length?function(){var n,i,a;for(a=[],n=0,i=e.length;i>n;n++)t=e[n],a.push(v(t));return a}().join("|"):e},l=t(i.language?i.language:e.defaultLanguage),i.skipLanguage&&l.match(v(i.skipLanguage))||c(n,l,1),y},e.fn.localize=e.localize,e.localize.data={}}(jQuery),define("jquery.localize",["jquery","xml2json"],function(e){return function(){var t;return t||e.$}}(this)),define("common/datafunctions.friends",["require","jquery","common/xhr","common/sdk","utils","common/baseUtils","setup.environment.utils","common/profile/profile-views","common/modals/modal-views","am","moment","hbs!common/templates/settings/linked_accounts_visibility","jquery.localize","common/jquery.visible"],function(e){function t(e,t,n){var i='{ "playerTicket":"'+t+'","env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"rockstarId":"'+n+'" }';return a.ajax({type:"POST",url:o.getApiUrl("/api/friend/getnickname"),services:["accounts"],headers:e,data:i,contentType:"application/json; charset=utf-8",dataType:"text",silentFail:!0,disableSlowMsg:!0,showSlowTimeout:!1})}function n(e,t){var n,a;switch(e.toLowerCase()){case"sc":a=d.action.settings_privacy_change_profile_visibility,n=i("#togglePrivacyProfile a.selected input").val();break;case"profile_location":a=d.action.settings_privacy_change_country_visibility,n=i("#togglePrivacyCountry a.selected input").val();break;case"gameplay_visibility":a=d.action.settings_privacy_change_stats_visibility,n=i("#togglePrivacyStats a.selected input").val();break;case"presencevisibility":a=d.action.settings_game_change_presence_visibility,n=i("#togglePresenceVisibility a.selected input").val();break;case"radioCloudSave":a=d.action.settings_game_change_cloud_save_enabled,n=i("#toggleCloudSave a.selected input").val();break;default:a=d.action.settings_privacy_change_platform_visibility,n=i("#"+e+" a.selected input").val()}var r={setting:e,oldValue:n,newValue:t};d.trackEvent(d.category.settings,a,r)}var i=e("jquery"),a=e("common/xhr"),r=e("common/sdk"),o=e("utils"),s=e("common/baseUtils"),l=e("setup.environment.utils"),c=e("common/profile/profile-views"),u=e("common/modals/modal-views"),d=e("am"),f=e("moment"),h=e("hbs!common/templates/settings/linked_accounts_visibility");e("jquery.localize"),e("common/jquery.visible");var p={},m=[];return p.getFriendsCache={},p.findPlayer=function(e,t,n){var i='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"searchNickname":"'+e+'","pageIndex":"'+t+'" }';o.WriteDebugLog("FindPlayer","options",i);var r=Promise.resolve(l.GetAuthHeaderAsync());return r.then(function(e){return a.ajax({type:"POST",url:o.getApiUrl("/api/friend/accountsearch"),services:["accounts"],headers:e,data:i,contentType:"application/json; charset=utf-8",dataType:"json",fatalError:n,requestDescription:"AccountSearch"})})},p.GetFriendsJS=function(e){o.WriteDebugLog("GetFriendsJS","options",JSON.stringify(e));var t=e;t.Players=[];var n={env:globals.rosEnvironment,title:globals.titleName,version:globals.RosTitleVersion,pageSize:e.PageSize,pageIndex:e.PageIndex,rockstarId:""},r=l.GetAuthHeaderAsync();r.done(function(e){a.ajax({type:"POST",url:o.getApiUrl("/api/friend/getfriendsandinvitessent"),services:["friends"],headers:e,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json",fatalError:u.ShowErrorModal,requestDescription:"GetFriends",success:function(e){if(l.TabIsActive(i("#friendsPanel .sideMenu #myFriendsLink"))){t.Players=e.RockstarAccountList.RockstarAccounts.map(function(e){var t=o.getOnlineTitle(e.IsOnline,e.OnlineGames);return{RockstarId:e.RockstarId,AvatarUrl:e.AvatarUrl,DisplayName:e.DisplayName,MutualFriends:e.MutualFriendCount,ViewerMutualFriendCount:e.MutualFriendCount,ViewerRelationship:p.GetRelationShipCode(e.Relationship),IsOnline:e.IsOnline,Game:e.IsOnline?e.OnlineGames[0].TitleName:null,Platform:e.IsOnline?e.OnlineGames[0].PlatformName:null,FriendlyGame:e.IsOnline?t.game:null,FriendlyPlatform:e.IsOnline?t.platform:null}}),t.Success=!0,t.Count=t.Players.length,t.Total=e.RockstarAccountList.Total;var n=JSON.stringify(t);s.pubsub.publish("friendFn.handlePlayerListResponse",n)}}})})},p.ClearGetFriendsCache=function(){p.getFriendsCache={}},p.getFriendCompare=function(e,t){o.WriteDebugLog("GetFriendCompare","","");var n='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"pageSize":"0","rockstarId":"" }';if(o.WriteDebugLog("GetFriendCompare","options",n),p.getFriendsCache[e]){var r=p.getFriendsCache[e];return Promise.resolve(r)}var s=Promise.resolve(l.GetAuthHeaderAsync());return s.then(function(e){return a.ajax({type:"POST",url:o.getApiUrl("/api/friend/getfriends"),services:["friends"],headers:e,data:n,contentType:"application/json; charset=utf-8",dataType:"json",fatalError:t,contentEl:i("#compareSelect"),requestDescription:"GetFriends"})})},p.getFriendInvites=function(e,t){o.WriteDebugLog("dataFnFriends.getFriendInvites","options",e);var n=Promise.resolve(l.GetAuthHeaderAsync());return n.then(function(n){return a.ajax({type:"POST",url:o.getApiUrl("/api/friend/getinvites"),services:["accounts","friends"],headers:n,data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",fatalError:t,requestDescription:"GetFriendInvites"})})},p.GetFriendAchievementsJS=function(e){o.WriteDebugLog("GetFriendAchievements","","");var t=l.getCredsAsync();t.done(function(t){if(t.Ticket){var n='{ "playerTicket":"'+t.Ticket+'","env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"friendRockstarId":"'+e+'" }';o.WriteDebugLog("GetFriendAchievements","options",n);var r=l.GetAuthHeaderAsync(t.Ticket);r.done(function(e){a.ajax({type:"POST",url:o.getApiUrl("/api/"+globals.titleName+"/getfriendachievements"),services:["gameachievements"],headers:e,data:n,contentType:"application/json; charset=utf-8",dataType:"xml",fatalError:u.ShowErrorModal,requestDescription:"GetFriendAchievements",success:function(e){o.WriteDebugLog("GetFriendAchievements","data",e),l.LoadGameAchievements(null,i(e).find("AchievementList"))},complete:function(e,t){o.ToggleCompareFriendElements(t),l.removeLoading("statsPanel"),l.hideStats()||(i("#statsLink2").removeClass("disabled"),i("#onlineStatsLink").removeClass("disabled"))}})})}})},p.closeCompareStats=function(){i("#compareSelect").animate({height:"0"},200,"easeInBack",function(){i("#compareSelect, #compareSelectContainer").hide()}).removeClass("open")},p.closeloadComparedStatsCompareStats=function(){l.setUpLoadingPanel("#statsPanel",function(){o.WriteDebugLog("loadComparedStats","",""),i("#statsPanel").addClass("compared"),i("#statsPanel").is(".stats")?i("#statsContent").show():i("#statsPanel").is(".achievements")&&i("#achievementsContent").show(),setTimeout(function(){i(".active .loadingMask").fadeOut(600,function(){o.stopSpinner(i(".active span.loading"))}),0==i("#statstable .col3").length&&(i("#statstable .statGroupHeader td").attr("colspan","3"),i("#statstable tr:not(.statGroupHeader)").each(function(){var e=i(this).find(".col2").html();i(this).append('<td class="col3">'+e+"</td>")})),0==i("#achievementstable .pointsFriend").length&&i("#achievementstable tr").each(function(){var e=i(this).find(".points").html();i(this).append('<td class="pointsFriend">'+e+"</td>")})},1e3)})},p.triggerMessageFriendSearch=function(e){void 0!=e&&"newMessageName"==e.attr("id")&&""!=e.val()&&e.autocomplete("search")},p.accountSearch=function(e,t,n,i,r){var s=l.GetAuthHeaderAsync();s.done(function(e){a.ajax({type:"POST",url:o.getApiUrl("/api/friend/accountsearch"),services:["accounts"],headers:e,dataType:"json",data:{searchNickname:n},fatalError:r,requestDescription:"AccountSearch",success:function(e){i(e,t)}})})},p.SendMessage=function(e,t,n,r){o.WriteDebugLog("SendMessage","","");var s='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"recipientRockstarId":"'+t+'","messageText":"'+n+'" }';o.WriteDebugLog("SendMessage","options",s);var c=l.GetAuthHeaderAsync();c.done(function(n){var c=i(r?".sendReply":".sendMessage");a.ajax({type:"POST",url:o.getApiUrl("/api/messaging/sendmessage"),services:["messaging"],headers:n,data:s,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,noRetryModal:!0,fatalError:u.ShowErrorModal,requestDescription:"SendMessage",success:function(e,t){if("success"==t){i(".newMessageEntry").val(""),i(".characterCount").text("250"),c.addClass("disabled"),i("#newMessageName").val(""),i("#friendsSearch #newMessageName").attr("data-rockstarId",""),r?d.trackEvent(d.category.message,d.action.message_reply):d.trackEvent(d.category.message,d.action.message_send);var n=i("#cancelMessage");n.hasClass("backFriendLink")?(n.removeClass("backFriendLink"),i("#cancelMessage, #newMessageInput").hide(),l.setUpLoadingPanel("#"+n.data("returnPanel"),function(){l.removeLoading(n.data("returnPanel"))})):r?(i("#messageThread").data("PageIndex",0),p.messagesThreadQuery()):(i("#menuMessages").click(),i("#cancelMessage, #newMessageInput").hide(),i("#newMessage").show())}},complete:function(n,a){e=null,t=null,"success"!==a&&c.removeClass("disabled"),i("#cancelMessage").removeClass("disabled")}})})},p.SendFriendAcceptInvite=function(e){o.WriteDebugLog("SendFriendAcceptInvite","playerRockstarId",e);var t='{ "RequestId":'+e+', "RockstarId":"'+e+'", "Success":true }';l.CallGameMethod("RGSC_FRIEND_ACCEPT_INVITE",t,"RGSC_JS_FRIEND_ACCEPT_INVITE_RESULT"),p.ClearFriendsCache(e),d.trackEvent(d.category.friend,d.action.friend_invite_accept)},p.getNicknameAsync=function(e){var n=new i.Deferred;if("undefined"==typeof e||!e.length)return n.reject({responseText:""},"error","rockstarId is undefined or empty"),n.promise();var a=m[e];if(void 0!=a&&a.length)return n.resolve(a),n.promise();var r=l.getCredsAsync();return r.done(function(i){if(i.Ticket){var a=l.GetAuthHeaderAsync(i.Ticket);a.done(function(a){var r=t(a,i.Ticket,e);r.done(function(t){m[e]=t,n.resolve(t)}),r.fail(n.reject)})}}),n.promise()},p.ClearFriendsCache=function(e){var t='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"friendRockstarId":'+e+" }",n=l.GetAuthHeaderAsync();n.done(function(e){a.ajax({type:"POST",url:o.getApiUrl("/api/friend/clearfriendscache"),services:["friends"],headers:e,data:t,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,silentFail:!0,disableSlowMsg:!0,success:function(){o.WriteDebugLog("ClearFriendsCache","Success","")},error:function(e,t,n){o.WriteDebugLog("ClearFriendsCache","ERROR",n),o.WriteDebugLog("ClearFriendsCache","ERROR status",t),o.WriteDebugLog("ClearFriendsCache","ERROR responseText",e.responseText,o.logType.error,o.logController.friend)}})}),p.ClearGetFriendsCache()},p.SendFriendDeclineInvite=function(e){o.WriteDebugLog("SendFriendDeclineInvite","playerRockstarId",e);var t='{ "RequestId":'+e+', "RockstarId":"'+e+'"}';l.CallGameMethod("RGSC_FRIEND_DECLINE_INVITE",t,"RGSC_JS_FRIEND_DECLINE_INVITE_RESULT"),p.ClearFriendsCache(e),d.trackEvent(d.category.friend,d.action.friend_invite_decline)},p.SendFriendRemove=function(e){o.WriteDebugLog("SendFriendRemove","playerRockstarId",e);var t='{ "RequestId":'+e+', "RockstarId":"'+e+'"}';l.CallGameMethod("RGSC_FRIEND_DELETE_FRIEND",t,"RGSC_JS_FRIEND_DELETE_FRIEND_RESULT"),p.ClearFriendsCache(e),d.trackEvent(d.category.friend,d.action.friend_delete)},p.SendInviteCancel=function(e){o.WriteDebugLog("SendInviteCancel","playerRockstarId",e);var t='{ "RequestId":'+e+', "RockstarId":"'+e+'"}';l.CallGameMethod("RGSC_FRIEND_CANCEL_INVITE",t,"RGSC_JS_FRIEND_CANCEL_INVITE_RESULT"),p.ClearFriendsCache(e),d.trackEvent(d.category.friend,d.action.friend_cancel_invite)},p.SendGameInvite=function(e){o.WriteDebugLog("SendGameInvite","playerRockstarId",e);var t='{ "RequestId":'+globals.account.RockstarId+', "RockstarId":"'+e+'"}';l.CallGameMethod("RGSC_GAME_INVITE_SEND",t,"RGSC_JS_GAME_INVITE_SEND_RESULT")},p.SendJoinGame=function(e){o.WriteDebugLog("SendJoinGame","playerRockstarId",e);var t='{ "RockstarId":"'+e+'"}';l.CallGameMethod("RGSC_JOIN_VIA_PRESENCE",t,"RGSC_JS_JOIN_VIA_PRESENCE_RESULT")},p.SendDeclineGameInvite=function(e){o.WriteDebugLog("DeclineGameInvite","messageId",e),l.CallGameMethod("RGSC_GAME_INVITE_DECLINED",'{ "GameInviteId" : '+e.replace("gameInviteId","")+" }",null),d.trackEvent(d.category.game,d.action.game_invite_decline),i("#"+e).fadeOut(function(){i(this).remove(),i("#friendsContainer").data("antiscroll").refresh(),i("#gameInvitesHeader span.purple").html(i("#gameInvitesList div.profileButton").length)})},p.SendAcceptGameInvite=function(e){o.WriteDebugLog("SendAcceptGameInvite","messageId",e),l.CallGameMethod("RGSC_GAME_INVITE_ACCEPTED",'{ "GameInviteId" : '+e.replace("gameInviteId","")+" }",null),d.trackEvent(d.category.game,d.action.game_invite_accept),i("#"+e).fadeOut(function(){i(this).remove(),i("#friendsContainer").data("antiscroll").refresh(),i("#gameInvitesHeader span.purple").html(i("#gameInvitesList div.profileButton").length)})},p.SendFriendRequest=function(e){o.WriteDebugLog("SendFriendRequest","playerRockstarId",e);var t='{ "RequestId":'+e+', "RockstarId":"'+e+'"}';l.CallGameMethod("RGSC_FRIEND_SEND_INVITE",t,"RGSC_JS_FRIEND_SEND_INVITE_RESULT"),p.ClearFriendsCache(e),d.trackEvent(d.category.friend,d.action.friend_invite_send)},p.SendFriendUnblock=function(e){o.WriteDebugLog("SendFriendUnblock","playerRockstarId",e);var t='{ "RequestId":'+e+', "RockstarId":"'+e+'"}';l.CallGameMethod("RGSC_FRIEND_UNBLOCK_PLAYER",t,"RGSC_JS_FRIEND_UNBLOCK_PLAYER_RESULT"),d.trackEvent(d.category.settings,d.action.settings_block_list_unblock)},p.UpdateSetting=function(e,t,a,s){var l=s.parent().find(".privacyChangeAlert");l.addClass("scicon-tick").fadeIn(),n(e,t);var c,u;e.indexOf("Cloud")>-1?(c=Promise.resolve(r.updateCloudSavesEnabledSetting("enabled"===t)),u=!0):(c=p.UpdatePrivacySetting({setting:e,value:t,accountId:a}),u=!1),c.then(function(e){if(u)t="true";else{if("undefined"==typeof e)return;var t=i(e).find("Status").text()}"true"===t&&(s.parent().children("a").removeClass("selected"),s.addClass("selected")),i("#checkName").fadeOut()}).catch(function(){o.WriteDebugLog("UpdatePrivacySetting","Error")}).then(function(){s.removeData("updating"),l.fadeOut("slow",function(){l.removeClass("confirm"),l=null,s=null})})},p.UpdatePrivacySetting=function(e){o.WriteDebugLog("UpdatePrivacySetting","setting=value",e.setting+"="+e.value);var t=Promise.resolve(l.GetAuthHeaderAsync());return t.then(function(t){var n='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"wsURL":"'+globals.wsURL+'","settingsNameValueCSV":"'+e.setting+"="+e.value+'","accountId":"'+e.accountId+'" }';return a.ajax({type:"POST",url:o.getApiUrl("/api/privacy/updateprivacysettings"),services:["accounts"],headers:t,data:n,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,fatalError:u.ShowErrorModal,requestDescription:"UpdatePrivacySettings"})})},p.GetMessageCountJS=function(e){if(null!=e&&0!=e){var t='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"rockstarId":"'+e+'" }';o.WriteDebugLog("GetMessageCountJS","options",t);var n=l.GetAuthHeaderAsync();n.done(function(e){a.ajax({type:"POST",url:o.getApiUrl("/api/messaging/getmessagecount"),services:["messaging"],headers:e,data:t,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,silentFail:!0,success:function(e,t){if("success"==t){var n=i(e).find("Unread").text();o.WriteDebugLog("GetMessageCountJS","unreadMessageCount",n),i("#menuMessages span.count").html("0"==n?"":n+" "+l.getText("New","Social"))}i("#checkName").fadeOut()}})})}},p.GetMessages=function(e){o.WriteDebugLog("GetMessages","","");var t='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"rockstarId":"'+globals.account.RockstarId+'","pageIndex":'+e+"}";o.WriteDebugLog("GetMessages","options",t);var n=l.GetAuthHeaderAsync();n.done(function(e){a.ajax({type:"POST",url:o.getApiUrl("/api/messaging/getmessagesenderlist"),services:["messaging"],headers:e,data:t,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,fatalError:u.ShowErrorModal,requestDescription:"GetMessageSenderList",success:function(e,t){"success"==t&&(i("#messagesList").data("total",i(e).find("UserList").attr("TotalUserCount")),p.ProcessMessageSenderList(e)),i("#checkName").fadeOut()},complete:function(){i("#messagesPanel").find("div.content").removeAttr("style")}})})},p.ProcessMessageSenderList=function(e){var t="",n=0,a=0,r=l.getText("New","Social"),s=(l.getText("Read","Social"),"en-US"==globals.titlelang?'<a class="ribbon-EN">NEW</a>':'<a class="ribbon">NEW</a>',0);i(e).find("MessageUser").each(function(e){o.WriteDebugLog("GetMessages","Message i",e);var l=i(this);p="";var c=e,u=l.find("ScNickname").text(),d=l.find("Messages").attr("LastReceivedOn");f.lang(globals.titlelang);var h=f.utc(d).local().fromNow(),p=null,m="",g=o.getLastStringSegment(l.find("AvatarUrl").text(),"/",2);g=o.getAvatarUrl(g,u);var v=l.find("RockstarId").text(),b=parseInt(l.find("Messages").attr("Total"),10),C=parseInt(l.find("Messages").attr("Unread"),10);if(n+=b,a+=C,C>0&&(p="new"),0==e){var S=i("#messageThread");S.data("data-id",v),S.data("data-avatar",g),S.data("data-nickname",u)}t+='<div tabindex="'+s+'" id="messageId'+c+'" class="message load_messages profileButton '+p+'" data-nickname="'+u+'" data-avatar="'+g+'" data-id="'+v+'">',p&&(t+='<span class="ribbon">NEW</span>',m='<span class="unreadCount purple"> *'+a+" "+r+"*</span>"),t+='<img width="32" height="32" class="avatarImg" alt="'+v+'" src="'+g+'"><div class="text"><h5 class="profilenickname">'+u+'</h5></div><div class="footer"><span class="received">'+h+"</span></div></div>"
});var c=i("#messagesList .box .antiscroll-inner");""==t?c.empty().append('<div class="emptyContainer"><p>'+l.getText("NoMessages","Social")+"</p></div>"):(c.find("#loadMore").remove(),c.append(t)),n>0&&0==i("#messagesList").data("PageIndex")&&p.messagesThreadQuery(),i("#messageCount").html(n),i("#unreadMessageCount").html(a),0==a&&(a=""),i("#messagesLink").find("span.count").html(a),c.find(".avatarImg").on("error",o.avatar404),e=null,t=null,n=null,a=null,r=null,l.removeLoading("messagesPanel"),i("#messagesList").data("antiscroll").refresh();var u="<div tabindex='0' id='loadMore'>"+l.getText("LoadOlderThreads","Social","Load older threads")+"</div>";void 0!=i("#messagesList").data("total")&&i("#messagesList .message").length<i("#messagesList").data("total")-1&&i("#messagesList .box .antiscroll-inner").append(u),c.find("#loadMore").unbind("click").bind("click",function(){if(void 0===i("#messagesList").data("total")||i("#messagesList .box .antiscroll-inner .message").length<i("#messagesList").data("total")){var e=parseInt(i("#messagesList").data("PageIndex"),10);i("#messagesList").data("PageIndex",++e),l.messagesListQuery()}}),c.find("#loadMore").unbind("keyup").bind("keyup",function(e){var t=i(e.currentTarget);13==e.which&&t.visible()&&i(this).click()}),c.find(".load_messages").unbind("click").bind("click",function(e){e.preventDefault();var t=i(this);if(t.is(".active"))return!1;i("#replyMessageInput").hide();var n=i("#messageThreadList");n.empty();var a=i("#messageThread");a.data("data-id",i(this).attr("data-id")),a.data("data-avatar",i(this).attr("data-avatar")),a.data("data-nickname",i(this).attr("data-nickname")),a.data("PageIndex",0),p.messagesThreadQuery()}),c.find(".load_messages").unbind("keyup").bind("keyup",function(e){var t=i(e.currentTarget);13==e.which&&t.visible()&&i(this).click()})},p.messagesThreadQuery=function(){o.WriteDebugLog("messagesThreadQuery","","");var e=i("#messageThread"),t=e.data("data-id"),n=e.data("data-avatar"),a=e.data("data-nickname"),r=e.data("PageIndex");void 0===r&&(r=0,e.data("PageIndex",r)),0==r&&i("#messageThreadList").empty(),l.setUpLoadingPanel("#messagesPanel"),p.GetMessageThread(t,n,a,r)},p.GetMessageThread=function(e,t,n,r){o.WriteDebugLog("GetMessageThread","friendRockstarId, friendRockstarUrl, friendRockstarNick, pageIndex",e+","+t+","+n,0/0+r);var s='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"senderRockstarId":"'+e+'","pageIndex":'+r+"}";o.WriteDebugLog("GetMessageThread","options",s);var c=l.GetAuthHeaderAsync();c.done(function(r){a.ajax({type:"POST",url:o.getApiUrl("/api/messaging/getmessages"),services:["messaging"],headers:r,data:s,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,fatalError:u.ShowErrorModal,requestDescription:"GetMessages",success:function(a,r){if("success"==r){var o=parseInt(i(a).find("Messages").attr("Total"),10);i("#messageThread").data("total",o),p.ProcessMessageThread(e,t,n,a)}i("#checkName").fadeOut()},complete:function(){e=null,t=null,n=null,l.removeLoading("messagesPanel")}})})},p.ProcessMessageThread=function(e,t,n,a){o.WriteDebugLog("ProcessMessageThread","friendRockstarId, friendRockstarUrl, friendRockstarNick",e+","+t+","+n),i(".load_messages").removeClass("active");var r=i("#messageThread"),c=i("div").find("[data-nickname='"+r.data("data-nickname")+"']");c.addClass("active"),i("#MessageThreadHeader .profilenickname").text(n),i("#MessageThreadHeader .reply, #MessageThreadHeader .backFriendLink").attr({"data-id":e,"data-avatar":t,"data-nickname":n});var u=i("#messagesPanel");i("#newMessageInput").is(":visible")||u.attr("class","panel active messageThread"),i("#messagesPanel div.content").removeAttr("style"),o.WriteDebugLog("GetMessageThread","data",i(a).find("Message").text());var d=n,h=t,m=i("#imgEditSelectedAvatar").attr("src");i("#messagesPanel .help-block").text("");var g=u.find("#messageThreadList"),v="",b=[],C=l.getText("Confirm","Social");g.find("#loadMoreMessages").remove(),i(a).find("Message").each(function(){var t;try{t=i.trim(o.jhtmlEncode(decodeURIComponent(i(this).find("Text").text())))}catch(n){t=i.trim(o.jhtmlEncode(i(this).find("Text").text()))}0==t.length&&(t="&nbsp;");var a=i(this).find("CreatedOn").text(),r=f.utc(a).local().fromNow(),s=f.utc(a).local().format("LLL"),l="",c=i(this).find("AuthorId").text(),u=i(this).find("ID").text(),p="TRUE"==i(this).find("Read").text().toUpperCase();p||(l="new"),c==e?(v+='<div id="messageId'+u+'" class="message msgFrom '+l+'">',p||(v+='<a class="ribbon">NEW</a>',b.push(u)),v+='<img width="64" height="64" class="avatarImg" alt="'+d+'" src="'+h+'"><div class="messageContent"><div class="messageBody">'+t+'</div><span class="timestamp" title="'+s+'">'+r+'</span><a class="icon-cross icon-30pct delete" title="'+C+'">'+C+'</a></div><span class="arrow"></span></div>'):(v+='<div id="messageId'+u+'" class="message msgTo '+l+'">',p||(v+='<a class="ribbon">NEW</a>'),v+='<img width="64" height="64" class="avatarImg" alt="'+d+'" src="'+m+'"><div class="messageContent"><div class="messageBody">'+t+'</div><span class="timestamp" title="'+s+'">'+r+'</span><a class="icon-cross icon-30pct delete" title="'+C+'">'+C+'</a></div><span class="arrow"></span></div>')}),g.append(v),g.find(".avatarImg").on("error",o.avatar404),v=null;var S="<div id='loadMoreMessages' class='btn btnGrey'>"+l.getText("LoadOlderMessages","Social","Load older messages")+"</div>";(void 0===i("#messageThread").data("total")||g.find(".message").length<i("#messageThread").data("total"))&&g.append(S),g.find("#loadMoreMessages").click(function(){if(void 0===i("#messageThread").data("total")||g.find(".message").length<i("#messageThread").data("total")){var e=parseInt(i("#messageThread").data("PageIndex"),10);i("#messageThread").data("PageIndex",++e),p.messagesThreadQuery()}}),i("#replyMessageInput #replyToNickname").html(d),i("#replyMessageInput #replyToNickname").attr("data-rockstarId",e),i("#replyMessageInput textarea").val(""),i("#replyMessageInput span.characterCount").text("0"),i("#replyMessageInput").show(),i("#newReplyEntry").show(),s.inGamePadMode()||i("#newReplyEntry").focus(),b.length>0&&p.MarkMessagesReadJS(b.join(",")),b=null,C=null,g.find("a.delete").unbind("click").bind("click",function(){return p.DeleteMessageConfirm(i(this).parents(".message").attr("id")),!1}),l.resetScrollbar("#messageThread"),i("#newMessage").show(),globals.MessagesLoading=!1},p.MarkMessagesReadJS=function(e){var t='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"messageIdCsv":"'+e+'" }';o.WriteDebugLog("MarkMessagesReadJS","options",t);var n=l.GetAuthHeaderAsync();n.done(function(e){a.ajax({type:"POST",url:o.getApiUrl("/api/messaging/markmessagesread"),services:["messaging"],headers:e,data:t,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,silentFail:!0,success:function(e,t){"success"==t&&("true"!=i(e).find("Status").text()?o.WriteDebugLog("MarkMessagesReadJS","Status error",i(e).find("Error").attr("ErrorMessage")):p.GetMessageCountJS(globals.account.RockstarId))},error:function(e,t,n){o.WriteDebugLog("MarkMessagesReadJS","ERROR",n),o.WriteDebugLog("MarkMessagesReadJS","ERROR status",t),o.WriteDebugLog("MarkMessagesReadJS","ERROR responseText",e.responseText,o.logType.error,o.logController.messaging)}})})},p.GetGameInvites=function(){o.WriteDebugLog("GetGameInvites","","");var e="",t=l.CallGameMethodAsync("RGSC_GET_GAME_INVITE_LIST",null,"RGSC_GET_GAME_INVITE_LIST_DEMO");t.done(function(t){if(o.WriteDebugLog("GetGameInvites","gameInviteList",t),t&&t.Count>0){var n=l.getText("Decline","Social"),i=l.getText("Accept","Social");e=t.GameInvites.reduce(function(e,t){var a=t.Nickname,r=o.getAvatarUrl(t.AvatarUrl,a),s=t.Salutation,l=f.unix(t.ReceivedTime.toString()).local().format("llll"),c="",u=e+'<div id="gameInviteId'+t.GameInviteId+'" class="message profileButton '+c+'" data-id="'+t.RockstarId+'">';return u+'<img width="64" height="64" class="avatarImg optionProfile" alt="" src="'+r+'"><div class="text"><h5><a href="#" class="profilenickname optionProfile">'+a+'</a></h5><div class="messageText">'+s+'</div></div><div class="footer"><span class="received">'+l+'</span></div><div class="buttons"><a class="option Decline btn btnLightGrey btnRounded" href="#">'+n+'</a><a class="option Accept btn btnPurple btnRounded" href="#">'+i+"</a></div></div>"},""),n=null,i=null}}),t.always(function(){i("#friendsPanel").find("div.content").removeAttr("style"),i("#gameInvitesList").empty().append(e).find("a.Decline").click(function(){p.SendDeclineGameInvite(i(this).closest("div.profileButton").attr("id"))}).end().find("a.Accept").click(function(){p.SendAcceptGameInvite(i(this).closest("div.profileButton").attr("id"))}).end().find(".optionProfile").click(function(){return i("#friendProfilePanel .content").hide(),p.friendProfileView(i(this).closest("div.profileButton").attr("data-id")),!1}),i("#gameInvitesList").find(".avatarImg").on("error",o.avatar404);var t=i("#gameInvitesList div.profileButton").length;i("#gameInvitesHeader span.purple").html(t),0==t&&(t=""),i("#gameInvitesLink .count").html(t),l.removeLoading("friendsPanel"),l.resetScrollbar("#friendsPanel")})},p.DeleteMessageConfirm=function(e){var t=i("#"+e+" .messageContent"),n=t.html(),a=l.getText("DeleteConfirm","Social","Are you sure you want to delete this message?"),r=l.getText("ConfirmButtonText","Social"),o=l.getText("Cancel","HomeSignin");t.addClass("deleteConfirm"),t.html("<span>"+a+'</span><a class="btn btnRed btnRounded confirm">'+r+'</a><a class="btn btnGrey btnRounded cancel">'+o+"</a>"),t.find("a.cancel").unbind("click").bind("click",function(){t.html(n),t.removeClass("deleteConfirm"),t.find("a.delete").unbind("click").bind("click",function(){return p.DeleteMessageConfirm(e),!1})}),t.find("a.confirm").unbind("click").bind("click",function(){p.DeleteMessage(e),t.removeClass("deleteConfirm");var n=l.getText("DeletingMessage","Social","Please wait...deleting message");t.html(n)})},p.DeleteMessage=function(e){o.WriteDebugLog("DeleteMessage","messageId",e);var t='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"messageId":"'+e.replace("messageId","")+'" }';o.WriteDebugLog("DeleteMessage","options",t);var n=l.GetAuthHeaderAsync();n.done(function(n){a.ajax({type:"POST",url:o.getApiUrl("/api/messaging/deletemessage"),services:["messaging"],headers:n,data:t,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,fatalError:u.ShowErrorModal,requestDescription:"DeleteMessage",success:function(t,n){"success"==n&&(d.trackEvent(d.category.message,d.action.message_delete),i("#"+e).fadeOut(function(){if(i(this).remove(),i("#messageThread").data("antiscroll").refresh(),""==i("#messageThreadList").html()){i("#messageThreadList").append('<div class="emptyContainer"><p>'+l.getText("NoMessages","Social")+"</p></div>"),i("#replyMessageInput").hide();var e=i("#messagesList .box .antiscroll-inner"),t=i("#replyToNickname").attr("data-rockstarid"),n=e.find("[data-id='"+t+"']");n.remove();var a=e.children(":first");if(a.length){var r=i("#messageThread");r.data("data-id",a.attr("data-id")),r.data("data-avatar",a.attr("data-avatar")),r.data("data-nickname",a.attr("data-nickname")),r.data("PageIndex",0),p.messagesThreadQuery()}}})),i("#checkName").fadeOut()},complete:function(){e=null}})})},p.HideStatusBarConfirm=function(e){var t=i(e);if(t.length){var n=t.closest(".statusbar");n.find("div").animate({"margin-top":"-200px"},200,"easeInQuart",function(){n.css({top:"-100%"}),u.hideModal()})}else i("div.statusbar").css("bottom",""),u.hideModal()},p.friendProfileView=function(e){o.WriteDebugLog("friendProfileView","rockstarId",e),l.clearActivePanel(function(){l.setUpLoadingPanel("#friendProfilePanel");var t=l.GetAuthHeaderAsync();t.done(function(t){a.ajax({type:"POST",url:o.getApiUrl("/api/friend/getprofile"),services:["accounts","friends","crews"],headers:t,data:JSON.stringify({RockstarId:e}),contentType:"application/json; charset=utf-8",dataType:"json",cache:!1,requestDescription:"GetFriendProfile",success:function(e,t){"success"==t&&(e.Accounts[0].RockstarAccount.ViewerRelationship=e.Accounts[0].RockstarAccount.Relationship,void 0===window.amd.profileView?window.amd.profileView=new c.ProfileView({profileData:e.Accounts[0]}):window.amd.profileView.reinitialize({profileData:e.Accounts[0]}),d.trackPage("/FriendProfile"))}})})})},p.friendProfileViewByRockstarId=function(e){p.friendProfileView(e,"","")},p.GetMutualFriendsCount=function(e,t){o.WriteDebugLog("GetMutualFriendsCount","otherRockstarId",t);var n=0,r=l.getCredsAsync();r.done(function(e){if(e.Ticket){var r='{ "playerTicket":"'+e.Ticket+'","env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"otherRockstarId":"'+t+'","pageIndex":"0" }',s=l.GetAuthHeaderAsync(e.Ticket);s.done(function(e){a.ajax({type:"POST",url:o.getApiUrl("/api/friend/getmutualfriends"),services:["accounts","friends"],headers:e,data:r,contentType:"application/json; charset=utf-8",dataType:"xml",silentFail:!0,success:function(e){var t=i(e);n=t.find("Result").attr("Total"),i("#friendProfileBody .friends h5").find("span.mutualCount").html(n),o.WriteDebugLog("GetMutualFriendsCount","mutualFriendCount",n),t=null,e=null},error:function(e,t,n){o.WriteDebugLog("GetMutualFriendsCount","ERROR",n),o.WriteDebugLog("GetMutualFriendsCount","ERROR status",t),o.WriteDebugLog("GetMutualFriendsCount","ERROR responseText",e.responseText,o.logType.error,o.logController.friend),i("#friendProfileBody .friends h5").find("span.mutualCount").html(0)}})})}})},p.getMyAccountInfo=function(e){o.WriteDebugLog("getMyAccountInfo","nickname",e);var t,n,i='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"nickname":"'+e+'" }';return o.isLegacyServiceLayer()?(t="/api/profile/GetAccountInfoLan",n=Promise.resolve(l.GetAuthHeaderAsyncV8())):(t="/api/profile/getuseraccountinfo",n=Promise.resolve(l.GetAuthHeaderAsync())),n.then(function(e){return o.isLegacyServiceLayer()&&(e=l.appendLanAuthHeader(e)),a.ajax({type:"POST",url:o.getApiUrl(t),headers:e,data:i,contentType:"application/json; charset=utf-8",dataType:"xml",requestDescription:"GetUserAccountInfo"})})},p.GetUserPrivacyInfo=function(e,t,n){o.WriteDebugLog("GetUserPrivacyInfo","rockstarId",e);var r=i(i("#privacySettings").is(":visible")?"#privacySettings":"#gameSettings"),s='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"rockstarId":"'+e+'","email":"'+t+'","nickname":"'+n+'" }',c=Promise.resolve(l.GetAuthHeaderAsync());return c.then(function(e){return a.ajax({type:"POST",url:o.getApiUrl("/api/profile/getuseraccountinfo"),services:["accounts"],headers:e,data:s,contentType:"application/json; charset=utf-8",dataType:"json",fatalError:p.GetUserPrivacyInfoError,requestDescription:"GetUserAccountInfo",contentEl:r})})},p.GetUserPrivacyInfoError=function(e){e.contentEl.hide(),u.ShowErrorModal(e)},p.LoadUserNetworksProfile=function(e){var t=i(e),n=t.find("OnlineServiceName"),a="",r=i("#friendProfileBody");o.WriteDebugLog("LoadUserNetworksProfile","networkAccounts.length",n.length),n.length>0?t.find("PlayerAccount").each(function(){var e=i(this).find("OnlineServiceName").text();switch(e){case"facebook":a+='<span class="tooltip platform FB" title="Facebook"><span>Facebook</span></span>';break;case"np":a+='<span class="tooltip platform PS3" title="Playstation 3"><span>Playstation 3</span></span>';break;case"sc":a+='<span class="tooltip platform RSC" title="Rockstar Games Social Club"><span>Rockstar Games Social Club</span></span>';break;case"twitter":a+='<span class="tooltip platform TWIT" title="Twitter"><span>Twitter</span></span>';break;case"xbl":a+='<span class="tooltip platform XBOX" title="XBOX 360 LIVE"><span>XBOX 360 LIVE</span></span>';break;case"legacycds":a+='<span class="tooltip platform DS" title="Nintendo DS"><span>Nintendo DS</span></span>'}}):r.find(".accountList").html(""),r.find(".accountList").html(a),r.find(".accountCount").html(r.find(".accountList").children().length),a=null,t=null,e=null},p.LoadUserNetworksPrivacy=function(e){var t=i(e),n=t.find("OnlineServiceName"),a="";o.WriteDebugLog("LoadUserNetworksPrivacy","networkAccounts.length",n.length),n.length>0&&(t.find("PlayerAccount").each(function(){var e=i(this).find("OnlineServiceName").text(),t="",n="";if("facebook"==e?(t="Facebook",n="FB"):"np"==e?(t="PlayStation&reg; Network",n="PSN"):"sc"==e?(t="Social Club",n="SC"):"twitter"==e?(t="Twitter",n="TWIT"):"xbl"==e?(t="Xbox Live&reg;",n="XBOX"):"google"==e?(t="Google",n="google"):"steam"==e?(t="Steam",n="steam"):"legacygfwl"==e&&(t="Games for Windows LIVE",n="GFWL"),""!=t){var r={icon:n,accountId:i(this).find("AccountId").text(),visibility:i(this).find("Visibility").text().toLowerCase(),minor:globals.account.Minor,settingId:"PlatformVisibility",settingName:"PlatformVisibility"+e,label:t};a+=o.renderCompiledTemplate(h,r)}}),l.resetScrollbar("#editProfile"));var r=i("#linkedAccountOptions");""!=a?(r.html(a).closest("fieldset").show(),r.find(".toggleOptions a").click(function(e){e&&e.preventDefault();var t=i(this);return t.is(".selected")?!1:(p.UpdateSetting(t.find("input:radio").attr("name"),t.find("input:radio").val(),t.closest("span.toggleOptions").attr("data-accountId"),t),!1)}),r.find("[rel*=localize]").localize("Settings",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"})):r.html("").closest("fieldset").hide(),a=null,t=null,e=null;var s=150;i("#privacySettingsForm .toggleOptions a").each(function(){i(this).attr("tabindex",s),s++})},p.GetDescriptiveGameTitle=function(e){var t="";switch(e){case 1:t="Grand Theft Auto IV";break;case 2:t="Midnight Club Los Angeles";break;case 3:t="Grand Theft Auto: The Lost and Damned";break;case 4:t="Grand Theft Auto: The Ballad of Gay Tony";break;case 6:t="Grand Theft Auto: Chinatown Wars";break;case 7:t="Beaterator";break;case 8:t="Red Dead Redemption";break;case 9:t="L.A. Noire";break;case 10:t="Max Payne 3";break;case 11:t="Grand Theft Auto V";break;case 12:t="Max Payne";break;default:t=""}return t},p.GetShortGameTitle=function(e){var t="";switch(e){case 1:t="GTAIV";break;case 2:t="MCLA";break;case 3:t="GTAIV_TLAD";break;case 4:t="GTAIV_BOGT";break;case 6:t="CW";break;case 7:t="Beaterator";break;case 8:t="RDR";break;case 9:t="LAN";break;case 10:t="MP3";break;case 11:t="GTAV";break;case 12:t="MP1";break;default:t=""}return t},p.GetGameBoxImageName=function(e){var t="";switch(e){case 1:t="gtaiv.png";break;case 2:t="mcla.png";break;case 3:t="gtaiv_tlad.png";break;case 4:t="gtaiv_bogt.png";break;case 6:t="cw.png";break;case 7:t="beaterator.png";break;case 8:t="rdr.png";break;case 9:t="lan.png";break;case 10:t="mp3.png";break;case 11:t="gtav.png";break;case 12:t="mp1.png";break;default:t="default.png"}return t},p.GetRelationShipCode=function(e){switch(e){case"Friend":return 32;case"BlockedByMe":return 2;case"BlockedByBoth":return 8;case"InvitedByMe":return 8;case"InvitedByThem":return 16;default:return 1}},p.RenderFriendsListPresence=function(e){var t=i("#landingFriendsList");i(e.Players).each(function(){var e=this.RockstarId,n=t.find('a[data-id="'+e+'"]'),i=n.closest("li");(this.CanSendGameInvite||this.CanJoinGame)&&n.find(".arrow").show(),this.CanSendGameInvite&&i.find(".optionGameInvite").show(),this.CanJoinGame&&i.find(".optionJoingame").show()})},p.RedirectToBlockList=function(e){var t=l.getText("MessageBlocked1","Social").format(e),n=l.getText("MessageBlocked2","Social"),i=l.getText("SendMessageTitle","Social");u.ShowConfirmModal(t,null,"settingsFn.showBlockList",null,"Yes","No",i,n)},p.GetAccountActivity=function(e){if(null!=e&&0!=e&&!l.isOffline()){var t='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"rockstarId":"'+e+'" }';o.WriteDebugLog("GetAccountActivity","options",t);var n=l.GetAuthHeaderAsync();n.done(function(e){a.ajax({type:"POST",url:o.getApiUrl("/api/friend/getaccountactivity"),services:["accounts"],headers:e,data:t,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,silentFail:!0,success:function(e,t){if("success"==t){o.WriteDebugLog("GetAccountActivity","data",e);var n=i(e).find("UnreadMessageCount").text(),a=i(e).find("CrewInviteCount").text();o.WriteDebugLog("GetAccountActivity","unreadMessageCount, crewInviteCount",n+", "+a);var r=i("#menuMessages");r.find("span.count").html("0"==n?"":n+" "+l.getText("New","Social")),i("#crewInvitesLink span.count").html("0"==a?"":a),r.attr("countRetrieved",!0)}i("#checkName").fadeOut()}})})}},o.pubsub.on("datafnfriends:friendProfileView",p.friendProfileView),o.pubsub.on("datafnfriends:SendFriendAccept",p.SendFriendAcceptInvite),o.pubsub.on("datafnfriends:SendFriendDeclineInvite",p.SendFriendDeclineInvite),o.pubsub.on("datafnfriends:SendFriendRemove",p.SendFriendRemove),o.pubsub.on("datafnfriends:SendFriendRequest",p.SendFriendRequest),o.pubsub.on("datafnfriends:SendInviteCancel",p.SendInviteCancel),o.pubsub.on("datafnfriends:RedirectToBlockList",p.RedirectToBlockList),o.pubsub.on("setup:GetMessages",p.GetMessages),o.pubsub.on("datafnfriends:GetMessageCount",p.GetMessageCountJS),o.pubsub.on("datafnfriends:SendGameInvite",p.SendGameInvite),o.pubsub.on("datafnfriends:SendJoinGame",p.SendJoinGame),o.pubsub.on("datafnfriends:SendFriendUnblock",p.SendFriendUnblock),o.pubsub.on("datafnfriends:ClearFriendsCache",p.ClearFriendsCache),o.pubsub.on("virtualKeyboard:keyboardResult",p.triggerMessageFriendSearch),o.pubsub.on("datafnfriends:ClearGetFriendsCache",p.ClearGetFriendsCache),p}),define("common/profile/friends",["require","jquery","utils","common/baseUtils","underscore","setup.environment.utils","common/modals/modal-views","common/datafunctions.friends","common/am/socialCount","am"],function(e){function t(e,t,n){var i=c("#friendSearch #friendSearchForm .errors");i.empty();var a;a=t>0?c("#findFriendsList").data("total"):e.MaxCount>0?e.MaxCount:"0";var r,o=e.BlockedCount>0?e.BlockedCount:"0";r=parseInt(a,10)>0&&parseInt(o,10)>0?parseInt(a,10)-parseInt(o,10).toString():a,n.Total=r;var s=e.RockstarAccountList.RockstarAccounts;n.Count=s.length,c.each(s,function(){u.WriteDebugLog("FindPlayer","RockstarId",this.RockstarId),u.WriteDebugLog("FindPlayer","Nickname",this.Nickname),u.WriteDebugLog("FindPlayer","CreatedDate",this.CreatedDate),n.Players.push({RockstarId:this.RockstarId,DisplayName:this.DisplayName,AvatarUrl:this.AvatarUrl,ViewerRelationship:m.GetRelationShipCode(this.Relationship)})});var l=JSON.stringify(n);u.WriteDebugLog("FindPlayer","jsonString",l),"0"==t&&(c("#findFriendsList").empty(),c("#findFriendsList").data("total",e.MaxCount>0?e.MaxCount:"0")),d.pubsub.publish("friendFn.handlePlayerListResponse",l)}function n(e){if(e.errorCode===u.errorCode("5005")){var t=c("#friendSearch .searchTip");t.html(h.getError("NickInvalid")),t.fadeIn()}else p.ShowErrorModal(e);var n=c(".panel.active").attr("id");u.removeLoading(n)}function i(){var e=["getfriends",globals.account.RockstarId].join(":");m.getFriendCompare(e,r).catch(function(e){u.WriteDebugLog("friendsFn.getFriendCompare","ajax error handled by fatalError",e)}).then(function(t){a(t,e),e=null}).catch(function(e){u.WriteDebugLog("friendsFn.getFriendCompare","unhandled exception",e,u.logType.error,u.logController.profile)})}function a(e,t){e.Status&&(m.getFriendsCache[t]=e,g.setSocialCountTotals(-1,e.RockstarAccountList.Total)),u.WriteDebugLog("getFriendCompareSuccess","data",e),o(e),v.trackPage("/FriendCompare")}function r(e){p.ShowErrorModal(e),u.stopSpinner($el.find(".spinner")).fadeOut(),m.ClearGetFriendsCache()}function o(e){var t=e.RockstarAccountList.RockstarAccounts,n=[];f.each(t,function(e){var t="<li><a data-userid='"+e.RockstarId+"' data-useravatar='"+e.AvatarUrl+"'>"+e.Name+"</a></li>";s(e),n.push(t)}),u.WriteDebugLog("renderFriendCompare","friendsList.join('')",n.join("")),c("#compareSelectList").html(n.join("")),n=null,u.stopSpinner(c("#compareSelect .spinner")).fadeOut(),c("#compareSelectContainer").fadeIn(function(){c(this).data("antiscroll").refresh()})}function s(e){u.WriteDebugLog("getFriendCompare","RockstarId",e.RockstarId),u.WriteDebugLog("getFriendCompare","Nickname",e.Name),u.WriteDebugLog("getFriendCompare","Avatar",e.AvatarUrl)}function l(e,t){if("undefined"==typeof e&&(e={RockstarAccountList:{Total:0}}),"undefined"==typeof t&&(t={PageIndex:0}),h.TabIsActive(c("#friendsPanel .sideMenu #friendInvitesLink"))){var n={RequestId:123456,ResultCode:0,PlayerListType:4,PageIndex:t.PageIndex,Players:[]},i=e.RockstarAccountList.RockstarAccounts;null!=e.RockstarAccountList&&null!=i&&i.length>0&&c.each(i,function(){n.Players.push({RockstarId:this.RockstarId,AvatarUrl:this.AvatarUrl,DisplayName:this.DisplayName,InviteShortMsg:this.ShortMessage,InviteMsg:this.Message,MutualFriends:this.MutualFriendCount,ViewerMutualFriendCount:this.MutualFriendCount,ViewerRelationship:m.GetRelationShipCode(this.Relationship)})}),n.Success=!0,n.Count=n.Players.length,n.Total=e.RockstarAccountList.Total;var a=JSON.stringify(n);c("#friendInvitesList").data("friendInvitesList",n),d.pubsub.publish("friendFn.handlePlayerListResponse",a)}}var c=e("jquery"),u=e("utils"),d=e("common/baseUtils"),f=e("underscore"),h=e("setup.environment.utils"),p=e("common/modals/modal-views"),m=e("common/datafunctions.friends"),g=e("common/am/socialCount"),v=e("am"),b={};return b.localize=function(){c("#friendsPanel").hasClass("localized")||(c("#friendProfilePanel, #friendsPanel").find("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),c("#friendsPanel").addClass("localized"))},b.triggerFindFriend=function(){var e=c("#findFriendsList");if(void 0===e.data("total")||e.find("div.profileButton").length<e.data("total")){var t=parseInt(e.data("pageIndex"),10);b.findPlayer(c("#friendSearchbox").val(),++t)}},b.findPlayer=function(e,i){u.WriteDebugLog("FindPlayer","searchTerm; pageIndex",e+"; "+c("#friendSearchbox").data("pageIndex")),c("#findFriendsIntro").hide(),c("#friendSearchTerm").show().find("span.purple").html(e),c("#friendsPanel .loadingMask").addClass("noMask bottom"),c("#findFriendsList").data("pageIndex",i),h.setUpLoadingPanel("#friendsPanel",function(){c("#findFriends .emptyContainer").remove()});var a={PlayerListType:99,PageIndex:i,Players:[]};m.findPlayer(e,i,n).catch(function(e){u.WriteDebugLog("friendsFn.findPlayer","ajax error handled by fatalError",e)}).then(function(e){return t(e,i,a)}).catch(function(e){u.WriteDebugLog("friendsFn.findPlayer","unhandled exception",e,u.logType.error,u.logController.profile)})},b.loadCompareStats=function(){if(c("#compareSelect").is(".open"))u.WriteDebugLog("CompareStats","click","close"),m.closeCompareStats();else{u.WriteDebugLog("CompareStats","click","open"),c("#comparedFriend").fadeOut();var e=c("#compareSelect").show().addClass("open").animate({height:"252px"},200,"easeOutQuart").promise();e.then(function(){u.initSpinner(c("#compareSelect .spinner")).fadeIn(),i()})}},b.getFriendInvites=function(e){m.getFriendInvites(e,p.ShowErrorModal).catch(function(e){u.WriteDebugLog("friendsFn.getFriendInvites","ajax error handled by fatalError",e)}).then(function(t){l(t,e)}).catch(function(e){u.WriteDebugLog("friendsFn.getFriendInvites","unhandled exception",e,u.logType.error,u.logController.profile)})},b.processMpPresenceInfo=function(e){var t=h.activePanelId();if("undefined"!=typeof t){if("homefeedPanel"===t)return void m.RenderFriendsListPresence(e);if(e.Players.length){var n=e.Players[0].RockstarId;"friendProfilePanel"===t&&c("#cardInfoVitals").attr("data-id")===n.toString()&&u.pubsub.trigger("profile:SetGameButtonVisibility_"+n,e)}}},b}),function(e){e.fn.jTweetsAnywhere=function(t){var t=e.extend({username:"rockstargames",list:null,searchParams:null,count:0,tweetProfileImagePresent:null,tweetFilter:defaultTweetFilter,showTweetFeed:!0,showFollowButton:!1,showConnectButton:!1,showLoginInfo:!1,showTweetBox:!1,mainDecorator:defaultMainDecorator,tweetFeedDecorator:defaultTweetFeedDecorator,tweetDecorator:defaultTweetDecorator,tweetProfileImageDecorator:defaultTweetProfileImageDecorator,tweetBodyDecorator:defaultTweetBodyDecorator,tweetUsernameDecorator:defaultTweetUsernameDecorator,tweetTextDecorator:defaultTweetTextDecorator,tweetAttributesDecorator:defaultTweetAttributesDecorator,tweetTimestampDecorator:defaultTweetTimestampDecorator,tweetSourceDecorator:defaultTweetSourceDecorator,tweetGeoLocationDecorator:defaultTweetGeoLocationDecorator,tweetInReplyToDecorator:defaultTweetInReplyToDecorator,tweetRetweeterDecorator:defaultTweetRetweeterDecorator,tweetFeedControlsDecorator:defaultTweetFeedControlsDecorator,tweetFeedControlsMoreBtnDecorator:defaultTweetFeedControlsMoreBtnDecorator,tweetFeedControlsPrevBtnDecorator:defaultTweetFeedControlsPrevBtnDecorator,tweetFeedControlsNextBtnDecorator:defaultTweetFeedControlsNextBtnDecorator,tweetFeedAutorefreshTriggerDecorator:defaultTweetFeedAutorefreshTriggerDecorator,tweetFeedAutorefreshTriggerContentDecorator:defaultTweetFeedAutorefreshTriggerContentDecorator,connectButtonDecorator:defaultConnectButtonDecorator,loginInfoDecorator:defaultLoginInfoDecorator,loginInfoContentDecorator:defaultLoginInfoContentDecorator,followButtonDecorator:defaultFollowButtonDecorator,tweetBoxDecorator:defaultTweetBoxDecorator,linkDecorator:defaultLinkDecorator,usernameDecorator:defaultUsernameDecorator,hashtagDecorator:defaultHashtagDecorator,loadingDecorator:defaultLoadingDecorator,errorDecorator:defaultErrorDecorator,noDataDecorator:defaultNoDataDecorator,tweetTimestampFormatter:defaultTweetTimestampFormatter,tweetTimestampTooltipFormatter:defaultTweetTimestampTooltipFormatter,tweetVisualizer:defaultTweetVisualizer,loadingIndicatorVisualizer:defaultLoadingIndicatorVisualizer,autorefreshTriggerVisualizer:defaultAutorefreshTriggerVisualizer,onDataRequestHandler:defaultOnDataRequestHandler,onRateLimitDataHandler:defaultOnRateLimitDataHandler,_tweetFeedConfig:{expandHovercards:!1,showTimestamp:{refreshInterval:0},showSource:!1,showGeoLocation:!0,showInReplyTo:!0,showProfileImages:null,showUserScreenNames:null,showUserFullNames:!1,includeRetweets:!0,completed:"tweetsLoaded",paging:{mode:"none",_limit:0,_offset:0},autorefresh:{mode:"none",interval:60,duration:3600,_startTime:null,_triggerElement:null},_pageParam:0,_maxId:null,_recLevel:0,_noData:!1,_clearBeforePopulate:!1},_tweetBoxConfig:{counter:!0,width:515,height:65,label:"What's happening?",defaultContent:"",onTweet:function(){}},_connectButtonConfig:{size:"medium"},_baseSelector:null,_baseElement:null,_tweetFeedElement:null,_tweetFeedControlsElement:null,_followButtonElement:null,_loginInfoElement:null,_connectButtonElement:null,_tweetBoxElement:null,_loadingIndicatorElement:null,_noDataElement:null,_tweetsCache:[],_autorefreshTweetsCache:[],_stats:{dataRequestCount:0,rateLimitPreventionCount:0,rateLimit:{remaining_hits:150,hourly_limit:150}}},t);if(t.mainDecorator)return t._baseSelector=this.selector,"string"!=typeof t.username&&(t.searchParams||(t.searchParams=["q=from:"+t.username.join(" OR from:")]),t.username=t.username[0]),"object"==typeof t.showTweetFeed&&e.extend(!0,t._tweetFeedConfig,t.showTweetFeed),"object"==typeof t.showTweetBox&&(t._tweetBoxConfig=t.showTweetBox,t.showTweetBox=!0),"object"==typeof t.showConnectButton&&(t._connectButtonConfig=t.showConnectButton,t.showConnectButton=!0),null==t._tweetFeedConfig.showProfileImages&&(t._tweetFeedConfig.showProfileImages=t.tweetProfileImagePresent),null==t._tweetFeedConfig.showProfileImages&&(t._tweetFeedConfig.showProfileImages=(t.list||t.searchParams)&&t.tweetProfileImageDecorator),null==t._tweetFeedConfig.showUserScreenNames&&((t.list||t.searchParams)&&(t._tweetFeedConfig.showUserScreenNames=!0),t.tweetUsernameDecorator||(t._tweetFeedConfig.showUserScreenNames=!1)),null==t._tweetFeedConfig.showUserFullNames&&((t.list||t.searchParams)&&(t._tweetFeedConfig.showUserFullNames=!0),t.tweetUsernameDecorator||(t._tweetFeedConfig.showUserFullNames=!1)),t.count=validateRange(t.count,0,t.searchParams?100:20),t._tweetFeedConfig.autorefresh.interval=Math.max(30,t._tweetFeedConfig.autorefresh.interval),t._tweetFeedConfig.paging._offset=0,t._tweetFeedConfig.paging._limit=t.count,0!=t.count&&t.showTweetFeed||(t.tweetFeedDecorator=null,t.tweetFeedControlsDecorator=null),"none"==t._tweetFeedConfig.paging.mode&&(t.tweetFeedControlsDecorator=null),t.showFollowButton||(t.followButtonDecorator=null),t.showTweetBox||(t.tweetBoxDecorator=null),t.showConnectButton||(t.connectButtonDecorator=null),t.showLoginInfo||(t.loginInfoDecorator=null),t._tweetFeedConfig.showTimestamp||(t.tweetTimestampDecorator=null),t._tweetFeedConfig.showSource||(t.tweetSourceDecorator=null),t._tweetFeedConfig.showGeoLocation||(t.tweetGeoLocationDecorator=null),t._tweetFeedConfig.showInReplyTo||(t.tweetInReplyToDecorator=null),e.ajaxSetup({cache:!0}),this.each(function(){t._baseElement=e(this),t._tweetFeedElement=t.tweetFeedDecorator?e(t.tweetFeedDecorator(t)):null,t._tweetFeedControlsElement=t.tweetFeedControlsDecorator?e(t.tweetFeedControlsDecorator(t)):null,t._followButtonElement=t.followButtonDecorator?e(t.followButtonDecorator(t)):null,t._tweetBoxElement=t.tweetBoxDecorator?e(t.tweetBoxDecorator(t)):null,t._connectButtonElement=t.connectButtonDecorator?e(t.connectButtonDecorator(t)):null,t._loginInfoElement=t.loginInfoDecorator?e(t.loginInfoDecorator(t)):null,t.mainDecorator(t),populateTweetFeed(t),populateAnywhereControls(t),bindEventHandlers(t),t._tweetFeedConfig.autorefresh._startTime=(new Date).getTime(),startAutorefresh(t),startTimestampRefresh(t)
})},defaultMainDecorator=function(e){e._tweetFeedElement&&e._baseElement.append(e._tweetFeedElement),e._tweetFeedControlsElement&&e._baseElement.append(e._tweetFeedControlsElement),e._connectButtonElement&&e._baseElement.append(e._connectButtonElement),e._loginInfoElement&&e._baseElement.append(e._loginInfoElement),e._followButtonElement&&e._baseElement.append(e._followButtonElement),e._tweetBoxElement&&e._baseElement.append(e._tweetBoxElement)},defaultTweetFeedControlsDecorator=function(e){var t="";return"prev-next"==e._tweetFeedConfig.paging.mode?(e.tweetFeedControlsPrevBtnDecorator&&(t+=e.tweetFeedControlsPrevBtnDecorator(e)),e.tweetFeedControlsNextBtnDecorator&&(t+=e.tweetFeedControlsNextBtnDecorator(e))):"endless-scroll"==e._tweetFeedConfig.paging.mode||e.tweetFeedControlsMoreBtnDecorator&&(t+=e.tweetFeedControlsMoreBtnDecorator(e)),'<div class="jta-tweet-list-controls">'+t+"</div>"},defaultTweetFeedControlsMoreBtnDecorator=function(){return'<span class="jta-tweet-list-controls-button jta-tweet-list-controls-button-more">More</span>'},defaultTweetFeedControlsPrevBtnDecorator=function(){return'<span class="jta-tweet-list-controls-button jta-tweet-list-controls-button-prev">Prev</span>'},defaultTweetFeedControlsNextBtnDecorator=function(){return'<span class="jta-tweet-list-controls-button jta-tweet-list-controls-button-next">Next</span>'},defaultTweetFeedAutorefreshTriggerDecorator=function(e,t){var n="";return t.tweetFeedAutorefreshTriggerContentDecorator&&(n=t.tweetFeedAutorefreshTriggerContentDecorator(e,t)),'<li class="jta-tweet-list-autorefresh-trigger">'+n+"</li>"},defaultTweetFeedAutorefreshTriggerContentDecorator=function(e){var t=""+e+" new "+(e>1?" tweets":" tweet");return'<span class="jta-tweet-list-autorefresh-trigger-content">'+t+"</span>"},defaultTweetFeedDecorator=function(){return'<ul class="jta-tweet-list"></ul>'},defaultTweetDecorator=function(e,t){var n="";return t._tweetFeedConfig.showProfileImages&&(n+=t.tweetProfileImageDecorator(e,t)),t.tweetBodyDecorator&&(n+=t.tweetBodyDecorator(e,t)),n+='<div class="jta-clear">&nbsp;</div>','<li class="jta-tweet-list-item">'+n+"</li>"},defaultTweetProfileImageDecorator=function(e){var t=e.retweeted_status||e,n=t.user?t.user.screen_name:!1||t.from_user,i=t.user?t.user.profile_image_url:!1||t.profile_image_url,a='<a class="jta-tweet-profile-image-link" href="http://twitter.com/'+n+'" target="_blank"><img src="'+i+'" alt="'+n+'"'+(isAnywherePresent()?"":' title="'+n+'"')+"/></a>";return'<div class="jta-tweet-profile-image">'+a+"</div>"},defaultTweetBodyDecorator=function(e,t){var n="";return t.tweetTextDecorator&&(n+=t.tweetTextDecorator(e,t)),t.tweetAttributesDecorator&&(n+=t.tweetAttributesDecorator(e,t)),'<div class="jta-tweet-body '+(t._tweetFeedConfig.showProfileImages?"jta-tweet-body-list-profile-image-present":"")+'">'+n+"</div>"},defaultTweetTextDecorator=function(e,t){var n=e.text;return e.retweeted_status&&(t._tweetFeedConfig.showUserScreenNames||null==t._tweetFeedConfig.showUserScreenNames||t._tweetFeedConfig.showUserFullNames||null==t._tweetFeedConfig.showUserFullNames)&&(n=e.retweeted_status.text),t.linkDecorator&&(n=t.linkDecorator(n,t)),t.usernameDecorator&&(n=t.usernameDecorator(n,t)),t.hashtagDecorator&&(n=t.hashtagDecorator(n,t)),(t._tweetFeedConfig.showUserScreenNames||t._tweetFeedConfig.showUserFullNames||e.retweeted_status&&(null==t._tweetFeedConfig.showUserScreenNames||null==t._tweetFeedConfig.showUserFullNames))&&(n=t.tweetUsernameDecorator(e,t)+" "+n),'<span class="jta-tweet-text">'+n+"</span>"},defaultTweetUsernameDecorator=function(e,t){var n,i=e.retweeted_status||e,a=i.user?i.user.screen_name:!1||i.from_user,r=i.user?i.user.name:null;a&&(t._tweetFeedConfig.showUserScreenNames||null==t._tweetFeedConfig.showUserScreenNames&&e.retweeted_status)&&(n='<span class="jta-tweet-user-screen-name"><a class="jta-tweet-user-screen-name-link" href="http://twitter.com/'+a+'" target="_blank">'+a+"</a></span>");var o;r&&(t._tweetFeedConfig.showUserFullNames||null==t._tweetFeedConfig.showUserFullNames&&e.retweeted_status)&&(o='<span class="jta-tweet-user-full-name">'+(n?" (":"")+'<a class="jta-tweet-user-full-name-link" href="http://twitter.com/'+a+'" name="'+a+'" target="_blank">'+r+"</a>"+(n?")":"")+"</span>");var s="";return n&&(s+=n),o&&(n&&(s+=" "),s+=o),(n||o)&&(s='<span class="jta-tweet-user-name">'+(e.retweeted_status?"RT ":"")+s+"</span>"),s},defaultTweetAttributesDecorator=function(e,t){var n="";return(t.tweetTimestampDecorator||t.tweetSourceDecorator||t.tweetGeoLocationDecorator||t.tweetInReplyToDecorator||e.retweeted_status&&t.tweetRetweeterDecorator)&&(n+='<span class="jta-tweet-attributes">',t.tweetTimestampDecorator&&(n+=t.tweetTimestampDecorator(e,t)),t.tweetSourceDecorator&&(n+=t.tweetSourceDecorator(e,t)),t.tweetGeoLocationDecorator&&(n+=t.tweetGeoLocationDecorator(e,t)),t.tweetInReplyToDecorator&&(n+=t.tweetInReplyToDecorator(e,t)),e.retweeted_status&&t.tweetRetweeterDecorator&&(n+=t.tweetRetweeterDecorator(e,t)),n+="</span>"),n},defaultTweetTimestampDecorator=function(e,t){var n=e.retweeted_status||e,i=formatDate(n.created_at),a=t.tweetTimestampFormatter(i),r=t.tweetTimestampTooltipFormatter(i),o=n.user?n.user.screen_name:!1||n.from_user,s='<span class="jta-tweet-timestamp"><a class="jta-tweet-timestamp-link" data-timestamp="'+i+'" href="http://twitter.com/'+o+"/status/"+n.id+'" target="_blank" title="'+r+'">'+a+"</a></span>";return s},defaultTweetTimestampTooltipFormatter=function(e){var t=new Date(e);return t.toLocaleString()},defaultTweetTimestampFormatter=function(e){var t=new Date,n=parseInt((t.getTime()-Date.parse(e))/1e3),i="";if(60>n)i+=n+" second"+(1==n?"":"s")+" ago";else if(3600>n){var a=parseInt((n+30)/60);i+=a+" minute"+(1==a?"":"s")+" ago"}else if(86400>n){var a=parseInt((n+1800)/3600);i+=a+" hour"+(1==a?"":"s")+" ago"}else{var r=new Date(e),o="AM",s=r.getHours();s>12&&(s-=12,o="PM");var l=(r.getMinutes(),["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]);i+=l[r.getMonth()]+" "+r.getDate(),r.getFullYear()<t.getFullYear()&&(i+=", "+r.getFullYear());var a=parseInt((n+43200)/86400);i+=" ("+a+" day"+(1==a?"":"s")+" ago)"}return i},exTimestampFormatter=function(e){var t=parseInt(((new Date).getTime()-Date.parse(e))/1e3),n="";if(60>t)n+="less than a minute ago";else if(3600>t){var i=parseInt((t+30)/60);n+=i+" minute"+(1==i?"":"s")+" ago"}else if(86400>t){var i=parseInt((t+1800)/3600);n+="about "+i+" hour"+(1==i?"":"s")+" ago"}else{var i=parseInt((t+43200)/86400);n+="about "+i+" day"+(1==i?"":"s")+" ago";var a=new Date(e),r="AM",o=a.getHours();o>12&&(o-=12,r="PM");var s=a.getMinutes(),l=(10>s?"0":"")+s;n+=" ("+o+":"+l+" "+r+" "+(a.getMonth()+1)+"/"+a.getDate()+"/"+a.getFullYear()+")"}return n},defaultTweetSourceDecorator=function(e){var t=e.retweeted_status||e,n=t.source.replace(/\&lt\;/gi,"<").replace(/\&gt\;/gi,">").replace(/\&quot\;/gi,'"'),i='<span class="jta-tweet-source"> via <span class="jta-tweet-source-link">'+n+"</span></span>";return i},defaultTweetGeoLocationDecorator=function(e){var t,n="",i=e.retweeted_status||e;if(i.geo&&i.geo.coordinates?t=i.geo.coordinates.join():i.place&&i.place.full_name&&(t=i.place.full_name),t){var a="here";i.place&&i.place.full_name&&(a=i.place.full_name);var r="http://maps.google.com/maps?q="+t;n='<span class="jta-tweet-location"> from <a class="jta-tweet-location-link" href="'+r+'" target="_blank">'+a+"</a></span>"}return n},defaultTweetInReplyToDecorator=function(e){var t=e.retweeted_status||e,n="";return t.in_reply_to_status_id&&t.in_reply_to_screen_name&&(n='<span class="jta-tweet-inreplyto"> <a class="jta-tweet-inreplyto-link" href="http://twitter.com/'+t.in_reply_to_screen_name+"/status/"+t.in_reply_to_status_id+'" target="_blank">in reply to '+t.in_reply_to_screen_name+"</a></span>"),n},defaultTweetRetweeterDecorator=function(e){var t="";if(e.retweeted_status){var n=e.user?e.user.screen_name:!1||e.from_user,i=(e.retweeted_status.retweet_count||0)-1,a='<a class="jta-tweet-retweeter-link" href="http://twitter.com/'+n+'" target="_blank">'+n+"</a>",r=" and "+i+(i>1?" others":" other");t='<br/><span class="jta-tweet-retweeter">Retweeted by '+a+(i>0?r:"")+"</span>"}return t},defaultConnectButtonDecorator=function(){return'<div class="jta-connect-button"></div>'},defaultLoginInfoDecorator=function(){return'<div class="jta-login-info"></div>'},defaultLoginInfoContentDecorator=function(e,t){var n="";if(t.isConnected()){var i=t.currentUser.data("screen_name"),a=t.currentUser.data("profile_image_url");n='<div class="jta-login-info-profile-image"><a href="http://twitter.com/'+i+'" target="_blank"><img src="'+a+'" alt="'+i+'" title="'+i+'"/></a></div><div class="jta-login-info-block"><div class="jta-login-info-screen-name"><a href="http://twitter.com/'+i+'" target="_blank">'+i+'</a></div><div class="jta-login-info-sign-out">Sign out</div></div><div class="jta-clear">&nbsp;</div>'}return n},defaultFollowButtonDecorator=function(){return'<div class="jta-follow-button"></div>'},defaultTweetBoxDecorator=function(){return'<div class="jta-tweet-box"></div>'},defaultLinkDecorator=function(e){return e?e.replace(/((ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?)/gi,'<a href="$1" class="jta-tweet-a jta-tweet-link" target="_blank" rel="nofollow">$1</a>'):""},defaultUsernameDecorator=function(e){return isAnywherePresent()?e:e.replace(/@([a-zA-Z0-9_]+)/gi,'@<a href="http://twitter.com/$1" class="jta-tweet-a twitter-anywhere-user" target="_blank" rel="nofollow">$1</a>')},defaultHashtagDecorator=function(e){return e.replace(/#([a-zA-Z0-9_]+)/gi,'<a href="https://twitter.com/search?q=%23$1" class="jta-tweet-a jta-tweet-hashtag" title="#$1" target="_blank" rel="nofollow">#$1</a>')},defaultLoadingDecorator=function(){return'<li class="jta-loading" rel="localize[Loading]">loading ...</li>'},defaultErrorDecorator=function(e){return'<li class="jta-error" rel="localize[TweetError]">ERROR: '+e+"</li>"},defaultNoDataDecorator=function(){return'<li class="jta-nodata" rel="localize[NoData]">No data</li>'},defaultTweetFilter=function(){return!0},defaultTweetVisualizer=function(e,t,n){e[n](t)},defaultLoadingIndicatorVisualizer=function(e,t,n,i){defaultVisualizer(e,t,"append","fadeIn",600,"fadeOut",200,i)},defaultAutorefreshTriggerVisualizer=function(e,t,n,i){defaultVisualizer(e,t,"prepend","slideDown",600,"fadeOut",200,i)},defaultVisualizer=function(e,t,n,i,a,r,o,s){var l=function(){s&&s()};e?(t.hide(),e[n](t),t[i](a,l)):t[r](o,function(){t.remove(),l()})},defaultOnDataRequestHandler=function(){return!0},defaultOnRateLimitDataHandler=function(){},updateLoginInfoElement=function(t,n){t._loginInfoElement&&t.loginInfoContentDecorator&&(t._loginInfoElement.children().remove(),t._loginInfoElement.append(t.loginInfoContentDecorator(t,n)),e(t._baseSelector+" .jta-login-info-sign-out").bind("click",function(){twttr.anywhere.signOut()}))},getFeedUrl=function(){return url="../common/GetTweets.aspx"},isAnywherePresent=function(){return"undefined"!=typeof twttr},clearTweetFeed=function(e){e._tweetFeedElement&&e._tweetFeedElement.empty()},populateTweetFeed=function(t){t.tweetDecorator&&t._tweetFeedElement&&getPagedTweets(t,function(t,n){n._tweetFeedConfig._clearBeforePopulate&&clearTweetFeed(n),hideLoadingIndicator(n,function(){e.each(t,function(t,i){n.tweetVisualizer(n._tweetFeedElement,e(n.tweetDecorator(i,n)),"append",n)}),n._tweetFeedConfig._noData&&n.noDataDecorator&&!n._tweetFeedConfig._noDataElement&&(n._tweetFeedConfig._noDataElement=e(n.noDataDecorator(n)),n._tweetFeedElement.append(n._tweetFeedConfig._noDataElement)),n._tweetFeedConfig._clearBeforePopulate&&n._tweetFeedElement.scrollTop(0),addHovercards(n),executeCompleted(n)})})},populateTweetFeed2=function(t){t._tweetFeedElement&&t._autorefreshTweetsCache.length>0&&("trigger-insert"==t._tweetFeedConfig.autorefresh.mode?t._tweetFeedConfig.autorefresh._triggerElement?t.tweetFeedAutorefreshTriggerContentDecorator&&t._tweetFeedConfig.autorefresh._triggerElement.html(t.tweetFeedAutorefreshTriggerContentDecorator(t._autorefreshTweetsCache.length,t)):t.tweetFeedAutorefreshTriggerDecorator&&(t._tweetFeedConfig.autorefresh._triggerElement=e(t.tweetFeedAutorefreshTriggerDecorator(t._autorefreshTweetsCache.length,t)),t._tweetFeedConfig.autorefresh._triggerElement.bind("click",function(){t.autorefreshTriggerVisualizer(null,t._tweetFeedConfig.autorefresh._triggerElement,t,function(){insertTriggerTweets(t)}),t._tweetFeedConfig.autorefresh._triggerElement=null}),t.autorefreshTriggerVisualizer(t._tweetFeedElement,t._tweetFeedConfig.autorefresh._triggerElement,t)):insertTriggerTweets(t))},insertTriggerTweets=function(t){if(t.tweetDecorator&&t._autorefreshTweetsCache.length>0){for(;t._autorefreshTweetsCache.length>0;){var n=t._autorefreshTweetsCache.pop();t._tweetsCache.unshift(n),t._tweetFeedConfig.paging._offset++,t.tweetVisualizer(t._tweetFeedElement,e(t.tweetDecorator(n,t)),"prepend",t)}addHovercards(t)}},addHovercards=function(e){isAnywherePresent()&&twttr.anywhere(function(t){t(e._baseSelector+" .jta-tweet-list").hovercards({expanded:e._tweetFeedConfig.expandHovercards}),t(e._baseSelector+" .jta-tweet-profile-image img").hovercards({expanded:e._tweetFeedConfig.expandHovercards,username:function(e){return e.alt}}),t(e._baseSelector+" .jta-tweet-retweeter-link").hovercards({expanded:e._tweetFeedConfig.expandHovercards,username:function(e){return e.text}}),t(e._baseSelector+" .jta-tweet-user-screen-name-link").hovercards({expanded:e._tweetFeedConfig.expandHovercards,username:function(e){return e.text}}),t(e._baseSelector+" .jta-tweet-user-full-name-link").hovercards({expanded:e._tweetFeedConfig.expandHovercards,username:function(e){return e.name}})})},populateAnywhereControls=function(t){isAnywherePresent()&&twttr.anywhere(function(n){if(t.tweetBoxDecorator&&n(t._baseSelector+" .jta-tweet-box").tweetBox(t._tweetBoxConfig),t.followButtonDecorator&&n(t._baseSelector+" .jta-follow-button").followButton(t.username),t.connectButtonDecorator){var i=e.extend({authComplete:function(){updateLoginInfoElement(t,n)},signOut:function(){updateLoginInfoElement(t,n)}},t._connectButtonConfig);n(t._baseSelector+" .jta-connect-button").connectButton(i),updateLoginInfoElement(t,n)}})},bindEventHandlers=function(t){t.tweetFeedControlsDecorator&&("prev-next"==t._tweetFeedConfig.paging.mode?(e(t._baseSelector+" .jta-tweet-list-controls-button-prev").bind("click",function(){!isLoading(t)&&t._tweetFeedConfig.paging._offset>0&&prevPage(t,!0)}),e(t._baseSelector+" .jta-tweet-list-controls-button-next").bind("click",function(){isLoading(t)||nextPage(t,!0)})):"endless-scroll"==t._tweetFeedConfig.paging.mode?t._tweetFeedElement.bind("scroll",function(){isLoading(t)||e(this)[0].scrollHeight-e(this).scrollTop()!=e(this).outerHeight()||nextPage(t,!1)}):e(t._baseSelector+" .jta-tweet-list-controls-button-more").bind("click",function(){isLoading(t)||nextPage(t,!1)}))},nextPage=function(e,t){doPage(e,t,Math.min(e._tweetFeedConfig.paging._offset+e._tweetFeedConfig.paging._limit,e._tweetsCache.length))},prevPage=function(e,t){doPage(e,t,Math.max(0,e._tweetFeedConfig.paging._offset-e._tweetFeedConfig.paging._limit))},doPage=function(e,t,n){e._tweetFeedConfig.paging._offset=n,e._tweetFeedConfig._clearBeforePopulate=t,populateTweetFeed(e)},startAutorefresh=function(e){"none"!=e._tweetFeedConfig.autorefresh.mode&&"prev-next"!=e._tweetFeedConfig.paging.mode&&0!=e._tweetFeedConfig.autorefresh.duration&&(e._tweetFeedConfig.autorefresh.duration<0||(new Date).getTime()-e._tweetFeedConfig.autorefresh._startTime<=1e3*e._tweetFeedConfig.autorefresh.duration)&&window.setTimeout(function(){processAutorefresh(e)},1e3*e._tweetFeedConfig.autorefresh.interval)},stopAutorefresh=function(e){e._tweetFeedConfig.autorefresh.duration=0},processAutorefresh=function(t){0!=t._tweetFeedConfig.autorefresh.duration&&(getRateLimitedData(t,!0,getFeedUrl(t,!1),function(t,n){var i=(t.results||t).slice(0);return i.error?void showError(n):(i.reverse(),e.each(i,function(e,t){isTweetInCache(t,n)||n.tweetFilter(t,n)&&n._autorefreshTweetsCache.unshift(t)}),void populateTweetFeed2(n))}),startAutorefresh(t))},startTimestampRefresh=function(e){e.tweetTimestampDecorator&&"object"==typeof e._tweetFeedConfig.showTimestamp&&e._tweetFeedConfig.showTimestamp.refreshInterval>0&&window.setTimeout(function(){processTimestampRefresh(e)},1e3*e._tweetFeedConfig.showTimestamp.refreshInterval)},processTimestampRefresh=function(t){e.each(t._tweetFeedElement.find(".jta-tweet-timestamp-link"),function(n,i){var a=e(i).attr("data-timestamp");e(i).html(t.tweetTimestampFormatter(a))}),startTimestampRefresh(t)},isTweetInCache=function(e,t){for(var n=t._tweetsCache.length,i=0;n>i;i++)if(e.id==t._tweetsCache[i].id)return!0;return!1},showLoadingIndicator=function(t){t._tweetFeedElement&&t.loadingDecorator&&!t._loadingIndicatorElement&&(t._loadingIndicatorElement=e(t.loadingDecorator(t)),t.loadingIndicatorVisualizer(t._tweetFeedElement,t._loadingIndicatorElement,t,null),t._tweetFeedElement.scrollTop(1e6))},hideLoadingIndicator=function(e,t){e._loadingIndicatorElement?(e.loadingIndicatorVisualizer(null,e._loadingIndicatorElement,e,t),e._loadingIndicatorElement=null):t&&t()},isLoading=function(e){return null!=e._loadingIndicatorElement},formatDate=function(e){return e.replace(/^([a-z]{3})( [a-z]{3} \d\d?)(.*)( \d{4})$/i,"$1,$2$4$3")},validateRange=function(e,t,n){return t>e&&(e=t),e>n&&(e=n),e},showError=function(e,t){e.errorDecorator&&e._tweetFeedElement&&(hideLoadingIndicator(e,null),e._tweetFeedElement.append(e.errorDecorator(t,e))),executeCompleted(e)},executeCompleted=function(e){var t=window[e._tweetFeedConfig.completed],n="function"==typeof t;n&&t()},getPagedTweets=function(e,t){e._tweetFeedConfig._recLevel=0,getRecPagedTweets(e,e._tweetFeedConfig.paging._offset,e._tweetFeedConfig.paging._limit,t)},getRecPagedTweets=function(t,n,i,a){if(++t._tweetFeedConfig._recLevel,n+i<=t._tweetsCache.length||t._tweetFeedConfig._recLevel>3||t._tweetFeedConfig._noData){n+i>t._tweetsCache.length&&(i=Math.max(0,t._tweetsCache.length-n));for(var r=[],o=0;i>o;o++)r[o]=t._tweetsCache[n+o];a(r,t)}else++t._tweetFeedConfig._pageParam,getRateLimitedData(t,!1,getFeedUrl(t,!0),function(t,r){var o=t.results||t;if(0==o.length)r._tweetFeedConfig._noData=!0;else{if(o.error)return void showError(r);e.each(o,function(e,t){t.id_str&&(t.id=t.id_str),t.in_reply_to_status_id_str&&(t.in_reply_to_status_id=t.in_reply_to_status_id_str),r._tweetFeedConfig._maxId||(r._tweetFeedConfig._maxId=t.id),r.tweetFilter(t,r)&&r._tweetsCache.push(t)})}getRecPagedTweets(r,n,i,a)})},getRateLimitedData=function(e,t,n,i){getData(e,t,n,i)},getData=function(t,n,i,a){return t._stats.dataRequestCount++,t.onDataRequestHandler(t._stats,t)?(n||showLoadingIndicator(t),void e.ajax({url:i,dataType:"json",type:"GET",timeout:8e3,global:!1,error:function(e){showError(t,e.Message)},success:function(e){a(e,t)}})):void hideLoadingIndicator(t,null)}}(jQuery),define("jTweetsAnywhere",["jquery"],function(e){return function(){var t;return t||e.$}}(this)),define("common/jTweetsAnywhere-1.2.1/twitter",["require","jquery","utils","setup.environment.utils","jTweetsAnywhere"],function(e){var t=e("jquery"),n=e("utils"),i=e("setup.environment.utils");e("jTweetsAnywhere");var a={};return a.GetTweets=function(){if(!i.LandingFriendsHaveBeenRetrieved()){if(t("#landingFriends").find("h3").hide(),t("#homefeedPanel").find(".contentWrapper").show(),t("#homefeedPanel").find(".offlineMode:visible").length)return void i.removeLoading("homefeedPanel");var e=t("#tweetFeed");e.show(),e.length>0&&(0==e.html().length||e.find(".jta-error").length>0)?(n.WriteDebugLog("GetTweets","",""),e.html(""),e.jTweetsAnywhere({username:"RockstarGames",count:8,showTweetFeed:{showProfileImages:!0,showUserScreenNames:!0,includeRetweets:!1,paging:{mode:"none"},completed:"GetTweetsCompleted"},loadingDecorator:function(){var e="";return'<li class="jta-loading">'+e+"</li>"},errorDecorator:function(){if(!i.isOffline()){var e=i.getError("TweetError");return'<li class="jta-error">'+e+"</li>"}return t("#homefeedPanel .offlineMode").show(),""},noDataDecorator:function(){if(n.WriteDebugLog("GetTweets","No Data",""),!i.isOffline()){var e=i.getError("TweetError");return'<li class="jta-nodata">'+e+"</li>"}return t("#homefeedPanel .offlineMode").show(),""}})):i.removeLoading("homefeedPanel")}},a.GetTweetsCompleted=function(){if(n.WriteDebugLog("GetTweetsCompleted","",""),!i.LandingFriendsHaveBeenRetrieved()){i.resetScrollbar("#homefeedPanel"),i.removeLoading("homefeedPanel");var e=t("#tweetFeed");if(0==e.html().length)if(i.isOffline())t("#homefeedPanel .offlineMode").show();else{var a=i.getError("TweetError");e.html("<li class='jta-nodata'>"+a+"</li>")}else{var r=e.find("a");"pcros"==globals.platform&&r.addClass("jta-tweet-link-enabled RGSCLoadExt")}}},a.hideTwitterFeed=function(){t("#tweetFeed").hide()},window.GetTweetsCompleted=a.GetTweetsCompleted,a}),define("hbs!common/templates/profile/profile_friend_online",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(){return" SCOnline "}function o(){return" SCOffline "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s,l,c="",u="function",d=this.escapeExpression,f=this;return c+='<li>\r\n    <a class="profileButton gold" data-id="',(l=n.RockstarId)?s=l.call(t,{hash:{}}):(l=t&&t.RockstarId,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'" data-services="accounts,friends">\r\n        <img id="imgProfile',(l=n.RockstarId)?s=l.call(t,{hash:{}}):(l=t&&t.RockstarId,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'" width="32" height="32" class="avatarImg" alt="',(l=n.DisplayName)?s=l.call(t,{hash:{}}):(l=t&&t.DisplayName,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'" src="',(l=n.AvatarUrl)?s=l.call(t,{hash:{}}):(l=t&&t.AvatarUrl,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'" />\r\n\r\n        <span class="text info">\r\n            <h5 class="profilenickname optionProfile">',(l=n.DisplayName)?s=l.call(t,{hash:{}}):(l=t&&t.DisplayName,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'</h5>\r\n            <span class="subText">\r\n                <i class="status ',s=n["if"].call(t,t&&t.IsOnline,{hash:{},inverse:f.program(3,o,a),fn:f.program(1,r,a)}),(s||0===s)&&(c+=s),c+='"></i>\r\n                <span>',(l=n.PlayingGame)?s=l.call(t,{hash:{}}):(l=t&&t.PlayingGame,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+"</span>\r\n            </span>\r\n        </span>\r\n\r\n        <i class='arrow' style=\"display: none;\"></i>\r\n    </a>\r\n    <div class='actions clearfix'>\r\n        <a href='#' class='btn btnPurple btnSmall optionGameInvite' rel='localize[InviteToGame]' style=\"display: none;\">Invite to game</a>\r\n        <a href='#' class='btn btnPurple btnSmall optionJoingame' rel='localize[JoinGame]' style=\"display: none;\">Join game</a>\r\n    </div>\r\n</li>"});return n}),define("common/games/gamecommon",["jquery","common/xhr","utils","setup.environment.utils","common/profile/profile-utils","common/datafunctions","common/datafunctions.friends","common/profile/friends","common/modals/modal-views","am","common/jTweetsAnywhere-1.2.1/twitter","common/am/socialCount","hbs!common/templates/profile/profile_friend_online","common/jquery.visible"],function(e,t,n,i,a,r,o,s,l,c,u,d,f){var h={};h.init=function(){e("#compareStats").click(function(e){e.preventDefault(),s.loadCompareStats()}),e("#compareSelect").find(".close").click(function(){return o.closeCompareStats(),e("#statsPanel").removeClass("compared"),p(),!1}),e("#compareSelectList").on("click","a",function(t){t&&t.preventDefault();var n=e(this);y(n.attr("data-userid"),n.attr("data-useravatar"),n.text());var i=e("#statsPanel .friendStatsTitle");i.html().length>12&&i.html(i.html().substring(0,9)+"...")}),e("#compareStatsLink").click(function(){var t=e("#friendProfileHead");return y(t.closest("#friendProfile").attr("data-id"),n.getLastStringSegment(t.find("img.avatarImg").attr("src"),"/",2),t.find("h5.profilenickname").text()),!1}),e("#statsButton").click(function(t){if(t&&t.preventDefault(),globals.isLauncher)return!1;if(!e(this).hasClass("disabled")){o.closeCompareStats();var r=e("#statsPanel");r.removeClass("compared"),r.find("#comparedFriend").hide(),r.hasClass("active")?e("#statsLink2").click():e("div.active").is(":animated")||(i.isSignedIn()?i.clearActivePanel(function(){n.isGameSupported()||e("#statsPanel").addClass("achievements"),e("#statsPanel").hasClass("achievements")||i.hideStats()?(e("#statsPanel").removeClass("achievements"),e("#awardsLink2").click()):e("#statsLink2").click()}):(0==e("#awardsButton").find(".on").length&&(r.removeClass("achievements"),i.setSelected(this)),a.navigatePendingSignIn("#statsButton")))}return n.pubsub.trigger("section:stats:loaded"),!1}),e("#statsPanel").on("keydown",".sideMenu a",function(t){var n=e(t.currentTarget);13==t.which&&n.visible()&&e(this).click()}),e("#statsLink2").click(function(t){if(t&&t.preventDefault(),!globals.isLauncher){var i=e(this),a=e("#statsPanel");return i.hasClass("disabled")||i.hasClass("on")&&a.hasClass("active")?void n.WriteDebugLog("statsLink2 click disabled"):void m()}}),e(document).on("click","#onlineStatsLink",function(t){if(t&&t.preventDefault(),"gta5"===globals.titleName){var a=e(this),r=e("#statsPanel");if(a.hasClass("disabled")||a.hasClass("on")&&r.hasClass("active"))return void n.WriteDebugLog("onlineStatsLink click disabled");e("#statsLink2").addClass("disabled"),e("#awardsLink2").addClass("disabled"),e(this).is(".on")||(r.find(".content").hide(),r.find("#statsHeader").show(),0==e("#statsButton .on").length&&i.setSelected("#statsButton"),i.setSelectedSide(e(this)),i.setUpLoadingPanel("#statsPanel",function(){e("#statsContent").show(),e("#statsPanel").hasClass("compared")?e("#statsPanel").attr("class","panel active stats onlineStats compared"):e("#statsPanel").attr("class","panel active stats onlineStats"),e("#statsPanel").hasClass("compared")?S(e("#comparedFriendNickname").attr("data-userid"),!0):S(null,!0)}),c.trackPage("/Statistics"))}}),e("#awardsButton").click(function(t){if(t&&t.preventDefault(),globals.isLauncher)return!1;if(!e(this).hasClass("disabled")){var n=e("#statsPanel");i.setSelected(e(this)),n.hasClass("active")||e("div.active").is(":animated")?e("#awardsLink2").click():i.isSignedIn()?i.clearActivePanel(function(){i.setUpLoadingPanel("#statsPanel"),e("#awardsLink2").click()}):a.navigatePendingSignIn("#awardsButton")}return!1}),e("#awardsLink2").click(function(t){if(t&&t.preventDefault(),!globals.isLauncher){var r=e(this),s=e("#statsPanel");if(n.isGameSupported()||r.removeClass("disabled"),r.hasClass("disabled")||r.hasClass("on")&&s.hasClass("active"))return void n.WriteDebugLog("awardsLink2 click disabled");e("#statsLink2").addClass("disabled"),e("#onlineStatsLink").addClass("disabled"),s.find(".content").hide(),s.find("#achievementsHeader").show(),e("#awardsButton").length?i.setSelected(e("#awardsButton")):0==e("#statsButton").find(".on").length&&i.setSelected("#statsButton"),i.setSelectedSide(e(this)),i.isSignedIn()?i.setUpLoadingPanel("#statsPanel",function(){e("#achievementsContent").show(),e("#statsPanel").hasClass("compared")?e("#statsPanel").attr("class","panel active achievements compared"):e("#statsPanel").attr("class","panel active achievements"),e("#statsPanel").hasClass("compared")?o.GetFriendAchievementsJS(e("#comparedFriendNickname").attr("data-userid")):e("#statsPanel").find("#achievementsContent").animate({opacity:"1"},500,function(){i.LoadGameAchievements()})}):(s.attr("class","panel achievements"),a.navigatePendingSignIn("#statsButton")),c.trackPage("/Accomplishments")}})},h.LoadHomeScreen=function(){i.isOnline()&&i.isSignedIn()&&!i.isLocal()?(e("#landingFriends #noFriends").hide(),u.hideTwitterFeed(),e("#landingFriendsList").empty(),i.setUpLoading("#landingFriends",g)):(i.setUpLoading("#homefeedPanel"),u.GetTweets())},h.getHomePageFriends=function(a){if(n.WriteDebugLog("gamecommon.getHomePageFriends","",""),!i.isOffline()){var r={PageSize:250,PageIndex:0};r.Players=[];var s={env:globals.rosEnvironment,title:globals.titleName,version:globals.RosTitleVersion,pageSize:r.PageSize,pageIndex:r.PageIndex,rockstarId:"",updatedFriendIds:a},c=["getfriends",globals.account.RockstarId].join(":");if("undefined"==typeof a&&o.getFriendsCache[c]){var d=o.getFriendsCache[c];return void v(d,r)}var f=i.GetAuthHeaderAsync();f.done(function(i){t.ajax({type:"POST",url:n.getApiUrl("/api/friend/getfriends"),headers:i,data:JSON.stringify(s),contentType:"application/json; charset=utf-8",dataType:"json",silentFail:!0,fatalError:l.ShowErrorModal,contentEl:e("#landingFriendsList"),services:["friends"],success:function(e,t){"success"===t&&(o.getFriendsCache[c]=e),v(e,r)},error:function(){u.GetTweets()}})}),f.fail(function(){u.GetTweets()})}};var p=function(){var t=e("#statsPanel .sideMenu li a.on"),n=t.attr("id");"onlineStatsLink"==n||"awardsLink2"==n?t.removeClass("on").click():m()},m=function(){var t=e("#statsPanel");e("#awardsLink2").addClass("disabled"),e("#onlineStatsLink").addClass("disabled"),t.find(".content").hide(),t.find("#statsHeader").show(),0==e("#statsButton .on").length&&i.setSelected("#statsButton"),i.setSelectedSide(e("#statsLink2")),i.setUpLoadingPanel("#statsPanel",function(){e("#statsContent").show(),e("#statsPanel").hasClass("compared")?e("#statsPanel").attr("class","panel active stats compared"):e("#statsPanel").attr("class","panel active stats"),n.isLegacyServiceLayer()?(e("#compareStats").hide(),S()):S(e("#statsPanel").hasClass("compared")?e("#comparedFriendNickname").attr("data-userid"):null)}),c.trackPage("/Statistics")},g=function(){i.isScuiVisible()&&i.isActivePanel("#homefeedPanel")&&setTimeout(h.getHomePageFriends,globals.homePageFriendsDelay)},v=function(t,i){var a=t.RockstarAccountList.RockstarAccounts;null!=t.RockstarAccountList&&null!=a&&a.length>0?(e.each(a,function(){var e=n.getOnlineTitle(this.IsOnline,this.OnlineGames);i.Players.push({RockstarId:this.RockstarId,AvatarUrl:this.AvatarUrl,DisplayName:this.DisplayName,MutualFriends:this.MutualFriendCount,ViewerMutualFriendCount:this.MutualFriendCount,Relationship:this.Relationship,ViewerRelationship:this.ViewerRelationship,IsOnline:this.IsOnline,Game:this.IsOnline?e.game:null,Platform:this.IsOnline?e.platform:null})}),i.Success=!0,i.Count=i.Players.length,i.Total=t.RockstarAccountList.Total,i.OnlineTotal=t.RockstarAccountList.OnlineTotal,i.PageIndex=t.RockstarAccountList.PageIndex,d.setSocialCountTotals(-1,i.Total),b(i)):C()},b=function(t){if(n.WriteDebugLog("gameCommon.showFriends","data",JSON.stringify(t)),t){var a="",s=e("#landingFriendsList");if(e("#onlineFriendCount").text(t.OnlineTotal),e("#landingFriends").find("h3").show(),(void 0===t.PageIndex||0===t.PageIndex)&&(s.data("total",t.Total),s.empty()),t.Count>0){var l=i.getText("PlayingGameOn","Social","Playing {0} on {1}"),c=[];e.each(t.Players,function(e,t){t.IsOnline&&c.push(t.RockstarId)}),c.length&&r.requestMultiplayerPresenceInfo(c),e.each(t.Players,function(e,t){var r=n.getAvatarUrl(t.AvatarUrl,t.DisplayName);t.AvatarUrl=r;var o=t.IsOnline?l.format(t.Game,t.Platform):i.getText("Offline","Social");t.PlayingGame=o,a+=n.renderCompiledTemplate(f,t)}),s.append(a),s.find("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),s.find("a.profileButton").click(function(){var t=e(this).parent(),n=t.find(".arrow");n.is(":visible")&&t.toggleClass("open")}),s.find(".avatarImg").on("error",n.avatar404),s.off("click","a.optionGameInvite").on("click","a.optionGameInvite",function(){return o.SendGameInvite(e(this).closest("li").find(".profileButton").attr("data-id")),!1}),s.off("click","h5.optionProfile").on("click","h5.optionProfile",function(){return e("#friendProfilePanel .content").hide(),o.friendProfileView(e(this).closest("a.profileButton").attr("data-id")),!1}),s.off("click","a.optionJoingame").on("click","a.optionJoingame",function(){return o.SendJoinGame(e(this).closest("li").find(".profileButton").attr("data-id")),!1
})}u.hideTwitterFeed(),i.removeLoading("landingFriends"),s.find("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),i.resetScrollbar("#landingFriends")}},C=function(){var t=e("#landingFriends"),a=t.find("#noFriends.emptySocial");a.find(".btn").off("click").on("click",function(e){e.preventDefault(),n.pubsub.trigger("setupEnv.showSocial","#findPlayerLink")}),a.find("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),t.find("h3").hide(),u.hideTwitterFeed(),i.resetScrollbar("#landingFriends"),a.show(),i.removeLoading("landingFriends")},S=function(e,t){n.isGameSupported()&&require(["common/games/"+globals.titleName],function(n){n.LoadPlayerStats(e,t)})},y=function(t,a,r){n.WriteDebugLog("CompareWithFriend","friendRockstarId, friendAvatarUrl, friendNickname",t+","+a+","+r);var s,l=e("#statsPanel"),c=t;s=""==a||"null"==a||a.match(/default.png$/)?n.getAvatarUrlFromUrl("",32):n.getAvatarUrl(a,r,32);var u=r;o.closeCompareStats(),l.find("#comparedFriendNickname").text(u),l.find("#comparedFriendNickname").attr("data-userid",c),l.find("#comparedFriendAvatar").attr("src",s),l.find("#statsHeader, #achievementsHeader").find("h5.friendStatsTitle").html(u),l.find("#comparedFriend").fadeIn().addClass("compare"),l.find("#compareStats").addClass("compare"),l.addClass("compared");var d=l.hasClass("onlineStats");l.hasClass("active")?l.hasClass("stats")?S(c,d):l.hasClass("achievements")&&o.GetFriendAchievementsJS(c):i.setUpLoadingPanel("#statsPanel",function(){l=e("#statsPanel"),l.find(".content").hide(),e("#statsContent").show(),l.find("#statsHeader").show(),i.setSelectedSide(l.find("#statsLink2")),l.hasClass("compared")?l.attr("class","panel active stats compared"):l.attr("class","panel active stats"),l.hasClass("stats")?S(c,d):l.hasClass("achievements")&&o.GetFriendAchievementsJS(c),c=null})};return h}),define("common/xhr-utils",["require","jquery","underscore","utils","common/baseUtils","common/localize"],function(e){function t(e,t){if(!t.services)return!0;var n=!1;return globals.scsServiceEnabled||(n=!0),s.isArray(t.services)&&s.each(t.services,function(e){n=n||!globals[e+"ServiceEnabled"]}),n?(t.silentFail||l.pubsub.trigger("setupEnv:showServiceAlert"),!1):!0}function n(e){function t(){if(c.isScuiVisible()){var t=u.getRequestDescription(e.requestDescription,e.url);c.pubsub.publish("notificationFn.infoMessage",u.getText("SlowServiceMessage","Notifications")+t)}}if(!e.disableSlowMsg&&!i(e)){var n=e.slowMsgTimeout||globals.slowAjaxMsgTimeout;e.slowTimeoutHandle=setTimeout(t,n)}}function i(e){return void 0!=e&&void 0!=e.url&&e.url.length>8&&"/desktop"==e.url.substr(-8)}function a(e){void 0!==e.slowTimeoutHandle&&clearInterval(e.slowTimeoutHandle)}function r(){o.ajaxSetup({timeout:globals.ajaxTimeout});var e=o(document);e.ajaxSend(function(e,i,a){return t(i,a)?void n(a):void i.abort()}),e.ajaxComplete(function(e,t,n){a(n)}),e.ajaxSuccess(function(){void 0!=o("body").data("AjaxRetry")&&o("body").removeData("AjaxRetry")}),e.ajaxError(function(e,t,n,i){if(!l.AjaxRequestAborted(t.statusText)&&(l.WriteDebugLog("Ajax Error","url; exception",n.url+"; "+i),a(n),!n.silentFail)){var r,s,d,f;if(s="url",d=n.url,l.stopSpinner(o("div.active:first span.waitMessage")).hide(),0==t.status?(f="jqxhr.status == 0",l.WriteDebugLog("Ajax Error","Reason",f)):404==t.status?(f="404",l.WriteDebugLog("Ajax Error","Reason",f+" Requested URL not found.")):429==t.status?(f="429",l.WriteDebugLog("Ajax Error","Reason",f+" Too Many Requests."),r=c.errorCode("8000")):500==t.status&&(f="500",l.WriteDebugLog("Ajax Error","Reason",f+" Internal Server Error.")),"parsererror"==i)return f="parser error",void l.WriteDebugLog("Ajax Error","Reason","Parsing JSON request failed.");if("timeout"==i)f="timeout",l.WriteDebugLog("Ajax Error","Reason","Request timed out."),r=c.errorCode("1001");else{var h=t.responseText;try{var p=c.tryConvertRespToJson({resp:h,isXml:c.isAjaxXml(n)});void 0!=p?r=p.Message:(s+="; resp","string"==typeof h&&h.length&&(h.length>50&&(h=h.substr(0,47)+"..."),d+="; "+h))}catch(m){}}if("undefined"!=typeof f&&f.length&&(s+="; reason",d+="; "+f),"undefined"!=typeof r&&r.length&&(s+="; errorCode",d+="; "+r),"undefined"!=typeof i&&i.length&&(s+="; exception",d+="; "+i),l.WriteDebugLog("Ajax Error",s,d,l.logType.error,l.logController[globals.titleName]),r==c.errorCode("3003")&&(void 0==o("body").data("AjaxRetry")||o("body").data("AjaxRetry")!=n.url))return o("body").data("AjaxRetry",n.url),void l.pubsub.trigger("setupEnv:timeOutRetryClick",n);var g=u.getErrorWithCode(r,n.requestDescription);if(l.WriteDebugLog("Ajax Error",r,g.Message),"timeout"!=i||void 0!=n.noRetryModal&&n.noRetryModal){var v={errorCode:r,message:g.Message,supportText:g.SupportText,codeDesc:g.CodeDescription,errorFunction:n.fatalError,contentEl:n.contentEl,responseText:t.responseText};l.pubsub.trigger("setupEnvUtils.showFatalError",v)}else n.noRetryModal=!0,l.pubsub.trigger("setupEnv.showTimeOutRetry",n);o("#buttonCancelMessage").hide()}})}var o=e("jquery"),s=e("underscore"),l=e("utils"),c=e("common/baseUtils"),u=e("common/localize");return{init:r}}),define("domReady",[],function(){function e(e){var t;for(t=0;t<e.length;t+=1)e[t](c)}function t(){var t=u;l&&t.length&&(u=[],e(t))}function n(){l||(l=!0,o&&clearInterval(o),t())}function i(e){return l?e(c):u.push(e),i}var a,r,o,s="undefined"!=typeof window&&window.document,l=!s,c=s?document:null,u=[];if(s){if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(window.attachEvent){window.attachEvent("onload",n),r=document.createElement("div");try{a=null===window.frameElement}catch(d){}r.doScroll&&a&&window.external&&(o=setInterval(function(){try{r.doScroll(),n()}catch(e){}},30))}"complete"===document.readyState&&n()}return i.version="2.0.1",i.load=function(e,t,n,a){a.isBuild?n(null):i(n)},i}),define("common/profile/signin-utils",["require","underscore","common/baseUtils","common/captcha-utils","common/localize","common/sdk","common/storage"],function(e){function t(){globals.signInRequested||(globals.signInRequested=!0,setTimeout(u.clearSignInRequestNote,8e3))}function n(){var e=s.getText("TermsofService","Register"),t=s.getText("UserBanned","HomeSignin");return t.replace("[Terms of Service]",'<a href="http://www.rockstargames.com/legal" class="RGSCLoadExt">'+e+"</a>")}function i(){if("undefined"!=typeof u.cache.profileList)return u.cache.profileList;var e=l.CallGameMethod("RGSC_GET_PROFILE_LIST",null,"RGSC_GET_PROFILE_LIST_DEMO");return u.cache.profileList=e,e}var a=e("underscore"),r=e("common/baseUtils"),o=e("common/captcha-utils"),s=e("common/localize"),l=e("common/sdk"),c=e("common/storage"),u={autoSignInData:null,cache:{}};return u.Account=function(e,t,n,i,a,r,o,s,l,c,u,d,f){return{AvatarUrl:t,CountryCode:n,Age:i,Email:a,isApproxDob:r,Nickname:o,RockstarId:s,ZipCode:l,Local:c,Minor:u,NickEditable:d,Validated:f,UgcWritePrivilege:e}},u.setAccount=function(e,t,n,i,a,r,o,s,l,c,d,f,h){globals.account=new u.Account(e,t,n,i,a,r,o,s,l,c,d,f,h)},u.clearAccount=function(){globals.account=null,u.clearAutoSigninData()},u.setAutoSigninData=function(e){u.autoSignInData=e},u.clearAutoSigninData=function(){u.autoSignInData=null},u.areSigninCredsFromGame=function(e){return"undefined"!=typeof e&&(globals.areSigninCredsFromGame=e),globals.areSigninCredsFromGame},u.clearAreSigninCredsFromGame=function(){delete globals.areSigninCredsFromGame},u.updateGlobalsOnSignIn=function(e,t){globals.underage=!1,globals.updatePassword=e.UpdatePassword,globals.ticket=e.Ticket,t&&u.areSigninCredsFromGame(!0);var n=void 0;"string"==typeof e.Nickname&&e.Nickname.length&&(n=e.Nickname);var i=void 0;"string"==typeof e.AvatarUrl&&e.AvatarUrl.length&&(i=r.getLastStringSegment(e.AvatarUrl,"/",2)),u.setAccount(e.UgcWritePrivilege,i,e.CountryCode,e.Age,e.Email,e.IsApproxDob,n,e.RockstarId.toString(),e.ZipCode,!1,e.Minor,void 0)},u.signInSuccessMissingDetails=function(e){var t={hasAge:!isNaN(e.Age)&&e.Age>=1,hasCountry:void 0!=e.CountryCode&&""!==e.CountryCode};return t.hasBoth=t.hasAge&&t.hasCountry,t},u.isCredsFromGameAvailable=function(e){var t=r.stringHasContent(e.Email),n=t&&r.stringHasContent(e.Password),i=r.stringHasContent(e.ScAuthToken),a=t&&r.stringHasContent(e.Ticket)&&e.TicketRefresh;return n||i||a},u.getProfileAsync=function(e,t,n){var o=null!=e&&void 0!=e&&"undefined"!=e,c=null!=n&&void 0!=n&&"undefined"!=n;if(!o&&!c)return Promise.reject();if((null==t||"undefined"==typeof t)&&(t=o?l.CallGameMethod("RGSC_GET_PROFILE_LIST_FILTERED",'{ "RockstarId":"'+e+'" }',"RGSC_GET_PROFILE_LIST","RGSC_GET_PROFILE_LIST_DEMO"):i()),!t)return Promise.resolve({});var u={};return t.NumProfiles>0&&(c&&(n=n.toLowerCase()),u=a.find(t.Profiles,function(t){return e&&t.RockstarId==e||n&&(void 0!=t.Email&&t.Email.toLowerCase()==n||void 0!=t.Nickname&&t.Nickname.toLowerCase()==n)})),Promise.resolve("undefined"==typeof u||"undefined"!=typeof u.RockstarId?u:{Error:s.getErrorWithCode(r.errorCode("6000.80")).Message})},u.getOfflineProfileAsync=function(e,t){var n=e,o=i();if(null!=n)return u.getProfileAsync(n,o);var s=t;"string"==typeof s&&(s=s.toLowerCase());var l=a.find(o.Profiles,function(e){return r.objStrMatch(e,"Email",s)||r.objStrMatch(e,"Nickname",s)});return"object"==typeof l?u.getProfileAsync(l.id,o,s):Promise.resolve({})},u.getOfflineSigninCount=function(){var e=c.getItem("offlineSigninCount");return e?parseInt(e,10):0},u.setOfflineSigninCount=function(e){return isNaN(e)?!1:c.setItem("offlineSigninCount",e)},u.incrementOfflineSigninCount=function(){var e=u.getOfflineSigninCount();u.setOfflineSigninCount(++e)},u.signInToGame=function(e){t();var n=u.areSigninCredsFromGame()?2:0;e.CallbackData=parseInt(e.CallbackData,10)|n,l.CallGameMethod("RGSC_SIGN_IN",e,"RGSC_SIGN_IN_DEMO","RGSC_JS_FINISH_SIGN_IN")},u.clearSignInRequestNote=function(){delete globals.signInRequested},u.getSigninJson=function(e,t){var n={accountId:e.PlayerAccountId,Age:e.Age,Email:e.Email,expiration:e.SecsUntilExpiration,Local:!1,RockstarId:e.RockstarId.toString(),SaveEmail:!1,SavePassword:!1,sessionKey:e.SessionKey,SignedIn:!0,SignedOnline:!0,ticket:e.Ticket,XMLResponse:encodeURIComponent(e.Xml)},i=e.Nickname;"string"==typeof i&&i.length&&(n.Nickname=i);var a=e.AvatarUrl;return"string"==typeof a&&a.length&&(n.AvatarUrl=r.getLastStringSegment(a,"/",2)),u.autoSignInData?(n.AutoSignIn=u.autoSignInData.AutoSignIn,n.SaveEmail=u.autoSignInData.SaveEmail,n.Password=u.autoSignInData.Password||"",u.autoSignInData.DOB&&(n.DOB=u.autoSignInData.DOB)):(n.AutoSignIn=t.checked,n.Password=t.pass,n.SaveEmail=t.save),n},u.notifyGameSignInFailed=function(e,t){e=r.getErrorCodeString(e),t=r.getErrorCodeExString(t),l.CallGameMethod("RGSC_SIGN_IN",{Error:{ErrorCode:e,ErrorCodeEx:t}},"RGSC_SIGN_IN_DEMO","RGSC_JS_FINISH_SIGN_IN")},u.errorToCode=function(e){var t={errorCode:"",errorCodeEx:""};if(!e)return t;if("string"==typeof e){t.errorCode=r.errorCode(e),t.errorCodeEx=t.errorCode;var n=r.splitErrorCode(t.errorCode);t.errorCode=n.code,t.errorCodeEx=n.codeEx}else t.errorCodeEx=e.CodeEx,t.errorCode=e.Code;return t},u.parseSignInError=function(e,t,i,a,l){var c,u={errorMsg:"",reloadLoginForm:i,type:"Unknown"};if(r.errorCodeIs(e,"NotAllowed")&&(r.errorCodeExIs(t,"SteamAccountLink")||r.errorCodeExIs(t,"RockstarAccountLink")))u.errorMsg=s.getError(r.errorCodeExIs(t,"SteamAccountLink")?"SteamAlreadyLinked":"RockstarAlreadyLinked"),u.type="SteamAlreadyLinked";else if(r.errorCodeExIs(t,"Privilege"))u.errorMsg=n(),u.type="Banned";else if(r.errorCodeExIs(t,"LoginAttempts"))globals.showLockedAccountCaptchaSignIn=!globals.showLockedAccountCaptchaSignIn,u.errorMsg=s.getError("TooManyLoginAttempts"),u.type="TooManyLoginAttempts";else if(r.errorCodeIs(e,"AuthenticationFailed")){if(r.errorCodeExIs(t,"DupLogin"))u.errorMsg=s.getErrorWithCode(r.errorCode("4000.89")).Message;else if("95"===t)u.errorMsg=s.getErrorWithCode(r.errorCode("4000.95")).Message;else{var d=globals.isNLE?"NotFound":"NotFoundEmail";u.errorMsg=s.getError(d)}u.type="AuthenticationFailed"}else a&&429===a.status?(c=s.getErrorWithCode(r.errorCode("8000")),u.errorMsg=c.Message+" "+c.CodeDescription,u.type="RateLimit"):r.isSteam()&&l?u.type="SteamAutoLogin":r.isSteam()?(c=s.getErrorWithCode(r.errorCode("1000.50")),u.errorMsg=c.Message+" "+c.CodeDescription,u.type="Steam",u.type="SteamAutoLogin"):r.isSteam()?(c=s.getErrorWithCode(r.errorCode("1000.50")),u.errorMsg=c.Message+" "+c.CodeDescription,u.type="Steam"):a&&o.isCaptchaInvalid(a.responseJSON)&&(u.errorMsg=s.getText("ReCaptchaError1","HomeSignin"),u.type="InvalidCAPTCHA");return u},u.clearCachedProfileList=function(){u.cache.profileList=void 0},u.getProfileListAsync=function(){if("undefined"!=typeof u.cache.profileList)return Promise.resolve(u.cache.profileList);var e="RGSC_GET_PROFILE_LIST_DEMO";globals.asyncEnabled&&(e="RGSC_GET_PROFILE_LIST_ASYNC_DEMO");var t=Promise.resolve(l.CallGameMethodAsync("RGSC_GET_PROFILE_LIST",null,e));return t.then(function(e){return u.cache.profileList=e,e})},u.getRockstarIdAsync=function(e){if(u.autoSignInData&&void 0!=u.autoSignInData.RockstarId)return Promise.resolve(u.autoSignInData.RockstarId);var t=u.getProfileAsync(void 0,void 0,e);return t.then(function(e){return"undefined"==typeof e?void 0:e.RockstarId})},u.checkOfflineFallbackAsync=function(e,t){var n=globals.isLauncher&&!r.isLauncherV2Enabled(),i=r.errorCodeExIs(t,"Password"),a="string"==typeof e&&e.length>0;return!a||i||n?Promise.reject():Promise.resolve(e)},u.constructOfflineSigninJson=function(e,t,n,i,a){return{AutoSignIn:i,Email:t,Local:!1,Password:n,RockstarId:e?e.toString():"0",SaveEmail:a,SavePassword:!1,SignedIn:!0,SignedOnline:!1}},u.formatOfflineFallbackDataAsync=function(e,t){return{isOfflineFallback:e.isOfflineSignin,reloadLoginForm:t,errorMsg:"",selectedProfile:e.selectedProfile}},u.fallbackSigninFailedAsync=function(){var e=u.hasProfileListAsync();return e.catch(function(){return{isOfflineFallback:!1,reloadLoginForm:!1}}).then(function(e){var t;t=r.errorCode(e?"6000.80":"6000.87");var n=s.getErrorWithCode(t);return{isOfflineFallback:!1,reloadLoginForm:!1,errorMsg:n.Message,errorCode:t,errorCodeDesc:n.CodeDescription}})},u.signInOfflineAsync=function(e,t,n){t=t||{},n=n||!1;var i=u.getOfflineProfileAsync(e,t.Email);return i.then(function(i){var a=!1,o=void 0;if(!i||void 0==i.Email&&void 0==i.Nickname){if(!i||void 0==i.Error){var l=u.hasProfileListAsync();return l.catch(function(e){throw new Error(e)}).then(function(e){return e}).then(function(e){var t=e?"OfflineSigninError":"OfflineSigninErrorNoProfiles";return o=s.getText(t,"HomeSignin"),{errorMsg:o,isOfflineSignin:a}})}o=i.Error}else t.RockstarId=e||i.RockstarId||0,n||0==i.AutoSignIn?("undefined"!=typeof i.Email&&(t.Email=i.Email),"undefined"!=typeof i.Password&&(t.Password=i.Password),"undefined"!=typeof i.ScAuthToken&&(t.ScAuthToken=i.ScAuthToken),"string"==typeof i.Nickname&&i.Nickname.length&&(t.Nickname=i.Nickname)):(t=u.constructOfflineSigninJson(e,i.Email,i.Password,!0,!0),u.areSigninCredsFromGame(!0)),u.setAccount(null,i.AvatarUrl,null,null,i.Email,null,i.Nickname,e,null,!0,void 0),u.incrementOfflineSigninCount(),u.signInToGame(t),r.isOffline(!0),a=!0;return{errorMsg:o,isOfflineSignin:a,selectedProfile:i}})},u.hasProfileListAsync=function(){var e=Promise.resolve(u.getProfileListAsync());return e.then(function(e){return e&&e.NumProfiles>0}).catch(function(){return!1})},r.pubsub.subscribe("signinUtils.signInToGame",function(e,t){u.signInToGame(t)}),r.pubsub.subscribe("signinUtils.notifyGameSignInFailed",function(e,t){u.notifyGameSignInFailed(t.errorCode,t.errorCodeEx)}),u}),define("common/steam",["jquery","common/xhr","utils","common/baseUtils","setup.environment.utils","xmlToJson"],function(e,t,n,i,a,r){function o(e,t,i,a){return void 0==e||isNaN(e)||0>=e?(n.WriteDebugLog("BindSteamAccount","Undefined","steamAppId",n.logType.error,n.logController[globals.titleName]),s("5000.76"),!1):void 0!=t&&t.length?void 0!=a&&void 0!=a.ticket&&a.ticket.length?!0:(n.WriteDebugLog("BindSteamAccount","Failed - Undefined values, signedInJson:",i,n.logType.error,n.logController[globals.titleName]),s("5000.51"),!1):(n.WriteDebugLog("BindSteamAccount","Undefined","steamAuthTicket",n.logType.error,n.logController[globals.titleName]),s("5000.77"),!1)}function s(e){var t=a.getErrorWithCode(e);a.showGenericFatalError(e,t.Message,t.SupportText)}function l(t,n){var r=e(t);"true"==r.find("Status").text()?(e("#activation").removeClass("pending"),globals.account&&(a.setProfileHtml(),e("#editAutoSignIn").prop("checked",n.AutoSignIn)),i.pubsub.publish("signinUtils.signInToGame",n)):c(void 0,void 0,void 0,t)}function c(t,r,o,s){var l="",c="",u="";void 0==s||!s.find("Error").length||"NotAllowed"!=s.find("Error").attr("Code")||"SteamAccountLink"!=s.find("Error").attr("CodeEx")&&"RockstarAccountLink"!=s.find("Error").attr("CodeEx")?void 0!=s?(l="Unknown",c="SteamAccountLink",n.WriteDebugLog("BindSteamAccount","Failed","Unknown service error",n.logType.error,n.logController[globals.titleName]),u=a.getText("i44","Activation")):(l="FetchFailed",c="SteamAccountLink",n.WriteDebugLog("BindSteamAccount","Ajax error",r,n.logType.error,n.logController[globals.titleName]),u=a.getText("i44","Activation")):(l=s.find("Error").attr("CodeEx"),c=s.find("Error").attr("CodeEx"),n.WriteDebugLog("BindSteamAccount","Failed","AlreadyLinked"),u=a.getError("SteamAccountLink"==s.find("Error").attr("CodeEx")?"SteamAlreadyLinked":"RockstarAlreadyLinked")),e("div.signIn").find(".SignInError").after('<span class="errorText">'+u+"</span>"),0==e("#selectProfile.active").length?a.clearActivePanel(function(){a.setUpSignedInOptions(!1,a.isOffline()),e("a.disabled:first").removeClass("disabled"),e("a.buttonSignIn.disabled").removeClass("disabled"),e("#buttonSignInProfile").show(),n.stopSpinner(e("div.buttonSignInWrapper span")).hide(),n.pubsub.trigger("signin.showSignin",a.isOnline())}):(e("a.disabled:first").removeClass("disabled"),e("a.buttonSignIn.disabled").removeClass("disabled"),e("#buttonSignInProfile").show(),n.stopSpinner(e("div.buttonSignInWrapper span")).hide()),i.pubsub.publish("signinUtils.notifyGameSignInFailed",{errorCode:l,errorCodeEx:c})}var u={};return u.BindSteamAccount=function(e,i,r){n.WriteDebugLog("BindSteamAccount","steamAppId, ticket",e+","+i);var s=JSON.stringify(r);if(o(e,i,s,r)){var u='{ "platformName":"'+globals.platform+'","env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"playerTicket":"'+r.ticket+'","steamAppId":"'+e+'","steamAuthTicket":"'+i+'" }',d=a.GetAuthHeaderAsync(r.ticket);d.done(function(e){var i=t.ajax({type:"POST",url:n.getApiUrl("/api/"+globals.titleName+"/bindsteamaccount"),data:u,headers:e,services:!0,timeout:3*globals.ajaxTimeout,slowMsgTimeout:2*globals.slowAjaxMsgTimeout,contentType:"application/json; charset=utf-8",dataType:"xml",requestDescription:"BindSteamAccount"});i.done(function(e){l(e,r,s)}),i.fail(function(e,t,n){c(e,t,n)}),i.always(function(){s=null,r=null})})}},u.SteamLinkPrompt=function(e){n.pubsub.trigger("steam:showActivationSteamLink",e)},u.getSteamNetworkAsync=function(i,r){n.WriteDebugLog("getSteamNetwork","rockstarId, ticket",i+","+r);var o={},s='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"rockstarId":"'+i+'" }',l=new e.Deferred,c=a.GetAuthHeaderAsync(r);return c.done(function(e){n.WriteDebugLog("getSteamNetwork","authHeader",JSON.stringify(e)),t.ajax({type:"POST",url:n.getApiUrl("/api/profile/getsteam"),services:["accounts"],headers:e,data:s,contentType:"application/json; charset=utf-8",dataType:"xml",requestDescription:"UserNetworks",fatalError:function(){throw n.WriteDebugLog("getSteamNetwork","fatalError","",n.logType.error,n.logController[globals.titleName]),"fail"},success:function(e){n.WriteDebugLog("getSteamNetwork","success"),o=u.getSteamSuccess(e),n.WriteDebugLog("getSteamNetwork","jsonResult","string"==typeof o?o:JSON.stringify(o)),l.resolve(o)},complete:function(){n.WriteDebugLog("getSteamNetwork","complete"),"resolved"!==l.state()&&l.reject()}})}),l.promise()},u.getSteamSuccess=function(t){var i=e(t),a=i.find("OnlineServiceName"),o={};return n.WriteDebugLog("getSteamSuccess","networkAccounts.length",a.length),a.length>0&&i.find("PlayerAccount").each(function(){var t=e(this).find("OnlineServiceName").text();return"steam"==t?(o=r(this),!1):void 0}),o},u}),define("common/profile/signin",["require","jquery","utils","common/baseUtils","common/profile/profile-utils","common/profile/signin-utils","setup.environment.utils","common/datafunctions","common/datafunctions.friends","common/formvalidation","common/captcha","common/steam","common/sdk","common/localize","am","common/am/customDimensions","common/auth","common/jquery.visible"],function(e){function t(e,t){var n,i,a,r,o=e;"object"==typeof e&&(o=e.rockstarId,n=e.email,i=e.password,a=e.autoSignIn,r=e.isRememberMe);var s=rt.constructOfflineSigninJson(o,n,i,a,r),l=rt.signInOfflineAsync(o,s,!t);return l.then(function(e){return e.isOfflineSignin?(tt("#mainNav").show(),ot.setOffline(!0)):(tt("a.btn.disabled:first").removeClass("disabled"),nt.stopSpinner(tt("div.buttonSignInWrapper").find("span")).hide(),at.resetSigninButtonText(),tt("#lblSignInErrorProfile").after('<span class="errorText">'+e.errorMsg+"</span>"),g()),nt.HideInvisibleMask(),e}).catch(ot.showGenericFatalError)}function n(e){nt.WriteDebugLog("signInOffline","rockstarId",e);var n=tt("#selectProfile.active").length,i=tt("#autoSignInProfile").is(":checked")?!0:!1,a=tt("#rememberMeProfile").is(":checked")?!0:!1;t({rockstarId:e,email:tt("#signInEmailProfile").val(),password:tt("#signInPasswordProfile").val(),autoSignIn:i,isRememberMe:a},!n)}function i(e,t){if(nt.WriteDebugLog("signInLocal","rockstarId, Nickname",e+","+t),null!=e||null!=t)if((void 0==e||"undefined"==e)&&(e=""),(void 0==t||"undefined"==t)&&(t=""),e.length>0||t.length>0){var n={Nickname:t,RockstarId:e.toString(),Local:!0,AutoSignIn:!0,SignedOnline:!1,SignedIn:!0};rt.setAccount(null,null,null,null,null,null,t,e,null,!0),rt.signInToGame(n)}else ot.showMessagePanel(ht.getError("ServerError"),"",ht.getError("SorryTry")),tt("#buttonCancelMessage").hide(),tt("#messagePanel .closeCurrentPanel").unbind("click").click(function(){ot.requestUiState(!1)});nt.HideInvisibleMask(),tt("#createProfileOffline .nickvalid").remove()}function a(){rt.clearAutoSigninData(),nt.HideInvisibleMask()}function r(e){if(globals.fullLog)try{var t=parseInt(e.RockstarId,10);t%10!==0&&(globals.fullLog=!1,globals.debugLog="")}catch(n){}}function o(e){if(st.isDesktopPlatform()){var t=rt.signInSuccessMissingDetails(e);if(t.hasBoth)return;tt("#dob").addClass(t.hasAge||t.hasCountry?t.hasCountry?"DOBUpdate":"countryUpdate":"DOBAndCountryUpdate")}}function s(e){var t=void 0;if(e instanceof Error)e={errorThrown:e.Message},t=e.errorThrown;else{var n=e.jqXhr.responseJSON;n?(t=n.Message,t&&t.length||(t=n.Error)):e.data&&(t=e.data.Error)}return t}function l(e){var t=ut.isCaptchaRequired(e);return t||(t=ut.isVisible()),t}function c(e){var n=s(e),i=e.jqXhr;nt.WriteDebugLog("handleSignInError","error",n);var a="errorText",r=!0;if(l(i)){var o=ut.forceSignInCaptcha();ot.initStyling(!0);var c=ut.isError()||o;R(c),r=!1}else ut.remove();var f=tt("#buttonSignInProfile");void 0!=f.attr("title")&&f.text(f.attr("title"));var h=rt.errorToCode(n),p=h.errorCodeEx,m=h.errorCode;if(m.indexOf("captcha")>-1)return ut.showError(m),tt("#buttonSignInProfile").removeClass("disabled").show(),nt.stopSpinner(tt("div.buttonSignInWrapper span")).hide(),pt.trackEvent(pt.category.profile,pt.action.profile_sign_in_recaptcha_failure),void rt.notifyGameSignInFailed(m,p);if(!vt.signInRetry&&"3003"===m)return vt.signInRetry=!0,void vt.signInOnline();var g=rt.parseSignInError(m,p,r,i,rt.autoSignInData),v=Promise.resolve({isOfflineFallback:!1,reloadLoginForm:g.reloadLoginForm,errorMsg:g.errorMsg});switch(g.type){case"SteamAlreadyLinked":pt.trackEvent(pt.category.profile,pt.action.profile_sign_in_failure_steam_already_linked);break;case"Banned":pt.trackEvent(pt.category.profile,pt.action.profile_sign_in_failure_banned);break;case"TooManyLoginAttempts":a+=" signInErrorText",pt.trackEvent(pt.category.profile,pt.action.profile_sign_in_failure_too_many_login_attempts);break;case"AuthenticationFailed":et(),a+=" signInErrorText",it.errorCodeExIs(p,"SteamAPI")||pt.trackEvent(pt.category.profile,pt.action.profile_sign_in_auth_failed);break;case"Steam":pt.trackEvent(pt.category.profile,pt.action.profile_sign_in_failure_other_steam_error);break;case"RateLimit":case"SteamAutoLogin":break;case"Unknown":var b=tt("#signInEmailProfile").val();v=rt.getRockstarIdAsync(b).then(function(e){return rt.checkOfflineFallbackAsync(e,g.errorCodeEx)}).then(t).then(function(e){return rt.formatOfflineFallbackDataAsync(e,g.reloadLoginForm)}).catch(rt.fallbackSigninFailedAsync).then(function(e){return e.reloadLoginForm?(tt("div.signIn span.errorText").remove(),tt(".headerMask").hide(),tt("#mainNav").show()):ot.showGenericFatalError(e.errorCode,e.errorMsg,ht.getError("ErrorSupport"),e.errorCodeDesc),e}).catch(ot.showGenericFatalError)}v.catch(function(e){nt.WriteDebugLog("handleSignInError","asyncComplete error",e)}).then(function(e){if(!e||!e.isOfflineFallback){if(it.isSteam()&&nt.isSteamV2Enabled()&&it.errorCodeExIs(p,"SteamAPI")&&it.errorCodeIs(m,"AuthenticationFailed"))return void ft.CallGameMethod("RGSC_REFRESH_STEAM_TICKET",null,"RGSC_REFRESH_STEAM_TICKET_DEMO");it.isSteam()&&rt.autoSignInData&&(it.errorCodeExIs(p,"SteamAPI")||it.errorCodeIs(m,"DoesNotExist")&&it.errorCodeExIs(p,"PlayerAccount"))?(ot.requestUiState(!0),setTimeout(function(){nt.pubsub.trigger("signin.showSignin",it.isOnline(),!1)},0)):e&&e.reloadLoginForm?(ot.requestUiState(!0),nt.pubsub.once("RGSC_JS_UI_STATE_RESPONSE",u(a,e.errorMsg))):d(a,e.errorMsg),rt.notifyGameSignInFailed(m,p),nt.stopSpinner(tt("div.buttonSignInWrapper span")).hide(),tt("a.buttonSignIn.disabled").removeClass("disabled"),tt("#buttonSignInProfile").show()}})}function u(e,t){nt.pubsub.trigger("signin.showSignin",it.isOnline(),!0),d(e,t)}function d(e,t){var n=tt("div.signIn");n.find(".errorText").remove(),n.find(".SignInError").after('<span class="'+e+'">'+t+"</span>")}function f(e){return"string"==typeof e&&e.length?void(vt.cache.prepopulateEmail=e):void(vt.cache.prepopulateEmail=void 0)}function h(){if("undefined"!=typeof vt.cache.prepopulateEmail){var e=tt("#signInEmailProfile");if(e.val().length>0&&e.val()!==vt.cache.prepopulateEmail)return;e.val(vt.cache.prepopulateEmail),tt("#rememberMeProfile").prop("checked",!0)}}function p(){vt.cache.prepopulateEmail=void 0}function m(e,t,n,a){if(nt.WriteDebugLog("selectProfile","rockstarId, local, profileList, nickname",e+","+t+","+n+","+a),tt("#existingProfiles").find("a.profileButton").removeClass("selected").end().find("[data-userid='"+e+"']").addClass("selected"),t)return i(e,a),Promise.resolve();var r;return r=null!=n?Promise.resolve(JSON.parse(n||"null")):rt.getProfileAsync(e),r.then(function(e){if(e){if("undefined"==typeof e.Nickname)return nt.WriteDebugLog("SelectProfile","ERROR","Profile not found"),void ot.showGenericFatalError();nt.WriteDebugLog("SelectProfile","Loading profile nickname, email",e.Nickname+","+e.Email);var t=tt("#selectProfile").find(".selectSignIn");nt.WriteDebugLog("SelectProfile","selectSignInButton.length",t.length),(it.isOffline()||!tt("#signInProfile").is(":visible"))&&(ot.forceLoginForm(),nt.pubsub.trigger("signin:showPageSignIn"));var n=tt("#selectProfile");n.find("input[name=signInOptionsProfile]").prop("checked",!1),n.find("#signInEmailProfile").val(""),n.find("#signInPasswordProfile").val(""),(e.SaveEmail||e.AutoSignIn)&&(e.Email&&(n.find("#signInEmailProfile").val(e.Email),n.find("#rememberMeProfile").prop("checked",!0)),e.Password&&n.find("#signInPasswordProfile").val(e.Password)),e.AutoSignIn&&n.find("#autoSignInProfile").prop("checked",!0),n.find("#buttonSignInProfile").focus()}}).catch(ot.showGenericFatalError)}function g(){var e=tt("#selectProfile.active").length;it.isScuiVisible()?e||ot.clearActivePanel(function(){vt.showSignin(it.isOnline(),!0)}):(tt("div.panel.active").removeClass("active"),ot.requestUiState(!0),ot.clearActivePanel(function(){ot.setUpLoadingPanel("#selectProfile",function(){vt.showSignin(it.isOnline(),!0)})}))}function v(e){var t,n=tt("div.signIn");e&&e.ScAuthTokenError?(t="AuthTokenInvalid",vt.sdkSignInFailure=!0):n.find(".errorText").length||ut.isError()||globals.showLockedAccountCaptchaSignIn||(t=globals.isNLE?"NotFound":"NotFoundEmail"),"string"==typeof t&&n.find(".SignInError").after('<span class="errorText">'+ht.getError(t)+"</span>"),rt.clearAutoSigninData(),g(),vt.resetSignInWrapper()}function b(e){if(void 0!=e.ticket&&null!=e.ticket&&(mt.setUserId(e.RockstarId),mt.setCustomDimension(mt.dimension.loginState,"true"),mt.getCustomDimensionData()),void 0!=e.RockstarId&&null!=e.RockstarId){nt.WriteDebugLog("handleSigninSuccess","jsonResult.RockstarId",e.RockstarId),tt("#editRockstarId").val(e.RockstarId);var t=rt.getOfflineSigninCount();mt.setCustomMetric(mt.metric.offlineSigninCount,t)}if(void 0==e.SignedOnline&&null==e.SignedOnline){var n=it.isOnline();e.Nickname&&"LocalProfile1"===e.Nickname&&(n=!1),e={SignedIn:!0,SignedOnline:n,ProfileSaved:!0,AchievementsSynched:!0},nt.WriteDebugLog("handleSigninSuccess","jsonResult",JSON.stringify(e))}if(void 0!=e.SignedOnline){if(e.SignedOnline)nt.WriteDebugLog("handleSigninSuccess","UpdatePassword",e.UpdatePassword?"true":"false"),it.isSteam()&&ot.isActivation()?nt.pubsub.trigger("steam:showActivationSteamSuccess"):!globals.isLauncher&&globals.updatePassword?k():ot.setProfileHtml(e.Local);else if(e.Local){if(ot.setProfileHtml(!0),void 0!=e.CallbackData&&1&e.CallbackData)return ot.setUpSignedInOptions(e.SignedIn,e.Local),void ot.requestUiState(!1)}else globals.account&&(it.isOffline(!0),ot.setProfileHtml(!1));ot.setUpSignedInOptions(e.SignedIn,e.Local)}S(e),rt.clearCachedProfileList(),vt.isCountryOrDobRequired(e.SignedOnline)?(nt.pubsub.once("RGSC_JS_UI_STATE_RESPONSE",function(){at.ShowCountryOrDobPrompt()}),ot.requestUiState(!0)):(ft.launcherNotifyEvent("SignIn"),y(e))}function C(e,t){if("undefined"!=typeof e.ProfileSaved&&e.ProfileSaved===!1){var n={iss:it.isSteam(),l:globals.titlelang};nt.WriteDebugLog("RGSC_JS_FINISH_SIGN_IN","ProfileSaved:false",t+"; "+JSON.stringify(n)+globals.debugLog,nt.logType.error,nt.logController[globals.titleName])}}function S(e){if(st.isDesktopPlatform()){var t,n="",i="",a=1,r=ht.getText("SignedIn","Notifications");e.SignedOnline||(r+=" ["+ht.getText("Offline","Social")+"]"),t='{ "Type" : "SIGNEDIN", "Count" : 1, "Data" : [ { "Id" : "SignedIn", "Name": "'+globals.account.Nickname+'", "Description" : "'+r+'" } ] }',e.NumInvitesReceieved&&e.NumInvitesReceieved>0&&(n=', { "Type" : "FRIENDREQUESTS", "Count" : 1, "Data" : [ { "Id" : "NumInvites", "Name": "[ '+e.NumInvitesReceieved+' ]", "Description" : "'+ht.getText("FriendRequests","Notifications")+'" } ] }',a++),e.NumFriendsOnline&&e.NumFriendsOnline>0&&(i=', { "Type" : "FRIENDSONLINE", "Count" : 1, "Data" : [ { "Id" : "NumFriends", "Name": "[ '+e.NumFriendsOnline+' ]", "Description" : "'+ht.getText("FriendsOnline","Notifications")+'" } ] }',a++),it.pubsub.publish("SDK.RGSC_JS_NOTIFICATION",'{ "Count" : '+a+', "Notifications" : ['+t+n+i+"] }")}}function y(t){if(E(t))ot.requestUiState(!1);else{var n=w();n||(nt.WriteDebugLog("afterSignInTidyUp","baseUtils.isScuiVisible() ; !isActivation ; !isEditProfile ; !isSignInOrSignUpOrMissingDetails ;  homeButtonEnabledOrNotPc ; !signinUtils.areSigninCredsFromGame",it.isScuiVisible()+" "+!ot.isActivation()+" "+!ot.isEditProfile()+" "+!ot.isSignInOrSignUpOrMissingDetails()+" "+_()+" "+!rt.areSigninCredsFromGame()),!it.isScuiVisible()||ot.isActivation()||ot.isEditProfile()||ot.isSignInOrSignUpOrMissingDetails()||!_()||rt.areSigninCredsFromGame()||e(["setup.environment"],function(e){e.showHomepage(!0)}))
}vt.clearSigninForm(),it.isSteam()&&nt.HideNonSteamFeatures(),vt.resetSignInWrapper()}function w(){if("function"==typeof globals.navAfterSigninCallback)return globals.navAfterSigninCallback(),delete globals.navAfterSigninCallback,!0;var e=tt("#mainNav, #headerLoginOptions, .sideMenu").find(".pendingSignIn");if(e.length>0){e.removeClass("pendingSignIn");var t=e.filter(":first");return nt.WriteDebugLog("navigateAfterSignIn","Pending Sign In",t.attr("id")),t.click(),!0}return!1}function _(){var e=tt("#homeButton").hasClass("disabled");return!e||"pcros"!==globals.platform}function E(e){var t=void 0!=e.CallbackData&&2===(2&e.CallbackData);return nt.WriteDebugLog("isAutoSignin","jsonResult.CallbackData, value",e.CallbackData+", "+JSON.stringify(t)),t}function k(){tt("#statsButton").show(),nt.pubsub.trigger("settingsFn.loadSettings"),tt("a.editPassword").click(),tt("#editProfile").find(".rowAnchor.editlink.editPassword").hide(),tt("#passwordForm .errors").append('<span class="pwerror errorText">'+ht.getError("PasswordUpdate")+"</span>")}function T(e){var t=tt("div.panel.active");t.length&&parseInt(t.css("top"),10)<0&&ot.showPanel(t);var n=globals.signInReCaptchaEnabled&&(globals.showSignInRecaptcha||globals.showAltSignInRecaptcha);if(n)return void A();var i=globals.signInReCaptchaEnabled&&globals.showLockedAccountCaptchaSignIn;if(i){globals.showLockedAccountCaptchaSignIn=!1;var a=!0;return L(a),void M()}tt.when($()).done(function(){var t=tt("#signInProfile");K(t),D(e);var n=P(),i=it.isOffline(),a=it.isNewSigninFlowEnabled(),r=it.isLegacyServiceLayer();i?(a?N():(O(),r&&!ot.isForceLoginForm(t)?H():n&&N()),n||B(a),W(n)):(a?N():(O(),N()),n||G())})}function I(){globals.localProfileCreation&&tt.when(vt.loadGameProfilesAsync()).done(function(){D();var e=P(),t=it.isOffline();O(),H(),t&&W(),e||G()})}function R(e){var t=it.isOffline();if(!t){D(e);var n=globals.signInReCaptchaEnabled&&(globals.showSignInRecaptcha||globals.showAltSignInRecaptcha);n&&!e?F():N(),x()}}function A(){var e=tt(".previousSignInErrorMessage").is(":visible")||ut.isVisible();return e&&!Y()?void L():void tt.when(vt.loadGameProfilesAsync()).done(function(){K(),D(),F();var e=it.isNewSigninFlowEnabled();e||O()})}function L(e){D(e);var t=it.isNewSigninFlowEnabled();t?(N(),x()):(O(),N()),j()}function P(){var e=tt("#selectProfile").find("#existingProfiles").html().length>0;return e||(vt.loadGameProfiles(),e=tt("#selectProfile").find("#existingProfiles").html().length>0),e}function D(e){0==tt("#mainNav").find(".pendingSignIn").length&&ot.setSelected(),nt.removeLoading("selectProfile");var t=tt("#selectProfile"),n=tt("#signInProfile"),i=tt(".formSignIn");i.hide(),i.find(".forgot").hide(),n.hide(),n.find(".buttonSignInQuitGame").hide(),n.find(".offlineMode").hide(),n.find(".previousSignInErrorMessage").hide(),n.find("#buttonSignInProfile").hide(),n.find("#buttonGoToSignIn").hide(),n.find(".orCreateAccount").hide(),n.find(".noExistingProfiles").hide(),tt("div.active").find("form.resetPasswordForm, .buttonResetWrapper").hide(),et();var a=t.find(".profileList");a.hide(),a.find(".noExistingProfiles").hide(),t.find(".noProfiles").hide(),t.find(".profilesExist").hide(),t.find("a.needAccountLink").hide(),t.find(".troubleSigningIn").hide(),t.find(".resetPasswordForm.signInEmailPasswordResetForm").hide(),t.find(".resetSuccessMsg").hide(),t.removeClass("nobg"),tt("#createProfileOffline").hide(),at.resetSigninButtonText(),e||Q(),q(e),J(e)}function x(){var e=tt("#signInProfile"),t=P();tt(".troubleSigningIn, .resetPasswordForm, .buttonResetWrapper").show(),tt(".formSignIn").find(".forgot").hide(),e.find(".buttonSignInQuitGame").hide(),!it.isNewSigninFlowEnabled()||globals.signInReCaptchaEnabled&&(globals.showSignInRecaptcha||globals.showAltSignInRecaptcha)?tt(".noExistingProfiles").hide():t||tt(".noExistingProfiles").show(),tt("#selectProfile").addClass("nobg")}function N(){var e=tt("#signInProfile");ot.resetForceLoginForm(e);var t=it.isOffline(),n=it.isLegacyServiceLayer(),i=globals.signInReCaptchaEnabled&&(globals.showSignInRecaptcha||globals.showAltSignInRecaptcha),a=it.isNewSigninFlowEnabled();e.show(),i||e.removeClass("verify"),tt(".formSignIn").show(),tt(".formSignIn").find("fieldset").show(),tt("div.active, .active .buttonSignInWrapper").show(),tt("#buttonSignInProfile").show(),e.find(".buttonSignInQuitGame").show(),h(),n&&tt("#signInEmailProfile").attr("placeholder",ht.getText("Email","HomeSignin")),t||(e.find(".forgot").show(),a&&tt(".orCreateAccount").show())}function M(){tt(".formSignIn").find("fieldset").hide()}function O(){var e=P();if(!e)return void U();var t=it.isOffline(),n=tt("#selectProfile");n.find(".profilesExist").show(),t||tt("a.needAccountLink").show()}function U(){var e=it.isOffline();if(e){var t=tt("#selectProfile");globals.signInReCaptchaEnabled&&(globals.showSignInRecaptcha||globals.showAltSignInRecaptcha)||t.find(".profilesExist").show()}else tt("#selectProfile").find(".noProfiles").show(),tt("a.needAccountLink").show(),G()}function F(){tt("#buttonGoToSignIn, .previousSignInErrorMessage").show(),tt("#selectProfile").removeClass("nobg"),tt("#signInProfile").show().addClass("verify")}function G(){var e,t=ht.getText("CreateSCAccount2","HomeSignin");t=t.replace("[title]",globals.titleDisplayName);var n=it.isNewSigninFlowEnabled();e=n?tt("#selectProfile").find(".noExistingProfiles"):tt(".profileList").find(".noExistingProfiles"),e.html("<p>"+t+"</p>"),e.find("a").attr("tabindex","6"),e.show()}function V(){var e=it.isNewSigninFlowEnabled();e?tt("#signInProfile").find(".noExistingProfiles").hide():tt(".profileList").find(".noExistingProfiles").hide()}function j(){V(),tt("#signInProfile").addClass("verify"),ut.forceSignInCaptcha()}function W(e){if(e)tt(".offline-NoLocalProfiles").hide(),tt(".offline-LocalProfiles").show(),tt("#selectProfile").addClass("hasProfiles");else{var t=ot.InternetConnectedStateAsync();t.done(function(e){var t="";e===!1&&(t=ht.getError("NoInternet"));var n=tt(".offline-NoLocalProfiles");n.find("#offline-connectionCheckMsg").remove();var i=n.find("p");"lanoire"===globals.titleName&&(n.find("h1").text(ht.getText("offlineTitle","HomeSignin")),i.text(ht.getText("OfflineSigninNotAvailableLan","HomeSignin"))),i.append("<span id='offline-connectionCheckMsg'><br/><br/>"+t+"</span>"),n.show(),tt(".offline-LocalProfiles").hide()})}}function B(e){if(tt("#headerLogin").hide(),e){var t=tt("#signInProfile");t.find(".formSignIn").hide(),t.find("div.offlineMode").addClass("noProfiles")}else{var n=tt("#selectProfile").find(".profileList");n.find("h1").first().hide(),n.find("h3").hide(),n.find("div.offlineMode").addClass("noProfiles")}}function H(){var e=tt("#createProfileOffline");return e.is(":visible")?void U():(e.show(),e.find(".buttonSignInWrapper").show(),void tt(".formSignIn").show())}function q(e){void 0!=e&&e||(tt("div.signIn").find("span.errorText, span.error").remove(),globals.signInReCaptchaEnabled&&(globals.showSignInRecaptcha||globals.showAltSignInRecaptcha)||tt("signInProfile").find(ut.getSigninInputSelector()).empty()),tt("#buttonSignInProfile").removeClass("disabled").show(),tt("#rememberMeProfile, #autoSignInProfile").prop("checked",!1),nt.stopSpinner(tt("div.buttonSignInWrapper span")).hide()}function J(e){void 0!=e&&e||tt("div.troubleSigningIn").find("span.errorText, span.error").remove(),tt("#buttonSignInPasswordReset").removeClass("disabled"),nt.stopSpinner(tt(".resetSpinner")).hide(),nt.stopSpinner(tt("div.buttonSignInWrapper span")).hide()}function $(){var e,t=tt("#signInProfile"),n=!Y(t)&&(t.is(":visible")||tt("#createProfileOffline").is(":visible"));return n?"undefined"==typeof vt.cache.loadProfilesPromise?(vt.cache.loadProfilesPromise=vt.loadGameProfilesAsync(),e=vt.cache.loadProfilesPromise):e=vt.cache.loadProfilesPromise:(vt.cache.loadProfilesPromise=vt.loadGameProfilesAsync(),e=vt.cache.loadProfilesPromise),e}function z(e){var t=e||tt("#signInProfile");t.data("reload",!0)}function Y(e){var t=e||tt("#signInProfile");return void 0!=t.data("reload")&&t.data("reload")===!0}function K(e){var t=e||tt("#signInProfile");t.removeData("reload")}function Q(){var e=at.CaptchaSelector();ot.clearForms(e)}function X(){tt("#buttonSignInPasswordReset").click(function(){var e=tt(this);if(e.hasClass("disabled"))return!1;e.addClass("disabled"),ct.clearErrorClasses();var t="signInEmailRetrievePassword";return ct.EmailValidation(t)?(e.hide(),nt.initSpinner(tt("#resetSpinner")).show(),tt("div.active .buttonResetWrapper span").show(),vt.resetPassword(t),!0):(e.removeClass("disabled"),!1)}),tt("#buttonCancelPasswordReset").click(function(e){e&&e.preventDefault(),z(),vt.showSignin()})}function Z(){tt(".buttonSignInWrapper span").show()}function et(){tt(".buttonSignInWrapper span").hide()}var tt=e("jquery"),nt=e("utils"),it=e("common/baseUtils"),at=e("common/profile/profile-utils"),rt=e("common/profile/signin-utils"),ot=e("setup.environment.utils"),st=e("common/datafunctions"),lt=e("common/datafunctions.friends"),ct=e("common/formvalidation"),ut=e("common/captcha"),dt=e("common/steam"),ft=e("common/sdk"),ht=e("common/localize"),pt=e("am"),mt=e("common/am/customDimensions"),gt=e("common/auth");e("common/jquery.visible");var vt={cache:{},sdkSignInFailure:!1,signInRetry:!1};return vt.init=function(){tt(".buttonSignInQuitGame").click(function(e){e&&e.preventDefault(),tt(this).hasClass("disabled")||ot.quitGame()}),tt("#lnkCreateOfflineProfile").click(function(e){e&&e.preventDefault(),globals.localProfileCreation&&I()}),tt("#createProfileOffline").find(".formSignIn").on("submit",function(){return tt("#buttonCreateProfileOffline").click(),!1}),tt("#buttonCreateProfileOffline").click(function(){var e=!1;return ct.clearErrorClasses(),ct.NicknameValidation("createProfileNickname")&&ct.LocalNicknameValidation()&&(Z(),i("",tt.trim(tt("#createProfileNickname").val())),e=!0),e}),tt("#autoSignInProfile").on("click",function(){tt(this).is(":checked")&&tt("#rememberMeProfile").prop("checked",!0)}),tt("#rememberMeProfile").on("click",function(){tt(this).is(":checked")||tt("#autoSignInProfile").prop("checked",!1)}),tt("#buttonSignInProfile").click(function(e){e&&e.preventDefault();var t=tt(this);if(!t.hasClass("disabled")){if(t.addClass("disabled").hide(),t.attr("title",t.text()),nt.ShowInvisibleMask(t,ht.getError("Loading")),nt.initSpinner(t.next()).fadeIn(),at.setAutoSignInValues(tt("#autoSignInProfile").is(":checked")),!ct.SignInValidation())return t.removeClass("disabled").show(),nt.HideInvisibleMask(),void nt.stopSpinner(t.next()).hide();Z(),setTimeout(vt.signInOnline,100)}}),tt("a.forgotPasswordLink").keydown(function(e){var t=tt(e.currentTarget);13==e.which&&t.visible()&&tt(this).click()}).click(function(){return R(!1),!1}),tt("#signInEmailPasswordResetForm").submit(function(e){e&&e.preventDefault(),tt("#buttonSignInPasswordReset").click()}),tt("#buttonGoToSignIn").click(function(e){e&&e.preventDefault(),L()}),tt("#existingProfiles").on("click","a.profileButton",function(e){e&&e.preventDefault();var t=tt(this),n=t.attr("data-userid");T(),m(n,t.data("local"),null,t.data("nick"))}),tt("#menuSignOut").click(function(){if(it.isLogoutDisabled())return!1;if(ot.setSelected(),!tt("#signOut").hasClass("active")){var e=tt("div.panel.active");tt("#signOut").removeAttr("data-prevPanel"),e.length&&e.attr("id").length&&tt("#signOut").attr("data-prevPanel",e.attr("id")),ot.clearActivePanel(function(){ot.setUpLoadingPanel("#signOut",function(){tt("#buttonSignOutNo").focus()})})}return!1}),tt("#buttonSignOutYes").click(function(e){e&&e.preventDefault(),vt.signOut()}),tt("#buttonSignOutNo").click(function(){var e=tt("#mainNav").find("li.on a");return e.length?e.click():tt("#signOut").attr("data-prevPanel").length?ot.clearActivePanel(function(){var e=tt("#signOut").attr("data-prevPanel");ot.setUpLoadingPanel("#"+e),ot.removeLoading(e)}):nt.pubsub.trigger("setupEnv:showHomepage",!0),!1}),X()},vt.signOut=function(){ot.clearActivePanel(function(){ft.CallGameMethod("RGSC_SIGN_OUT",null,"RGSC_SIGN_OUT_DEMO"),ot.closeModalsAndHideMenu(),rt.clearAccount(),tt(".statusbar").empty().hide(),lt.ClearGetFriendsCache(),nt.pubsub.trigger("signout:completed"),lt.closeCompareStats(),pt.endSession(),ft.CallGameMethod("RGSC_DESTROY_COMMERCE_DATA",null,"RGSC_DESTROY_COMMERCE_DATA_DEMO"),ot.setUpSignedInOptions(!1,it.isOffline()),it.isScuiVisible()&&vt.showSignin(it.isOnline())})},vt.sdkAutoSignInRequest=function(e){return rt.setAutoSigninData(e),it.isLoadedInOfflineMode()&&(ot.setOffline(!0),void 0!=e.Local&&!e.Local&&void 0!=e.RockstarId)?void n(e.RockstarId):void(rt.isCredsFromGameAvailable(e)||it.isSteam()?(pt.trackPage("/Signin_Auto"),vt.signInOnline()):null==e.Local||!e.Local||null==e.Nickname&&null==e.RockstarId||i(e.RockstarId,e.Nickname))},vt.signInOnline=function(){if(rt.clearAreSigninCredsFromGame(),it.isOffline())return null==rt.autoSignInData||void 0==rt.autoSignInData.RockstarId&&void 0==rt.autoSignInData.Nickname?n(null):m(rt.autoSignInData.RockstarId,!1,null,rt.autoSignInData.Nickname);ut.hideError();var e={captchaData:ut.getCaptchaData()};return rt.autoSignInData?(e.email=rt.autoSignInData.Email,e.password=rt.autoSignInData.Password):(e.email=tt("#signInEmailProfile").val(),e.password=tt("#signInPasswordProfile").val()),st.signInAsync(rt.autoSignInData,e).then(vt.onSuccessSignIn).catch(c).then(a)},vt.onSuccessSignIn=function(e){var t=e.data;if(!t.Status)return void c(e);if("gta5"==globals.titleName&&0==tt("#onlineStatsLink").length){var n=tt("#statsPanel .sideMenu #statsLink2").parent();tt('<li><a id="onlineStatsLink" href="#"><i></i><span>'+ht.getText("OnlineStatistics","HomeSignin")+"</span></a></li>").insertAfter(n)}ut.remove(),tt("#formAccountDetails").find("span.errorText").remove(),tt("#signupDobContainer").find("select").prop("disabled",!1),tt("#signupDobContainer").find(".dk_container").removeClass("disabled"),tt("#signupDetailsContainer").show();var i={checked:tt("#autoSignInProfile").is(":checked")?!0:!1,pass:tt("#signInPasswordProfile").val(),save:tt("#rememberMeProfile").is(":checked")?!0:!1},a=rt.getSigninJson(t,i);if(rt.updateGlobalsOnSignIn(t,rt.autoSignInData),r(t),it.isLegacyServiceLayer()&&gt.storeLanAuthValue(t.Auth),o(t),at.setAutoSignInValues(a.AutoSignIn),a.SaveEmail||p(),it.isSteam())try{var s=dt.getSteamNetworkAsync(globals.account.RockstarId,a.ticket);s.done(function(e){e&&void 0!=e.AccountId?dt.BindSteamAccount(globals.steamAppId,globals.steamAuthTicket,a):dt.SteamLinkPrompt(a),e=null}),s.fail(function(){dt.SteamLinkPrompt(a)})}catch(l){return ft.CallGameMethod(null,null,"RGSC_JS_FINISH_SIGN_IN"),nt.WriteDebugLog("onSuccessSignIn","ERROR in getSteamNetwork","",nt.logType.error,nt.logController[globals.titleName]),void c(e)}else{globals.account&&ot.setProfileHtml(a.Local);try{rt.signInToGame(a)}catch(l){return ft.CallGameMethod(null,null,"RGSC_JS_FINISH_SIGN_IN"),a={code:"error",content:"<redacted>"},nt.WriteDebugLog("onSuccessSignIn","ERROR jsonString",JSON.stringify(a)),void nt.WriteDebugLog("onSuccessSignIn","signInToGame exception",l&&l.message?l.message:"",nt.logType.error,nt.logController[globals.titleName])}}pt.trackEvent(pt.category.profile,pt.action.profile_sign_in);var u=rt.getOfflineSigninCount();u>0&&(pt.trackEvent(pt.category.profile,pt.action.profile_sign_in_offline),rt.setOfflineSigninCount(0)),vt.signInRetry=!1},vt.loadGameProfilesAsync=function(){var e=new tt.Deferred;return tt("#selectProfile").hasClass("active")?tt.when(vt.loadGameProfiles()).then(function(t){e.resolve(t)},e.reject):ot.clearActivePanel(function(){ot.setUpLoadingPanel("#selectProfile",function(){tt.when(vt.loadGameProfiles()).then(function(t){e.resolve(t)},e.reject)})}),e.promise()},vt.loadGameProfiles=function(){nt.WriteDebugLog("LoadGameProfiles");var e=new tt.Deferred,t=rt.getProfileListAsync();return t.then(function(t){if(t&&t.NumProfiles>0){var n=0,i=[],a=ht.getText("LastVisit","HomeSignin");tt.each(t.Profiles,function(e,t){try{if(!t.SaveEmail&&!t.Local)return;0===e&&t.SaveEmail&&f(t.Email),nt.WriteDebugLog("LoadGameProfiles","Id,Nick",t.RockstarId+","+t.Nickname);var r="info",o="";n++,void 0==t.Local&&(t.Local=!1),t.Local&&(r+=" local","0"==t.RockstarId&&"1969-12-31"==nt.ConvertDateString(t.LastSignInTime)&&n--);var s=void 0!=t.RockstarId?t.RockstarId:"";i.push('<a class="profileButton gold" href="#" data-userid="'+s+'" data-local="'+t.Local+'" data-nick="'+t.Nickname+'"><img id="imgProfile'+e+'" width="32" height="32" class="avatarImg" alt="'+t.Nickname+'" src="'+o+'"/><span class="text '+r+'"><h5 class="profilenickname">'+t.Nickname+'</h5><span class="subText">'+a+" "+nt.ConvertDateString(t.LastSignInTime)+"</span></span></a>"),nt.WriteDebugLog("LoadGameProfiles","RemMe,RemPW,Auto",t.SaveEmail+","+t.SavePassword+","+t.AutoSignIn)}catch(l){nt.WriteDebugLog("LoadGameProfiles","ERROR LOADING PROFILE nick",t.Nickname,nt.logType.error,nt.logController.profile)}}),tt("#profileCount").html(n),tt("#existingProfiles").html(i.join("")),tt("#existingProfiles").find(".avatarImg").on("error",nt.avatar404),tt.each(t.Profiles,function(e,t){globals.avatarServiceEnabled?tt("#imgProfile"+e).attr("src",nt.getAvatarUrl(t.AvatarUrl,t.Nickname,32)):t.AvatarUrl&&!t.AvatarUrl.match(/default.png$/)?tt("#imgProfile"+e).attr("src",ot.getAvatarSource(t.AvatarUrl,32,tt("#imgProfile"+e))):tt("#imgProfile"+e).attr("src",nt.getAvatarUrlFromUrl("",32))}),ot.resetScrollbar("#existingProfilesContainer, #profileList")}e.resolve()}).catch(function(){e.reject()}),e.promise()},vt.showSignin=function(e,t){return globals.signInRequested?(nt.WriteDebugLog("signin.showSignin","denied","RGSC_JS_FINISH_SIGN_IN not yet returned"),!1):(nt.WriteDebugLog("signin.showSignin","online",e),(void 0!=e&&!e||!globals.scsServiceEnabled)&&ot.setOffline(!0),it.isSteam()&&nt.HideNonSteamFeatures(),ot.showHeaderMenu(),vt.sdkSignInFailure&&(t=!0),it.isSignedIn()?nt.pubsub.trigger("setupEnv:showHomepage",!0):(ot.initHeaderMenu(!1,!0),T(t),mt.startSession(),pt.trackPage("/Signin")),!0)},vt.clearSigninForm=function(){Q(),tt("#signIn input:checkbox").prop("checked",!1),tt("#selectProfile input:checkbox").prop("checked",!1)},vt.resetSignInWrapper=function(){tt("a.btn.disabled:first").removeClass("disabled"),tt("a.buttonSignIn.disabled").removeClass("disabled"),tt("#buttonSignInProfile").show(),nt.stopSpinner(tt("div.buttonSignInWrapper span")).hide()},vt.isCountryOrDobRequired=function(e){var t=at.isDobMissing(),n=at.isCountryMissing();return e&&(t||n)},vt.gameFinishedSignin=function(e){nt.HideInvisibleMask(),rt.clearSignInRequestNote(),vt.sdkSignInFailure=!1;var t=tt.parseJSON(e||"null");null!=t?(nt.WriteDebugLog("gameFinishedSignin","jsonResult.SignedIn",t.SignedIn),C(t,e),t.SignedIn?b(t):v(t)):v(t),nt.stopSpinner(tt("div.buttonSignInWrapper span")).hide(),setTimeout(function(){nt.pubsub.trigger("signin:signinComplete")},500)},vt.resetPassword=function(e){var t=tt("#"+e).val();nt.WriteDebugLog("signin.resetPassword","email",t),tt(".troubleSigningIn .resetPasswordForm .errors").html(""),st.resetPassword(t).then(function(e){var t="true"===tt(e).find("Status").text();t&&(tt(".active .resetSuccessMsg").show(),tt("#signInEmailPasswordResetForm").hide())}).catch(function(e){nt.WriteDebugLog("signin.resetPassword","ajax error caught",e)}).then(function(){nt.stopSpinner(tt("#resetSpinner")).fadeOut(function(){var e=tt("#buttonSignInPasswordReset");e.removeClass("disabled"),e.fadeIn()}),tt("a.btn.disabled:first").removeClass("disabled")}).catch(function(e){nt.WriteDebugLog("signin.resetPassword","unhandled exception",e,nt.logType.error,nt.logController.profile)})},nt.pubsub.on("signin.signOut",vt.signOut),nt.pubsub.on("signin.showSignin",vt.showSignin),nt.pubsub.on("signin:showPageSignIn",T),vt}),function(e,t,n){var i=navigator.userAgent.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/),a=!!i,r=a&&parseFloat(i[1])<7,o=navigator.userAgent.match(/iPad|iPhone|Android|IEMobile|BlackBerry/i),s={},l=[],c={pgup:33,pgdown:34,end:35,home:36,left:37,up:38,right:39,down:40,enter:13,tab:9,zero:48,z:90,last:221},u=['<div class="dk_container" id="dk_container_{{ id }}" tabindex="{{ tabindex }}" aria-hidden="true">','<a class="dk_toggle dk_label">{{ label }}</a>','<div class="dk_options">','<ul class="dk_options_inner" role="main" aria-hidden="true">',"</ul>","</div>","</div>"].join(""),d='<li><a data-dk-dropdown-value="{{ value }}">{{ text }}</a></li>',u=['<div class="dk_container" id="dk_container_{{ id }}" tabindex="{{ tabindex }}" aria-hidden="true">','<a class="dk_toggle dk_label">{{ iconTmp }}{{ imgTmp }}{{ label }}</a>','<div class="dk_options">','<ul class="dk_options_inner" role="main" aria-hidden="true">',"</ul>","</div>","</div>"].join(""),d='<li class="{{ current }}{{ disabled }}"><a data-dk-dropdown-value="{{ value }}">{{ iconTmp }}{{ imgTmp }}{{ text }}</a></li>',f='<i class="dkicon {{ icon }}"></i>',h='<img class="dkimg" src="{{ img }}"/>',p={startSpeed:400,theme:!1,changes:!1,syncReverse:!0,nativeMobile:!0,autoWidth:!0},m=null,g=null,v=function(e,t,n){var i,a,r,o;i=e.attr("data-dk-dropdown-value"),a=e.text(),a=e.html(),r=t.data("dropkick"),o=r.$select,o.val(i).trigger("change"),t.find(".dk_label").text(a),t.find(".dk_label").html(a),n=n||!1,!r.settings.change||n||r.settings.syncReverse||r.settings.change.call(o,i,a)},b=function(e){e.removeClass("dk_open dk_open_top"),m=null},C=function(n){var i=n.find(".dk_toggle"),a=n.find(".dk_options").outerHeight(),r=e(t).height()-i.outerHeight()-i.offset().top+e(t).scrollTop(),o=i.offset().top-e(t).scrollTop();return o>a?r>a:!0},S=function(e,t,n){var i=e.find(".dk_options_inner"),a=t.prevAll("li").outerHeight()*t.prevAll("li").length,r=i.scrollTop(),o=i.height()+i.scrollTop()-t.outerHeight();(n&&"keydown"===n.type||r>a||a>o)&&i.scrollTop(a)},y=function(e,t){if(!e.hasClass("disabled")){var n=C(e);m=e.toggleClass("dk_open");var n=C(e),i=n?"dk_open":"dk_open_top dk_open";e.find(".dk_options").css({top:n?e.find(".dk_toggle").outerHeight()-1:"",bottom:n?"":e.find(".dk_toggle").outerHeight()-1}),m=e.addClass(i),S(e,e.find(".dk_option_current"),t)}},w=function(e,t,n){t.find(".dk_option_current").removeClass("dk_option_current"),e.addClass("dk_option_current"),S(t,e,n)},_=function(t,n){var i,a,r,o,s,l,u,d=t.keyCode,f=n.data("dropkick"),h=String.fromCharCode(d),p=n.find(".dk_options"),m=n.hasClass("dk_open"),g=p.find("li"),C=n.find(".dk_option_current"),S=g.first(),_=g.last(),E=p.length&&C.length?Math.floor(p.height()/C.height()):0,k=e(g.get(Math.max(0,C.index()-E))),T=e(g.get(Math.min(g.length-1,C.index()+E)));switch(d){case c.pgup:m?w(k,n,t):y(n,t),t.preventDefault();break;case c.pgdown:m?w(T,n,t):y(n,t),t.preventDefault();break;case c.home:m?w(S,n,t):y(n,t),t.preventDefault();break;case c.end:m?w(_,n,t):y(n,t),t.preventDefault();break;case c.enter:m?C.hasClass("disabled")||(v(C.find("a"),n),b(n)):y(n,t),t.preventDefault();break;case c.tab:m&&(C.length&&v(C.find("a"),n),b(n));break;case c.up:a=C.prev("li"),m?a.length?w(a,n,t):w(_,n,t):y(n,t),t.preventDefault();break;case c.down:m?(i=C.next("li").first(),i.length?w(i,n,t):w(S,n,t)):y(n,t),t.preventDefault()}if(d>=c.zero&&d<=c.z){for(r=(new Date).getTime(),null===f.finder||void 0===f.finder?(f.finder=h.toUpperCase(),f.timer=r):r>parseInt(f.timer,10)+1e3?(f.finder=h.toUpperCase(),f.timer=r):(f.finder=f.finder+h.toUpperCase(),f.timer=r),o=g.find("a"),s=0,l=o.length;l>s;s++)if(u=e(o[s]),0===u.html().toUpperCase().indexOf(f.finder)){v(u,n),w(u.parent(),n,t);break}n.data("dropkick",f)}},E=function(t){return e.trim(t).length>0?t:!1},k=function(t,n){var i,a,r,o,s,l,c,u=t.replace("{{ id }}",n.id).replace("{{ label }}",n.label).replace("{{ tabindex }}",n.tabindex),p=[],m=void 0!=n.icon?f.replace("{{ icon }}",n.icon):"",g=void 0!=n.img?h.replace("{{ img }}",n.img):"";if(u=u.replace("{{ iconTmp }}",m).replace("{{ imgTmp }}",g),n.options&&n.options.length)for(a=0,r=n.options.length;r>a;a++)o=e(n.options[a]),s=0===a&&void 0!==o.attr("selected")&&void 0!==o.attr("disabled")?null:d.replace("{{ value }}",o.val()).replace("{{ current }}",E(o.val())===n.value?"dk_option_current":"").replace("{{ disabled }}",void 0!==o.attr("disabled")?"disabled":"").replace("{{ text }}",e.trim(o.html())),null!=s&&o.data("icon")?(l=f.replace("{{ icon }}",o.data("icon")),s=s.replace("{{ iconTmp }}",l)):null!=s&&(s=s.replace("{{ iconTmp }}","")),null!=s&&o.data("img")?(c=h.replace("{{ img }}",o.data("img")),s=s.replace("{{ imgTmp }}",c)):null!=s&&(s=s.replace("{{ imgTmp }}","")),p[p.length]=s;return i=e(u),i.find(".dk_options_inner").html(p.join("")),i};r||(n.documentElement.className=n.documentElement.className+" dk_fouc"),s.init=function(t){return t=e.extend({},p,t),u=t.dropdownTemplate?t.dropdownTemplate:u,d=t.optionTemplate?t.optionTemplate:d,this.each(function(){var n,i,a=e(this),r=a.find(":selected").first(),s=a.find("option"),c=a.data("dropkick")||{},d=a.attr("id")||a.attr("name"),f=t.width||a.outerWidth(),h=a.attr("tabindex")||"0",p=!1;return c.id?a:(c.settings=t,c.tabindex=h,c.id=d,c.$original=r,c.$select=a,c.value=E(a.val())||E(r.attr("value")),c.label=r.text(),c.options=s,c.icon=r.data("icon"),c.img=r.data("img"),p=k(u,c),c.settings.autoWidth&&p.find(".dk_toggle").css({width:f+"px"}),a.before(p).appendTo(p),p=e('div[id="dk_container_'+d+'"]').fadeIn(t.startSpeed),n=t.theme||"default",p.addClass("dk_theme_"+n),c.theme=n,c.$dk=p,a.data("dropkick",c),p.addClass(a.attr("class")),p.data("dropkick",c),l[l.length]=a,p.on("focus.dropkick",function(){g=p.addClass("dk_focus")}).on("blur.dropkick",function(){p.removeClass("dk_focus"),g=null}),o&&c.settings.nativeMobile&&p.addClass("dk_mobile"),c.settings.syncReverse&&a.on("change",function(t){var n=a.val(),i=e('a[data-dk-dropdown-value="'+n+'"]',p),r=i.text();p.find(".dk_label").text(r),c.settings.change&&c.settings.change.call(a,n,r),w(i.parent(),p,t)}),i=a.attr("form")?e("#"+a.attr("form").replace(" ",", #")):a.closest("form"),void(i.length&&i.on("reset",function(){a.dropkick("reset")})))})},s.theme=function(t){var n=e(this).data("dropkick"),i=n.$dk,a="dk_theme_"+n.theme;i.removeClass(a).addClass("dk_theme_"+t),n.theme=t},s.reset=function(){return this.each(function(){var t=e(this).data("dropkick"),n=t.$dk,i=e('a[data-dk-dropdown-value="'+t.$original.attr("value")+'"]',n);t.$original.prop("selected",!0),n.find(".dk_label").text(t.label),w(i.parent(),n)})},s.setValue=function(t){return this.each(function(){var n=e(this).data("dropkick").$dk,i=e('.dk_options a[data-dk-dropdown-value="'+t+'"]',n);i.length?v(i,n)|w(i.parent(),n):console.warn("There is no option with this value in "+n.selector)})},s.refresh=function(t){return this.each(function(){var n,i,a=e(this).data("dropkick"),r=a.$select,o=a.$dk;a.options=r.children(),i=k(u,a).find(".dk_options_inner"),o.find(".dk_options_inner").replaceWith(i),a.$original.parent().length||(a.$original=r.find(":selected").first(),a.label=a.$original.text()),n=e('a[data-dk-dropdown-value="'+r.val()+'"]',o),w(n.parent(),o),v(n,o,!t)})},e.fn.dropkick=function(e){if(!r){if(s[e])return s[e].apply(this,Array.prototype.slice.call(arguments,1));if("object"==typeof e||!e)return s.init.apply(this,arguments)}},e(function(){e(n).on(a?"mousedown":"click",".dk_options a",function(){var t=e(this),n=t.parents(".dk_container").first();return t.parent().hasClass("disabled")||(v(t,n),w(t.parent(),n),b(n)),!1}),e(n).on("keydown.dk_nav",function(e){var t;m?t=m:g&&(t=g),t&&_(e,t)}),e(n).on("click",null,function(t){var n,i=e(t.target);if(m&&0===i.closest(".dk_container").length)b(m);else{if(i.is(".dk_toggle, .dk_label"))return n=i.parents(".dk_container").first(),n.hasClass("dk_open")?b(n):(m&&b(m),y(n,t)),!1;i.attr("for")&&e("#dk_container_"+i.attr("for"))[0]&&e("#dk_container_"+i.attr("for")).trigger("focus.dropkick")}});var i="onwheel"in t?"wheel":"onmousewheel"in n?"mousewheel":"MouseScrollEvent"in t?"DOMMouseScroll MozMousePixelScroll":!1;i&&e(n).on(i,".dk_options_inner",function(e){var t=e.originalEvent.wheelDelta||-e.originalEvent.deltaY||-e.originalEvent.detail;return a?(this.scrollTop-=Math.round(t/10),!1):t>0&&this.scrollTop<=0||0>t&&this.scrollTop>=this.scrollHeight-this.offsetHeight?!1:!0})})}(jQuery,window,document),define("dropkick",["jquery"],function(e){return function(){var t;return t||e.$}}(this)),define("common/settings/settings-views",["jquery","backbone","underscore","utils","common/datafunctions.friends","dropkick"],function(){var e={};return e}),function(e){"function"==typeof define&&define.amd?define("common/jquery.basicSlider",["jquery"],e):e(jQuery)}(function(e){function t(e){if(null!==e&&"undefined"!=typeof e){var t=e.find("li"),a=t.length;if(2>a)return void l(e);e.data("basicSlider").options.init||i(e),n(e,a)}}function n(e,t){var n=e.data("basicSlider"),i=n.options.originalWidth?n.options.originalWidth:e.width(),a=n.options.itemWidth?n.options.itemWidth:e.width()+29,r=a*t,o=a*t,l=0;e.css({width:r}),e.parent().css({width:a}),e.parent().parent().css({width:a}),e.find("li").css({width:a,display:"inline","float":"left"}),s(e,l,n.options.index),n.options.originalWidth=i,n.options.itemWidth=a,n.options.totalWidth=r,n.options.visibleWidth=o,n.options.numItems=t,n.options.left=l,n.options.init=!0}function i(e){e.wrap('<div class="basicSliderContainer"></div>'),e.wrap('<div class="basicSliderListContainer" style="overflow:hidden;"></div>'),e.parent().after('<span class="arrow back"><a href="#"><span>«</span></a></span><span class="arrow forward"><a href="#" class=""><span>»</span></a></span>'),e.find("li").addClass("panel"),a(e)}function a(e){var t=e.parent().parent();t.on("click",".arrow.back",r),t.on("click",".arrow.forward",o)}function r(t){t.preventDefault();var n=e(t.delegateTarget).find("ul"),i=n.data("basicSlider");i.options.left=i.options.left+i.options.itemWidth,i.options.index--,i.options.index<1&&(i.options.left=-1*i.options.visibleWidth+i.options.itemWidth,i.options.index=i.options.numItems),s(n,i.options.left,i.options.index)}function o(t){t.preventDefault();var n=e(t.delegateTarget).find("ul"),i=n.data("basicSlider");i.options.left=i.options.left-i.options.itemWidth,i.options.index++,i.options.index>i.options.numItems&&(i.options.left=0,i.options.index=1),s(n,i.options.left,i.options.index)}function s(e,t,n){e.find("li").removeClass("active"),e.find("li:eq("+(n-1)+")").addClass("active"),e.css({left:t})}function l(e){e.parent().hasClass("basicSliderListContainer")&&(e.parent().parent().find("span.arrow").remove(),e.unwrap().unwrap(),e.find("li").removeClass("active panel"),e.css({left:0,width:e.data("basicSlider").options.originalWidth}),e.removeData("basicSlider"))}var c={init:function(n){return this.each(function(){var i=e(this),a=i.data("basicSlider"),r={index:1};n=e.extend({},r,n),a?a.options.index=1:i.data("basicSlider",{options:n}),t(i)})}};e.fn.basicSlider=function(t){return c[t]?c[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.basicSlider"),null):c.init.apply(this,arguments)}}),define("common/settings/settings",["require","jquery","utils","common/baseUtils","underscore","common/sdk","common/profile/profile-utils","common/profile/signin-utils","setup.environment.utils","common/datafunctions","common/datafunctions.friends","common/formvalidation","common/modals/modal-views","common/storage","common/captcha","am","common/settings/settings-views","common/jquery.basicSlider","common/jquery.visible","dropkick"],function(e){function t(){var e=G("#editProfile");G("#headerLoginOptionsDrop").is(":visible")&&G("#headerLoginOptionsButton").click(),J.setSelected(),e.find("span.errorText, span.error, span.tick").remove(),e.find(".errors").html(""),e.find(".btn").prop("disabled",!1),G("#profileSettings li a.editlink").show().siblings(".formWrapper").hide(),G("#editOldPassword, #editNewPassword, #editNewPasswordConf").val("")}function n(e,t){var n=G("#editProfile");J.closeModalsAndHideMenu(),J.setSelectedSide(G(e)),n.find(".content").removeAttr("style"),n.hasClass("active")?n.removeClass().addClass("panel active "+t):J.clearActivePanel(function(){J.setUpLoadingPanel("#editProfile",function(){J.removeLoading("editProfile"),n.removeClass().addClass("panel active "+t),G("#"+t).show()
})})}function i(){G("#myNetworkDetails").parent().show()}function a(){var e=J.CallGameMethodAsync("RGSC_GET_NETWORK_INFO","","RGSC_GET_NETWORK_INFO_DEMO");return e.done(function(e){"undefined"!=typeof e&&i()}),e}function r(){s();var e=a();e.done(o),n("#myNetworkDetails","networkSettings"),Z.trackPage("/MyNetworkDetails")}function o(e){if("undefined"!=typeof e){var t=l(e),n=G("#networkSettings");n.find(".public").html(t.publicAddress),n.find(".private").html(t.privateAddress),n.find(".nat").html(t.nat),t.natBold?n.find(".nat").addClass("error"):n.find(".nat").removeClass("error"),t.upnp?n.find(".upnp").html(t.upnp).parents("li").show():n.find(".upnp").parents("li").hide(),t.warning?G("#connectionDetails").show().find("p").html(t.warning):G("#connectionDetails").hide()}}function s(){var e=J.getText("NatDetecting","Settings");o({PublicAddress:e,PrivateAddress:e,NATDetectionState:1,NATType:0,uPnP:1,ShowNatTypeWarning:!1},!0)}function l(e){var t,n,i=!1;switch(e.NATDetectionState){case 1:t=J.getText("NatDetecting","Settings");break;case 3:t=J.getText("NatFailed","Settings");break;default:t=J.getText("Nat"+e.NATType,"Settings"),3===e.NATType&&(i=!0)}switch(e.uPnP){case 0:n=void 0;break;default:n=J.getText("Upnp"+e.uPnP,"Settings")}var a={publicAddress:e.PublicAddress,privateAddress:e.PrivateAddress,nat:t,natBold:i,upnp:n,warning:e.ShowNatTypeWarning?J.getText("NatWarning","Settings"):void 0};return a}function c(e){var n=G("#editProfile");if(e&&G(e).find("Status")&&"true"===G(e).find("Status").text()){n.find("span.errorText, span.error, span.pwvalid").remove();var i=n.find("#editNewPassword").val(),a={Password:i};J.CallGameMethod("RGSC_MODIFY_PROFILE",JSON.stringify(a),"RGSC_JS_FINISH_MODIFY_PROFILE"),q.clearCachedProfileList(),t()}else w(e);return!0}function u(e){if(e.errorCode==V.errorCode("5005")){var n=G("#editProfile"),i=J.getError("IncorrectPassword");n.find("#passwordForm .errors").append('<span class="errorText">'+i+"</span>")}else K.ShowErrorModal(e);("undefined"==typeof e.errorCode||""===e.errorCode)&&t()}function d(e){if(e&&"true"===G(e).find("Status").text()){var t=G("#editProfile"),n=t.find("#editEmail").val(),i=t.find("#editEmailPassword").val();globals.account.Email=n;var a={Email:n,Password:i};J.CallGameMethod("RGSC_MODIFY_PROFILE",JSON.stringify(a),"RGSC_JS_FINISH_MODIFY_PROFILE"),q.clearCachedProfileList(),_(n)}else E(e);G("#editEmailBtn").prop("disabled",!1)}function f(e){var t=e.errorCode,n=e.message,i=e.contentEl,a=e.supportText,r=e.errorCodeDesc,o=V.errorCode("4001.11");if("undefined"!=typeof responseText&&responseText.indexOf("captcha")>-1){var s=G(responseText),l=s.find("Error");if(t=l.attr("Code"),void 0!=t&&t.indexOf("captcha")>-1)return X.handleFailed(t),void E(responseText)}else t===o?(n="",r="",K.ShowFeatureDisabledModal(t,n,i,a,r)):K.ShowErrorModal({errorCode:t,message:n,contentEl:i,supportText:a,errorCodeDesc:r});_(globals.account.Email),G("#editEmailPassword").val("")}function h(e){e&&"true"==G(e).find("Status").text()&&_()}function p(e,t){if(e&&"true"===G(e).find("Status").text()){globals.account.Nickname=t,globals.account.NickEditable=!1;var n={NickName:t};C(t),J.CallGameMethod("RGSC_MODIFY_PROFILE",JSON.stringify(n),"RGSC_JS_FINISH_MODIFY_PROFILE"),q.clearCachedProfileList()}else y(e)}function m(e){var t=G("#editNameBtn"),n=G("#editName");e?(t.prop("disabled",!1),n.prop("readonly",!1)):(t.prop("disabled",!0),n.prop("readonly",!0))}function g(e){var t=G("#editProfile"),n=G("#dob");if(e&&"true"==G(e).find("Status").text()){var i=t.find("#editCountry").val();globals.account.Country=i,globals.account.CountryCode=i,globals.account.Minor="true"===G(e).find("Minor").text();var a={CountryCode:i};return J.CallGameMethod("RGSC_MODIFY_PROFILE",JSON.stringify(a),"RGSC_JS_FINISH_MODIFY_PROFILE"),n.hasClass("countryUpdate")&&(J.initHeaderMenu(!0),n.hide(),n.find("p.intro").hide(),G("#activation").hasClass("pending")?J.clearActivePanel(function(){J.setUpLoadingPanel("#activation")}):(globals.isLauncher&&(J.setupSignedInOptionsLauncher(),J.launcherNotifyEvent("SignIn")),G("#homeButton").click()),n.removeClass("countryUpdate"),J.initHeaderMenu(!0)),!0}var r=e?G(e).find("Error").attr("ErrorMessage"):void 0;return V.WriteDebugLog("OnSuccessUpdateCountry","ERROR",r,V.logType.error,V.logController.profile),void 0!=r&&"too young"==r.toLowerCase()&&Y.handleUnderAgeError(),n.hasClass("countryUpdate")&&void 0!=r&&"missing dob"==r.toLowerCase()&&(n.removeClass("countryUpdate"),n.addClass("DOBAndCountryUpdate"),n.find(".intro").text(J.getText("EnterDOBAndCountry","Register","Please enter your date of birth and country.")),V.loadDateDropdowns()),!1}function v(e){if(e&&"true"==G(e).find("Status").text()){var t,n=G("#imgEditSelectedAvatar").attr("src").indexOf("ugc/")>-1;globals.avatarServiceEnabled&&n?t=globals.account.AvatarUrl:(t=j.getLastStringSegment(G("#imgEditSelectedAvatar").attr("src"),"/",2),globals.account.AvatarUrl=t);var i={AvatarUrl:t};J.CallGameMethod("RGSC_MODIFY_PROFILE",JSON.stringify(i),"RGSC_JS_FINISH_MODIFY_PROFILE"),q.clearCachedProfileList(),globals.avatarServiceEnabled&&et.RefreshAvatar()}else{var a=G("#signedInUserAvatar").attr("src").replace(/\/images\/avatars\/32x32/,"/images/avatars/128x128/");G("#imgEditSelectedAvatar").attr("alt","").attr("title","").attr("src",a),V.WriteDebugLog("OnSuccessUpdateAvatar","ERROR",e?G(e).find("Error").text():"",V.logType.error,V.logController.profile)}}function b(e){e.errorCode==V.errorCode("6001.11")&&(G(".emailvalid").remove(),G("#editEmail").after('<span class="error"></span>')),K.ShowErrorModal(e)}function C(e){G("#editNameDisplay").text(e),t(),P()}function S(e,t,n,i,a){var r,o=G(i),s=o.find(t),l="ErrorUpdate",c="",u=!1;if("undefined"==typeof e)r=!0;else{var d=k(G(e));r=d.isPassword,c=void 0!=d.errorText?d.errorText:"","string"==typeof e&&e.indexOf("captcha")>-1&&(u=!0)}if(V.WriteDebugLog("updatePropertyFailure","ERROR for "+t,c),o.find("span.error, span.errorText").remove(),r)o.find(n).after('<span class="error"></span>');else{if(u)return;s.after('<span class="error"></span>'),l=a}s.parents("form").find(".errors").append('<span class="errorText">'+J.getError(l)+"</span>")}function y(e){G(".nickvalid").remove(),S(e,"#editName","#editNamePassword","#editProfile","NickExists")}function w(e){var t,n,i=G("#editProfile"),a="";if("nomatch"==e)i.find("#editNewPasswordConf").after('<span class="error"></span>'),a=J.getError("ConfirmMatch"),V.WriteDebugLog("updateEditPasswordFailure","ERROR",a);else{try{t=G(e).find("Error").attr("Code"),n=G(e).find("Error").text()}catch(r){t="unknown",n=e?e.toString():""}switch(t){case"PasswordOld":i.find("#editOldPassword").after('<span class="error"></span>'),a=J.getError("IncorrectPassword");break;case"Password":i.find("#editNewPassword").after('<span class="error"></span>'),a=Y.getPasswordError("InvalidPasswordNew");break;default:i.find("#editOldPassword").after('<span class="error"></span>'),a=J.getError("ErrorPassword")}V.WriteDebugLog("updateEditPasswordFailure","ERROR",n)}i.find("#passwordForm .errors").append('<span class="errorText">'+a+"</span>")}function _(e){G("#editEmailDisplay").text(e),G("#editEmail").val(e),t()}function E(e){G(".emailvalid").remove(),S(e,"#editEmail","#editEmailPassword","#editProfile","ValidEmail")}function k(e){var t={isPassword:!1},n=e.find("Error");if(void 0!=n&&n.length||(n=e.find("message")),void 0==n||!n.length)return t;if(void 0!=n.attr("ErrorMessage")&&n.attr("ErrorMessage").length){var i=n.attr("ErrorMessage");null!=i.match(/password/i)&&(t.isPassword=!0,t.errorText=i)}else if(void 0==n.attr("CodeEx")||"Password"!=n.attr("CodeEx")&&"PasswordNew"!=n.attr("CodeEx")){if(n.text().length){var a=j.splitErrorCode(n.text()),r=a.code;j.errorCodeIs(r,"AuthenticationFailed")&&(t.isPassword=!0)}}else t.isPassword=!0;return t}function T(e){G("#editCountryDisplay").text(e),G("#editCountry").dropkick("setValue",globals.account.CountryCode),t()}function I(e){var n=G("#editProfile");if(e&&"true"===G(e).find("Status").text()){var i={};n.find("#editNewPassword").val()&&(i.Password=n.find("#editNewPassword").val(),t()),n.find("#editName:visible").length&&(i.Nickname=n.find("#editName").val(),globals.account.Nickname=i.Nickname,C(i.Nickname)),n.find("#editEmail:visible").length&&(i.Email=n.find("#editEmail").val(),globals.account.Email=i.Email,_(i.Email)),n.find("#editCountry").val()!=globals.account.CountryCode&&(i.CountryCode=n.find("#editCountry").val(),globals.account.CountryCode=i.CountryCode,T(G("#editProfile").find("#editCountry option:selected").text())),i.AutoSignIn=n.find("#editAutoSignIn").is(":checked"),J.CallGameMethod("RGSC_MODIFY_PROFILE",JSON.stringify(i),"RGSC_JS_FINISH_MODIFY_PROFILE"),q.clearCachedProfileList(),G("#monthOfBirth:visible").length&&et.updateDobSuccess()}else{var a=e?G(e).find("Error").attr("ErrorMessage"):"";V.WriteDebugLog("onSuccessUpdateProfile()","ERROR",a,V.logType.error,V.logController.profile),n.find("#editName:visible").length&&y(e),n.find("#editEmail:visible").length&&E(e),n.find("#editOldPassword:visible").length&&w(e),n.find("#lblEditProfileError").html(J.getError("ServerError"))}n.find("#editProfileButtonWrapper span").hide(),n.find("a.disabled:first").removeClass("disabled")}function R(){var e=globals.account,t=G("#editCountry"),n=e.CountryCode;t.val(n).dropkick("setValue",n),G("#editCountryDisplay").text(t.find("option[value="+n+"]").text())}function A(e,t,n){var i=[],a=0;i.push("<li>");var r=301;W.each(e,function(e){15===a&&(i.push("</li><li>"),a=0),a+=1;var t=V.getSelfieUrl(e.src,e.t);i.push("<a href='#' tabindex='"+r+"'><img src='"+t+"' data-id='"+e.i+"' data-type='"+e.t+"' data-cid='"+e.cid+"' alt='"+t+"' data-image='"+n+"' /></a>"),r++}),i.push("</li>");var o=G("#"+t);o.html(i.join("")),o.basicSlider()}function L(e){return void 0!=globals.account.NickEditable&&void 0!=globals.account.Validated?(globals.account.NickEditable||P(),void(globals.account.Validated?G("#emailForm .emailVerify").hide():G("#emailForm .emailVerify").show())):void z.getMyAccountInfo(e).catch(function(e){V.WriteDebugLog("checkAccountDetails","ajax error handled by fatalError",e)}).then(function(e){var t=G(e),n="true"==t.find("NickEditable").text();globals.account.NickEditable=n,n||P();var i="true"==t.find("Validated").text();globals.account.Validated=i,i?G("#emailForm .emailVerify").hide():G("#emailForm .emailVerify").show()}).catch(function(e){V.WriteDebugLog("checkAccountDetails","unhandled exception",e,V.logType.error,V.logController.profile)})}function P(){var e=G("#nameForm");e.find(".buttons").hide(),e.find("#editName").val(globals.account.Nickname),e.find("#editName").hide(),e.find("#editNamePassword").closest("div.clearfix").hide();var t=J.getText("NickNotEdit","Settings");e.find(".help-inline:first").html(t),e.find(".nickvalid").remove()}function D(e,t){var n=new G.Deferred;if(V.WriteDebugLog("getLocalProfileAsync","nickname",e),null!=e&&"undefined"!=typeof e&&"undefined"!==e){var i;i=null==t?q.getProfileListAsync():Promise.resolve(JSON.parse(t)),i.then(function(t){var i;if(t&&t.NumProfiles>0){var a=e.toLowerCase();i=W.find(t.Profiles,function(e){return e.Local&&e.Nickname.toLowerCase()===a}),"undefined"!=typeof i&&V.WriteDebugLog("getLocalProfileAsync","nickname",i.Nickname)}else V.WriteDebugLog("getLocalProfileAsync","ProfileNotFound",e);n.resolve(i)}).catch(function(){n.resolve()})}else J.showMessagePanel(J.getError("ServerError"),"",J.getError("SorryTry")),G("#buttonCancelMessage").hide(),G("#messagePanel").find(".closeCurrentPanel").off("click").on("click",function(e){e.preventDefault(),J.requestUiState(!1)}),n.resolve();return n.promise()}function x(){G("#headerLoginOptionsDrop").is(":visible")&&G("#headerLoginOptionsButton").click();var e=globals.account;if(!J.isOffline()&&null!==e&&!e.Local){V.WriteDebugLog("setupProfileSettings","account",JSON.stringify(e));var t=G("#editProfile");t.find(".content").removeAttr("style"),et.getCountriesAsync(e.CountryCode).then(R).catch(function(e){V.WriteDebugLog("myProfileLink.click","getCountriesAsync rejected promise",e)});var n=G("#editEmail");n.val(e.Email),n.prop("disabled")&&n.next().hasClass("locked")&&n.after('<span class="locked"></span>');var i=G("#nameForm");i.find(".buttons").show(),i.find(".help-inline").html(""),i.find("#editName").show(),i.find("#editNamePassword").closest("div.clearfix").show(),L(e.Nickname),G("#editNameDisplay").text(e.Nickname),G("#editEmailDisplay").text(e.Email);var a="true"==Q.getItem("hideNotifications");F(a),t.hasClass("active")?t.removeClass().addClass("panel active myProfile"):J.clearActivePanel(function(){J.setUpLoadingPanel("#editProfile",function(){J.removeLoading("editProfile"),t.removeClass().addClass("panel active myProfile"),G("#myProfile").show()})}),J.setSelectedSide(G("#myProfileLink")),J.resetScrollbar("#editProfile"),Z.trackPage("/ProfileSettings")}}function N(){V.WriteDebugLog("updateAutoSignIn","updateAutoSignIn"),Z.trackEvent(Z.category.settings,Z.action.settings_profile_edit_auto_sign_in);var e=G("#editProfile").find("#editAutoSignInInput").is(":checked");globals.account.AutoSignIn=e,H.setAutoSignInValues(e),t();var n={AutosignIn:e};J.CallGameMethod("RGSC_MODIFY_PROFILE",JSON.stringify(n),"RGSC_JS_FINISH_MODIFY_PROFILE"),q.clearCachedProfileList()}function M(e){if("undefined"!=typeof e&&e.val().length){var t=e.val();G("#editAvatarPanelInner").attr("class",t),V.initSpinner(G("#editAvatarPanel span.loading")).fadeIn(),G("#editAvatarPanelInner").animate({opacity:"0"},200,function(){et.setAvatarThumbsHtml(t,"avatarSlider","imgEditSelectedAvatar"),setTimeout(function(){G("#editAvatarPanelInner").animate({opacity:"1"},600),J.removeLoading("editAvatarPanel")},300)})}}function O(){G("#mainNav li").removeClass("on"),G("#editProfile").hasClass("active")?(G("#blockListPlayercards").empty().removeData(),et.blockListQuery()):J.clearActivePanel(function(){J.setUpLoadingPanel("#editProfile"),G("#blockListPlayercards").empty().removeData(),et.blockListQuery()})}function U(){V.WriteDebugLog("updateAndCloseHideNotifications","UpdateHideNotifications"),Z.trackEvent(Z.category.settings,Z.action.settings_profile_edit_hide_notifications);var e=G("#editHideNotificationsInput").is(":checked");Q.setItem("hideNotifications",e),F(e),t()}function F(e){var t=e?"Yes":"No";G("#editHideNotificationsInput").prop("checked",e),G("#editHideNotificationsDisplay").text(J.getText(t,"HomeSignin"))}{var G=e("jquery"),V=e("utils"),j=e("common/baseUtils"),W=e("underscore"),B=e("common/sdk"),H=e("common/profile/profile-utils"),q=e("common/profile/signin-utils"),J=e("setup.environment.utils"),$=e("common/datafunctions"),z=e("common/datafunctions.friends"),Y=e("common/formvalidation"),K=e("common/modals/modal-views"),Q=e("common/storage"),X=e("common/captcha"),Z=e("am");e("common/settings/settings-views")}e("common/jquery.basicSlider"),e("common/jquery.visible"),e("dropkick");var et={};return et.init=function(){function e(e){var t;V.isCloudSaveEnabled()&&(t=Promise.resolve(B.getCloudSavesEnabledSetting())),"undefined"==typeof t&&(t=Promise.resolve({RosTitleName:globals.titleName,Enabled:"unknown"})),t.then(function(t){J.setPrivacyAndGameOptions(e,t)})}G("#menuSettings").click(function(e){e&&e.preventDefault(),et.loadSettings()}),G("#nameForm").submit(function(e){e&&e.preventDefault(),setTimeout(function(){if(Y.UpdateNicknameValidation()){var e=J.getText("UpdateNickConfirm","Settings");K.ShowConfirmModal(e,null,"settingsFn.updateNickname")}},100)}),G("#editNameBtn").on("click",function(e){e&&e.preventDefault(),G(this).parents("form").submit()}),G("#emailForm").submit(function(e){e&&e.preventDefault();var t=G("#editEmailBtn");t.prop("disabled")||(t.prop("disabled",!0),setTimeout(function(){Y.UpdateEmailValidation()?et.updateEmail():t.prop("disabled",!1)},100))}).on("init",".reCaptchaContainer",function(){X.initCaptchaEditEmail()}),G("#editEmailBtn").on("click",function(e){e&&e.preventDefault(),G(this).parents("form").submit()}),G("#validateEmail").click(function(e){e&&e.preventDefault();var t=G(e.currentTarget);t.prop("disabled")||(t.prop("disabled, true"),setTimeout(function(){et.resendValidation()},100))}),G("#passwordForm").submit(function(e){e&&e.preventDefault();var t=G("#editPasswordBtn");t.prop("disabled")||(t.prop("disabled",!0),setTimeout(function(){Y.UpdatePasswordValidation()?et.updatePassword():t.prop("disabled",!1)},100))}),G("#editPasswordBtn").on("click",function(e){e&&e.preventDefault(),G(this).parents("form").submit()}),G("#countryForm").submit(function(e){e&&e.preventDefault();var t=G("#editCountryBtn");t.prop("disabled")||(t.prop("disabled",!0),setTimeout(function(){et.updateCountry(G("#editCountry").val())},100))}),G("#editCountryBtn").on("click",function(e){e&&e.preventDefault(),G(this).parents("form").submit()}),G("#autoSignInForm").submit(function(e){e&&e.preventDefault(),setTimeout(N,100)}),G("#editAutoSignInBtn").on("click",function(e){e&&e.preventDefault(),G(this).parents("form").submit()}),G("#hideNotificationsForm").submit(function(e){e&&e.preventDefault(),setTimeout(U,100)}),G("#editHideNotificationsInputBtn").on("click",function(e){e&&e.preventDefault(),G(this).parents("form").submit()}),G("#editAvatarGame").change(function(){var e=G(this).find("option:selected");return M(e),!1}),G("#editProfile").find(".sideMenu a").keydown(function(e){var t=G(e.currentTarget);13==e.which&&t.visible()&&G(this).click()}),G("#myProfileLink").click(function(){G(this).is(".on")||globals.isLauncher||x()}),G("#privacyLink").click(function(){if(!G(this).is(".on")&&!globals.isLauncher){Y.clearErrorClasses(),G("#headerLoginOptionsDrop").is(":visible")&&G("#headerLoginOptionsButton").click();var t=G("#editProfile");t.hasClass("active")?t.attr("class","panel active privacySettings"):J.clearActivePanel(function(){J.setUpLoadingPanel("#editProfile"),t.attr("class","panel active privacySettings")}),G(this).hasClass("on")||(J.setSelectedSide(G(this)),J.setUpLoadingPanel("#editProfile",function(){var t=z.GetUserPrivacyInfo(globals.account.RockstarId,"","");t.then(e),G("#linkedAccountOptions").show(),$.GetUserNetworks(globals.account.RockstarId,"","",z.LoadUserNetworksPrivacy),G("#privacySettingsForm").show()})),G("#privacySettings").show(),Z.trackPage("/PrivacySettings")}}),G("#gameSettingsLink").click(function(){if(!G(this).is(".on")&&!globals.isLauncher){G("#headerLoginOptionsDrop").is(":visible")&&G("#headerLoginOptionsButton").click();var t=G("#editProfile");t.hasClass("active")?t.attr("class","panel active gameSettings"):J.clearActivePanel(function(){J.setUpLoadingPanel("#editProfile"),t.attr("class","panel active gameSettings")}),G(this).hasClass("on")||(J.setSelectedSide(G(this)),J.setUpLoadingPanel("#editProfile",function(){var t=z.GetUserPrivacyInfo(globals.account.RockstarId,"","");t.then(e)})),t.find(".content").removeAttr("style"),J.resetScrollbar("#editProfile"),Z.trackPage("/GameSettings")}}),G("#blockListLink").click(function(e){e&&e.preventDefault(),G(this).is(".on")||globals.isLauncher||O()}),G("#profileSettings").find(".editlink").click(function(e){e&&e.preventDefault(),t(),G("#profileSettings ."+G(this).data("field")).toggle().find("span.errorText").remove().end().find("span.error").remove().end().find("div.reCaptchaContainer").trigger("init")}),G("#profileSettings").find(".closeRow").click(function(e){e&&e.preventDefault(),t()}),G("#accountSettings").on("click",".btn.linkAccount",function(e){var t=G(e.currentTarget);Z.trackEvent(Z.category.settings,Z.action.settings_account_linking_link,t.attr("data-os"))}).on("click",".btn.unlink",function(e){var t=G(e.currentTarget);Z.trackEvent(Z.category.settings,Z.action.settings_account_linking_unlink,t.attr("data-os"))}),G("#lnkChangeAvatar, #editAvatar").click(function(){if(!G(this).is(".on")&&!globals.isLauncher){et.setAvatarThumbsHtml("","avatarSlider","imgEditSelectedAvatar"),G("#selectedAvatarContainer").removeClass(),G("#editProfile").hasClass("active")||J.clearActivePanel(function(){J.setUpLoadingPanel("#editProfile")}),J.closeModalsAndHideMenu(),J.setSelectedSide(G("#lnkChangeAvatar")),G("#editProfile .content").removeAttr("style"),J.setUpLoadingPanel("#editProfile",function(){G("#editProfile").attr("class","panel active avatar"),G("#avatar").show()}),G(".selectAvatarPanel .inner .loadingAvatarGames").show(),G(".selectAvatarPanel form").hide();var e;globals.avatarServiceEnabled?(e=$.getAvatarsAsync(),e.done(function(e,t){et.getAvatarsSuccess(e,t,"editAvatarGame")})):(e=$.getAvatarGamesAsync(),e.done(function(e,t){et.getAvatarGamesSuccess(e,t,"editAvatarGame")})),J.removeLoading("editProfile"),"en-US"==globals.titlelang||G("#editProfile").hasClass("localized")||(G("#editProfile").find("[rel*=localize]").localize("Settings",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),G("#editProfile").addClass("localized")),J.resetScrollbar("#editProfile"),Z.trackPage("/ChangeAvatar")}}),G("#avatarSlider").on("click","li a",function(e){e&&e.preventDefault();var t=G(this).find("img");t.length&&(et.changeSelectedAvatar(t[0],t.attr("data-image")),G("#editAvatarSubmit").focus())}),G("#editAvatarSubmit").click(function(){var e=G("#editAvatarGame").val();return e?(Y.clearErrorClasses(),et.updateAvatar(),!1):!1}),G(".deleteLocalUserData, #menuDeleteProfile").click(function(e){if(e&&e.preventDefault(),globals.isLauncher)return!1;Y.clearErrorClasses();var t=G("div.panel.active");return G("#deleteProfile").removeAttr("data-prevPanel"),t.length&&t.attr("id").length&&G("#deleteProfile").attr("data-prevPanel",t.attr("id")),J.clearActivePanel(function(){var e="lanoire"===globals.titleName&&J.isOffline()&&J.isLocal?"DeleteProfileInfoLocalLan":"DeleteProfileInfo",t=J.getText(e,"HomeSignin").replace("[title]",globals.titleDisplayName);G("#deleteProfileInfo").text(t),J.setUpLoadingPanel("#deleteProfile")}),!1}),G("#buttonDeleteProfileYes").click(function(){return globals.isLauncher?!1:(G(this).hasClass("disabled")||(G(this).addClass("disabled"),G("#editRockstarId").val(globals.account.RockstarId),et.deleteProfile(G("#editRockstarId").val())),!1)}),G("#buttonDeleteProfileNo").click(function(e){if(e&&e.preventDefault(),globals.isLauncher)return!1;var t=G("#mainNav li.on a");return t.length?t.click():G("#deleteProfile").attr("data-prevPanel").length?J.clearActivePanel(function(){J.setUpLoadingPanel("#"+G("#deleteProfile").attr("data-prevPanel")),J.removeLoading(G("#deleteProfile").attr("data-prevPanel"))}):V.pubsub.trigger("setupEnv:showHomepage",!0),!1}),G("#myNetworkDetails").on("click",function(e){e&&e.preventDefault(),G(this).is(".on")||globals.isLauncher||r()}),G("#networkInformation").on("click","a",function(e){e&&e.preventDefault()}),G("#retryNetworkSettings").on("click","a",function(e){if(e&&e.preventDefault(),G("#retryNetworkSettings").is(":visible")){G("#retryNetworkSettings").fadeOut("fast"),setTimeout(function(){G("#retryNetworkSettings").fadeIn()},3e3),s();var t=a();t.done(o)}})},et.loadSettings=function(){globals.isLauncher||(a(),t(),G("#myProfileLink").click(),"en-US"!=globals.titlelang&&(G("#editProfile").hasClass("localized")||(G("#editProfile [rel*=localize]").localize("Settings",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),G("#editProfile").addClass("localized"))))},et.updatePassword=function(){var e,t,n;return Z.trackEvent(Z.category.settings,Z.action.settings_profile_edit_password),V.isLegacyServiceLayer()?void et.updateProfile():(e=G("#editNewPassword").val(),void(e&&(V.WriteDebugLog("UpdatePasswordJS","UpdatePassword",""),t=G("#editOldPassword").val(),n=G("#editNewPasswordConf").val(),$.updatePassword(t,e,n,u).catch(function(e){V.WriteDebugLog("settingsFn.updatePassword","ajax error handled by fatalError",e)}).then(c).then(function(){G("#editPasswordBtn").prop("disabled",!1)}).catch(function(e){V.WriteDebugLog("settingsFn.updatePassword","unhandled exception",e,V.logType.error,V.logController.profile)}))))},et.updateEmail=function(){if(G("#emailForm .errors").html(""),Z.trackEvent(Z.category.settings,Z.action.settings_profile_edit_email),V.isLegacyServiceLayer())return void et.updateProfile();var e=X.getCaptchaData();$.UpdateEmail(G("#editEmail").val(),G("#editEmailPassword").val(),f,e).then(d).catch(function(e){G("#editEmailBtn").prop("disabled",!1),V.WriteDebugLog("settingsFn.updateEmail","unhandled exception",e,V.logType.error,V.logController.profile)})},et.resendValidation=function(){$.resendValidation().catch(function(e){V.WriteDebugLog("settingsFn.resendValidation","ajax error handled by fatalError",e)}).then(h).then(function(){G("#validateEmail").prop("disabled",!1)}).catch(function(e){V.WriteDebugLog("settingsFn.resendValidation","unhandled exception",e,V.logType.error,V.logController.profile)})},et.updateNickname=function(){if(G("#nameForm .errors").html(""),Z.trackEvent(Z.category.settings,Z.action.settings_profile_edit_nickname),V.isLegacyServiceLayer())return void et.updateProfile();m(!1);var e=G("#editName").val(),t=G("#editNamePassword").val();$.updateNickname(e,t).catch(function(e){return"object"==typeof e&&"string"==typeof e.responseText?(V.WriteDebugLog("settingsFn.updateNickname","ajax error handled by fatalError",e.responseText),e.responseText):void V.WriteDebugLog("settingsFn.updateNickname","ajax error handled by fatalError",e)}).then(function(t){return p(t,e)}).then(function(){m(!0)}).catch(function(e){V.WriteDebugLog("settingsFn.updateNickname","unhandled exception",e,V.logType.error,V.logController.profile)})},et.updateCountry=function(e){return V.ShowInvisibleMask(G("#submitAccount"),J.getError("Loading")),G("#countryForm .errors").html(""),Z.trackEvent(Z.category.settings,Z.action.settings_profile_edit_country),V.isLegacyServiceLayer()?void et.updateProfile():void $.updateCountry(e).catch(function(e){V.WriteDebugLog("settingsFn.updateCountry","ajax error handled by fatalError",e)}).then(function(e){return g(e)}).then(function(e){G("#editCountryBtn").prop("disabled",!1);var t=e?G("#editProfile").find("#editCountry option:selected").text():G('#editCountry option[value="'+globals.account.CountryCode+'"]').text();T(t),V.HideInvisibleMask()}).catch(function(e){V.WriteDebugLog("settingsFn.updateCountry","unhandled exception",e,V.logType.error,V.logController.profile)})},et.updateAvatar=function(){G(".editSelectedAvatar .errors").html(""),Z.trackEvent(Z.category.settings,Z.action.settings_change_avatar),J.setUpLoading("#editProfile");var e="",t="",n="";if(globals.avatarServiceEnabled)t=G("#imgEditSelectedAvatar").data("id"),n=G("#imgEditSelectedAvatar").data("cid");else{var i=G("#imgEditSelectedAvatar").attr("src");e=i.match(/default.png$/)?"":V.prefixAvatarUrl(j.getLastStringSegment(i,"/",2))}$.updateAvatar(e,t,n).catch(function(e){V.WriteDebugLog("settingsFn.updateAvatar","ajax error handled by fatalError",e)}).then(function(e){return v(e)}).then(function(){J.clearActivePanel(function(){G("#myProfileLink").click()})}).catch(function(e){V.WriteDebugLog("settingsFn.updateAvatar","unhandled exception",e,V.logType.error,V.logController.profile)})},et.RefreshAvatar=function(){globals.account.AvatarCacheBust=(new Date).valueOf();var e=J.getText("AvatarBeingProcessedTitle","Settings"),t=J.getText("AvatarBeingProcessedMsg","Settings");K.ShowConfirmModal(t,null,null,null,"Ok",null,e),setTimeout(function(){J.setProfileHtml()},35e3)},et.updateProfile=function(){V.WriteDebugLog("settingsFn.updateProfile","","");var e=G("#editProfile");e.find("#lblEditProfileError").html("");var t,n=G("#imgEditSelectedAvatar").attr("src");t=!G("#imgEditSelectedAvatar").length||-1!=n.indexOf("base64")||n.match(/default.png$/)?"":j.getLastStringSegment(n,"/",2);var i="",a="",r="",o="",s="",l="",c="";if(e.length){if(e.find("#dk_container_editCountry:visible").length&&(i=e.find("#editCountry").val()),e.find("#editOldPassword:visible").length&&(r=globals.account.Email,o=e.find("#editOldPassword").val(),l=e.find("#editNewPassword").val()),e.find("#editEmail:visible").length){if(r=globals.account.Email,a=e.find("#editEmail").val(),a===r)return void _(r);o=e.find("#editEmailPassword").val()}e.find("#editName:visible").length&&(s=e.find("#editName").val(),o=e.find("#editNamePassword").val(),r=globals.account.Email)}G("#monthOfBirth:visible").length&&(c=V.formatDob(G("#yearOfBirth").val(),G("#monthOfBirth").val(),G("#dayOfBirth").val())),$.updateLegacyProfile(t,i,c,a,r,s,l,o,b).catch(function(e){V.WriteDebugLog("settingsFn.updateProfile","ajax error handled by fatalError",e)}).then(I).then(function(){G("#editProfileContainer input.btn").prop("disabled",!1),G("#editProfileContainer a.btn").removeClass("disabled"),V.isLegacyServiceLayer()&&G("#editProfile").is(".active.avatar")&&G("#myProfileLink").click(),V.HideInvisibleMask()}).catch(function(e){V.WriteDebugLog("settingsFn.updateProfile","unhandled exception",e,V.logType.error,V.logController.profile)})},et.updateDobSuccess=function(e){var t=G(e),n=e?t.find("Status").text():"false",i=e?t.find("Error").attr("ErrorMessage"):void 0;if("false"==n)return void(void 0!=i&&"too young"==i.toLowerCase()&&Y.handleUnderAgeError());if(globals.account){var a=t.find("Age").text();globals.account.Age=a,globals.account.Minor="true"==t.find("Minor").text();var r=t.find("CountryCode").text();void 0!=r&&""!=r&&(globals.account.CountryCode=r,globals.account.Country=r),J.setProfileHtml()}var o=G("#dob");o.removeClass("DOBUpdate DOBAndCountryUpdate"),o.hide(),o.find("p.intro").hide(),J.initHeaderMenu(!0),G("#activation").hasClass("pending")?J.clearActivePanel(function(){J.setUpLoadingPanel("#activation")}):(globals.isLauncher&&(J.setupSignedInOptionsLauncher(),J.launcherNotifyEvent("SignIn")),G("#homeButton").click())},et.deleteProfile=function(e){if(V.WriteDebugLog("DeleteProfile","rockstarId",e),"undefined"==typeof e||"undefined"===e||null==e)G("#lblDeleteProfileError").html("There was a problem deleting this profile."),G("#buttonDeleteProfileYes").removeClass("disabled"),G("#deleteProfile").find(".panelButtonWrapper span").hide(),V.WriteDebugLog("DeleteProfile","rockstarId invalid","",V.logType.error,V.logController.profile);else try{G("#deleteProfile").find(".panelButtonWrapper span").css("display","inline-block"),J.CallGameMethod("RGSC_SIGN_OUT",null,"RGSC_SIGN_OUT_DEMO"),setTimeout(function(){var t=!0;""===e&&(t=D(globals.account.Nickname,null),G.when(t).done(function(t){t&&(q.setAccount(null,null,null,null,null,null,t.Nickname,t.RockstarId,null,!0,void 0,t.NickEditable,t.Validated),e=t.RockstarId)})),G.when(t).done(function(){J.setUpSignedInOptions(!1,J.isLocal()),"default0"==e&&(e="0"),J.CallGameMethod("RGSC_DELETE_PROFILE",'{ "rockstarId": "'+e+'" }',"RGSC_DELETE_PROFILE_DEMO"),q.clearCachedProfileList(),q.clearAccount(),setTimeout(function(){G("#buttonDeleteProfileYes").removeClass("disabled"),G("#deleteProfile").find(".panelButtonWrapper").find("span").hide(),V.pubsub.trigger("signin.showSignin")},500)})},500)}catch(t){G("#lblDeleteProfileError").html("There was a problem deleting this profile."),G("#buttonDeleteProfileYes").removeClass("disabled"),G("#deleteProfile").find(".panelButtonWrapper span").hide(),V.WriteDebugLog("settingsFn.deleteProfile","ERROR",t.message,V.logType.error,V.logController.profile)}},et.getCountriesAsync=function(e){if(!V.IsCountryListEmpty())return Promise.resolve();if(globals.getCountriesInProgress)return V.WriteDebugLog("getCountries","skipped","already in progress"),Promise.reject("getCountries skipped: already in progress");globals.getCountriesInProgress=!0,V.WriteDebugLog("getCountries","selectedCountryCode",e),G("span.loadFailed").hide();var t=["#editCountry","#signUpCountry"];W.forEach(t,function(e){G(e).hide()}),G("span.loadingText").fadeIn();var n=$.getCountriesAsync(e).then(function(n){if(!et.getCountriesSuccess(n,e,t))throw"getCountries error";globals.getCountriesInProgress=!1,t=null}).catch(function(e){throw et.getCountriesError(t),globals.getCountriesInProgress=!1,t=null,e});return n},et.getCountriesSuccess=function(e,t,n){if(V.WriteDebugLog("getCountriesSuccess","success status"),!e.Status)return!1;var i=[],a=[];return W.forEach(e.List,function(e){var t=i,n=e.Code;
("US"==n||"GB"==n)&&(t=a),t.push("<option value='"+n+"'>"+e.Name+"</option>")}),W.forEach(n,function(e){var n=G(e);n.html(a.join("")+i.join("")),t&&"#editCountry"===e?n.find("option[value="+t+"]").prop("selected",!0):(n.find("option:first").prop("selected",!0),t="US"),G("span.loadingText").hide(),n.dropkick(),n.dropkick("setValue",t)}),!0},et.getCountriesError=function(e){W.forEach(e,function(e){G(e).hide()}),G("span.loadingText").hide(),G("span.loadFailed").show(),G("#countryForm").find("#editCountryBtn").prop("disabled",!0)},et.blockListQuery=function(){G("#editProfile").hasClass("active")||J.clearActivePanel(function(){J.setUpLoadingPanel("#editProfile")}),J.closeModalsAndHideMenu(),J.setSelectedSide(G("#blockListLink")),G("#editProfile .content").removeAttr("style"),J.setUpLoadingPanel("#editProfile",function(){G("#blockList").show(),G("#editProfile").attr("class","panel active blockList")});var e=G("#blockListPlayercards").data("PageIndex");void 0===e&&(e=0,G("#blockListPlayercards").data("PageIndex",e)),Z.trackPage("/BlockList");var t=Math.round((new Date).getTime()/1e3);J.CallGameMethod("RGSC_REQUEST_PLAYER_LIST",'{ "RequestId": '+t+', "PlayerListType": 8, "PageIndex": '+e+', "PageSize": 10 }',"RGSC_JS_PLAYER_LIST_RESPONSE_DEMO")},et.getAvatarGamesSuccess=function(e,t,n){if("success"==t){var i=G("#"+n);i.empty(),globals.avatarXML=e;var a="",r=[];G(e).find("avatars g").each(function(){a!=G(this).attr("g")&&(a=G(this).attr("g"),r.push("<option value='"+G(this).attr("g")+"'>"+G(this).attr("dn")+"</option>"))}),i.append(r.join("")),V.SortSelect("#"+n),i.prepend("<option value=''>"+J.getText("SelectbyGame","Register")+"</option>"),i.find("option:first").prop("selected",!0),i.dropkick(),i.dropkick("setValue",""),i.hide()}else V.WriteDebugLog("LoadAvatarGamesError","error","Error getting avatar xml",V.logType.error,V.logController.profile);G("div.selectAvatarPanel .inner .loadingAvatarGames").hide(),G("div.selectAvatarPanel form").show(),G("#dk_container_editAvatarGame").focus(),n=null},et.getAvatarsSuccess=function(e,t,n){if("success"==t){var i=G("#"+n);i.empty(),globals.avatarXML=e;var a="",r=[];W.each(e.categories,function(e){if(a!=e.c){if(a=e.c,"UserCreated"===a&&!V.customAvatarsEnabled())return;var t="UserCreated"!==a?e.n:J.getText("SelfiesAndMugshots","Settings");r.push("<option value='"+a+"'>"+t+"</option>")}}),i.append(r.join("")),i.find("option:first").prop("selected",!0);var o=i.find("option:selected");i.dropkick(),i.dropkick("setValue",o.val()),i.hide(),M(o)}else V.WriteDebugLog("LoadAvatarGamesError","error","Error getting avatar xml",V.logType.error,V.logController.profile);G("div.selectAvatarPanel .inner .loadingAvatarGames").hide(),G("div.selectAvatarPanel form").show(),G("#dk_container_editAvatarGame").focus(),n=null},et.changeSelectedAvatar=function(e,t){V.WriteDebugLog("changeSelectedAvatar","control, destinationControl",e+" , "+t),G("#"+t).data("id","").data("cid","");var n=G(e);if(n.length>0){n.closest("div.avatarPanel").find("img.selected").removeClass("selected");var i=n.attr("src");i=i.replace(/\/images\/avatars\//,"/images/avatars/128x128/"),G("#selectedAvatarContainer").removeClass().addClass(n.data("type")),G("#"+t).attr("alt",n.attr("alt")).attr("title",n.attr("title")).attr("src",i).data("id",n.data("id")).data("cid",n.data("cid")),n.addClass("selected")}},et.setAvatarThumbsHtml=function(e,t,n){if(globals.avatarXML)if("UserCreated"===e&&V.customAvatarsEnabled())$.getCustomAvatarsAsync().catch(function(e){V.WriteDebugLog("settingsFn.setAvatarThumbsHtml","ajax error handled by fatalError",e)}).then(function(e){A(e,t,n),J.showCustomAvatarInfoContainer()}).catch(function(e){V.WriteDebugLog("settingsFn.customAvatarsEnabled","unhandled exception",e,V.logType.error,V.logController.profile)});else{J.hideCustomAvatarInfoContainer();var i=[];i.push("<li>");var a=0,r=301;if(globals.avatarServiceEnabled){var o=W.where(globals.avatarXML.avatars,{c:e});W.each(o,function(e){15===a&&(i.push("</li><li>"),a=0),a+=1;var t=V.getAvatarUrlFromUrl(e.a);i.push("<a href='#' tabindex='"+r+"'><img src='"+t+"' data-id='"+e.i+"' alt='"+e.n+"' title='"+e.n+"' width='64' height='64' data-image='"+n+"' /></a>"),r++})}else{var s=G(globals.avatarXML).find("g[g='"+e+"']");s.find("a").each(function(){var e=G(this),t=V.jhtmlEncode(e.text());15===a&&(i.push("</li><li>"),a=0),a+=1;var o=V.getAvatarUrlFromUrl(e.attr("url"));i.push("<a href='#' tabindex='"+r+"'><img src='"+o+"' alt='"+t+"' title='"+t+"' width='64' height='64' data-image='"+n+"' /></a>"),r++})}i.push("</li>");var l=G("#"+t);l.html(i.join("")),l.basicSlider()}},et.modifyProfileComplete=function(){G("#editProfileButtonWrapper span").hide(),et.changeSelectedAvatar("#editAvatar","signedInUserAvatar"),et.changeSelectedAvatar("#editAvatar","imgDeleteProfile"),G("#editOldPassword").val(""),G("#editNewPassword").val(""),G("#editNewPasswordConf").val(""),G("#editEmail").val(""),G("#editEmailPassword").val(""),G("#editName").val(""),J.setProfileHtml()},V.pubsub.on("settingsFn.loadSettings",et.loadSettings),V.pubsub.on("settingsFn.showBlockList",O),V.pubsub.on("settingsFn.getCountriesAsync",et.getCountriesAsync),V.pubsub.on("settingsFn.updateNickname",et.updateNickname),et}),define("common/profile/signup",["require","jquery","utils","common/baseUtils","common/profile/profile-utils","common/profile/signin-utils","setup.environment.utils","common/datafunctions","common/profile/signin","common/settings/settings","common/formvalidation","common/captcha","am","common/am/customDimensions","common/auth","dropkick","common/jquery.visible"],function(e){function t(e){var t=N("#"+e).val();M.WriteDebugLog("signup.resetPassword","email",t),N(".troubleSigningUp .resetPasswordForm .errors").html(""),V.resetPassword(t).then(function(e){var t="true"===N(e).find("Status").text();t&&(N(".active .resetSuccessMsg").show(),N("#signUpEmailPasswordResetForm").hide())}).catch(function(e){M.WriteDebugLog("signup.resetPassword","ajax error caught",e)}).then(function(){M.stopSpinner(N("#resetSpinnerSignUp")).fadeOut(function(){var e=N("#buttonSignUpPasswordReset");e.removeClass("disabled"),e.fadeIn()}),N("a.btn.disabled:first").removeClass("disabled")}).catch(function(e){M.WriteDebugLog("signup.resetPassword","unhandled exception",e,M.logType.error,M.logController.profile)})}function n(e){void 0!=e&&e||N("div.troubleSigningUp").find("span.errorText, span.error").remove(),N("#buttonSignUpPasswordReset").removeClass("disabled"),M.stopSpinner(N(".resetSpinnerSignUp")).hide(),M.stopSpinner(N("div.buttonSignInWrapper").find("span")).hide()}function i(e,t){var n=e&&t;if(n){if(!B.DOBValidation())return;R()}else if(t){if(!B.DOBValidation())return;I()}else e&&W.updateCountry(N("#signUpCountry").val())}function a(e){if(e&&e.preventDefault(),!N("#submitAccount").hasClass("disabled")){var t=U.isCountryMissing(),n=U.isDobMissing(),a=t||n;return a?void i(t,n):void(B.CreateAccountValidation()&&(A("signUpPassword"),N("#dob").hide(),r(),o()))}}function r(){U.setSignUpStepText(2),N("#dob, #introTextContainer, #privacyTextContainer, #termsTextContainer").hide(),h(),f()}function o(){return U.isSignupCaptchaEnabled()?(H.isSignUpVisible()||H.initCaptchaSignup(),void q.trackPage("/CreateAccountReCaptcha")):void E()}function s(){h(),N("#signUpReCaptchaContainer").hide()}function l(){d(!0,!1,!1)}function c(e){d(!1,!0,e)}function u(){d(!0,!0,!0)}function d(e,t,n){r(),U.isSignupCaptchaEnabled()?o():N("#signUpReCaptchaContainer").show(),m(),v(),e&&C(),t&&S(n)}function f(){N(".nickvalid").remove(),N(".emailvalid").remove(),N(".active .resetSuccessMsg").hide()}function h(){N("#updateDetails").hide().find("p").hide(),N("#signUpNicknameUpdate").val(""),N("#signUpEmailUpdate").val(""),b(),g()}function p(){return N("#updateDetails").visible()}function m(){var e=N("#signUpReCaptchaContainer .troubleSigningUp");e.show(),e.find(".resetPasswordForm").show(),e.find(".errors").hide(),n()}function g(){var e=N("#signUpReCaptchaContainer .troubleSigningUp");e.hide(),e.find(".resetPasswordForm").hide(),e.find(".errors").hide(),n()}function v(){N("#signUpReCaptchaContainer .infoText").hide(),N("#signUpReCaptchaInputForm .errors").text(G.getError("InvalidCreateAccountError")).show()}function b(){N("#signUpReCaptchaInputForm .errors").hide(),N("#signUpReCaptchaContainer .infoText").show()}function C(){N("#updateDetails").show().find(".nickname").show(),N("#signUpNicknameUpdate").val(N("#signUpNickname").val())}function S(e){N("#updateDetails").show().find(".email").show();var t=N("#signUpEmail").val();N("#signUpEmailUpdate").val(t),e&&N("#signUpEmailRetrievePassword").val(t)}function y(e,t,n,i){if(N("#lblCreateAccountError").html(""),e.Status===!1||"0"===e.Status)w(n,t,"",e,i);else{if(e.RockstarId&&void 0!=e.RockstarId){var a=e.RockstarId;J.setUserId(a)}J.setCustomDimension(J.dimension.creationDate,(new Date).toISOString()),J.setCustomDimension(J.dimension.creationPath,J.getCreationPath(globals.titleName)),q.trackPage("/CreateAccountSuccess"),G.CreateAccountSuccessSetup(!0),F.clearCachedProfileList();var r=M.formatDob(N("#yearOfBirth").val(),N("#monthOfBirth").val(),N("#dayOfBirth").val()),o=N("#signupAutoSignIn").is(":checked")?!0:!1,s=N("#signupRememberMe").is(":checked")?!0:!1,l={Email:N("#signUpEmail").val(),Password:N("#signUpPassword").val(),Nickname:N("#signUpNickname").val(),DOB:r,SaveEmail:s,SavePassword:!1,AutoSignIn:o};F.setAutoSigninData(l),M.WriteDebugLog("OnSuccessCreateAccount","jsonString",JSON.stringify(l)),j.onSuccessSignIn({data:e,jqXhr:n})}M.clearCreateAccount3003()}function w(e,t,n,i,a){M.WriteDebugLog("onErrorCreateAccount","ERROR",n,M.logType.error,M.logController.profile);var r=z.createAccountErrorViewModel(e,t,n,i,a);if(r.is3003)return void j.signInOnline();if(r.isAgeOutOfRange)return B.handleUnderAgeError(),void N("#onlinePolicies").fadeOut(function(){N("#termsTextContainer").hide(),H.hide(),N("#dob").fadeIn()});M.WriteDebugLog("onErrorCreateAccount","Error",r.errorCode+"."+(r.errorCodeEx||"")+": "+(r.errorMessage||""),M.logType.error,M.logController.profile);var o=G.getErrorWithCode(r.errorCode);G.showGenericFatalError(r.errorCode,o.Message,o.SupportText,o.CodeDescription),G.CreateAccountSuccessSetup(!1),G.removeLoading("signupPanelsWrapper")}function _(){return p()?N("#signUpNicknameUpdate").visible()&&!B.NicknameValidation("signUpNicknameUpdate")?!1:N("#signUpEmailUpdate").visible()&&!B.EmailValidation("signUpEmailUpdate")?!1:!0:!0}function E(){if(f(),_()){var e=N("#signUpEmailUpdate").val()||N("#signUpEmail").val(),t=N("#signUpNicknameUpdate").val()||N("#signUpNickname").val();N("#signUpEmail, #signUpEmailConfirm").val(e),N("#signUpNickname").val(t),$.storeAuthValue();var n={email:e,nickname:t,captchaData:H.getCaptchaData()};V.validateAccountDetails(n).then(function(e){k(e)}).catch(function(e){T(e)})}}function k(e){N("#lblCreateAccountError").html(""),!e.Status||"0"===e.Status||e.Error&&e.Error.length?T(void 0,"success",e):($.storeAuthValue(e.AuthToken),q.trackPage("/ValidateAccountDetails"),s(),L())}function T(e,t,n){var i=z.validateAccountDetailsErrorViewModel(e,t,n);if(i.isCaptchaError){var a=N("#signUpNicknameUpdate").visible(),r=N("#signUpEmailUpdate").visible();return d(a,r),void H.handleSignUpFailed(i.errorCode)}if(i.invalidAge)return B.handleUnderAgeError(),void N("#onlinePolicies").fadeOut(function(){N("#termsTextContainer").hide(),H.hide(),N("#dob").fadeIn()});if(i.existsEmail&&i.existsNickname)return u(),B.NicknameExists("signUpNicknameUpdate",i.exists,i.nicknames,!0),void B.EmailExists("signUpEmailUpdate",i.exists);if(i.existsNickname)return l(),void B.NicknameExists("signUpNicknameUpdate",i.exists,i.nicknames,!0);if(i.existsEmail)return c(!0),void B.EmailExists("signUpEmailUpdate",!0);if(i.invalidNickname||i.profaneNickname)return l(),void B.showError("nick",N("#signUpNicknameUpdate"),G.getError(M.errorCodeLocKey(i.errorCode)));if(i.invalidEmail)return c(!1),void B.showError("email",N("#signUpEmailUpdate"),G.getError(M.errorCodeLocKey(i.errorCode)));M.WriteDebugLog("validateAccountDetailsError","Error",i.errorCode+"."+(i.errorCodeEx||"")+": "+(i.errorMessage||""),M.logType.error,M.logController.profile);var o=G.getErrorWithCode(i.errorCode);G.showGenericFatalError(i.errorCode,o.Message,o.SupportText,o.CodeDescription),G.CreateAccountSuccessSetup(!1),G.removeLoading("loginPanelsWrapper")}function I(){if(M.ShowInvisibleMask(N("#submitAccount"),G.getError("Loading")),O.isLegacyServiceLayer())return void W.updateProfile();M.WriteDebugLog("UpdateDOB","","");var e=M.formatDob(N("#yearOfBirth").val(),N("#monthOfBirth").val(),N("#dayOfBirth").val()),t='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"dob":"'+e+'"}';M.WriteDebugLog("UpdateDOB","options",t),V.updateDob(e).catch(function(e){M.WriteDebugLog("settingsFn.updateDob","ajax error handled by fatalError",e)}).then(W.updateDobSuccess).then(function(){M.HideInvisibleMask()}).catch(function(e){M.WriteDebugLog("settingsFn.updateDob","unhandled exception",e,M.logType.error,M.logController.profile)})}function R(){if(M.ShowInvisibleMask(N("#submitAccount"),G.getError("Loading")),O.isLegacyServiceLayer())return void W.updateProfile();M.WriteDebugLog("UpdateDOB","","");var e=M.formatDob(N("#yearOfBirth").val(),N("#monthOfBirth").val(),N("#dayOfBirth").val()),t=N("#signUpCountry").val();V.UpdateDOBAndCountry(e,t).catch(function(e){M.WriteDebugLog("settingsFn.updateDobAndCountry","ajax error handled by fatalError",e)}).then(W.updateDobSuccess).then(function(){M.HideInvisibleMask()}).catch(function(e){M.WriteDebugLog("settingsFn.updateDobAndCountry","unhandled exception",e,M.logType.error,M.logController.profile)})}function A(e){M.WriteDebugLog("checkPassword");var t=N("#"+e),n=N("#"+e+"Conf"),i=n.val()!==t.val(),a=N("div.active span.pwvalid").length||N("div.active span.pwerror").length;i||a||(t.parents().children("span.pwvalid").remove(),B.PasswordValidation("signUpPassword")&&V.checkPasswordAsync(t.val()).then(function(t){B.PasswordInvalid(e,"false"===N(t).find("Status").text())}).catch(function(){M.WriteDebugLog("checkPassword","ajax failed")}))}function L(){var e=P();N("#termsTextContainer, #privacyTextContainer").removeAttr("style"),N("#onlinePolicies").find(".buttonPara a").hide(),N("#onlinePolicies").fadeIn(),N("#introTextContainer").show(),G.setUpLoading("#introTextContainer"),e.then(function(){G.removeLoading("introTextContainer"),N("#onlinePolicies").find(".buttonPara a").hide(),G.resetScrollbar("#onlinePolicies"),N("#onlinePoliciesContainer .antiscroll-scrollbar.antiscroll-scrollbar-vertical").hide(),N('#onlinePolicies .text a[href!="#"][class!="policyButtons"]:not(.btn)').addClass("RGSCLoadExt"),N("#buttonPrivacy").show(),setTimeout(function(){N("#buttonPrivacy").focus()},10),q.trackPage("/OnlinePolicies")}).catch(function(){M.WriteDebugLog("getPoliciesPromise","caught error")})}function P(){N("#buttonPrivacy, #buttonTerms").removeClass("complete"),N("#legalAgree").hide();var e=V.getPrivacyPolicy(),t=V.getTermsOfService();return e.then(function(e){var t=N(e).find("pp");if(t.length>0){var n=N("#privacyPolicyText");N("#privacyTextContainer").hide();var i=t.find("Text").text()||t.find("text").text();n.html(x(i)),U.setSignUpStepText(3)}else D()}).catch(function(){G.removeLoading("introTextContainer");var e=M.errorCode("3000.19"),t=G.getErrorWithCode(e,"GetPrivacyPolicy").Message;D(e,t)}),t.then(function(e){var t=N(e).find("tos");if(t.length>0){var n=N("#termsServiceText");N("#termsTextContainer").hide();var i=t.find("Text").text()||t.find("text").text();n.html(x(i)),n.html().length<=0&&D()}else D()}).catch(function(){G.removeLoading("introTextContainer");var e=M.errorCode("3000.20"),t=G.getErrorWithCode(e,"GetTos").Message;D(e,t)}),Promise.all([e,t])}function D(e,t,n,i,a){N("#onlinePolicies").hide(),G.showGenericFatalError(e,t,i,a)}function x(e){var t="<span class='rockstarLogo'></span>";return e.replace(new RegExp(/\[PAGE\]/g),"<br /><br />").replace(new RegExp(/\n/g),"<br />").replace(/\u00B5/g,"&nbsp;").replace("~EX_R*~",t).replace("[R*]",t)}var N=e("jquery"),M=e("utils"),O=e("common/baseUtils"),U=e("common/profile/profile-utils"),F=e("common/profile/signin-utils"),G=e("setup.environment.utils"),V=e("common/datafunctions"),j=e("common/profile/signin"),W=e("common/settings/settings"),B=e("common/formvalidation"),H=e("common/captcha"),q=e("am"),J=e("common/am/customDimensions"),$=e("common/auth");e("dropkick"),e("common/jquery.visible");var z={};return z.init=function(){N("#joinClub").keyup(function(e){var t=N(e.currentTarget);13==e.which&&t.visible()&&N(this).click()}).click(function(){return(!N(this).hasClass("disabled")||N("#selectProfile").hasClass("active"))&&(N("#recaptcha_challenge_field").val(""),N("#submitAccount").addClass("disabled"),G.setSelected(this),U.clearSignUpForms(),W.getCountriesAsync(),G.clearActivePanel(function(){N("#onlinePolicies, #signUpConfirm").hide(),N(H.getSignUpContainerElement()).hide(),N("#dob, #AccountDetailsForm, #registrationBack, #signUpSteps").show(),N("#dob p.intro").text(""),N("#lnkCreateOfflineProfile").toggle(globals.localProfileCreation),N("#signupPanels").css({left:"0"}),M.loadDateDropdowns(),G.setUpLoadingPanel("#signupPanelsWrapper",function(){U.signupDropkick(),U.signupClickOnEnter(),G.removeLoading("signupPanelsWrapper"),N("#signUpNickname").focus()})}),q.trackPage("/CreateAccountStart")),!1}),N("#signupAutoSignIn").on("click",function(){N(this).is(":checked")&&N("#signupRememberMe").prop("checked",!0)}),N("#signupRememberMe").on("click",function(){N(this).is(":checked")||N("#signupAutoSignIn").prop("checked",!1)}),N("a.previousPanel").keyup(function(e){var t=N(e.currentTarget);13==e.which&&t.visible()&&N(this).click()}).click(function(){if("block"==N("#dob").css("display"))return N("#dob").fadeOut(function(){M.pubsub.trigger("signin.showSignin")}),!1;if("block"===N("#signUpReCaptchaContainer").css("display")){var e=H.getSignUpContainerElement();return e.fadeOut(function(){U.setSignUpStepText(1),N("#dob").fadeIn(),N("#onlinePolicies").fadeOut()}),!1}if("block"===N("#introTextContainer").css("display"))return N("#introTextContainer").fadeOut(function(){U.setSignUpStepText(1),N("#dob").fadeIn(),N("#onlinePolicies").fadeOut()}),!1;if("block"===N("#termsTextContainer").css("display"))return N("#termsDisagree").hide(),N("#termsAgree").hide(),N("#onlinePoliciesContainer .antiscroll-scrollbar.antiscroll-scrollbar-vertical").hide(),N("#termsTextContainer").fadeOut(function(){U.setSignUpStepText(3),N("#introTextContainer").fadeIn(function(){N("#buttonPrivacy").show().focus()})}),!1;if("block"===N("#privacyTextContainer").css("display"))return N("#privacyDisagree, #privacyAgree").hide(),N("#onlinePoliciesContainer .antiscroll-scrollbar.antiscroll-scrollbar-vertical").hide(),N("#privacyTextContainer").fadeOut(function(){U.setSignUpStepText(3),N("#introTextContainer").fadeIn(function(){N("#buttonPrivacy").show().focus()})}),!1;var t=N(this).closest("div.signupPanel");return t.hasClass("DOBUpdate")||N(this).parents("div.panel").fadeOut(function(){t.hide(),t=null}),!1}),N("a.needAccountLink, .orCreateAccount a").click(function(e){return e&&e.preventDefault(),globals.localProfileCreation&&G.isOffline()?N("#joinClubOffline").click():G.isOnline()&&(M.loadDateDropdowns(),"en-US"!=globals.titlelang&&(N("#dob").hasClass("localized")||(N("[rel*=localize]").localize("Register",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),M.isGameSupported()&&N("#signUpConfirm [rel*=localize]").localize("General",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/"+globals.titleName}),N("#dob").addClass("localized"))),N("#dob").fadeIn(),N("#signupPanelsWrapper").hasClass("active")||N("#joinClub").click()),!1}),N("#signupMailingListContainer").on("click","span",function(){var e=N(this).siblings("input");e.prop("checked")?e.prop("checked",!1):e.prop("checked",!0),e.focus()}),N("#monthOfBirth, #yearOfBirth").change(function(){var e=M.getDaysForMonth(N("#monthOfBirth").val(),N("#yearOfBirth").val()),t=N("#dayOfBirth"),n=t.find("option"),i=n.length-e;if(i>0)n.slice(e).remove(),t.dropkick("refresh");else if(0>i)for(var a=n.length;e>=a;a++)0==t.find("option[value="+a+"]").length&&(N("<option>").val(a).text(a).appendTo("#dayOfBirth"),t.dropkick("refresh"))}),N("#yearOfBirth").change(function(e){var t=N(e.currentTarget);return t.hasClass("ignoreChange")?void t.removeClass("ignoreChange"):void B.DOBValidation(!1)}),N("#submitAccount").keyup(function(e){var t=N(e.currentTarget);13==e.which&&t.visible()&&a()}),N("#formAccountDetails").on("submit",a),N("#submitAccount").on("click",a),N("#signupCaptchaSubmit").on("click",function(e){e&&e.preventDefault(),N(this).hasClass("disabled")||E()}),N("#signUpReCaptchaInputForm").submit(function(e){e&&e.preventDefault(),N("#signupCaptchaSubmit").click()}),N("#signUpEmailPasswordResetForm").submit(function(e){e&&e.preventDefault(),N("#buttonSignUpPasswordReset").click()}),N("#buttonSignUpPasswordReset").click(function(){var e=N(this);if(e.hasClass("disabled"))return!1;e.addClass("disabled"),B.clearErrorClasses();var n="signUpEmailRetrievePassword";return B.EmailValidation(n)?(e.hide(),M.initSpinner(N("#resetSpinnerSignUp")).show(),N("div.active .buttonResetWrapper span").show(),t(n),!0):(e.removeClass("disabled"),!1)}),N("#onlinePolicies .buttonPara a").keyup(function(e){var t=N(e.currentTarget);13==e.which&&t.visible()&&N(this).click()}),N("#buttonPrivacy").click(function(e){e&&e.preventDefault();var t=N("#onlinePoliciesContainer");t.find(".antiscroll-scrollbar.antiscroll-scrollbar-vertical").show(),N("#onlinePolicies").find(".buttonPara a").hide(),t.find("#introTextContainer").fadeOut(function(){U.setSignUpStepText(3),N("#privacyTextContainer").fadeIn(function(){G.resetScrollbar("#onlinePolicies"),N("#onlinePolicies").find(".buttonPara .privacyButton").show(),N("#privacyAgree").focus()}).focus()}),t.find(".antiscroll-scrollbar.antiscroll-scrollbar-vertical").css("height","15px"),q.trackPage("/PrivacyPolicy")}),N("#privacyAgree").click(function(e){e&&e.preventDefault();var t=N("#onlinePoliciesContainer");t.find(".antiscroll-scrollbar.antiscroll-scrollbar-vertical").hide(),N("#onlinePolicies").find(".buttonPara a").hide(),t.find("#privacyTextContainer").fadeOut(function(){t.find(".antiscroll-inner").animate({scrollTop:0},"fast"),U.setSignUpStepText(4),N("#termsTextContainer").fadeIn(function(){N("#onlinePoliciesContainer .antiscroll-scrollbar.antiscroll-scrollbar-vertical").show().css("height","15px"),N("#onlinePolicies .buttonPara .termsButton").show(),N("#termsAgree").focus()}).focus()}),q.trackPage("/TermsAndConditions")}),N("#privacyDisagree").click(function(e){e&&e.preventDefault(),N("#introTextContainer, #onlinePolicies, #privacyTextContainer, #termsTextContainer").hide(),G.resetScrollbar("#onlinePolicies"),M.pubsub.trigger("signin.showSignin")}),N("#termsAgree").click(function(){return z.createAccount(),!1}),N("#termsDisagree").click(function(){return N("#introTextContainer, #onlinePolicies, #privacyTextContainer, #termsTextContainer").hide(),G.resetScrollbar("#onlinePolicies"),M.pubsub.trigger("signin.showSignin"),!1}),N("#signUpNickname").off("focusout.validation").on("focusout.validation",function(){B.NicknameValidation("signUpNickname")}),N("#signUpEmail").off("focusout.validation").on("focusout.validation",function(){var e=N(this);e.val(e.val().trim()),B.EmailValidation("signUpEmail"),B.ConfirmEmail(N("#signUpEmailConfirm"))}),N("#signUpEmailConfirm").off("focusout.validation").on("focusout.validation",function(){var e=N(this);e.val(e.val().trim()),B.ConfirmEmail(N("#signUpEmailConfirm"))}),N("#signUpPassword").off("keydown").on("keydown",function(){B.clearPasswordConfirmationInput()}),N("#signUpPassword").off("focusout.validation").on("focusout.validation",function(){B.ConfirmPassword(N("#signUpPasswordConf"))}),N("#signUpPasswordConf").off("focusout.validation").on("focusout.validation",function(){A("signUpPassword"),B.ConfirmPassword(N("#signUpPasswordConf"))}),N("#createAccount").click(function(e){e&&e.preventDefault(),N(this).hasClass("disabled")||z.createAccount()}),N("#signUpConfirmButton").keyup(function(e){var t=N(e.currentTarget);13==e.which&&t.visible()&&N(this).click()}).click(function(){return G.clearActivePanel(function(){N("#signUpConfirm").hide(),M.pubsub.trigger("setupEnv:showHomepage")}),!1})},z.createAccount=function(){var e=N("#createAccount, #termsAgree");M.ShowInvisibleMask(e,G.getError("Loading")),F.clearAreSigninCredsFromGame();var t={dob:M.formatDob(N("#yearOfBirth").val(),N("#monthOfBirth").val(),N("#dayOfBirth").val()),email:N("#signUpEmail").val(),password:N("#signUpPassword").val(),nickname:N("#signUpNickname").val(),mailinglist:N("#signupMailingListContainer").find("input:checked").length>0,countryCode:N("#signUpCountry").length?N("#signUpCountry").val():""};t.authValue=t.nickname+"|"+t.email;var n={Email:t.email,Password:t.password};V.createAccountAsync(t).then(function(e){y(e.data,e.status,e.jqXhr,n)}).catch(function(e){e instanceof Error&&(e={errorThrown:e.message}),w(e.jqXhr,e.textStatus,e.errorThrown,void 0,n)}).then(function(){M.HideInvisibleMask(),n=null})},z.createAccountErrorViewModel=function(e,t,n,i,a){var r={},o=e&&e.responseJSON;if(!M.getCreateAccount3003()&&o&&o.Message&&o.Message.indexOf(M.errorCode("3003"))>-1){M.setCreateAccount3003();var s={Email:a.Email,Password:a.Password};return F.setAutoSigninData(s),r.is3003=!0,r}if("success"===t)if(n=i.Error,n&&(r.errorCode=n.Code,r.errorCodeEx=n.CodeEx,r.errorMessage=n.ErrorMessage),void 0!=r.errorCode&&"NotAllowed"===r.errorCode&&"Privilege"===r.errorCodeEx)r.errorCode=M.errorCode("4001.38");else{if(void 0!=r.errorCode&&r.errorCode===M.errorCode("5003.4"))return r.isAgeOutOfRange=!0,r;if("NotAllowed"==r.errorCode){var l=i.Error?i.Error.CodeEx:"";"SteamAccountLink"===l?r.errorCode=M.errorCode("4001.49"):"RockstarAccountLink"===l&&(r.errorCode=M.errorCode("4001.81"))}}else if("timeout"===t)r.errorCode=M.errorCode("1001");else if("error"===t&&e&&403===e.status){var c=e&&e.statusText&&e.statusText.indexOf("synchronizer")>-1;c&&(r.errorCode=e.statusText)}return"undefined"==typeof r.errorCode&&("object"==typeof o&&(r.errorCode=o.Message),"undefined"==typeof r.errorCode&&(r.errorCode=M.errorCode("1000.1"))),r},z.validateAccountDetailsErrorViewModel=function(e,t,n){var i,a,r={};if("undefined"!=typeof e&&(a=e.responseText),r.isCaptchaError="undefined"==typeof n&&"undefined"!=typeof a&&a.indexOf("captcha")>-1,r.isCaptchaError)return n=e.responseJSON,i=n.Error,r.errorCode=i.Code,r;if("success"===t){if(i=n.Error,r.errorCode=i.Code,r.errorCodeEx=i.CodeEx,r.errorMessage=i.ErrorMessage,void 0!=r.errorCode&&r.errorCode==M.errorCode("5003.4"))return r.invalidAge=!0,r;if(void 0!=r.errorCode&&"AlreadyExists"===r.errorCode&&"NickAndEmail"===r.errorCodeEx)return r.exists=!n.Status,r.existsEmail=r.exists,r.existsNickname=r.exists,r.nicknames=n.NickNames,r;if(void 0!=r.errorCode&&"AlreadyExists"===r.errorCode&&"Nickname"===r.errorCodeEx)return r.exists=!n.Status,r.existsNickname=r.exists,r.nicknames=n.NickNames,r;if(void 0!=r.errorCode&&"AlreadyExists"===r.errorCode&&"Email"===r.errorCodeEx)return r.exists=!n.Status,r.existsEmail=r.exists,r}else"timeout"==t&&(r.timeout=!0,r.errorCode=M.errorCode("1001"));if("undefined"==typeof r.errorCode){if("object"==typeof e.responseJSON&&(r.errorCode=e.responseJSON.Message),r.errorCode===M.errorCode("5001.27"))return r.invalidNickname=!0,r;if(r.errorCode===M.errorCode("5004.27"))return r.profaneNickname=!0,r;if(r.errorCode===M.errorCode("5001.11"))return r.invalidEmail=!0,r;"undefined"==typeof r.errorCode&&(r.errorCode=M.errorCode("1000.1"))}return r},z}),define("common/messages/messages",["require","jquery","utils","underscore","setup.environment.utils","common/profile/profile-utils","common/datafunctions.friends","common/modals/modal-views","am","common/antiscroll","jquery-ui","common/jquery.visible"],function(e){var t=e("jquery"),n=e("utils"),i=e("underscore"),a=e("setup.environment.utils"),r=e("common/profile/profile-utils"),o=e("common/datafunctions.friends"),s=e("common/modals/modal-views"),l=e("am");e("common/antiscroll"),e("jquery-ui"),e("common/jquery.visible");var c={};c.init=function(){var e=t("#newReplyEntry"),i=t(".newMessageEntry");e.keyup(function(e){var i=t(e.currentTarget);if(i.visible()){if(n.trimValueIfExceedMaxLength(i),13==e.which)return void t(".sendReply").click();var a=t(this).val().length;f(a)}}),e.focusout(function(){var e=t(this).val().length;f(e)}),i.keyup(function(e){var i=t(e.currentTarget);if(i.visible()){if(n.trimValueIfExceedMaxLength(i),13==e.which)return void t(".sendMessage").click();var r=t(this).val().length;t("#messagesContainer").find(".characterCountWrapper span.characterCount").text(r),a.EnableSendMessageButton(r)}}),i.focusout(function(){var e=t(this).val().length;t("#messagesContainer").find(".characterCountWrapper span.characterCount").text(e),a.EnableSendMessageButton(e)}),t("#messagesPanel #cancelMessage").click(function(e){e&&e.preventDefault();var i=t(this);if(!globals.isLauncher&&!i.hasClass("disabled")){var r=t("#newMessageName");r.val(""),r.attr("data-rockstarId","");var o=t("#newMessageInput");if(o.find("textarea").val(""),o.find("span.characterCount").text("0"),t("#messagesPanel .help-block").text(""),t(".sendMessage").addClass("disabled"),t("#newMessageInput, #cancelMessage").hide(),i.hasClass("backFriendLink"))return n.WriteDebugLog("cancelMessage",".click","return to friends"),i.removeClass("backFriendLink"),void a.showPanel(t("#"+i.data("returnPanel")));n.WriteDebugLog("cancelMessage",".click","return to messages"),t("#messagesList, #messageThread, #newMessage").show()}}),t("#newMessageToPlayer").find(".back").click(function(e){if(e&&e.preventDefault(),!globals.isLauncher){var n=t(this);o.GetMessageThread(n.attr("data-id"),n.attr("data-avatar"),n.attr("data-nickname"))}}),t("#MessageThreadHeader").find("a.reply").click(function(e){if(e&&e.preventDefault(),!globals.isLauncher){var n=t(this);c.openNewMessage(n.attr("data-id"),n.attr("data-avatar"),n.attr("data-nickname"))}}),t("#newMessageName").keydown(function(e){return 13==e.keyCode||32==e.keyCode?!1:!0}),t(".sendReply").keyup(function(e){var n=t(e.currentTarget);13==e.which&&n.visible()&&t(this).click()}).click(function(e){e&&e.preventDefault();var n=t(this);if(!n.hasClass("disabled")){var i=t("#replyMessageInput"),r=encodeURIComponent(t("#replyMessageInput .newMessageEntry").val().trim());if(0==r.length)return void i.find(" .input .help-block").text(a.getText("MessageMissing","Errors"));i.find(" .input .help-block").text("");var s=t("#replyToNickname"),l=s.attr("data-rockstarId");if(void 0!=l){n.addClass("disabled");var c=s.text();o.SendMessage(c,l,r,!0)}}}),t(".sendMessage").keyup(function(e){var n=t(e.currentTarget);13==e.which&&n.visible()&&t(this).click()}).click(function(e){e&&e.preventDefault();var n=t(this);if(!n.hasClass("disabled")){var i=t("#friendsSearch").find("#newMessageName"),r=i.attr("data-rockstarId");if(r===globals.account.RockstarId){var l=a.getText("MessageBlocked3","Social"),c=a.getText("SendMessageTitle","Social");return void s.ShowConfirmModal(l,"","",null,"Ok",null,c)}var u,d=encodeURIComponent(t("#newMessageInput .newMessageEntry").val().trim()),f=t("#newMessageInput .input .help-block");0==d.length?(f.text(a.getText("MessageMissing","Errors")),u=!0):f.text("");var h=i.val(),p=t("#friendsSearch .help-block");""==h||void 0==r||""==r?(p.text(a.getText("NicknameMissing","Errors")),u=!0):p.text(""),u||(n.addClass("disabled"),t("#cancelMessage").addClass("disabled"),o.SendMessage(h,r,d,!1))}})},c.showMessagesPage=function(){t("#headerLoginOptionsDrop").is(":visible")&&t("#headerLoginOptionsButton").click();var e=t("#messagesPanel"),n=e.hasClass("active");a.setSelected(),a.isSignedIn()?(t("#messageThreadList").empty(),t("#replyMessageInput, #newMessageInput, #cancelMessage").hide(),t("#messagesList .box .antiscroll-inner").empty(),t("#messagesList").removeData(),t("#messageThread").removeData(),t("#cancelMessage").removeClass("backFriendLink"),t("#newMessageName").removeData().val(""),t("#newMessage").show(),a.messagesListQuery(),"en-US"!=globals.titlelang&&(e.hasClass("localized")||(e.find("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),e.addClass("localized"))),e.find("div.antiscroll-wrap").antiscroll()):r.navigatePendingSignIn("#menuMessages"),n||l.trackPage("/Messages")
},c.openNewMessage=function(e,r,s,l){if(n.WriteDebugLog("openNewMessage","returnPanel-xxx",l),!globals.messagingServiceEnabled)return t("#homeButton").click(),void n.pubsub.trigger("setupEnv:showServiceAlert");var c=void 0!=l&&""!=l,f=t("#messagesPanel"),h=f.find("#cancelMessage"),p=f.find("#newMessageName"),m=f.find("#newMessageEntry");c&&(h.addClass("backFriendLink").data("returnPanel",l),p.val(s).attr("data-rockstarId",e)),f.hasClass("active")||a.setUpLoadingPanel("#messagesPanel",function(){c?m.focus():p.focus()}),m.val(""),f.find("#newMessageInput span.characterCount").text("0"),f.find(".sendMessage").addClass("disabled"),f.find(".help-block").text(""),f.find("div.content").removeAttr("style"),a.setSelectedSide("#messagesLink"),n.WriteDebugLog("openNewMessage","#newMessageInput style",t("#newMessageInput").attr("style")),f.find("#newMessageInput h5").html(a.getText("SendMessageTitle","Social","Send a new message")),t("#cancelMessage, #newMessageInput").show(),t("#newMessage").hide(),f.attr("class","panel active messageFriendSearch"),"en-US"!=globals.titlelang&&(f.hasClass("localized")||(f.find("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),f.addClass("localized"))),p.hasClass("ui-autocomplete-input")||p.autocomplete({source:function(e,n){o.accountSearch(e,n,t("#newMessageName").val(),u,d)},appendTo:".ui-widget",minLength:3,messages:{noResults:"",results:function(){}},select:function(e,i){e.preventDefault();var r=t("#newMessageName");if(1==i.item.relationship)r.attr("data-rockstarId",""),r.val(""),n.pubsub.trigger("datafnfriends:RedirectToBlockList",i.item.label);else{r.val(i.item.label),r.attr("data-rockstarId",i.item.id);var o=0+encodeURIComponent(t("#newMessageEntry").val()).length;a.EnableSendMessageButton(o)}},change:function(){var e=t("#newMessageName");if("undefined"==typeof e.data("rockstarId")){var n=t("#newMessageName").siblings(".ui-widget");if(n.children("li").length>0){var i=n.find("li:contains("+e.val()+")");i.length||(i=n.children("li").first());var a=i.data("ui-autocomplete-item");e.val(a.value),e.attr("data-rockstarId",a.id)}}}}),p._renderItem=function(e,n){return i.include(self.idArr,n.id)?void 0:t("<li></li>").data("ui-autocomplete-item",n).append("<a>"+n.name+"</a>").appendTo(e)},a.removeLoading("messagesPanel")},c.disableMessagingFeatures=function(){t("#menuMessages").parent("li").hide()};var u=function(e,n){t("#msgFriendSearchForm .help-block").html(""),n(t.map(e.RockstarAccountList.RockstarAccounts,function(e){return{label:e.Name,value:e.Name,id:e.RockstarId,relationship:e.Relationship}}))},d=function(e){if(e.errorCode==n.errorCode("5005")){var i=t("#msgFriendSearchForm"),r=a.getError("NickInvalid");return i.find(".help-block").html(r),void i.find(".ui-autocomplete").hide()}s.ShowErrorModal(e)},f=function(e){e>0?t(".sendReply").removeClass("disabled"):t(".sendReply").addClass("disabled")};return n.pubsub.on("msg.openNewMessage",c.openNewMessage),c}),define("common/app-cache",["jquery","backbone","utils","backbone-cache"],function(e,t){var n={};return n.crews=new t.Cache,n}),define("hbs!common/templates/crew/mycrews",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div id="activeCrew"></div>\r\n<div id="myCrewList"></div>'});return n}),define("hbs!common/templates/crew/crew_card_large",["hbs","common/hbs/handlebars","hbs!common/templates/crew/crew_tag","common/templates/helpers/emblemUrl"],function(e,t){var n=t.template(function(e,t,n,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=this.merge(i,e.partials);var a,r,o,s="",l="function",c=this.escapeExpression,u=n.helperMissing,d=this;return s+='<div class="crewLarge lightCard">\n    <div class="clearfix">\n        <div class="crewLast" rel="localize[Active]">Active</div>\n        <div class="',(r=n.CrewType)?a=r.call(t,{hash:{}}):(r=t&&t.CrewType,a=typeof r===l?r.call(t,{hash:{}}):r),s+=c(a)+' crewType">\n\n            <img class="avatar" src="'+c((r=n.emblemUrl||t&&t.emblemUrl,o={hash:{}},r?r.call(t,t&&t.CrewId,128,o):u.call(t,"emblemUrl",t&&t.CrewId,128,o)))+'" />\n\n            <h3>',(r=n.CrewName)?a=r.call(t,{hash:{}}):(r=t&&t.CrewName,a=typeof r===l?r.call(t,{hash:{}}):r),s+=c(a)+"</h3>\n\n            ",a=d.invokePartial(i["common/templates/crew/crew_tag"],"common/templates/crew/crew_tag",t,n,i),(a||0===a)&&(s+=a),s+='\n\n            <p><span class="memberCount">',(r=n.MemberCount)?a=r.call(t,{hash:{}}):(r=t&&t.MemberCount,a=typeof r===l?r.call(t,{hash:{}}):r),s+=c(a)+'</span> <span rel="localize[Members]">members</span></p>\n        </div>\n\n        <div class="right">\n            <div class="left">\n                <ul id="crewList" class="clearfix">\n                    <li>\n                        <h5>\n                            <span rel="localize[Division]">Division</span>\n                        </h5>\n                        <p class="division">',(r=n.Division)?a=r.call(t,{hash:{}}):(r=t&&t.Division,a=typeof r===l?r.call(t,{hash:{}}):r),s+=c(a)+'</p>\n                    </li>\n                </ul>\n            </div>\n\n            <div class="actions clearfix">\n                <a class="leaveTrigger" data-id="',(r=n.CrewId)?a=r.call(t,{hash:{}}):(r=t&&t.CrewId,a=typeof r===l?r.call(t,{hash:{}}):r),s+=c(a)+'" href="#" rel="localize[LeaveCrew]">\n                    Leave Crew\n                </a>\n            </div>\n        </div>\n    </div>\n</div>'});return n}),define("hbs!common/templates/crew/crew_members",["hbs","common/hbs/handlebars","hbs!common/templates/crew/crew_tag"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e){var t,i,a="";return a+='\n<div id="crewHeader" class="clearfix">\n  <div class="profileButton" data-rel="">\n    <img width="64" height="64" class="avatarImg" data-id="',(i=n.LeaderRockstarId)?t=i.call(e,{hash:{}}):(i=e&&e.LeaderRockstarId,t=typeof i===c?i.call(e,{hash:{}}):i),a+=u(t)+'" alt="" src="',(i=n.LeaderAvatar)?t=i.call(e,{hash:{}}):(i=e&&e.LeaderAvatar,t=typeof i===c?i.call(e,{hash:{}}):i),a+=u(t)+'" />\n      <div class="text">\n        <h5 class="profilenickname" data-id="',(i=n.LeaderRockstarId)?t=i.call(e,{hash:{}}):(i=e&&e.LeaderRockstarId,t=typeof i===c?i.call(e,{hash:{}}):i),a+=u(t)+'">',(i=n.LeaderNickname)?t=i.call(e,{hash:{}}):(i=e&&e.LeaderNickname,t=typeof i===c?i.call(e,{hash:{}}):i),a+=u(t)+'</h5>\n          <span class="infoWrap rank" rel="localize[Leader]">Leader</span>\n          <span class="infoWrap dateJoined">\n          <span rel="localize[Joined]">Joined</span>: ',(i=n.LeaderDateJoined)?t=i.call(e,{hash:{}}):(i=e&&e.LeaderDateJoined,t=typeof i===c?i.call(e,{hash:{}}):i),a+=u(t)+"\n        </span>\n      </div>\n    </div>\n</div>\n"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=this.merge(i,e.partials);var o,s,l="",c="function",u=this.escapeExpression,d=this;return l+='<div class="clearfix">\n  <h3>',(s=n.CrewName)?o=s.call(t,{hash:{}}):(s=t&&t.CrewName,o=typeof s===c?s.call(t,{hash:{}}):s),l+=u(o)+"</h3>\n  ",o=d.invokePartial(i["common/templates/crew/crew_tag"],"common/templates/crew/crew_tag",t,n,i),(o||0===o)&&(l+=o),l+='\n  <h4 id="memberCount"><i></i> ',(s=n.MemberCount)?o=s.call(t,{hash:{}}):(s=t&&t.MemberCount,o=typeof s===c?s.call(t,{hash:{}}):s),l+=u(o)+' <span rel="localize[Members]">members</span></h4>\n</div>\n\n',o=n["if"].call(t,t&&t.LeaderNickname,{hash:{},inverse:d.noop,fn:d.program(1,r,a)}),(o||0===o)&&(l+=o),l+='\n\n<form id="crewMemberSearchForm" class="clearfix">\n    <div class="input">\n        <div class="ui-widget" id="crewMemberSearchInput">\n            <input type="text" name="crewMemberSearchText" id="crewMemberSearchText" class="text" placeholder="Find Crew Members" rel="localize[FindCrewMembers]" />\n        </div>					\n        <span class="help-block"></span>\n    </div>\n    <a id="crewMemberSearchLink" class="searchButton"><span>Search</span></a>\n    <p rel="localize[CrewList]">This page shows the most recently active crew members.</p>\n</form>\n\n<div class="list clearfix"></div>'});return n}),define("hbs!common/templates/crew/crew_invite",["hbs","common/hbs/handlebars","hbs!common/templates/crew/crew_tag","common/templates/helpers/emblemUrl"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(){return'\n            <a class="optionAcceptCrew btn btnPurple btnSmall"><span rel="localize[Accept]">Accept</span></a>\n        '}function o(e){var t,i,a="";return a+='\n            <a class="optionAcceptCrew btn btnPurple btnSmall disabled" rel="localize[Accept]" title="',(i=n.MaxCrewsMsg)?t=i.call(e,{hash:{}}):(i=e&&e.MaxCrewsMsg,t=typeof i===d?i.call(e,{hash:{}}):i),a+=f(t)+'"><span rel="localize[Accept]">Accept</span></a>\n        '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=this.merge(i,e.partials);var s,l,c,u="",d="function",f=this.escapeExpression,h=n.helperMissing,p=this;return u+='<div class="crewCard lightCard">\n    <div class="crewType clearfix">\n        <img class="avatar" width="64" height="64" src="'+f((l=n.emblemUrl||t&&t.emblemUrl,c={hash:{}},l?l.call(t,t&&t.CrewId,64,c):h.call(t,"emblemUrl",t&&t.CrewId,64,c)))+'"/>\n        <div class="left">\n            <h5>',(l=n.CrewName)?s=l.call(t,{hash:{}}):(l=t&&t.CrewName,s=typeof l===d?l.call(t,{hash:{}}):l),u+=f(s)+"</h5>\n\n            ",s=p.invokePartial(i["common/templates/crew/crew_tag"],"common/templates/crew/crew_tag",t,n,i),(s||0===s)&&(u+=s),u+="\n\n            <p>",(l=n.MemberCount)?s=l.call(t,{hash:{}}):(l=t&&t.MemberCount,s=typeof l===d?l.call(t,{hash:{}}):l),u+=f(s)+' <span rel="localize[Members]">members</span></p>\n        </div>\n    </div>\n    <div class="options">\n\n        ',s=n["if"].call(t,t&&t.CanJoin,{hash:{},inverse:p.program(3,o,a),fn:p.program(1,r,a)}),(s||0===s)&&(u+=s),u+='\n\n        <a class="optionDeclineCrew btn btnGrey btnSmall"><span rel="localize[Decline]">Decline</span></a>\n    </div>\n</div>'});return n}),define("hbs!common/templates/crew/crew_invites_empty",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div id="noCrewInvites" class="emptySocial">\r\n    <p rel="localize[NoCrewInvites]">No pending crew invites</p>\r\n    <span></span>\r\n    <a class="btn btnPurple" href="#" rel="localize[JoinACrew]">Join a crew</a>\r\n</div>'});return n}),define("hbs!common/templates/crew/mycrews_empty",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div id="noCrew" class="emptySocial">\r\n    <p rel="localize[NotACrewMember]">Not a member of any crew yet</p>\r\n    <span></span>\r\n    <a class="btn btnPurple" href="#" rel="localize[JoinACrew]">Join a crew</a>\r\n</div>'});return n}),define("hbs!common/templates/crew/crew_members_empty",["hbs","common/hbs/handlebars","common/templates/helpers/ifequals"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e){var t,i,a="";return a+='\r\n<div id="noCrew" class="emptySocial">\r\n    <p>',(i=n.errorMsg)?t=i.call(e,{hash:{}}):(i=e&&e.errorMsg,t=typeof i===u?i.call(e,{hash:{}}):i),a+=d(t)+'</p>\r\n    <span></span>\r\n    <a class="btn btnPurple" href="#" rel="localize[JoinACrew]">Join a crew</a>\r\n</div>\r\n'}function o(e){var t,i,a="";return a+='\r\n<h3 class="errorText">',(i=n.errorMsg)?t=i.call(e,{hash:{}}):(i=e&&e.errorMsg,t=typeof i===u?i.call(e,{hash:{}}):i),a+=d(t)+"</h3>\r\n"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s,l,c,u="function",d=this.escapeExpression,f=this,h=n.helperMissing;return l=n.ifequals||t&&t.ifequals,c={hash:{},inverse:f.program(3,o,a),fn:f.program(1,r,a)},s=l?l.call(t,t&&t.errorCode,"NotACrewMember",c):h.call(t,"ifequals",t&&t.errorCode,"NotACrewMember",c),s||0===s?s:""});return n}),define("hbs!common/templates/crew/find_crew",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<form id="searchCrewsForm" class="clearfix">\r\n    <input type="hidden" id="searchCrewtype" value="" />\r\n    <fieldset>\r\n        <legend>Search Crews Form</legend>\r\n        <div id="searchCrewsSelect">\r\n            <div class="input">\r\n                <select name="selectCrewType" id="selectCrewType">\r\n                    <option value="" rel="localize[CrewTypeAll]">All Types</option>\r\n                    <option data-category="opencrews" value="opencrews" rel="localize[CrewTypeOpen]">Open Crews</option>\r\n                    <option data-category="rockstar" value="rockstarcrews" rel="localize[CrewTypeRockstar]">Rockstar Crews</option>\r\n                    <option data-category="chatterBoxes" value="chatterboxes" rel="localize[CrewTypeChatterBoxes]">Chatter Boxes</option>\r\n                    <option data-category="thrillSeekers" value="thrillseekers" rel="localize[CrewTypeThrillSeekers]">Thrill Seekers</option>\r\n                    <option data-category="rebels" value="rebels" rel="localize[CrewTypeRebels]">Rebels</option>\r\n                    <option data-category="soldiers" value="soldiers" rel="localize[CrewTypeSoldiers]">Soldiers</option>\r\n                    <option data-category="allStars" value="allstars" rel="localize[CrewTypeAllStars]">All Stars</option>\r\n                    <option data-category="friends" value="friends" rel="localize[CrewTypeMyFriends]">My Friends\' Crews</option>\r\n                </select>\r\n            </div>\r\n            <span class="help-block"></span>\r\n        </div>\r\n        <div id="searchCrewsInput">\r\n            <div class="input">\r\n                <input type="text" name="searchCrewnames" id="searchCrewnames" maxlength="20" placeholder="Search by name" rel="localize[SearchByName]" />\r\n                <a href="#" id="searchButton" class="searchButton">\r\n                    <span rel="localize[Search]">>Search</span>\r\n                </a>\r\n            </div>\r\n            <span class="help-block" rel="localize[SearchMin3Chars]">Search must contain a minimum of 3 characters</span>\r\n        </div>\r\n    </fieldset>\r\n</form>\r\n<div class="foundCrewsWrapper">\r\n    <div class="foundCrews">\r\n        <div class="foundCrewsInner clearfix"></div>\r\n    </div>\r\n</div>'});return n}),define("hbs!common/templates/crew/crews_empty",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var i,a,r="",o="function",s=this.escapeExpression;return r+='<h3 class="errorText">',(a=n.ErrorMsg)?i=a.call(t,{hash:{}}):(a=t&&t.ErrorMsg,i=typeof a===o?a.call(t,{hash:{}}):a),r+=s(i)+"</h3>"});return n}),define("hbs!common/templates/crew/crew_request",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var i,a,r="",o="function",s=this.escapeExpression;return r+='<div class="profileButton crewRequest">\r\n    <img width="64" height="64" class="avatarImg" data-id="',(a=n.RockstarId)?i=a.call(t,{hash:{}}):(a=t&&t.RockstarId,i=typeof a===o?a.call(t,{hash:{}}):a),r+=s(i)+'" alt="" src="',(a=n.AvatarUrl)?i=a.call(t,{hash:{}}):(a=t&&t.AvatarUrl,i=typeof a===o?a.call(t,{hash:{}}):a),r+=s(i)+'" />\r\n    <div class="text">\r\n        <h5>\r\n            <a href="#" class="profilenickname" data-id="',(a=n.RockstarId)?i=a.call(t,{hash:{}}):(a=t&&t.RockstarId,i=typeof a===o?a.call(t,{hash:{}}):a),r+=s(i)+'">',(a=n.Nickname)?i=a.call(t,{hash:{}}):(a=t&&t.Nickname,i=typeof a===o?a.call(t,{hash:{}}):a),r+=s(i)+'</a>\r\n        </h5>\r\n    </div>\r\n    \r\n    <div class="options">\n        <a class="optionInvite btn btnPurple btnSmall"><span rel="localize[Invite]">Invite</span></a>\n        <a class="optionDelete btn btnGrey btnSmall"><span rel="localize[Delete]">Delete</span></a>\n    </div>\n</div>'});return n}),define("hbs!common/templates/crew/crew_invites_header",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<ul id="crewInvitesSwitch" class="clearfix noRemove">\r\n    <li class="invites noRemove">\r\n      <a href="#" class="noRemove" rel="localize[Invites]">Invites</a>\r\n    </li>\r\n    <li class="requests noRemove">\r\n      <a href="#" class="noRemove" rel="localize[Requests]">Requests</a>\r\n    </li>\r\n  </ul>'});return n}),define("hbs!common/templates/crew/crew_requests_empty",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div id="noCrewInvites" class="emptySocial">\r\n    <p rel="localize[NoCrewRequests]">No pending requests</p>\r\n    <span></span>\r\n</div>'});return n}),define("hbs!common/templates/crew/crew_requests_crews_i_manage",["hbs","common/hbs/handlebars","common/templates/helpers/emblemUrl"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(){return'\r\n  <p class="noRemove" rel="localize[SelectACrew]">Select a crew</p>\r\n'}function o(e){var t,i,a,r="";return r+='\r\n      <li class="noRemove">\r\n          <a href="#" data-crewId="',(i=n.CrewId)?t=i.call(e,{hash:{}}):(i=e&&e.CrewId,t=typeof i===c?i.call(e,{hash:{}}):i),r+=u(t)+'" class="noRemove">\r\n              <img class="avatar noRemove" src="'+u((i=n.emblemUrl||e&&e.emblemUrl,a={hash:{}},i?i.call(e,e&&e.CrewId,64,a):d.call(e,"emblemUrl",e&&e.CrewId,64,a)))+'" title="',(i=n.CrewName)?t=i.call(e,{hash:{}}):(i=e&&e.CrewName,t=typeof i===c?i.call(e,{hash:{}}):i),r+=u(t)+'"/>\r\n          </a>\r\n      </li>\r\n      '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s,l="",c="function",u=this.escapeExpression,d=n.helperMissing,f=this;return l+='<div id="manageCrews" class="noRemove">\r\n',s=n["if"].call(t,t&&t.ShowTitle,{hash:{},inverse:f.noop,fn:f.program(1,r,a)}),(s||0===s)&&(l+=s),l+='\r\n\r\n  <ul class="crewsIManage noRemove">\r\n      ',s=n.each.call(t,t&&t.CrewsIManage,{hash:{},inverse:f.noop,fn:f.program(3,o,a)}),(s||0===s)&&(l+=s),l+="\r\n  </ul>\r\n</div>"});return n}),define("common/crews/crews-views",["jquery","backbone","underscore","common/crews/crews-models","utils","common/baseUtils","common/datafunctions","setup.environment.utils","common/datafunctions.friends","common/modals/modal-views","am","common/profile/profile-views","common/app-cache","common/am/socialCount","hbs!common/templates/crew/mycrews","hbs!common/templates/crew/crew_card","hbs!common/templates/crew/crew_card_large","hbs!common/templates/crew/crew_members","hbs!common/templates/crew/crew_invite","hbs!common/templates/crew/crew_invites_empty","hbs!common/templates/crew/mycrews_empty","hbs!common/templates/crew/crew_members_empty","hbs!common/templates/crew/find_crew","hbs!common/templates/crew/crews_empty","hbs!common/templates/crew/crew_tag","hbs!common/templates/crew/crew_request","hbs!common/templates/crew/crew_invites_header","hbs!common/templates/crew/crew_requests_empty","hbs!common/templates/crew/crew_requests_crews_i_manage","dropkick"],function(e,t,n,i,a,r,o,s,l,c,u,d,f,h,p,m,g,v,b,C,S,y,w,_,E,k,T,I,R){var A,L={};L.closeCrewViews=function(){void 0!=window.amd.crews.MyCrewsView&&window.amd.crews.MyCrewsView.onClose(),void 0!=window.amd.crews.CrewMembersView&&window.amd.crews.CrewMembersView.onClose(),void 0!=window.amd.crews.CrewInvitesView&&window.amd.crews.CrewInvitesView.onClose(),void 0!=window.amd.crews.FindCrewView&&window.amd.crews.FindCrewView.onClose(),void 0!=window.amd.crews.CrewRequestsView&&window.amd.crews.CrewRequestsView.onClose(),void 0!=window.amd.crews.CrewInvitesHeaderView&&window.amd.crews.CrewInvitesHeaderView.onClose()},L.MyPrimaryCrewTagView=t.View.extend({el:"#crewCardTag",render:function(){var e="";if(this.model.get("CrewTag")){this.model.set({IsMember:!0});var t=this.model.toJSON();e=a.renderCompiledTemplate(E,t)}return this.$el.html(e),this.$el.fadeIn(),this},fetchPrimaryCrew:function(e){if(void 0!=e)this.model=e,this.render();else{var t=this,n=s.GetAuthHeaderAsync();n.done(function(e){t.model.fetch({headers:e})})}},onClose:function(){this.stopListening(),a.pubsub.off("crews:UpdatePrimaryCrewTag")},initialize:function(){n.bindAll(this,"render","fetchPrimaryCrew"),this.model=new i.PrimaryCrewModel,this.listenTo(this.model,"change",this.render),a.pubsub.on("crews:UpdatePrimaryCrewTag",this.fetchPrimaryCrew),this.fetchPrimaryCrew()}}),L.CrewListView=t.View.extend({render:function(){var e=this;return this.collection.each(function(t){var n=new L.CrewView({model:t});if(e.CrewViews.push(n),"search"==t.get("Template"))e.$el.append(n.render().el);else{var i=!t.get("IsPrimary");t.set({CanMakeActive:i,CanLeave:!0,IsMember:!0}),t.get("IsPrimary")?(a.pubsub.trigger("crews:UpdatePrimaryCrewTag",t),e.$el.find("#activeCrew").append(n.render().el)):e.$el.find("#myCrewList").append(n.render().el)}e.$(".crewCard img").on("error",a.crewImage404),e.$(".crewLarge img").on("error",a.crewImage404)}),this},onClose:function(){if(void 0!=this.CrewViews&&this.CrewViews.length>0)for(var e=0;e<this.CrewViews.length;e++)this.CrewViews[e].onClose()},initialize:function(){n.bindAll(this,"render","onClose"),this.CrewViews=[],this.render()}}),L.MyCrewsView=L.CrewListView.extend({el:"#crewsList",events:{"click #noCrew.emptySocial .btn":"goToFindCrew"},render:function(){if(!s.TabIsActive(e("#friendsPanel .sideMenu #myCrewsLink")))return this;var t=this.collection.toJSON(),n=a.renderCompiledTemplate(p,t);return this.$el.html(n),0==this.collection.length?(n=a.renderCompiledTemplate(S),this.$el.html(n),e("#crewCardTag").html("")):A=new L.CrewListView({el:this.el,collection:this.collection}),e(".loadingMask").hide(),this.$("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),this.$el.fadeIn(),e("#friendsContainer").data("antiscroll").refresh(),this},goToFindCrew:function(){e("#findCrewLink").click()},onFatalError:function(t){t.title="ALERT",c.ShowErrorModal(t),e(".loadingMask").hide()},onClose:function(){if(this.stopListening(),void 0!=A&&A.CrewViews.length>0)for(var e=0;e<A.CrewViews.length;e++)A.CrewViews[e].onClose()},initialize:function(){n.bindAll(this,"render","onClose"),void 0!=A&&A.onClose(),s.setUpLoadingPanel("#friendsPanel"),this.collection=new i.CrewCollection({},{cacheKey:"get_crews_"+globals.account.RockstarId,cacheObject:f.crews}),this.listenTo(this.collection,"sync",this.render);var e=this,t=s.GetAuthHeaderAsync();t.done(function(t){e.collection.fetch({headers:t,requestDescription:"MyCrews",fatalError:e.onFatalError})})}}),L.CrewView=t.View.extend({events:{"click .leaveTrigger":"leaveCrew","click .makeActive":"makeActive","click .join":"joinCrew","click .requestInvite":"requestInvite"},render:function(){var e,t=s.getError("MaxNoCrewsExceeded");this.model.set({MaxCrewsMsg:t});var n=this.model.toJSON();return e=this.model.get("IsPrimary")?a.renderCompiledTemplate(g,n):a.renderCompiledTemplate(m,n),this.$el.html(e),this},showConfirmationDialog:function(e,t,n){window.amd.modals.ConfirmModalView=new c.ConfirmModalView({Message:e,Name:this.model.get("CrewName"),pubsubKey:t,FocusBtn:"cancel",cancelPubsubKey:n})},leaveCrew:function(t){t.preventDefault();var n=e(t.currentTarget);if(!n.hasClass("disabled")){this.disableButtons(),a.WriteDebugLog("CrewView.leaveCrew","CrewId",this.model.get("CrewId"));var i=this.model.get("IsPrimary")?s.getText("LeavePrimaryCrewName","Social"):s.getText("LeaveCrewName","Social");this.showConfirmationDialog(i,"crew.leave."+this.model.get("CrewId"),"crew.enableButtons."+this.model.get("CrewId"))}},leaveCrewConfirm:function(){s.setUpLoadingPanel("#friendsPanel"),this.updateCrewModel.leave(this.model.get("CrewId"),this.leaveCrewSuccess,this.errorFn)},leaveCrewSuccess:function(t){if(t&&(a.WriteDebugLog("CrewView.leaveCrewSuccess","Status",t.get("Status")),P(),1==t.get("Status"))){if(e("#myCrewsLink").hasClass("on")){var n=e("#myCrewsLink");n.removeClass("on"),n.click()}h.updateCrewCount("subtract"),u.trackEvent(u.category.crew,u.action.crew_leave)}},makeActive:function(t){t.preventDefault();var n=e(t.currentTarget);if(!n.hasClass("disabled")){this.disableButtons(),a.WriteDebugLog("CrewView.makeActive","CrewId",this.model.get("CrewId"));var i=s.getText("MakeActiveCrewName","Social");this.showConfirmationDialog(i,"crew.makeactive."+this.model.get("CrewId"),"crew.enableButtons."+this.model.get("CrewId"))}},makeActiveConfirm:function(){s.setUpLoadingPanel("#friendsPanel"),this.updateCrewModel.makeActive(this.model.get("CrewId"),this.makeActiveSuccess,this.errorFn)},makeActiveSuccess:function(t){if(t&&(a.WriteDebugLog("CrewView.makeActiveSuccess","Status",t.get("Status")),P(),1==t.get("Status"))){if(e("#myCrewsLink").hasClass("on")){var n=e("#myCrewsLink");n.removeClass("on"),n.click()}u.trackEvent(u.category.crew,u.action.crew_make_active)}},joinCrew:function(t){t.preventDefault(),a.WriteDebugLog("CrewView.joinCrew","CrewId",this.model.get("CrewId"));var n=e(t.currentTarget);n.hasClass("disabled")||(this.disableButtons(),this.updateCrewModel.joinCrew(this.model.get("CrewId"),this.joinCrewSuccess,this.errorFn))},joinCrewSuccess:function(t){t&&(a.WriteDebugLog("CrewView.joinCrewSuccess","Status",t.get("Status")),P(),1==t.get("Status")&&(h.updateCrewCount("add"),u.trackEvent(u.category.crew,u.action.crew_join),e("#myCrewsLink").click()))},requestInvite:function(t){t.preventDefault();var n=e(t.currentTarget);n.hasClass("disabled")||(this.disableButtons(),a.WriteDebugLog("CrewView.requestInvite","CrewId",this.model.get("CrewId")),this.updateCrewModel.requestInvite(this.model.get("CrewId"),this.requestInviteSuccess,this.errorFn))},requestInviteSuccess:function(e){if(e&&(a.WriteDebugLog("CrewView.requestInviteSuccess","Status",e.get("Status")),1==e.get("Status"))){this.$(".crewCard .actions .requestInvite").remove();var t=s.getText("CrewRequestPending","Social");this.$(".crewCard .actions.clearfix").append('<span class="requestPending">'+t+"</span>");var n=s.getText("RequestSentToCrew","Social");n=n.replace("[CrewName]",this.model.get("CrewName")),u.trackEvent(u.category.crew,u.action.crew_request_invite),r.pubsub.publish("notificationFn.infoMessage",n)}},disableButtons:function(){this.$(".actions a").addClass("disabled")},enableButtons:function(){this.$(".actions a").removeClass("disabled")},errorFn:function(e){this.enableButtons(),e.title="ALERT",c.ShowErrorModal(e)},onClose:function(){a.pubsub.off("crew.leave."+this.model.get("CrewId")),a.pubsub.off("crew.makeactive."+this.model.get("CrewId")),a.pubsub.off("crew.enableButtons."+this.model.get("CrewId"))},initialize:function(){n.bindAll(this,"render","onClose","joinCrewSuccess","requestInviteSuccess","makeActiveSuccess","leaveCrewConfirm","makeActiveConfirm","showConfirmationDialog","disableButtons","enableButtons","errorFn"),a.pubsub.on("crew.leave."+this.model.get("CrewId"),this.leaveCrewConfirm),a.pubsub.on("crew.makeactive."+this.model.get("CrewId"),this.makeActiveConfirm),a.pubsub.on("crew.enableButtons."+this.model.get("CrewId"),this.enableButtons),this.updateCrewModel=new i.UpdateCrewModel}}),L.CrewMembersView=t.View.extend({el:"#crewMembersList",events:{"click #crewMemberSearchLink":"search","keydown #crewMemberSearchText":"search","click .profileButton .avatarImg":"goToMemberProfile","click .profileButton .profilenickname":"goToMemberProfile","click #noCrew.emptySocial .btn":"goToFindCrew"},render:function(){if(!s.TabIsActive(e("#friendsPanel .sideMenu #crewMembersLink")))return this;this.$el.empty();var n,i=this.collection.at(0);if(0==this.collection.length||0==i.get("CrewMemberCount")||!i.get("Status"))return this.renderEmpty(i),this;var r={CrewName:i.get("CrewName"),CrewTag:i.get("CrewTag"),IsPrivate:i.get("IsPrivate"),IsFounderCrew:i.get("IsFounderCrew"),IsMember:!1,CrewColour:i.get("CrewColour"),MemberCount:i.get("CrewMemberCount")},o=new t.Collection(i.get("CrewMembers")),l=o.findWhere({Rank:"Leader"});return void 0!=l&&(r.LeaderAvatar=l.get("AvatarUrl"),r.LeaderRockstarId=l.get("RockstarId"),r.LeaderNickname=l.get("Nickname"),r.LeaderDateJoined=l.get("DateJoinedLocalized")),n=a.renderCompiledTemplate(v,r),this.$el.html(n),s.setupTextInputGameNotifications(this.$("input:text, input:password, textarea")),this.renderMembers(o),e(".loadingMask").hide(),this.$("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),this.$el.fadeIn(),e("#friendsContainer").data("antiscroll").refresh(),this},renderEmpty:function(t){var n=this.getError(t.toJSON()),i=a.renderCompiledTemplate(y,n);this.$el.html(i),e(".loadingMask").hide(),this.$("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),this.$el.fadeIn()},renderMembers:function(e){var t=this;this.MemberViews=[],e.each(function(e){t.$(".list").append('<div class="profileWrapper '+e.get("Nickname")+'"></div>'),e.set({DisplayName:e.get("Nickname"),activePanel:"friendsPanel",Relationship:l.GetRelationShipCode(e.get("Relationship")),cardType:"crewMember"},{silent:!0});var n=new d.ProfileFriendView({model:e,el:"div."+e.get("Nickname")});t.MemberViews.push(n),t.$(".list").append(n.render().el)})},goToMemberProfile:function(t){t.preventDefault();var n=e(t.currentTarget),i=n.attr("data-id");void 0!=i&&l.friendProfileView(i)},getError:function(e){var t,n=e&&e.Error?e.Error.CodeEx:"";switch(n){case"NotACrewMember":t=s.getText("NotACrewMember","Social");break;case"NoMatchingMembers":t=s.getError("NoMatchCrewMembers");break;default:t=s.getError("CrewGeneralServiceError")}return a.WriteDebugLog("CrewMembersView","getError",n+" "+t),{errorCode:n,errorMsg:t}},renderSearchResults:function(){e(".profileButton.crewMember").parent().remove();var n,i=this.searchModel.toJSON();if(void 0!=i&&i.Status)if(i.CrewMembers&&i.CrewMembers.length){var r=this;this.MemberView=[];var o=new t.Collection(i.CrewMembers);o.each(function(e){r.$(".list").append('<div class="profileWrapper '+e.get("Nickname")+'"></div>'),e.set({DateJoinedLocalized:a.localizedDate(e.get("DateJoined"),"LL"),DisplayName:e.get("Nickname"),activePanel:"friendsPanel",Relationship:l.GetRelationShipCode(e.get("Relationship")),cardType:"crewMember"},{silent:!0});var t=new d.ProfileFriendView({model:e,el:"div."+e.get("Nickname")});r.MemberViews.push(t),r.$el.append(t.render().el)})}else{var c=s.getError("NoMatchCrewMembers");n=a.renderCompiledTemplate(y,{errorMsg:c}),this.$el.append(n)}else{var u=this.getError(i);n=a.renderCompiledTemplate(y,u),this.$el.append(n)}return e(".loadingMask").hide(),this.$("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),this.$el.fadeIn(),this},search:function(t){var n=t.currentTarget;if("crewMemberSearchText"!=e(n).attr("id")||13==t.which){t.preventDefault(),e(".errorText").remove();var i=this.$("#crewMemberSearchText").val();if(i.length>0&&i.length<3){var a=s.getError("SearchMin3Chars");return void this.$("#crewMemberSearchForm").append('<span class="errorText">'+a+"</span>")}if(s.setUpLoadingPanel("#friendsPanel"),""==i){var r=e("#crewMembersLink");return r.removeClass("on"),void r.click()}var o=this.collection.at(0).get("CrewId"),l=this.collection.at(0).get("IsPrivate"),u='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"searchNickname":"'+i+'","pageIndex":"0","crewId":"'+o+'","isPrivate":"'+l+'" }',d=this,f=s.GetAuthHeaderAsync();f.done(function(e){d.searchModel.fetch({type:"POST",headers:e,contentType:"application/json; charset=utf-8",data:u,success:d.searchSuccess,requestDescription:"SearchCrewMembers",fatalError:c.ShowErrorModal})})}},searchSuccess:function(){this.renderSearchResults(),u.trackEvent(u.category.crew,u.action.crew_members_search)},goToFindCrew:function(){e("#findCrewLink").click()},onFatalError:function(t){t.title="ALERT",c.ShowErrorModal(t),e(".loadingMask").hide()
},onClose:function(){this.stopListening(),n.each(this.MemberViews,function(e){e.close()})},initialize:function(){n.bindAll(this,"render","renderEmpty","searchSuccess","onClose"),s.setUpLoadingPanel("#friendsPanel"),this.searchModel=new i.CrewMemberSearch;var e=this;e.collection=new i.CrewMemberCollection([],{game:globals.titleName,cacheKey:"active_crew_members_"+globals.titleName,cacheObject:f.crews}),e.listenTo(e.collection,"sync",e.render);var t=s.getCredsAsync();t.done(function(t){if("undefined"!=typeof t&&t.Ticket){var n=s.GetAuthHeaderAsync(t.Ticket);n.done(function(n){e.collection.fetch({data:{PlayerTicket:t.Ticket},type:"POST",headers:n,requestDescription:"CrewMembers",fatalError:e.onFatalError})})}})}}),L.CrewInvitesHeaderView=t.View.extend({el:"#crewInvitesHeader",events:{"click #crewInvitesSwitch .invites":"showInvites","click #crewInvitesSwitch .requests":"showRequests"},render:function(){if(!s.TabIsActive(e("#friendsPanel .sideMenu #crewInvitesLink")))return this;if(this.$el.empty(),0==this.collection.length)return this.showInvites(),this;var t=a.renderCompiledTemplate(T);return this.$el.append(t),this.$("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),this.$el.fadeIn(),"requests"===this.model.get("tab")?this.showRequests():this.showInvites(),this},showInvites:function(){e("#crewRequestsList").empty().hide(),this.$("#crewInvitesSwitch .invites").hasClass("active")||(this.$("#crewInvitesSwitch .invites").addClass("active"),this.$("#crewInvitesSwitch .requests").removeClass("active"),this.$("#manageCrews").hide(),void 0==window.amd.crews.CrewInvitesView?window.amd.crews.CrewInvitesView=new L.CrewInvitesView:(window.amd.crews.CrewInvitesView.onClose(),window.amd.crews.CrewInvitesView.initialize()))},showRequests:function(){e("#crewInvitesList").empty().hide(),this.$("#crewInvitesSwitch .requests").hasClass("active")||(this.$("#crewInvitesSwitch .requests").addClass("active"),this.$("#crewInvitesSwitch .invites").removeClass("active"),this.$("#manageCrews").show(),void 0==window.amd.crews.CrewRequestsView?window.amd.crews.CrewRequestsView=new L.CrewRequestsView({CrewsIManageCollection:this.collection}):(window.amd.crews.CrewRequestsView.onClose(),window.amd.crews.CrewRequestsView.initialize({CrewsIManageCollection:this.collection})))},onFatalError:function(t){t.title="ALERT",c.ShowErrorModal(t),e(".loadingMask").hide()},onClose:function(){this.stopListening()},initialize:function(e){n.bindAll(this,"render","onClose","showInvites","showRequests"),this.model=new Backbone.Model,this.model.set({tab:e.tab}),s.setUpLoadingPanel("#friendsPanel"),this.collection=new i.CrewsWithManagePermissionCollection,this.listenTo(this.collection,"sync",this.render);var t=this,a=s.GetAuthHeaderAsync();a.done(function(e){t.collection.fetch({headers:e,requestDescription:"GetCrewsWithManagePermission",fatalError:t.onFatalError})})}}),L.CrewInvitesView=t.View.extend({el:"#crewInvitesList",events:{crewInvitesScroll:"getNextPage","click #noCrewInvites.emptySocial .btn":"goToFindCrew"},render:function(){if("undefined"!=typeof this.invitesCollection){var t=this.invitesCollection.length;e("#crewInvitesLink span.count").html(0==t?"":t)}if(!s.TabIsActive(e("#friendsPanel .sideMenu #crewInvitesLink")))return this;0==this.model.get("PageIndex")&&this.$el.empty();var n;if(void 0==this.invitesCollection||0==this.invitesCollection.length)n=a.renderCompiledTemplate(C),this.$el.append(n);else{var i=this;this.InviteViews=[],this.invitesCollection.each(function(e){var t=new L.InviteView({model:e});i.InviteViews.push(t),i.$el.append(t.render().el),i.$(".crewCard img").on("error",a.crewImage404)})}return s.removeLoading("friendsPanel"),this.$("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),this.$el.fadeIn(),e("#friendsContainer").data("antiscroll").refresh(),this},goToFindCrew:function(){e("#findCrewLink").click()},getNextPage:function(){var e=this.model.get("PageIndex")+1,t=this.crewInviteCollection.at(0).get("PageCount");t>e&&this.model.set({PageIndex:e})},fetchInvites:function(){var e=this,t=e.model.get("PageIndex"),n=s.GetAuthHeaderAsync();n.done(function(n){e.crewInviteCollection.fetch({remove:!1,type:"POST",contentType:"application/json; charset=utf-8",headers:n,data:'{ "pageIndex": '+t+" }",requestDescription:"GetCrewInvites",fatalError:c.ShowErrorModal,success:function(){var n=e.crewInviteCollection.getInvites(t);e.invitesCollection.reset(n),e.render()}})})},onClose:function(){if(this.stopListening(),void 0!=this.InviteViews&&this.InviteViews.length>0)for(var e=0;e<this.InviteViews.length;e++)this.InviteViews[e].onClose()},initialize:function(){n.bindAll(this,"render","onClose","getNextPage","fetchInvites"),s.setUpLoadingPanel("#friendsPanel"),this.crewInviteCollection=new i.CrewInviteCollection,this.invitesCollection=new i.Invites,this.model=new Backbone.Model;var e=this;this.model.on("change",function(){e.model.hasChanged("PageIndex")&&e.fetchInvites()}),this.model.set({PageIndex:0})}}),L.InviteView=t.View.extend({events:{"click .optionAcceptCrew":"acceptInvite","click .optionDeclineCrew":"declineInvite"},render:function(){var e,t=s.getError("MaxNoCrewsExceeded"),n=a.getAvatarUrl(this.model.get("AvatarUrl"),this.model.get("Nickname"));return this.model.set({AvatarUrl:n,MaxCrewsMsg:t,IsMember:!1}),e=a.renderCompiledTemplate(b,this.model.toJSON()),this.$el.html(e),this},acceptInvite:function(t){t.preventDefault();var n=e(t.currentTarget);n.hasClass("disabled")||(this.disableButtons(),a.WriteDebugLog("InviteView.acceptInvite","CrewName",this.model.get("CrewName")),this.updateCrewModel.acceptInvite(this.model.get("CrewId"),this.model.get("InviteId"),this.acceptInviteSuccess,this.errorFn))},acceptInviteSuccess:function(t){if(t){if(a.WriteDebugLog("InviteView.acceptInviteSuccess","Status",t.get("Status")),1!=t.get("Status"))return;this.$(".options").hide(),u.trackEvent(u.category.crew,u.action.crew_invite_accept),s.UpdateSocialSideMenuCount("subtract","#crewInvitesLink",!1),h.updateCrewCount("add"),P(),e("#myCrewsLink").click()}},declineInvite:function(t){t.preventDefault();var n=e(t.currentTarget);if(!n.hasClass("disabled")){this.disableButtons(),a.WriteDebugLog("InviteView.declineInvite","CrewName",this.model.get("CrewName"));var i=s.getText("DeclineInviteCrewName","Social");this.showConfirmationDialog(i,"crew.declineInvite."+this.model.get("InviteId"),"crew.enableButtons."+this.model.get("InviteId"))}},declineInviteConfirm:function(){this.updateCrewModel.declineInvite(this.model.get("CrewId"),this.model.get("InviteId"),this.declineInviteSuccess,this.errorFn)},declineInviteSuccess:function(e){if(e){if(a.WriteDebugLog("InviteView.declineInviteSuccess","Status",e.get("Status")),1!=e.get("Status"))return;this.$(".options").hide(),s.UpdateSocialSideMenuCount("subtract","#crewInvitesLink",!1),u.trackEvent(u.category.crew,u.action.crew_invite_decline);var t=s.getText("DeclineCrewInvite","Social");t=t.replace("[CrewName]",this.model.get("CrewName")),r.pubsub.publish("notificationFn.infoMessage",t)}},showConfirmationDialog:function(e,t,n,i){window.amd.modals.ConfirmModalView=new c.ConfirmModalView({Message:e,Name:this.model.get("CrewName"),pubsubKey:t,FocusBtn:"cancel",cancelPubsubKey:n,cancelPubsubParams:i})},disableButtons:function(){this.$el.find(".options a").addClass("disabled")},enableButtons:function(){this.$el.find(".options a").removeClass("disabled")},errorFn:function(e,t){this.enableButtons(),c.ShowErrorModal({errorCode:e,message:t})},onClose:function(){this.stopListening(),a.pubsub.off("crew.declineInvite."+this.model.get("InviteId")),a.pubsub.off("crew.enableButtons."+this.model.get("InviteId"))},initialize:function(){n.bindAll(this,"render","onClose","declineInviteConfirm","declineInviteSuccess","showConfirmationDialog","acceptInviteSuccess","disableButtons","enableButtons","errorFn"),this.updateCrewModel=new i.UpdateCrewModel,a.pubsub.on("crew.declineInvite."+this.model.get("InviteId"),this.declineInviteConfirm),a.pubsub.on("crew.enableButtons."+this.model.get("InviteId"),this.enableButtons)}}),L.CrewRequestsView=t.View.extend({el:"#crewRequestsList",events:{crewRequestsScroll:"getNextPage","click .crewsIManage li a":"selectCrew"},render:function(){if(!s.TabIsActive(e("#friendsPanel .sideMenu #crewInvitesLink")))return this;this.$el.empty();var t=this.model.get("CrewsIManage").length;return t>0&&this.showCrews(),this},showCrews:function(){if(!e(".crewsIManage").length){var t,n=this.model.get("CrewsIManage").toJSON();t=a.renderCompiledTemplate(R,{CrewsIManage:n,ShowTitle:this.model.get("CrewsIManage").length>1}),this.$el.append(t),this.$("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),this.$(".crewsIManage noRemove").fadeIn(),e("#friendsContainer").data("antiscroll").refresh(),s.removeLoading("friendsPanel"),this.$(".crewsIManage img").on("error",a.crewImage404)}},showRequests:function(){var t;if(0==this.requestsCollection.length)t=a.renderCompiledTemplate(I),this.$el.append(t);else{var n=this;this.RequestViews=[],this.requestsCollection.each(function(e){var t=new L.RequestView({model:e});n.RequestViews.push(t),n.$el.append(t.render().el)})}this.$("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),this.$el.fadeIn(),e("#friendsContainer").data("antiscroll").refresh(),this.setSelectedCrew(),s.removeLoading("friendsPanel")},selectCrew:function(t){t.preventDefault();var n=e(t.currentTarget);if(!n.hasClass("active")){var i=n.attr("data-crewId");this.model.set({CrewId:i,PageIndex:0})}},setSelectedCrew:function(){e(".crewsIManage a").removeClass("active");var t=e(".crewsIManage a[data-crewId='"+this.model.get("CrewId")+"']");t.addClass("active")},fetchRequests:function(e){void 0==e&&(e=!0);var t=this,n=this.model.get("CrewId"),i=this.model.get("PageIndex"),a=s.GetAuthHeaderAsync();a.done(function(a){t.crewRequestCollection.fetch({remove:e,type:"POST",contentType:"application/json; charset=utf-8",headers:a,data:'{ "pageIndex": '+i+', "crewId": '+n+" }",requestDescription:"GetPendingRequests",fatalError:c.ShowErrorModal,success:function(){var e=t.crewRequestCollection.getRequests(i);t.requestsCollection.reset(e),t.showRequests()}})})},getNextPage:function(){var e=this.model.get("PageIndex")+1,t=this.crewRequestCollection.at(0).get("PageCount");t>e&&(this.model.set({PageIndex:e}),this.fetchRequests(!1))},onClose:function(){this.stopListening()},initialize:function(e){n.bindAll(this,"render","onClose","getNextPage","fetchRequests","showRequests"),s.setUpLoadingPanel("#friendsPanel");var t=e.CrewsIManageCollection.at(0).get("CrewId");this.crewRequestCollection=new i.CrewRequestCollection,this.requestsCollection=new i.Requests,this.model=new Backbone.Model;var a=this;this.model.on("change",function(){a.model.hasChanged("CrewId")&&(a.$("*").not(".noRemove").remove(),a.fetchRequests())}),this.model.set({CrewsIManage:e.CrewsIManageCollection,CrewId:t,PageIndex:0}),this.render()}}),L.RequestView=t.View.extend({events:{"click .optionInvite":"sendInvite","click .optionDelete":"deleteRequest"},render:function(){var e,t=a.getAvatarUrl(this.model.get("AvatarUrl"),this.model.get("Nickname"));return this.model.set({AvatarUrl:t,IsMember:!1}),e=a.renderCompiledTemplate(k,this.model.toJSON()).trim(),this.$el.html(e),this},sendInvite:function(t){t.preventDefault(),a.WriteDebugLog("RequestView.sendInvite","Nickname",this.model.get("Nickname"));var n=e(t.currentTarget);n.hasClass("disabled")||(this.disableButtons(),this.updateCrewModel.sendInvite(this.model.get("RockstarId"),this.model.get("CrewId"),this.sendInviteSuccess,this.errorFn))},sendInviteSuccess:function(e){if(e){if(a.WriteDebugLog("RequestView.sendInviteSuccess","Status",e.get("Status")),1!=e.get("Status"))return;this.$(".options").hide();var t=s.getText("CrewInviteSent","Social");t=t.replace("[Nickname]",this.model.get("Nickname")),u.trackEvent(u.category.crew,u.action.crew_invite_sent),r.pubsub.publish("notificationFn.infoMessage",t)}},deleteRequest:function(t){t.preventDefault(),a.WriteDebugLog("RequestView.deleteRequest","Nickname",this.model.get("Nickname"));var n=e(t.currentTarget);n.hasClass("disabled")||(this.disableButtons(),this.updateCrewModel.deleteRequest(this.model.get("CrewId"),this.model.get("RequestId"),this.deleteRequestSuccess,this.errorFn))},deleteRequestSuccess:function(e){if(e){if(a.WriteDebugLog("RequestView.deleteRequestSuccess","Status",e.get("Status")),1!=e.get("Status"))return;this.$(".options").hide();var t=s.getText("CrewRequestDeleted","Social");t=t.replace("[Nickname]",this.model.get("Nickname")),u.trackEvent(u.category.crew,u.action.crew_delete_request),r.pubsub.publish("notificationFn.infoMessage",t)}},disableButtons:function(){this.$el.find(".options a").addClass("disabled")},enableButtons:function(){this.$el.find(".options a").removeClass("disabled")},errorFn:function(e,t){this.enableButtons(),c.ShowErrorModal({errorCode:e,message:t})},onClose:function(){this.stopListening()},initialize:function(){n.bindAll(this,"render","onClose","sendInviteSuccess","deleteRequestSuccess","disableButtons","enableButtons","errorFn"),this.updateCrewModel=new i.UpdateCrewModel}}),L.FindCrewView=L.CrewListView.extend({el:"#findCrews",events:{"change #selectCrewType":"triggerSearch","keydown #searchCrewnames":"searchInputKeyPress","click #searchButton":"searchButtonClick"},crewTypes:{opencrews:"opencrews",rockstarcrews:"rockstarcrews",chatterboxes:"chatterboxes",thrillseekers:"thrillseekers",rebels:"rebels",soldiers:"soldiers",allstars:"allstars"},render:function(t){if(!s.TabIsActive(e("#friendsPanel .sideMenu #findCrewLink")))return this;this.$el.empty();var n=this.collection.toJSON(),i=a.renderCompiledTemplate(w,n[0]);return this.$el.html(i),s.setupTextInputGameNotifications(this.$("input:text, input:password, textarea")),this.$("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),e("#selectCrewType").dropkick(),"undefined"!=typeof t&&this.setSearchOptions(t),this.$el.fadeIn(),u.trackPage("/FindCrew"),this},setSearchOptions:function(e){if("undefined"!=typeof e.crewType&&""!==e.crewType){var t=this,i=n.find(t.crewTypes,function(t){return t.toLowerCase()==e.crewType.toLowerCase()});"undefined"!=typeof i&&this.$("#selectCrewType").dropkick("setValue",i)}"undefined"!=typeof e.searchString&&""!==e.searchString&&this.$("#searchCrewnames").val(e.searchString.substring(0,20))},searchInputKeyPress:function(e){13==e.which&&this.searchButtonClick(e)},searchButtonClick:function(e){e.preventDefault();var t=this.$("#searchCrewnames");t.length&&(!t.val().length||t.val().length>2)&&(this.triggerSearch(),u.trackEvent(u.category.crew,u.action.crew_search,t.val()))},resetSearchResults:function(){var e=this.$(".foundCrews");e.hide(),s.setUpLoadingPanel("#friendsPanel")},triggerSearch:function(){this.resetSearchResults();var e=this.$("#selectCrewType").find("option:selected"),t=e.data("category"),n=!1;if("friends"==t)n=!0,this.$("#searchCrewsInput").fadeOut();else{this.$("#searchCrewsInput").fadeIn();var i=this.$("#searchCrewnames").val(),a="rockstar"==t?1:-1,r="opencrews"==t||"rockstar"==t?1:-1;("opencrews"==t||""==t&&""==i)&&(a=0)}this.collection.initialize(),t=void 0==t||"rockstar"==t?"":t;var o='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+',"searchTerm":"'+i+'","crewType":"'+t+'","openCrewFilter":'+r+',"systemCrewFilter":'+a+',"pageIndex":0,"friendsCrews":'+n+" }",l=this,u=s.GetAuthHeaderAsync();u.done(function(e){l.collection.fetch({type:"POST",headers:e,contentType:"application/json; charset=utf-8",data:o,success:l.renderSearchResults,requestDescription:"SearchCrews",fatalError:c.ShowErrorModal})})},renderSearchResults:function(){this.clearCrewList();var t=this.$(".foundCrewsInner");if(this.collection.Total>0)t.html(""),this.collection.each(function(e){e.set("Template","search")}),A=new L.CrewListView({el:t,collection:this.collection});else{var n=s.getError("NoMatches"),i=a.renderCompiledTemplate(_,{ErrorMsg:n});t.html(i),t.parent().fadeIn()}this.$("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),e(".loadingMask").hide(),this.$(".foundCrews").fadeIn(),e("#friendsContainer").data("antiscroll").refresh()},clearCrewList:function(){if(void 0!=A&&A.CrewViews.length>0)for(var e=0;e<A.CrewViews.length;e++)A.CrewViews[e].onClose()},onClose:function(){this.stopListening(),this.collection.unbind("reset",this.renderSearchResults),this.collection.unbind("error",this.fetchfail),this.$el.hide(),this.clearCrewList()},initialize:function(e){n.bindAll(this,"render","onClose","triggerSearch","renderSearchResults","searchInputKeyPress","searchButtonClick","resetSearchResults","clearCrewList","setSearchOptions"),void 0!=A&&this.clearCrewList(),s.setUpLoadingPanel("#friendsPanel"),this.collection=new i.SearchCrewsCollection,this.render(e),this.triggerSearch()}});var P=function(){f.crews.clear()};return a.pubsub.on("section:social:loaded",P),a.pubsub.on("signout:completed",P),L}),define("common/store/store-models",["require","jquery","backbone","underscore","utils","common/baseUtils","setup.environment.utils","am","common/am/customDimensions"],function(e){var t=e("jquery"),n=e("backbone"),i=e("underscore"),a=e("utils"),r=e("common/baseUtils"),o=e("setup.environment.utils"),s=e("am"),l=e("common/am/customDimensions"),c={},u=window.globals;return c.Catalog=n.Model.extend({initialize:function(e){(void 0==e||void 0==e.titlelang)&&this.set("titlelang","en-US"),this.isMaintenanceMode()||this.initCommerceSystem()},isMaintenanceMode:function(){var e=this;return(null==this.storeStatusModel||"undefined"==typeof this.storeStatusModel)&&(this.storeStatusModel=new c.StoreStatus,this.storeStatusModel.on("change",function(){e.setMaintenanceMode()})),this.storeStatusModel.fetch({cache:!1,silentFail:!0}),this.setMaintenanceModeSilently(),this.get("isMaintenanceMode")?!0:!1},setMaintenanceModeSilently:function(){this.setMaintenanceMode(!0)},setMaintenanceMode:function(e){e=e||!1;var t=r.isSteam(),n=!t&&"undefined"!=typeof u.isCde&&!u.isCde,i=t&&"undefined"!=typeof u.isCse&&!u.isCse;n||i?this.set({isMaintenanceMode:!0},{silent:e}):this.set({isMaintenanceMode:!1},{silent:e})},initCommerceSystem:function(){a.WriteDebugLog("store-models.initCommerceSystem","init store v2"),this.categories=new c.CategoryCollection,this.products=new c.ProductCollection,this.get("_isLoading")||(o.CallGameMethod("RGSC_INITIALISE_COMMERCE_DATA",null,"RGSC_INITIALISE_COMMERCE_DATA_DEMO"),o.CallGameMethod("RGSC_REQUEST_COMMERCE_DATA",{LanguageCode:a.stripRegion(this.get("titlelang"))},"RGSC_REQUEST_COMMERCE_DATA_DEMO")),this.set({_isLoading:!0,_isDataValid:!1,_isError:!1},{silent:!0})},loadCatalogAsync:function(e){var n=this,i=new t.Deferred;if(n.isSimplifiedCommerce())return i.resolve(),i.promise();n.set({_isDataValid:!1,_isError:!1},{silent:!0});var a=setInterval(function(){var t=n.isCommerceDataValidAsync(e,a);t.done(function(){i.resolve()})},500);return setTimeout(function(){n.cancelPollingCommerce(a),i.reject()},u.ajaxTimeout),i.promise()},isSimplifiedCommerce:function(){return a.isSdkAtLeast("1.1.6.3")},isCommerceDataValidAsync:function(e,n){var i=this,a=new t.Deferred;if(!o.isActivePanel("#storev2Panel"))return i.cancelPollingCommerce(n),a.reject(),a.promise();var r=o.CallGameMethodAsync("RGSC_IS_COMMERCE_DATA_VALID",null,"RGSC_IS_COMMERCE_DATA_VALID_DEMO");return r.done(function(t){"undefined"!=typeof t&&"undefined"!=typeof t.Result&&i.set({_isDataValid:t.Result},{silent:!0}),i.isCommerceDataValidSuccess(e,n)?a.resolve():a.reject()}),r.fail(function(){i.set({_isLoading:!1},{silent:!0}),a.reject()}),a.promise()},isCommerceDataValidSuccess:function(e,t){var n=this;return n.get("_isDataValid")?(n.startCatalogLoad(e,t),!0):(n.checkCommerceErrorStateAsync(t),!1)},checkCommerceErrorStateAsync:function(e){var t=this,n=o.CallGameMethodAsync("RGSC_IS_COMMERCE_IN_ERROR_STATE",null,"RGSC_IS_COMMERCE_IN_ERROR_STATE_DEMO");n.done(function(n){t.commerceErrorSuccess(n,e)}),n.fail(function(){t.commerceErrorFailure()})},commerceErrorSuccess:function(e,t){"undefined"!=typeof e&&"undefined"!=typeof e.Result&&(a.WriteDebugLog("commerceErrorSuccess","isErrorJson",JSON.stringify(e)),this.set({_isError:e.Result},{silent:!0}),this.get("_isError")&&(this.set({_isLoading:!1},{silent:!0}),this.cancelPollingCommerce(t)))},commerceErrorFailure:function(){a.WriteDebugLog("commerceErrorFailure","promise failed","aborting"),this.set({_isLoading:!1},{silent:!0})},startCatalogLoad:function(e,t){a.WriteDebugLog("hasCommerceSystemResponded","_isDataValid; _isLoading; _isError",this.get("_isDataValid")+"; "+this.get("_isLoading")+"; "+this.get("_isError")),this.set({_isLoading:!1},{silent:!0}),this.cancelPollingCommerce(t),this.getCatalog(e)},cancelPollingCommerce:function(e){null!==e&&(clearInterval(e),e=null,(!this.get("_isDataValid")||this.get("_isError"))&&this.getError()&&this.set({_isLoading:!1},{silent:!0}))},getCatalog:function(e){if(a.WriteDebugLog("getCatalog","_isDataValid; _isLoading; _isError",this.get("_isDataValid")+"; "+this.get("_isLoading")+"; "+this.get("_isError")),!this.get("_isLoading")&&!this.get("_isError")&&this.get("_isDataValid")){var t=this;t.set({_isCatalogLoaded:!1},{silent:!0});var n=setInterval(function(){t.pollForCatalog(e,n)},500);setTimeout(function(){t.cancelPollingCommerceCatalog(n)},u.ajaxTimeout)}},pollForCatalog:function(e,t){a.WriteDebugLog("pollForCatalog","_isDataValid; _isLoading; _isError",this.get("_isDataValid")+"; "+this.get("_isLoading")+"; "+this.get("_isError"));var n=this;if(!o.isActivePanel("#storev2Panel"))return void n.cancelPollingCommerceCatalog(t);if(!n.get("_isLoading")&&!n.get("_isError")&&n.get("_isDataValid")){if(n.get("_isCatalogLoaded"))return void n.cancelPollingCommerceCatalog(t);var i=o.CallGameMethodAsync("RGSC_GET_COMMERCE_CATALOG",null,"RGSC_GET_COMMERCE_CATALOG_DEMO");i.done(function(i){n.getCommerceCatalogSuccess(i,e,t)})}},getCommerceCatalogSuccess:function(e,t,n){null!=e&&"undefined"!=typeof e&&("string"==typeof e&&(e=JSON.parse(e)),a.WriteDebugLog("getCommerceCatalogSuccess","catalog",JSON.stringify(e)),"undefined"!=typeof e.Count&&(this.set({_isLoading:!1,_isDataValid:!0,_isCatalogLoaded:!0,_isError:!1},{silent:!0}),this.cancelPollingCommerceCatalog(n),"undefined"!=typeof t&&(e.Category=t.category,e.Product=t.productId),this.getCatalogModel(e)))},cancelPollingCommerceCatalog:function(e){return null!==e&&"undefined"!=typeof e?(a.WriteDebugLog("cancelPollingCommerceCatalog"),clearInterval(e),e=null,this.get("_isCatalogLoaded")?void 0:void this.getError()):void 0},getCatalogModel:function(e){e.StoreAvailable=!0,e.SingleProductView=this.isSingleProductView(e.Product),e=c.Catalog.prototype.parse.call(this,e),c.Catalog.prototype.set.call(this,e,{parse:!0})},isSingleProductView:function(e){return"undefined"!=typeof e&&""!==e},getError:function(){return o.isActivePanel("#storev2Panel")?(this.set({storeAvailable:!1},{silent:!0}),this.trigger("change"),!0):!1},searchProducts:function(e,t){var n;if(n="purchased"===a.toLower(e)?this.filterByPurchased():this.filterByCategory(e),null!==t&&"undefined"!=typeof t&&t.length){var i=a.toLower(t);return n.filter(function(e){var t=a.toLower(e.get("Name").toString()),n=a.toLower(e.get("Desc").toString()),r=a.toLower(e.get("Id").toString()),o=t.indexOf(i)>=0||n.indexOf(i)>=0||r.indexOf(i)>=0;return o})}return n},filterProducts:function(e,t){var n;if(n="purchased"==a.toLower(e)?this.filterByPurchased():this.filterByCategory(e),void 0==n||0==n.length)return n;var i;return""!=t&&(i=this.findProduct(n,t)),void 0!=i&&i.length>0?(i[0].productFound=!0,i):n},filterByCategory:function(e){var t=void 0,n=a.toLower(e);if("top_default"===n){var r=this.get("products");void 0!=r&&(t=r.models)}else t=this.get("products").filter(function(e){var t=i.any(e.get("CategoryMemberships"),function(e){return a.toLower(e)===n});return t});return t},filterByPurchased:function(){var e=this.get("products").filter(function(e){return e.get("Purchased")&&!e.get("Consumable")});return e},findProduct:function(e,n){var i=a.toLower(n),r=t.grep(e,function(e){return a.toLower(e.get("Id"))===i});return r},findCategory:function(e,t){var n=a.toLower(t),r=i.find(e,function(e){var t=a.toLower(e.Id)===n,i=a.toLower(e.Name)===n;return t||i});return r},parse:function(e){return a.WriteDebugLog("Catalog.parse","response.StoreAvailable",e.StoreAvailable),a.WriteDebugLog("Catalog.parse","response.ProductCount",e.ProductCount),{products:new c.ProductCollection(e.Products,{parse:!0}),categories:new c.CategoryCollection(e.Categories,{parse:!0}),productCount:e.ProductCount,categoryCount:e.CategoryCount,storeAvailable:e.StoreAvailable,category:e.Category,product:e.Product,singleProductView:e.SingleProductView}}}),c.Category=n.Model.extend({idAttribute:"Id",parse:function(e){return void 0==e||void 0==e.Name||e.Name.length?e:(e.Name="All",e)}}),c.CategoryCollection=n.Collection.extend({model:c.Category}),c.Product=n.Model.extend({idAttribute:"Id",parse:function(e){var t=e.Consumable,n=e.Purchased,a=e.Installed,r=!1;(t||!n)&&(r=!0);var o=!1;return t||!n||a||(o=!0),e=i.extend(e,{ShowPurchaseButton:r,ShowInstallButton:o}),void 0!=e.ImagePaths&&e.ImagePaths.length>0&&void 0!=e.ImagePaths[0]&&(e=i.extend(e,{ImagePath:e.ImagePaths[0]})),e},setupPurchaseFlowTelemetry:function(){var e=this,t=o.CallGameMethodAsync("RGSC_COMMERCE_GET_PURCHASE_FLOW_TELEMETRY",null,"RGSC_COMMERCE_GET_PURCHASE_FLOW_TELEMETRY_DEMO");t.done(function(t){"object"==typeof t&&("undefined"!=typeof t.l&&l.setCustomDimension(l.dimension.pia1,t.l.toString()),"undefined"!=typeof t.liid&&l.setCustomDimension(l.dimension.pia2,t.liid.toString()),"undefined"!=typeof t.lip&&l.setCustomDimension(l.dimension.pia3,t.lip.toString()),"undefined"!=typeof t.b&&l.setCustomDimension(l.dimension.pia4,t.b.toString()),"undefined"!=typeof t.d&&l.setCustomDimension(l.dimension.pia5,t.d.toString()),"undefined"!=typeof t.sid&&l.setCustomDimension(l.dimension.pia6,t.sid.toString()),s.trackEvent(s.category.store,s.action.store_start_purchase,e.get("Id")))})}}),c.ProductCollection=n.Collection.extend({model:c.Product}),c.UserAccount=n.Model.extend({url:a.getApiUrl("/api/profile/getsignedinuseraccountinfo")}),c.StoreStatus=n.Model.extend({url:a.getApiUrl("/api/profile/storestatus"),initialize:function(){this.on("change",this.updateStoreStatus)},updateStoreStatus:function(){u.isCde=this.get("IsCommerceDefaultEnabled"),u.isCse=this.get("IsCommerceSteamEnabled"),u.cmm=this.get("CommerceMaintenanceMessages")}}),c}),define("common/am/commerce",["require","am","common/am/customDimensions","utils"],function(e){function t(e){var t=window.globals||{isAmEc:!1};return void 0!=e&&(t.isAmEc=e),t.isAmEc}function n(){a.isEnabled()&&a.isSetup()&&(window.ga("require","ec"),t(!0))}function i(e,t){window.ga("ec:setAction",e,t)}var a=e("am"),r=e("common/am/customDimensions"),o=e("utils"),s={};return s.setup=function(){t()&&n()},s.addImpression=function(e,n,i,r,o,s){a.isEnabled()&&t()&&window.ga("ec:addImpression",{id:e,name:n,category:i,brand:r,list:o,position:s})},s.productListRendered=function(){a.trackPage("/Store/Products"),o.WriteDebugLog("Google Analytics","productListRendered","/Store/Products",o.logType.debug,o.logController[globals.titleName])},s.checkout=function(){a.isEnabled()&&t()&&i("checkout",{step:1}),a.trackPage("/Store/Checkout"),o.WriteDebugLog("Google Analytics","checkout","/Store/Checkout",o.logType.debug,o.logController[globals.titleName])},s.confirmPurchase=function(e){a.isEnabled()&&t()&&(i("checkout",{step:2,option:e}),r.setCustomDimension(r.dimension.paymentType,e)),a.trackPage("/Store/ConfirmPurchase"),o.WriteDebugLog("Google Analytics","confirmPurchase","/Store/ConfirmPurchase: "+e,o.logType.debug,o.logController[globals.titleName])},s.proceedToPayment=function(){a.trackPage("/Store/ProceedToPayment"),o.WriteDebugLog("Google Analytics","proceedToPayment","/Store/ProceedToPayment",o.logType.debug,o.logController[globals.titleName])},s.checkoutCompletion=function(e,n,s,l,c,u,d){var f=!1,h={},p={};a.isEnabled()&&t()&&(h={id:e,name:n,category:s,brand:globals.titleName,price:l,quantity:c,currency:u},window.ga("ec:addProduct",h),p={id:e,affiliation:"SCUI Store",revenue:d,currency:u},i("purchase",p),f=!0),a.trackPage("/Store/CheckoutCompletion"),o.WriteDebugLog("Google Analytics","checkoutCompletion","/Store/CheckoutCompletion: "+JSON.stringify(h),o.logType.debug,o.logController[globals.titleName]),o.WriteDebugLog("Google Analytics","checkoutCompletion","purchase: "+JSON.stringify(p),o.logType.debug,o.logController[globals.titleName]),f&&(r.setCustomDimension(r.dimension.previousPurchase,!0),r.setCustomDimension(r.dimension.lastPurchaseDate,(new Date).toISOString()))},s}),define("hbs!common/templates/store/product",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e){var t,i,a="";return a+='\r\n      <span class="purchase_button"><a href="#" class="btn btnPurple btnLarge" data-id="',(i=n.Id)?t=i.call(e,{hash:{}}):(i=e&&e.Id,t=typeof i===u?i.call(e,{hash:{}}):i),a+=d(t)+'" rel="localize[BuyButton]">Buy</a></span>\r\n      '}function o(){return'\r\n      <span class="install_button"></span>\r\n      '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s,l,c="",u="function",d=this.escapeExpression,f=this;return c+='<div class="item clearfix product" data-id="',(l=n.Id)?s=l.call(t,{hash:{}}):(l=t&&t.Id,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'">\r\n  <a class="thumbWrapper" href="#">\r\n    <img class="thumb" src="',(l=n.StoreImageBaseUrl)?s=l.call(t,{hash:{}}):(l=t&&t.StoreImageBaseUrl,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s),(l=n.ImagePath)?s=l.call(t,{hash:{}}):(l=t&&t.ImagePath,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'" alt=""/>\r\n    <img class="info" src="ext/scui/images/info.png" alt="info icon" />\r\n  </a>\r\n  <div class="storeItemText">\r\n		<div class="storeItemTextSummary">\r\n			<h4>',(l=n.Name)?s=l.call(t,{hash:{}}):(l=t&&t.Name,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+"</h4>\r\n			<h5>",(l=n.PriceString)?s=l.call(t,{hash:{}}):(l=t&&t.PriceString,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+"&nbsp;</h5>\r\n      ",s=n["if"].call(t,t&&t.ShowPurchaseButton,{hash:{},inverse:f.noop,fn:f.program(1,r,a)}),(s||0===s)&&(c+=s),c+="\r\n      ",s=n["if"].call(t,t&&t.ShowInstallButton,{hash:{},inverse:f.noop,fn:f.program(3,o,a)}),(s||0===s)&&(c+=s),c+='\r\n      <div class="errors"><span class="errorText"></span></div>\r\n    </div>\r\n	</div>\r\n</div>'});return n}),define("hbs!common/templates/store/no_products",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="item clearfix">\r\n	<h4 rel="localize[NoProducts]">No products match your search criteria.</h4>\r\n</div>'});return n}),define("hbs!common/templates/store/product_not_found",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="item clearfix">\r\n	<h4 rel="localize[ProductNotFound]">Product could not be found.</h4>\r\n</div>'});return n}),define("hbs!common/templates/store/store_under_age",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="errorText" style="margin-top: 20px;">\r\n    <span rel="localize[StoreUnderAge]">Your Social Club account does not meet the age requirements for accessing the Store.</span>\r\n</div>'});return n}),define("hbs!common/templates/store/store_container",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),' <div id="store">\r\n	<div id="storeHeader">\r\n		<div class="clearfix">\r\n			<h3><span rel="localize[StoreTitle]">Store</span></h3>\r\n\r\n		</div>\r\n	</div>\r\n\r\n	<div id="products" class="box-wrap antiscroll-wrap">\r\n        <div class="box">\r\n            <div class="antiscroll-inner"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<div id="storeV2Iframe">\r\n    <iframe></iframe>\r\n</div>\r\n\r\n<div id="storeV2Error"></div>'
});return n}),define("hbs!common/templates/store/store_options",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="options">\r\n    <div id="storeFilter">\r\n        <form>\r\n		      <div id="storeSearch" class="input">\r\n			      <input id="searchInput" name="searchInput" type="text" class="text" placeholder="Search" rel="localize[SearchLabel]" maxLength="50" />\r\n			      <input id="searchSubmit" name="searchSubmit" type="submit" value="Go" rel="localize[GoButton]"/>\r\n		      </div>\r\n		      <div id="storeCategory" class="input">\r\n			      <label for="category" rel="localize[StoreCategory]">Category:</label>\r\n			      <select id="category" name="category">\r\n                      <option value="purchased" rel="localize[Purchased]">Purchased</option>\r\n                  </select>\r\n		      </div>\r\n        </form>\r\n    </div>\r\n    <span id="redeemSerialKey" tabindex="20" class="btn btnPurple btnLarge" rel="localize[RedeemSerialKey]">Use Activation Code</span>\r\n</div>'});return n}),define("hbs!common/templates/store/product_info",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(){return'\r\n        <span class="purchase_button"></span>\r\n      '}function o(){return'\r\n      <span class="install_button"></span>\r\n      '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s,l,c="",u="function",d=this.escapeExpression,f=this;return c+='<div id="product_info">\r\n    <div class="header">\r\n        <h4>',(l=n.Name)?s=l.call(t,{hash:{}}):(l=t&&t.Name,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'</h4>\r\n        <a class="close"></a>\r\n    </div>\r\n    <div class="thumb">\r\n        <img src="',(l=n.StoreImageBaseUrl)?s=l.call(t,{hash:{}}):(l=t&&t.StoreImageBaseUrl,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s),(l=n.ImagePath)?s=l.call(t,{hash:{}}):(l=t&&t.ImagePath,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+'" alt=""/>\r\n    </div>\r\n    <div class="storeItemTextSummary clearfix">\r\n        <h5>',(l=n.PriceString)?s=l.call(t,{hash:{}}):(l=t&&t.PriceString,s=typeof l===u?l.call(t,{hash:{}}):l),c+=d(s)+"</h5>\r\n        ",s=n["if"].call(t,t&&t.ShowPurchaseButton,{hash:{},inverse:f.noop,fn:f.program(1,r,a)}),(s||0===s)&&(c+=s),c+="\r\n      ",s=n["if"].call(t,t&&t.ShowInstallButton,{hash:{},inverse:f.noop,fn:f.program(3,o,a)}),(s||0===s)&&(c+=s),c+='\r\n    </div>\r\n    <div class="box-wrap antiscroll-wrap">\r\n        <div class="box">\r\n            <div class="antiscroll-inner">\r\n                <div class="storeItemTextDescription">\r\n                    <p>',(l=n.Desc)?s=l.call(t,{hash:{}}):(l=t&&t.Desc,s=typeof l===u?l.call(t,{hash:{}}):l),(s||0===s)&&(c+=s),c+="</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    \r\n</div>       \r\n"});return n}),define("hbs!common/templates/store/purchase_button",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var i,a,r="",o="function",s=this.escapeExpression;return r+='<a href="#" class="btn btnPurple btnLarge purchaseBtn" data-id="',(a=n.Id)?i=a.call(t,{hash:{}}):(a=t&&t.Id,i=typeof a===o?a.call(t,{hash:{}}):a),r+=s(i)+'" rel="localize[CheckOutButton]">Check out</a>'});return n}),define("hbs!common/templates/store/install_button",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var i,a,r="",o="function",s=this.escapeExpression;return r+='<a href="#" class="btn btnPurple btnLarge installBtn" rel="localize[InstallButton]" data-id="',(a=n.Id)?i=a.call(t,{hash:{}}):(a=t&&t.Id,i=typeof a===o?a.call(t,{hash:{}}):a),r+=s(i)+'">Install</a>'});return n}),define("hbs!common/templates/store/maintenance",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="maintenance clearfix">\r\n    <h1 class="serverErrorTitle"></h1>\r\n    <div class="errorContainer box-wrap">\r\n	    <div class="box">\r\n	        <div class="text">\r\n	            <h3 class="serverErrorSubTitle"></h3>\r\n	            <p class="errorDescription"></p>\r\n	            <p class="errorSubMessage"></p>\r\n	            <p class="errorCodeDescription"></p>\r\n	        </div>\r\n	    </div>\r\n    </div>\r\n</div>'});return n}),define("common/store/store-views",["jquery","backbone","underscore","common/store/store-models","utils","common/baseUtils","common/datafunctions","setup.environment.utils","common/profile/profile-utils","common/modals/modal-views","am","common/am/commerce","hbs!common/templates/store/product","hbs!common/templates/store/no_products","hbs!common/templates/store/product_not_found","hbs!common/templates/store/store_under_age","hbs!common/templates/store/store_container","hbs!common/templates/store/store_options","hbs!common/templates/store/product_info","hbs!common/templates/store/purchase_button","hbs!common/templates/store/install_button","hbs!common/templates/store/maintenance","dropkick","common/jquery.visible"],function(e,t,n,i,a,r,o,s,l,c,u,d,f,h,p,m,g,v,b,C,S,y){var w={},_=[];"undefined"==typeof window.globals&&(window.globals={});var E,k,T=window.globals,I=6;return w.showCommerce=function(t){if(a.WriteDebugLog("showCommerce","url",t),s.isOnline()&&l.isDobMissing())l.showDOBPrompt();else{s.hideHeaderMenu();var n=e("#storePanel");n.show().find("#storeFrame").unbind("load").load(function(){var t=e(this).attr("src");a.WriteDebugLog("showCommerce","frmSrc.length, loaded url",t.length+","+t),e(this).hasClass("loaded")?(e(this).removeClass("loaded"),s.removeLoading("storePanel"),e("#scuiPanelInstruction").removeAttr("style class").addClass("store2").fadeIn("slow")):t.length>0&&(e(this).addClass("loaded"),setTimeout(function(){s.removeLoading("storePanel")},1e4))});var i=n.position();null==t||void 0==t||!n.hasClass("active")||!n.find("div.loadingMask").is(":visible")||i.top<0?(s.setUpLoadingPanel("#storePanel",function(){e("#storeFrame").removeClass("loaded").attr("src",t)}),e("#scuiPanelInstruction").addClass("store").delay(1e3).fadeIn("slow")):e("#storeFrame").attr("src",t)}},w.showCommerceV2=function(t){if(!T.isLauncher)if(a.WriteDebugLog("showCommerceV2","url",t),s.isSignedIn())if(s.isOnline()&&l.isDobMissing())l.showDOBPrompt();else{var n=e("#storeButton");s.setSelected(n),s.clearActivePanel(function(){s.setUpLoadingPanel("#storev2Panel");var e=n.data("productId"),t=n.data("category");void 0==window.amd.store.StoreView?window.amd.store.StoreView=new w.StoreView({productId:e,category:t}):window.amd.store.StoreView.reInitialize({productId:e,category:t})})}else l.navigatePendingSignIn(w.showCommerceV2)},w.clearAutoSearch=function(){e("#storeButton").removeData()},w.setAutoSearch=function(t,n){e("#storeButton").data(t,n)},w.setAutoSearchProduct=function(e){w.setAutoSearch("productId",e)},w.setAutoSearchCategory=function(e){w.setAutoSearch("category",e)},w.StoreView=t.View.extend({el:"#storev2Panel .contentWrapper #storeCatalog",events:{"click #redeemSerialKey":"redeemVoucher","keypress #redeemSerialKey":"redeemVoucherKeypress","click #searchSubmit":"search","change #category":"search"},render:function(){if(this.renderContainer(),this.renderOptions(),this.model.get("isMaintenanceMode"))this.renderMaintenanceView();else{if(this.model.get("underAge"))return this.renderUnderAgeError(),this;if(!this.model.get("storeAvailable"))return"undefined"==typeof this.model.get("storeAvailable")?(this.reInitialize(),this):(this.renderStoreUnavailable(),this);this.renderCategories(),this.filter()}if(this.$el.parent().find(".loadingMask").hide(),this.$el.show(),s.setupTextInputGameNotifications(this.$("input:text, input:password, textarea")),this.model.get("isMaintenanceMode"))return this;var e=this,t=n.debounce(function(t){e.addProductImpressions(t)},500);return this.$("#products .antiscroll-inner").scroll(t),this},renderContainer:function(){var e=a.renderCompiledTemplate(g);this.$el.html(e)},renderOptions:function(){var e=a.renderCompiledTemplate(v);this.$("#storeHeader").find(".clearfix").append(e),"en-US"!=T.titlelang&&this.$("#storeHeader").find("[rel*=localize]").localize("Store",{language:T.titlelang,pathPrefix:T.baseAssetUrl+"xml/Shared"})},renderUnderAgeError:function(){e("#storeButton").hide(),this.$(".options").remove(),this.$(".antiscroll-scrollbar.antiscroll-scrollbar-vertical").hide();var t=a.renderCompiledTemplate(m);this.$("#products").find(".box .antiscroll-inner").html(t),"en-US"!=T.titlelang&&this.$("#products").find("[rel*=localize]").localize("Store",{language:T.titlelang,pathPrefix:T.baseAssetUrl+"xml/Shared"}),this.$el.parent().find(".loadingMask").hide(),this.$el.show()},renderCategories:function(){var e=this.$("select#category"),t=this.model.get("categories");if(null!=t){var n;this.model.get("categories").each(function(e){n+="<option value='"+a.toLower(e.get("Id"))+"' rel=\"localize["+e.get("Id")+']">'+e.get("Name")+"</option>"}),e.prepend(n),e.find("[rel*=localize]").localize("Store",{language:T.titlelang,pathPrefix:T.baseAssetUrl+"xml/Shared"}),e.dropkick()}},renderStoreUnavailable:function(){var e=a.errorCode("7000"),t=s.getErrorWithCode(e,"");s.showGenericFatalError(e,t.Message,t.SupportText,t.CodeDescription),this.onClose()},renderMaintenanceView:function(){var e=a.renderCompiledTemplate(y);this.$("#products").find(".antiscroll-inner").append(e);var t="";T.cmm&&T.cmm[T.titlelang]&&(t=this.parseMaintenanceSupportText(T.cmm[T.titlelang]));var n=a.errorCode("1002.24"),i=s.getErrorWithCode(n,""),r=s.getError("FeatureDisabled"),o=i.Message;t&&t.length&&(r=" ",o=" ");var l={errorCode:n,message:o,codeDesc:i.CodeDescription,title:s.getError("Maintenance"),subtitle:r,supportText:t};s.initErrorText(this.$el,l)},parseMaintenanceSupportText:function(e){return e?(e=e.replace(/{{a href= *([a-zA-Z0-9\:\/\.\-\_=\?]+)}}(.+?) *{{\/a}}/gi,'<a href="$1" class="RGSCLoadExt">$2</a>'),(e.indexOf("{{")>0||e.indexOf("}}")>0)&&(e=""),e):e},removeProducts:function(){n.each(window.amd.store.ProductViews,function(e){e.close()}),void 0!=window.amd.store.EmptyProductView&&window.amd.store.EmptyProductView.close(),window.amd.store.ProductViews=[],window.amd.store.EmptyProductView=void 0},renderProducts:function(n){if(this.removeProducts(),n.length<I&&(I=n.length),0===n.length){var i=new t.Model({singleProductView:this.model.get("singleProductView")}),a=new w.ProductView({model:i,id:"no_products"});return a.renderEmpty(),window.amd.store.EmptyProductView=a,void this.$("#products").find(".antiscroll-inner").append(a.$el)}this.model.get("productCount")>I&&e("#storeFilter").show();var r=this;n.each(function(e){var t=new w.ProductView({model:e,id:"product_"+e.id});window.amd.store.ProductViews.push(t),t.render(),r.$("#products").find(".antiscroll-inner").append(t.$el)}),this.$("#products.antiscroll-wrap").antiscroll(),"en-US"!=T.titlelang&&this.$("#products").find("[rel*=localize]").localize("Store",{language:T.titlelang,pathPrefix:T.baseAssetUrl+"xml/Shared"}),this.addProductImpressions(),d.productListRendered()},addProductImpressions:function(e){var t=this,n=t.$("#products .antiscroll-inner"),i=n.find("div.product"),a=t.$("#searchInput").val().length>0,r=!1,o=this.model.get("products");o.each(function(e){var o=e.get("Id"),s=n.find("div[data-id='"+o+"']"),l=_.indexOf(o),c=l>=0;if(!s.length||!s.find(".purchase_button a").visible(!1,!0,"vertical",t.$("#products .antiscroll-inner")))return void(c&&_.splice(l,1));if(!c){var u=i.index(s)+1,f=a?"search":t.model.get("category");d.addImpression(o,e.get("Name"),e.get("CategoryMemberships").toString(),T.titleName,f,u),_.push(o),r=!0}}),r&&"undefined"!=typeof e&&u.trackEvent(u.category.store,u.action.store_product_scroll)},redeemVoucher:function(e){e&&e.preventDefault();var t="COMMERCE",n="REDEMPTIONCODE",i={State:t,SubState:n,Visible:!0,Online:s.isOnline(),Data:{Message:41,Referrer:"store"}};a.pubsub.trigger("gamefunctions:showActivation",i,t,n)},redeemVoucherKeypress:function(e){13==e.which&&this.redeemVoucher()},search:function(e){e.preventDefault();var t=this.$("#searchInput").val(),n=this.$("#category").val();this.model.set({category:n,product:t},{silent:!0});var i=this.model.searchProducts(n,t);this.searchResultsModel.reset(i),this.renderProducts(this.searchResultsModel)},filter:function(){var e=this.model.get("category"),t=this.$("select#category"),n="top_default";if(null!==e&&void 0!==e&&""!==e){var i=this.model.get("categories").toJSON(),r=this.model.findCategory(i,e);r&&(n=a.toLower(e))}var o=this.model.get("product");this.$("#searchInput").val(o),t.val(n),t.dropkick("setValue",n)},hideStoreIframe:function(){var e=this;a.pubsub.off("headerLoginUser:click:disabled",this.hideStoreIframe),this.$("#storeV2Iframe").fadeOut(function(){s.initHeaderMenu(!0),a.removeLoading("storev2Panel"),e.removeStoreMessageHandler(),e.$("#store").fadeIn(),e.model.get("reloadManifest")?e.model.set({storeAvailable:void 0,reloadManifest:!1}):e.filter()})},processStoreEvents:function(e){var t=T.storeOrigin,i={complete:"complete",backtostore:"backtostore",error:"error",openlink:"openlink",pageview:"pageview",focuschange:"focuschange"};if(e.origin!==t)return void a.WriteDebugLog("processStoreEvents","Unsupported origin",e.origin);var r,o=e.data;try{"string"==typeof e.data&&(o=JSON.parse(e.data))}catch(l){return this.showError(a.errorCode("6003.66")),a.WriteDebugLog("processStoreEvents","event exception",l.toString(),a.logType.error,a.logController[T.titleName]),void this.hideStoreIframe()}if("undefined"==typeof o)return a.WriteDebugLog("processStoreEvents","Undefined event data","",a.logType.error,a.logController[T.titleName]),this.showError(a.errorCode("5000.66")),void this.hideStoreIframe();if(r=o.command,!n.has(i,r))return a.WriteDebugLog("processStoreEvents","Unsupported event command",r,a.logType.error,a.logController[T.titleName]),this.showError(a.errorCode("5003.66")),void this.hideStoreIframe();switch(a.WriteDebugLog("processStoreEvents","data",JSON.stringify(o),a.logType.debug,a.logController[T.titleName]),this.clearErrors(),r){case i.complete:a.WriteDebugLog("processStoreEvents","Complete"),this.durablesNeedManifestReload(this.model),this.hideStoreIframe();break;case i.backtostore:a.WriteDebugLog("processStoreEvents","Back To Store"),this.hideStoreIframe();break;case i.openlink:var c=o.url;"string"==typeof c&&c.length?(a.WriteDebugLog("processStoreEvents","Launch URL from Digital River",c),s.launchExternalBrowserForUrl(c)):(a.WriteDebugLog("processStoreEvents","URL string from Digital River is undefined","",a.logType.error,a.logController[T.titleName]),this.showError(a.errorCode("7000.73")));break;case i.error:a.WriteDebugLog("processStoreEvents","Error returned from Digital River",e.data,a.logType.error,a.logController[T.titleName]),this.showError(a.errorCode("7000.66")),this.hideStoreIframe();break;case i.pageview:switch(o.page){case"checkout":d.checkout();break;case"confirmpurchase":var u=o.type;"undefined"==typeof u?a.WriteDebugLog("processStoreEvents","Payment Type from Digital River is undefined","",a.logType.error,a.logController[T.titleName]):(a.WriteDebugLog("processStoreEvents","Confirm purchase",u),d.confirmPurchase(o.type));break;case"proceedtopayment":d.proceedToPayment();break;case"complete":for(var f=["productid","price","revenue","currency"],h=!1,p=[],m=0,g=f.length;g>m;m++){var v=f[m],b=o[v]&&"undefined"!=typeof o[v];b||(h=!0,p.push(v))}if(h)a.WriteDebugLog("processStoreEvents","Purchase Complete missing data",p.toString(),a.logType.error,a.logController[T.titleName]);else{a.WriteDebugLog("processStoreEvents","Checkout completion");var C=this.model.get("purchaseProductName"),S=this.model.get("purchaseProductId"),y=this.model.get("purchaseProductCategory");d.checkoutCompletion(S,C,y,o.price,1,o.currency,o.revenue),this.durablesNeedManifestReload(this.model)}break;default:a.WriteDebugLog("processStoreEvents","Invalid pageview data",o.page,a.logType.error,a.logController[T.titleName])}break;case i.focuschange:var w=o.hasfocus;if("undefined"==typeof w)a.WriteDebugLog("processStoreEvents","hasfocus state from Digital River is undefined","",a.logType.error,a.logController[T.titleName]);else{var _={hasFocus:w};s.setupTextEntry(_)}break;default:a.WriteDebugLog("processStoreEvents","Invalid command",r,a.logType.error,a.logController[T.titleName])}},durablesNeedManifestReload:function(e){var t=!e.get("consumable");t&&e.set({reloadManifest:!0},{silent:!0})},addStoreMessageHandler:function(){window.addEventListener("message",this.processStoreEvents,!1)},removeStoreMessageHandler:function(){a.WriteDebugLog("removeStoreMessageHandler","","",a.logType.debug,a.logController[T.titleName]),window.removeEventListener("message",this.processStoreEvents,!1)},clearErrors:function(){this.$(".errors .errorText, .errorCode").html("")},showError:function(e){var t=s.getErrorWithCode(e);c.ShowErrorModal({errorCode:e,message:t})},updateGlobalAccount:function(){this.userAccountModel=new i.UserAccount;var e=this,t={env:T.rosEnvironment,title:T.titleName,version:T.RosTitleVersion},n=s.GetAuthHeaderAsync();n.done(function(n){e.userAccountModel.fetch({type:"POST",headers:n,contentType:"application/json; charset=utf-8",data:t,success:this.updateGlobalAccountSuccess,fatalError:c.ShowErrorModal})})},updateGlobalAccountSuccess:function(){var e=this.userAccountModel.get("Error");if(void 0!=e)a.WriteDebugLog("updateGlobalAccount","error",e,a.logType.error,a.logcontroller.profile);else{if(void 0==T.account)return void a.WriteDebugLog("updateGlobalAccount","error","globals.account is undefined",a.logType.error,a.logController.profile);T.account.Age=this.userAccountModel.get("Age"),T.account.Minor=this.userAccountModel.get("Minor"),T.account.Country=this.userAccountModel.get("Country"),T.account.CountryCode=this.userAccountModel.get("Country")}},receiveCheckoutUrl:function(t){clearTimeout(E),a.WriteDebugLog("purchase","data.Url",t.Url),this.showStoreIframe(t,e(this.model.get("purchaseElem")))},showStoreIframe:function(e){var t=this,n=e.Url;this.$("#store").fadeOut(function(){s.initHeaderMenu(!1),a.pubsub.on("headerLoginUser:click:disabled",t.hideStoreIframe);var e=t.$("#storeV2Iframe"),i=e.find("iframe");i.on("load",function(){"undefined"!=typeof k&&(clearTimeout(k),t.addStoreMessageHandler(),e.fadeIn(),a.removeLoading("storev2Panel"),t.resetProductImpressions())}),i.attr("src",n),k=setTimeout(t.iframeError,T.ajaxTimeout)})},iframeError:function(){a.WriteDebugLog("iframeError","7000.91","",a.logType.error,a.logController[T.titleName]),this.showError(a.errorCode("7000.91")),this.hideStoreIframe(),k=void 0},setPurchasedProductDetails:function(e){this.model.set({purchaseProductId:e.Id,purchaseProductName:e.Name,purchaseProductCategory:e.CategoryMemberships.toString(),consumable:e.Consumable},{silent:!0})},onClose:function(){s.CallGameMethod("RGSC_DESTROY_COMMERCE_DATA",null,"RGSC_DESTROY_COMMERCE_DATA_DEMO"),window.amd.store.StoreView=void 0,this.stopListening(),this.resetProductImpressions(),a.pubsub.off("gamefunctions:checkoutUrl",this.receiveCheckoutUrl),a.pubsub.off("store:SetPurchasedProductDetails",this.setPurchasedProductDetails),a.pubsub.off("headerLoginUser:click:disabled",this.hideStoreIframe)},resetProductImpressions:function(){_=[]},reset:function(e){this.$el.html(""),s.setUpLoadingPanel("#storev2Panel");var t=this;if(this.model.isMaintenanceMode())return void this.render();var n=function(){t.model.unset("underAge",{silent:!0});var n=t.model.loadCatalogAsync(e);n.done(function(){t.resetProductImpressions()})},i=function(){t.model.set({underAge:!0})},r=function(){t.showError(a.errorCode("7000.65")),a.pubsub.trigger("setupEnv:showHomepage")};this.checkAge(n,i,r)},checkAge:function(e,t,n){var i={ofAgeCallbkFn:e,underAgeCallbkFn:t,errorCallbkFn:n};a.pubsub.trigger("setupEnvUtils:checkStoreAgeAppropriate",i)},reInitialize:function(e){s.CallGameMethod("RGSC_DESTROY_COMMERCE_DATA",null,"RGSC_DESTROY_COMMERCE_DATA_DEMO"),this.model.initCommerceSystem(),this.reset(e)},initialize:function(e){n.bindAll(this,"render","reInitialize","renderProducts","renderCategories","onClose","search","filter","renderUnderAgeError","checkAge","updateGlobalAccount","updateGlobalAccountSuccess","renderContainer","renderOptions","reset","processStoreEvents","receiveCheckoutUrl","addProductImpressions","setPurchasedProductDetails","showStoreIframe","iframeError","hideStoreIframe","renderMaintenanceView","renderStoreUnavailable"),this.model=new i.Catalog({titlelang:T.titlelang}),this.listenTo(this.model,"change",this.render),this.searchResultsModel=new i.ProductCollection,a.pubsub.on("gamefunctions:checkoutUrl",this.receiveCheckoutUrl),a.pubsub.on("store:SetPurchasedProductDetails",this.setPurchasedProductDetails),this.reset(e)}}),w.ProductView=t.View.extend({events:{"click .product":"showInfo"},render:function(){var e=T.storeImageBaseUrl;e=e.replace("{0}",T.titleName).replace("{1}",T.platform);var t=this.model.get("ImagePath");void 0!=e&&void 0!=t&&e.length&&t.length?e.lastIndexOf("/")!==e.length-1&&0!==t.indexOf("/")&&(e+="/"):(e="",this.model.set({ImagePath:T.baseUrl+"images/store/fallback.jpg"},{silent:!0})),this.model.set({StoreImageBaseUrl:e}),a.WriteDebugLog("ProductView.render","storeImageBaseUrl + imagePath",e+this.model.get("ImagePath"));var n=this.model.toJSON(),i=a.renderCompiledTemplate(f,n);if(this.$el.html(i),this.model.get("ShowInstallButton")){var r=new w.InstallButtonView({model:this.model,el:this.$el.find(".install_button")});r.render()}return this.$("img").on("error",this.image404),this},showInfo:function(e){e&&e.preventDefault();var t=new w.ProductInfoView({model:this.model});window.amd.store.ProductInfoView=t,u.trackPage("/Store/ProductInfo"),t.render()},image404:function(){var t=T.baseUrl+"images/store/fallback.jpg";t!=this.src&&(this.src=t),e(this).off("error")},renderEmpty:function(){var t;return t=a.renderCompiledTemplate(this.model.get("singleProductView")?p:h),this.$el.html(t),"en-US"!=T.titlelang&&this.$el.find("[rel*=localize]").localize("Store",{language:T.titlelang,pathPrefix:T.baseAssetUrl+"xml/Shared"}),e("#storeFilter").show(),this},onClose:function(){},initialize:function(){n.bindAll(this,"render","onClose","renderEmpty")}}),w.ProductInfoView=t.View.extend({events:{"click .purchase":"purchase","click .close":"onClose"},el:"#product_info_wrapper",render:function(){var e=this.model.toJSON(),t=a.renderCompiledTemplate(b,e);if(this.$el.append(t),this.model.get("ShowPurchaseButton")){var n=new w.PurchaseButtonView({model:this.model,el:this.$el.find(".purchase_button")});n.render()}if(this.model.get("ShowInstallButton")){var i=new w.InstallButtonView({model:this.model,el:this.$el.find(".install_button")});i.render()}"en-US"!=T.titlelang&&this.$el.find("[rel*=localize]").localize("Store",{language:T.titlelang,pathPrefix:T.baseAssetUrl+"xml/Shared"}),this.$("img").on("error",this.image404),this.$el.fadeIn(),this.$(".antiscroll-wrap").antiscroll()},image404:function(){var t=T.baseUrl+"images/store/fallback.jpg";t!=this.src&&(this.src=t),e(this).off("error")},onClose:function(){this.$el.fadeOut(),this.$el.html(""),this.stopListening(),window.amd.store.ProductInfoView=void 0},initialize:function(){n.bindAll(this,"render","onClose")}}),w.PurchaseButtonView=t.View.extend({events:{"click .purchaseBtn":"purchase"},render:function(){var t=e(this.el),n=a.renderCompiledTemplate(C,{Id:this.model.get("Id")});"en-US"!=T.titlelang&&t.find("[rel*=localize]").localize("Store",{language:T.titlelang,pathPrefix:T.baseAssetUrl+"xml/Shared"}),t.html(n)},purchase:function(e){e.preventDefault(),s.closeModalsAndHideMenu();var t={Id:this.model.get("Id"),Name:this.model.get("Name"),CategoryMemberships:this.model.get("CategoryMemberships"),Consumable:this.model.get("Consumable")};a.pubsub.trigger("store:SetPurchasedProductDetails",t),s.setUpLoadingPanel("#storev2Panel");var n,i=this;n=r.isSteam()?i.startSteamPurchase:i.requestCheckoutUrl;var o=function(){i.model.setupPurchaseFlowTelemetry(),n()};return"undefined"!=typeof T.account&&"undefined"!=typeof T.account.CountryCode&&"DE"===T.account.CountryCode.toUpperCase()?(a.WriteDebugLog("purchase","globals.account.CountryCode",T.account.CountryCode),void this.checkAgeForPurchase(o)):void o()},checkAgeForPurchase:function(e){var t=this,n=function(){t.renderUnderAgeError(),t.updateGlobalAccount()},i=function(){t.showError(a.errorCode("7000.65")),t.model.unset("disablePurchase",{silent:!0})};this.checkAge(e,n,i)},checkAge:function(e,t,n){var i={ofAgeCallbkFn:e,underAgeCallbkFn:t,errorCallbkFn:n};a.pubsub.trigger("setupEnvUtils:checkStoreAgeAppropriate",i)},startSteamPurchase:function(){function e(){var e=s.CallGameMethodAsync("RGSC_START_STEAM_PURCHASE",c,"RGSC_START_STEAM_PURCHASE_DEMO");e.done(function(e){a.WriteDebugLog("startSteamPurchase","isRequested stringified",JSON.stringify(e)),"undefined"!=typeof e&&(n("request received"),"undefined"!=typeof e.Result&&e.Result||(a.WriteDebugLog("asyncStartSteamPurchase","RGSC_START_STEAM_PURCHASE_ASYNC","false",a.logType.error,a.logController[T.titleName]),o.startSteamPurchaseError())),i=setInterval(t,500),setTimeout(n,T.ajaxTimeout)}),e.fail(function(){o.startSteamPurchaseError()})}function t(){if(a.WriteDebugLog("didLastSteamPurchaseFail","",""),!s.isActivePanel("#storev2Panel"))return n("navigation"),!1;var e=s.CallGameMethod("RGSC_DID_LAST_STEAM_PURCHASE_FAIL",null,"RGSC_DID_LAST_STEAM_PURCHASE_FAIL_DEMO");return"undefined"!=typeof e&&"undefined"!=typeof e.Result&&(r=e.Result,a.WriteDebugLog("didLastSteamPurchaseFail","is purchase failed",r)),r?(n("failed"),!0):!1}function n(e){a.WriteDebugLog("cancelPollingSteamPurchase","purchaseFailed",r),a.WriteDebugLog("cancelPollingSteamPurchase","reason",e),null!==i&&(clearInterval(i),i=null,r&&o.startSteamPurchaseError())}var i,r,o=this,l=this.model.get("Id"),c={ProductId:l,Language:a.stripRegion(T.titlelang)};a.WriteDebugLog("startSteamPurchase","productId",l),e()},startSteamPurchaseError:function(){if(s.isActivePanel("#storev2Panel")){var e=a.errorCode("7000.71"),t=s.getErrorWithCode(e),n=s.getErrorWithCode(e,"RGSC_START_STEAM_PURCHASE");s.showGenericFatalError(e,n.Message,"",t.CodeDescription)}},requestCheckoutUrl:function(){var e=this,t=this.model.get("Id"),n={ProductId:t,Country:void 0!=T.account?T.account.CountryCode:"",Language:a.stripRegion(T.titlelang)};a.WriteDebugLog("requestCheckoutUrl","productId",t);var i=s.CallGameMethodAsync("RGSC_REQUEST_CHECKOUT_URL",n,"RGSC_REQUEST_CHECKOUT_URL_DEMO");i.done(function(t){if("undefined"!=typeof t&&t.Result){var n=setTimeout(e.requestCheckoutUrlError,T.ajaxTimeout);E=n}else a.WriteDebugLog("store-views.requestCheckoutUrl","isRequested",JSON.stringify(t),a.logType.error,a.logController[T.titleName]),e.requestCheckoutUrlError()}),i.fail(function(){e.requestCheckoutUrlError()})},requestCheckoutUrlError:function(){if(s.isActivePanel("#storev2Panel")){a.WriteDebugLog("requestCheckoutUrlError");var e=a.errorCode("7000.63"),t=s.getErrorWithCode(e),n=s.getErrorWithCode(e,"RGSC_REQUEST_CHECKOUT_URL");s.showGenericFatalError(e,n.Message,"",t.CodeDescription)}},resetProductImpressions:function(){_=[]},onClose:function(){this.stopListening()},initialize:function(){n.bindAll(this,"render","purchase","checkAgeForPurchase","checkAge","startSteamPurchase","startSteamPurchaseError","requestCheckoutUrl","requestCheckoutUrlError","resetProductImpressions","onClose")}}),w.InstallButtonView=t.View.extend({events:{"click .installBtn":"install"},render:function(){var t=e(this.el),n=a.renderCompiledTemplate(S,{Id:this.model.get("Id")});"en-US"!=T.titlelang&&t.find("[rel*=localize]").localize("Store",{language:T.titlelang,pathPrefix:T.baseAssetUrl+"xml/Shared"}),t.html(n)},install:function(e){e&&e.preventDefault();var t={productId:this.model.get("Id")};s.CallGameMethod("RGSC_INSTALL_PRODUCT",t,"RGSC_INSTALL_PRODUCT_DEMO","RGSC_JS_INSTALL_PRODUCT_RESULT")},onClose:function(){this.stopListening()},initialize:function(){n.bindAll(this,"render","install","onClose")}}),w}),define("common/sdk/v2_notifications",["require","jquery","utils","common/baseUtils","setup.environment.utils","common/datafunctions","common/gamefunctions","common/games/gamecommon","common/storage"],function(e){function t(e,t){if(u.WriteDllLog("RGSC_JS_NOTIFICATION","jsonNotifications",t),t=c.parseJSON(t||"null")){var n=c("#headerWrapper");n.length>0?f.isScuiVisible()?f.isHeaderMenuVisible()?(u.WriteDebugLog("---RGSC_JS_NOTIFICATION","$headerWrapper","is enabled and visible"),c("#notificationPanel").css("top",c("#header").height())):u.WriteDebugLog("---RGSC_JS_NOTIFICATION","$headerWrapper","is enabled but is hidden or positioned off-screen"):f.hideUI():u.WriteDebugLog("---RGSC_JS_NOTIFICATION","$headerWrapper","doesn't exist in HTML"),t.Count>0?c.each(t.Notifications,function(e,t){u.WriteDebugLog("---RGSC_JS_NOTIFICATION","jsonNotification",t.Type);var n=t.Type.toUpperCase();switch(n){case"NETWORK":f.setOffline(!t.Online);break;case"ACHIEVEMENTS":case"GAMEINVITES":case"MESSAGERECEIVED":case"FRIENDSTATUS":case"FRIENDREQUESTRECEIVED":case"FRIENDREQUESTACCEPTED":case"INFORMATION":case"DOWNLOADSTATUS":case"WELCOME":case"SIGNEDIN":case"DUPLICATESIGNEDOUT":case"FRIENDREQUESTS":case"FRIENDSONLINE":case"ROS.CLAN.INVITE":case"JOINREQUEST":case"ROS.CLAN.MEMBER.PROMOTED":case"CONNECTIONLOST":a(t)}}):u.WriteDebugLog("---RGSC_JS_NOTIFICATION","jsonNotifications.Count","0")}else u.WriteDebugLog("---RGSC_JS_NOTIFICATION","jsonNotifications","null")}function n(e,n){var i='{ "Type" : "INFORMATION", "Count" : 1, "Data" : [ { "Description" : "'+n+'" } ] }';t('{ "Count" : 1, "Notifications" : ['+i+"] }")}function i(e){var t=["NETWORK","GAMEINVITES","INFORMATION","DOWNLOADSTATUS","DUPLICATESIGNEDOUT","CONNECTIONLOST"],n="true"==g.getItem("hideNotifications");return n&&-1==c.inArray(e,t)?(u.WriteDebugLog("ShowNotification","false"),!0):!1}function a(e){if(u.WriteDebugLog("showNotification","jsonNotification",JSON.stringify(e)),e&&!(e.Count<=0)&&e.Data){var t=r(e);t.updateCounts&&f.CallGameMethod("RGSC_REQUEST_PLAYER_LIST_COUNTS",'{ "RequestId": 5 }',"RGSC_JS_PLAYER_LIST_COUNTS_RESPONSE_DEMO");var n=[],i=!1;c.each(e.Data,function(e,a){var r=o(e,a,t);r.showNotification&&(i=!0),r.updatedFriendId>0&&n.push(r.updatedFriendId)}),n.length&&f.isScuiVisible()&&m.getHomePageFriends(n,!0),i&&f.CallGameMethod("RGSC_SET_NOTIFICATION_VISIBLE",'{ "visible": true }',null)}}function r(e){var t={notifyImage:"",eventClass:"",clickClass:"",notificationTitle:"",updateCounts:!1,notificationType:"",activePanelName:c("div.active.panel").attr("id")};switch("undefined"!=typeof e.Type&&(t.notificationType=e.Type.toUpperCase()),t.notificationType){case"ACHIEVEMENTS":t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/achievement.png' alt='' width='48' height='48'/>",t.clickClass=" clickable",t.eventClass=" notifyAchievements",t.notificationTitle=f.getText("Accomplishment","Notifications");break;case"FRIENDREQUESTRECEIVED":t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/friendrequest.png' alt='' width='48' height='48'/>",t.clickClass=" clickable",t.eventClass=" notifyFriendRequests",t.notificationTitle=f.getText("FriendRequest","Notifications"),"friendsPanel"==t.activePanelName&&c("div.active.panel.friendInvites").length?c("#friendInvitesLink").removeClass("on").click():t.updateCounts=!0;break;case"FRIENDREQUESTACCEPTED":t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/friendrequest.png' alt='' width='48' height='48'/>",t.clickClass=" clickable",t.eventClass=" notifyFriendRequests",t.notificationTitle=f.getText("FriendRequestAccepted","Notifications"),"friendsPanel"==t.activePanelName&&c("div.active.panel.myFriends").length&&c("#myFriendsLink").removeClass("on").click();break;case"FRIENDSTATUS":t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/friendsonline.png' alt='' width='48' height='48'/>",t.clickClass=" clickable",t.eventClass=" notifyFriends",t.notificationTitle=f.getText("FriendOnline","Notifications");
break;case"MESSAGERECEIVED":globals.account&&u.pubsub.trigger("datafnfriends:GetMessageCount",globals.account.RockstarId),t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/message.png' alt='' width='48' height='48'/>",t.clickClass=" clickable",t.eventClass=" notifyMessages",t.notificationTitle=f.getText("MessageReceived","Notifications");var n=c("#newMessageInput").is(":visible"),i=""!=c("#newReplyEntry").val().trim();"messagesPanel"!=t.activePanelName||globals.MessagesLoading||n||i||(globals.MessagesLoading=!0,c("#menuMessages").click());break;case"GAMEINVITES":t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/invite.png' alt='' width='48' height='48'/>",t.clickClass=" clickable",t.eventClass=" notifyGameInvites",t.notificationTitle=f.getText("MultiplayerInvite","Notifications"),"friendsPanel"==t.activePanelName&&c("div.active.panel.gameInvites").length?c("#gameInvitesLink").removeClass("on").click():t.updateCounts=!0;break;case"INFORMATION":t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/information.png' alt='' width='48' height='48'/>",t.clickClass=" clickable",t.eventClass=" notifyInfo",t.notificationTitle=f.getText("Information","Notifications");break;case"DOWNLOADSTATUS":t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/information.png' alt='' width='48' height='48'/>",t.notificationTitle=f.getText("DownloadStatus","Notifications");break;case"WELCOME":t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/information.png' alt='' width='48' height='48'/>",t.notificationTitle=f.getText("Information","Notifications");break;case"SIGNEDIN":t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/friendsonline.png' alt='' width='48' height='48'/>",t.notificationTitle=f.getText("Information","Notifications");break;case"DUPLICATESIGNEDOUT":t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/information.png' alt='' width='48' height='48'/>",t.notificationTitle=f.getText("Information","Notifications");break;case"FRIENDREQUESTS":t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/friendrequests.png' alt='' width='48' height='48'/>",t.clickClass=" clickable",t.eventClass=" notifyFriendRequests",t.notificationTitle=f.getText("FriendRequest","Notifications");break;case"FRIENDSONLINE":t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/friendsonline.png' alt='' width='48' height='48'/>",t.clickClass=" clickable",t.eventClass=" notifyFriends",t.notificationTitle=f.getText("FriendOnline","Notifications");break;case"ROS.CLAN.INVITE":h.ClearProxyCache(),f.UpdateSocialSideMenuCount("add","#crewInvitesLink",!1),t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/crewinvite.png' alt='' width='48' height='48'/>",t.clickClass=" clickable",t.eventClass=" notifyClanInvite",t.notificationTitle=f.getText("CrewInviteNotification","Notifications");break;case"JOINREQUEST":t.clickClass=" clickable",t.eventClass=" notifyClanRequest";case"ROS.CLAN.MEMBER.PROMOTED":t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/crewinvite.png' alt='' width='48' height='48'/>";break;case"CONNECTIONLOST":t.notifyImage="<img class='avatar' src='"+globals.baseUrl+"images/notifications/information.png' alt='' width='48' height='48'/>",t.notificationTitle=f.getText("Information","Notifications")}return t}function o(e,t,n){var a="",r="",o=0;switch(n.notificationType){case"ACHIEVEMENTS":try{n.notifyImage="<img class='avatar' src='"+f.GetAchievementImage(t.Id)+"' alt='' width='48' height='48'/>"}catch(l){}a=t.Description,r=void 0!=t.Name?"<span class='name'>"+t.Name+"</span><br />":"";break;case"DOWNLOADSTATUS":a=f.getText("i"+t.Message,"Notifications"),r=void 0!=t.Name?"<span class='name'>"+t.Name+"</span><br />":"";break;case"FRIENDREQUESTRECEIVED":null==t.Nickname||void 0==t.Nickname||""==t.Nickname?a=f.getText("FriendRequestReceivedGeneric","Notifications"):(r="<span class='name'>"+t.Nickname+"</span><br />",a=f.getText("FriendRequestReceived","Notifications"));break;case"FRIENDREQUESTACCEPTED":r=void 0!=t.Nickname?"<span class='name'>"+t.Nickname+"</span><br />":"",a=f.getText("FriendRequestAccepted","Notifications");break;case"FRIENDSTATUS":if(r=void 0!=t.Nickname?"<span class='name'>"+t.Nickname+"</span><br />":"",t.AvatarUrl&&""!=t.AvatarUrl){var d=u.getAvatarUrl(t.AvatarUrl,t.Nickname);n.notifyImage="<img class='avatar' src='"+d+"' alt='' width='48' height='48'/>"}if(t.IsOnline?a=f.getText("FriendOnlineStatus","Notifications"):(a=f.getText("FriendOfflineStatus","Notifications"),n.notificationTitle=f.getText("FriendOffline","Notifications")),"friendsPanel"==n.activePanelName&&c("div.active.panel.myFriends").length){var h="offline";t.IsOnline&&(h="online"),c("#friendsList").find(".profileButton[data-id='"+t.RockstarId+"']").removeClass("online offline").addClass(h)}if(t.RockstarId){var p,m;t.IsOnline?(p="SCOnline",m=f.getText("Online","Social"),t.IsPlayingSameTitle&&(o=t.RockstarId)):(p="SCOffline",m=f.getText("Offline","Social"));var g=c("#landingFriendsList"),v=g.children("li"),b=g.find('[data-id="'+t.RockstarId+'"]');b.find("i.status").removeClass("SCOnline SCOffline").addClass(p),b.find(".subText span").text(m),v.sort(function(e,t){var n=c(e),i=c(t),a=n.find(".status").hasClass("SCOnline"),r=i.find(".status").hasClass("SCOnline");if(a&&!r)return-1;if(r&&!a)return 1;var o=n.find(".profilenickname").text(),s=i.find(".profilenickname").text();return o.localeCompare(s)}),v.detach().appendTo(g),u.pubsub.trigger("datafnfriends:ClearFriendsCache",t.RockstarId)}break;case"GAMEINVITES":a=f.getText("MultiplayerInviteReceived","Notifications"),r=void 0!=t.Nickname?"<span class='name'>"+t.Nickname+"</span><br />":"";break;case"WELCOME":var C="i"+t.Message;if(c.isNumeric(t.NumControllers)){var S=parseInt(t.NumControllers,10);S>0&&(C+="GamePad")}u.WriteDebugLog("ShowNotification","WELCOME localisationKey",C),a="dev"===globals.rosEnvironment?"[DEV] "+f.getText(C,"Notifications"):f.getText(C,"Notifications");break;case"MESSAGERECEIVED":a=f.getText("PrivateMessageReceived","Notifications"),r=void 0!=t.Nickname?"<span class='name'>"+t.Nickname+"</span><br />":"";break;case"ROS.CLAN.INVITE":r=void 0!=t.cn?"<span class='name'>"+t.cn+"</span><br />":"",a=f.getText("CrewInvite","Notifications");break;case"JOINREQUEST":r=void 0!=t.cn?"<span class='name'>"+t.cn+"</span><br />":"",a=f.getText("CrewRequest","Notifications");break;case"ROS.CLAN.MEMBER.PROMOTED":r=void 0!=t.cn?"<span class='name'>"+t.cn+"</span><br />":"",a=f.getText("CrewMemberPromoted","Notifications");break;case"CONNECTIONLOST":a=f.getText("ConnectionLost","Notifications");break;default:a=void 0!=t.Description?t.Description:"",r=void 0!=t.Name?"<span class='name'>"+t.Name+"</span><br />":void 0!=t.Nickname?"<span class='name'>"+t.Nickname+"</span><br />":""}f.isScuiVisible()||f.hideUI();var y=!1;if(!i(n.notificationType)){y=!0;var w=Math.random().toString().substring(2,10),_=void 0!=t.Id?t.Id:"",E=_+"_"+n.notificationType.replace(/\./g,"-")+e+w;u.WriteDebugLog("ShowNotification","notifyId","id='notify"+E+"'");var k="<div class='"+n.notificationType+" notify"+E+" notification"+n.clickClass+n.eventClass+"'>"+n.notifyImage+"<i></i><span class='title"+n.clickClass+"'>"+n.notificationTitle+"</span><br />"+r+"<span class='"+n.clickClass+"'>"+a+"</span></div>",T=c("#notificationPanel").append(k).find("div.notify"+E);T.fadeIn("slow").delay(3500*(e+1)).fadeOut("slow",function(){c(this).remove(),s()})}return{showNotification:y,updatedFriendId:o}}function s(){u.WriteDebugLog("FinishedShowingToasts","$('#notificationPanel div.notification').length",c("#notificationPanel div.notification").length),0==c("#notificationPanel div.notification").length&&f.CallGameMethod("RGSC_SET_NOTIFICATION_VISIBLE",'{ "visible": false }',null)}function l(e,t,n,i){i.push(t),e.on("click","div."+t,function(e){e.preventDefault(),v[n](this)})}var c=e("jquery"),u=e("utils"),d=e("common/baseUtils"),f=e("setup.environment.utils"),h=e("common/datafunctions"),p=e("common/gamefunctions"),m=e("common/games/gamecommon"),g=e("common/storage"),v={};return v.triggerLastNotificationClick=function(){var e=c("#notificationPanel"),t=e.data("boundClasses");if(!t||0==e.children().length)return!1;var n=!1,i=c(e.children().get().reverse());return i.each(function(){var e=c(this);return c(t).each(function(){return e.hasClass(this)?(e.click(),n=!0,!1):!0}),n?!1:!0}),n},v.openAchievements=function(e){c(e).remove(),p.RGSC_JS_REQUEST_UI_STATE('{ "Visible": true, "Online": '+f.isOnline()+', "State": "Achievements" }',!0)},v.openInformation=function(e){c(e).remove(),p.RGSC_JS_REQUEST_UI_STATE('{ "Visible": true, "Online": '+f.isOnline()+', "State": "Main" }',!0)},v.openFriends=function(e){c(e).remove(),p.RGSC_JS_REQUEST_UI_STATE('{ "Visible": true, "Online": '+f.isOnline()+', "State": "Friends" }',!0)},v.openFriendRequests=function(e){c(e).remove(),p.RGSC_JS_REQUEST_UI_STATE('{ "Visible": true, "Online": '+f.isOnline()+', "State": "Friends", "SubState": "Request" }',!0)},v.openGameInvites=function(e){c(e).remove(),p.RGSC_JS_REQUEST_UI_STATE('{ "Visible": true, "Online": '+f.isOnline()+', "State": "GameInvites" }',!0)},v.openMessages=function(e){c(e).remove(),p.RGSC_JS_REQUEST_UI_STATE('{ "Visible": true, "Online": '+f.isOnline()+', "State": "Messages" }',!0)},v.openCrewInvites=function(e){c(e).remove(),p.RGSC_JS_REQUEST_UI_STATE('{ "Visible": true, "Online": '+f.isOnline()+', "State": "CrewInvites" }',!0)},v.openCrewRequests=function(e){c(e).remove(),p.RGSC_JS_REQUEST_UI_STATE('{ "Visible": true, "Online": '+f.isOnline()+', "State": "CrewRequests" }',!0)},v.init=function(){d.pubsub.subscribe("SDK.RGSC_JS_NOTIFICATION",t),d.pubsub.subscribe("notificationFn.infoMessage",n);var e=c("#notificationPanel"),i=e.data("boundClasses")||[];l(e,"notifyAchievements","openAchievements",i),l(e,"notifyFriendRequests","openFriendRequests",i),l(e,"notifyFriends","openFriends",i),l(e,"notifyMessages","openMessages",i),l(e,"notifyGameInvites","openGameInvites",i),l(e,"notifyInfo","openInformation",i),l(e,"notifyClanInvite","openCrewInvites",i),l(e,"notifyClanRequest","openCrewRequests",i),e.data("boundClasses",i)},v.init(),v}),define("setup.environment",["require","jquery","common/xhr","common/xhr-utils","domReady","underscore","utils","common/baseUtils","common/profile/profile-utils","setup.environment.utils","common/profile/signin","common/profile/signup","common/profile/friends","common/messages/messages","common/settings/settings","common/datafunctions.friends","common/formvalidation","common/crews/crews-views","common/captcha","common/store/store-views","common/launcher/launcher","common/games/gamecommon","common/sdk/v2_notifications","common/modals/modal-views","am","common/am/commerce","common/antiscroll","jquery-ui","common/jquery.mousewheel","dropkick","common/virtualKeyboard","common/jquery.visible"],function(e){function t(){C.friendProfileView=function(){}}function n(){}function i(){globals.friendsServiceEnabled||t(),globals.crewServiceEnabled||n(),globals.messagingServiceEnabled||v.disableMessagingFeatures()}function a(){r(document).on("keydown",function(e){if(9==e.which){var t=r(e.target);t.is("input")||t.is("textarea")||t.is(".tab")||e.shiftKey&&t.is(".shiftTab")||e&&e.preventDefault()}})}var r=e("jquery"),o=e("common/xhr"),s=e("common/xhr-utils"),l=e("domReady"),c=e("underscore"),u=e("utils"),d=e("common/baseUtils"),f=e("common/profile/profile-utils"),h=e("setup.environment.utils"),p=e("common/profile/signin"),m=e("common/profile/signup"),g=e("common/profile/friends"),v=e("common/messages/messages"),b=e("common/settings/settings"),C=e("common/datafunctions.friends"),S=e("common/formvalidation"),y=e("common/crews/crews-views"),w=e("common/captcha"),_=e("common/store/store-views"),E=e("common/launcher/launcher"),k=e("common/games/gamecommon"),T=e("common/sdk/v2_notifications"),I=e("common/modals/modal-views"),R=e("am"),A=e("common/am/commerce");e("common/antiscroll"),e("jquery-ui"),e("common/jquery.mousewheel"),e("dropkick"),e("common/virtualKeyboard"),e("common/jquery.visible");var L={};return window.amd={crews:{},store:{},modals:{},settings:{},friends:{}},globals.initialVersion=0,globals.platform="",globals.wsURL="",L.scrollbarIsAtBottom=function(e){var t="#friendsPanel";"blockList"===e&&(t="#editProfile");var n=r(t+" .antiscroll-scrollbar"),i=n.position();if(null!=i){var a=n.height()+i.top;if(a>=345)return!0}return!1},L.StartUp=function(e){u.WriteDebugLog("StartUp","isOffline",e),e&&h.setOffline(!0);var t=r("#homefeedPanel").find(".newsRow");t.length>0&&t.html().length>0&&t.show(),h.initHeaderMenu(!0),h.showHeaderMenu(!0,function(){L.showHomepage(!0)})},L.ShowEULA=function(){u.WriteDebugLog("ShowEULA","Desktop EULA","Error: Not supported on this platform")},L.ShowSignup=function(e){u.WriteDebugLog("ShowSignup","online",e),e||h.setOffline(!0),h.initHeaderMenu(!0,!0),h.isOffline()?p.showSignin():r("#joinClub").click()},L.showCrews=function(){u.WriteDebugLog("showCrews"),h.setSelectedSide("#myCrewsLink"),r(".content").hide(),r(".crewsList").show(),r("#friendsPanel").attr("class","panel active myCrews"),y.closeCrewViews(),void 0==window.amd.crews.MyCrewsView?window.amd.crews.MyCrewsView=new y.MyCrewsView:(window.amd.crews.MyCrewsView.onClose(),window.amd.crews.MyCrewsView.initialize()),u.WriteDebugLog("showCrews Finished"),R.trackPage("/MyCrews")},L.showPrimaryCrewMembers=function(){u.WriteDebugLog("showPrimaryCrewMembers"),h.setSelectedSide("#crewMembersLink"),r(".content").hide(),r(".crewMembersList").show(),r("#friendsPanel").attr("class","panel active crewMembersList"),y.closeCrewViews(),void 0==window.amd.crews.CrewMembersView?window.amd.crews.CrewMembersView=new y.CrewMembersView:(window.amd.crews.CrewMembersView.onClose(),window.amd.crews.CrewMembersView.initialize()),u.WriteDebugLog("showPrimaryCrewMembers Finished"),R.trackPage("/CrewMembers")},L.loadCrewInvites=function(){h.setUpLoadingPanel("#friendsPanel",function(){r("#friendsPanel").attr("class","panel active crewInvitesList"),L.showCrewInvites()})},L.showCrewInvites=function(){u.WriteDebugLog("showCrewInvites"),h.setSelectedSide("#crewInvitesLink"),r(".content").hide(),r(".crewInvitesList").show(),r("#friendsPanel").attr("class","panel active crewInvitesList"),y.closeCrewViews(),void 0==window.amd.crews.CrewInvitesHeaderView?window.amd.crews.CrewInvitesHeaderView=new y.CrewInvitesHeaderView({tab:"invites"}):(window.amd.crews.CrewInvitesHeaderView.onClose(),window.amd.crews.CrewInvitesHeaderView.initialize({tab:"invites"})),R.trackPage("/CrewInvites")},L.loadCrewRequests=function(){h.setUpLoadingPanel("#friendsPanel",function(){r("#friendsPanel").attr("class","panel active crewInvitesList"),L.showCrewRequests()})},L.showCrewRequests=function(){u.WriteDebugLog("showCrewRequests"),h.setSelectedSide("#crewInvitesLink"),r(".content").hide(),r(".crewInvitesList").show(),r("#friendsPanel").attr("class","panel active crewInvitesList"),y.closeCrewViews(),void 0==window.amd.crews.CrewInvitesHeaderView?window.amd.crews.CrewInvitesHeaderView=new y.CrewInvitesHeaderView({tab:"requests"}):(window.amd.crews.CrewInvitesHeaderView.onClose(),window.amd.crews.CrewInvitesHeaderView.initialize({tab:"requests"})),R.trackPage("/CrewInvites")},L.showCrewSearch=function(e,t){u.WriteDebugLog("showCrewSearch"),h.setUpLoadingPanel("#friendsPanel"),h.setSelected(r("#socialButton")),h.setSelectedSide("#findCrewLink"),r(".content").hide(),r(".crewsList").show(),r("#friendsPanel").attr("class","panel active findCrews"),y.closeCrewViews();var n={searchString:e,crewType:t};void 0==window.amd.crews.FindCrewView?window.amd.crews.FindCrewView=new y.FindCrewView(n):(window.amd.crews.FindCrewView.onClose(),window.amd.crews.FindCrewView.initialize(n)),R.trackPage("/FindCrew")},L.myFriendsQuery=function(){var e=r("#friendsPanel");if(!r(this).is(".on")){h.closeModalsAndHideMenu(),e.find(".content").removeAttr("style"),h.setSelectedSide(r("#myFriendsLink")),h.setUpLoadingPanel("#friendsPanel"),r("#friendsPanel").attr("class","panel active myFriends");var t=r("#friendsList").data("PageIndex"),n=r("#friendsList").data("total"),i=20;if(void 0===t&&(t=0,r("#friendsList").data("PageIndex",t)),void 0==n||n>i*t){var a=Math.round((new Date).getTime()/1e3),o={RequestId:a,PlayerListType:3,PageIndex:t,PageSize:i};C.GetFriendsJS(o),r("#friendsContainer").data("antiscroll").refresh()}else h.removeLoading("friendsPanel")}},L.friendInviteQuery=function(){var e=r("#friendsPanel");if(!r(this).is(".on")){h.closeModalsAndHideMenu(),h.setSelectedSide(r(this)),h.setUpLoadingPanel("#friendsPanel",function(){r("#friendInvitesList").show()}),e.attr("class","panel active friendInvites");var t=r("#friendInvitesList").data("PageIndex"),n=r("#friendInvitesList").data("total"),i=100;if(void 0===t&&(t=0,r("#friendInvitesList").data("PageIndex",t)),void 0==n||n>i*t){var a={PageIndex:t,PageSize:i};g.getFriendInvites(a)}R.trackPage("/FriendInvites")}},L.showSocialSection=function(e){if(!globals.isLauncher){var t=r("#socialButton"),n=function(){"undefined"!=typeof e&&e.length||(e="#myFriendsLink"),r(e).click()};if(t.hasClass("disabled")||r("#friendsPanel").hasClass("active")||r("div.panel.active").is(":animated"))return void n();if(!h.isSignedIn())return h.setSelected(t),void f.navigatePendingSignIn("#socialButton");if(h.isOffline())return void L.showHomepage(!0);var i=r("#friendsPanel");"true"!==i.attr("countsRetrieved")&&h.CallGameMethod("RGSC_REQUEST_PLAYER_LIST_COUNTS",'{ "RequestId": 1 }',"RGSC_JS_PLAYER_LIST_COUNTS_RESPONSE_DEMO"),i.hasClass("localized")||(r("#friendProfilePanel, #friendsPanel").find("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),i.addClass("localized")),globals.crewsServiceEnabled&&(void 0==window.amd.crews.MyPrimaryCrewTagView?window.amd.crews.MyPrimaryCrewTagView=new y.MyPrimaryCrewTagView:(window.amd.crews.MyPrimaryCrewTagView.onClose(),window.amd.crews.MyPrimaryCrewTagView.initialize())),h.setSelected(t),u.pubsub.trigger("section:social:loaded"),h.setUpLoadingPanel("#friendsPanel",function(){n()})}},L.showTimeOutRetry=function(e){u.WriteDebugLog("showTimeOut","waitingResponse",globals.waitingResponse);var t=r("div.panel.active");I.ShowConfirmModal(h.getText("FailedToLoadData","Notifications"),"","setupEnv:timeOutRetryClick",e,"Retry"),h.removeLoading(t.attr("id"))},L.timeOutRetryClick=function(e){var t=r("div.panel.active");h.setUpLoading(t),o.ajax(e)},L.ShowServiceAlert=function(){var e=u.errorCode("1002"),t=h.getText(u.errorCodeLocKey(e),"Errors");I.ShowConfirmModal(t,null,null,null,"Close",null)},L.retryOnlineConnection=function(){h.CallGameMethod("RGSC_RELOAD_UI",'{ "OfflineSite": false }',"RGSC_RELOAD_UI_DEMO")},L.showMessagesPage=function(){v.showMessagesPage()},L.processNetworkStatusChange=function(e){var t=r("#confirmPanel");t.find(".confirmPanelButtonWrapper").hide(),t.find(".confirmPanelOptionsWrapper").hide(),e.Online?(t.find("#confirmPanelTitle").html(h.getError("ConnectionUpdate")),t.find("#confirmPanelText").html(h.getError("NetworkDetected")),t.find("#confirmPanelTextLong").html("<p>"+h.getError("OfflineBut")+"</p>"),t.find("#confirmPanelYes").off("click").on("click",function(){return h.requestUiState(!0),!1}),t.find("#confirmPanelNo").off("click").on("click",function(){return r("#confirmPanel").hide(),r("div.panel.active").show(),!1}),h.isOnline(!0),t.find("#confirmPanelButtonWrapperYesNo").show()):(h.initHeaderMenu(!1),t.find("#confirmPanelTitle").html(h.getError("ConnectLost")),t.find("#confirmPanelText").html(h.getError("UnableConnect")),t.find("#confirmPanelTextLong").html(h.getError("DisconnectRefresh")),t.find("#confirmPanelOk").off("click").on("click",function(){return h.setOffline(!0),r("div.panel.active").length>0?(u.WriteDebugLog("RGSC_JS_NETWORK_CHANGE","$(div.panel.active).id",r("div.panel.active").attr("id")),r("div.panel.active").show()):L.StartUp(!0),r("#confirmPanel").hide(),h.initHeaderMenu(!0),!1}),h.isOffline(!0),r("#confirmPanelButtonWrapperOk").show()),r("div.panel.active").hide(),t.show()},l(function(){a(),window.open=function(e){h.launchExternalBrowserForUrl(e)};var t=!0;R.setup(t),A.setup(),s.init(),i(),p.init(),m.init(),E.init(),b.init(),k.init(),v.init();var n=r(document);r("div.antiscroll-inner").bind("scroll mousewheel",function(){var e,t,n,i=r(this),a=i.closest("div.panel").find("div.loadingMask:visible");if(!a.length){var o=i.closest("div").find(".content:visible").attr("id");if(L.scrollbarIsAtBottom(o)){switch(o){case"findFriends":g.triggerFindFriend();break;case"friendInvitesList":if(t=r("#friendInvitesList"),void 0===t.data("total")||t.find(".profileButton").length<t.data("total")){e=parseInt(t.data("PageIndex"),10),t.data("PageIndex",++e);var s,l=t.data("friendInvitesList");void 0!=l&&(l.PageIndex=e,s=JSON.stringify(l)),d.pubsub.publish("friendFn.handlePlayerListResponse",s)}break;case"friendsList":t=r("#friendsList"),(void 0===t.data("total")||t.find("div.profileButton").length<t.data("total"))&&(e=parseInt(t.data("PageIndex"),10),t.data("PageIndex",++e),n=r("#friendsPanel .loadingMask"),n.addClass("noMask"),n.hasClass("bottom")||n.addClass("bottom"),L.myFriendsQuery());break;case"blockList":t=r("#blockListPlayercards"),(void 0===t.data("total")||t.find("div.profileButtonWrapper").length<t.data("total"))&&(e=parseInt(t.data("PageIndex"),10),t.data("PageIndex",++e),n=r("#editProfile .loadingMask"),n.addClass("noMask"),n.hasClass("bottom")||n.addClass("bottom"),b.blockListQuery());break;case"crewInvitesHeader":r("#crewInvitesList").is(":visible")?r("#crewInvitesList").trigger("crewInvitesScroll"):r("#crewRequestsList").is(":visible")&&r("#crewRequestsList").trigger("crewRequestsScroll")}o=null}}}),r([globals.baseUrl+"images/rsc_icon_small.png",globals.baseUrl+"images/friend_request.png",globals.baseUrl+"images/friend_request.png",globals.baseUrl+"images/friend_online.png",globals.baseUrl+"images/message_received.png",globals.baseUrl+"images/multi_invite.png",globals.baseUrl+"images/info.png"]).preload(),r("#homefeedPanel").on("click","#retryConnection",function(e){e&&e.preventDefault(),r(this).text(h.getError("Loading")),L.retryOnlineConnection()}),r("#headerLoginButton").keyup(function(e){var t=r(e.currentTarget);13==e.which&&t.visible()&&r(this).click()}),r("#headerLoginButton, #joinClubOffline").click(function(){return w.clearResponseValue(),(!r(this).hasClass("disabled")||r("#signupPanelsWrapper").hasClass("active"))&&p.showSignin(h.isOnline()),!1}),r("div.antiscroll-wrap").each(function(){var e=r(this),t=e.closest(".panel"),n=t.length&&!t.is(":visible");n&&t.css("display","block");var i=void 0;e.hasClass("antiscroll-always-on")&&(i={autoHide:!1}),e.antiscroll(i),n&&t.css("display","")}),r("#headerLoginOptionsButton").click(function(){globals.isLauncher||r(this).hasClass("disabled")||("true"!==r("#menuMessages").attr("countRetrieved")&&C.GetAccountActivity(globals.account.RockstarId),r("#headerLoginOptionsDrop").toggle(),r("#headerLoginOptionsButton").toggleClass("active"))}),r("#headerLoginUser").click(function(e){e&&e.preventDefault();var t=r(this);if(!globals.isLauncher)return t.hasClass("disabled")||h.isMyProfileVisible()?void u.pubsub.trigger("headerLoginUser:click:disabled"):void(h.isOffline()||t.hasClass("disabled")||u.isLegacyServiceLayer()||(t.addClass("disabled"),u.pubsub.trigger("datafnfriends:friendProfileView",globals.account.RockstarId)))}),r("#headerLoginOptionsDrop").find("ul li a").keydown(function(e){var t=r(e.currentTarget);13==e.which&&t.visible()&&r(this).click()}),r("a.closeCurrentPanel").click(function(){return h.clearActivePanel(),!1}),r("#menuMessages").click(function(e){e&&e.preventDefault(),globals.isLauncher||v.showMessagesPage()}),r("a.closeButton").click(function(){return h.clearActivePanel(function(){r(this).parents(".panel").removeClass("active"),h.CloseUI()}),!1}),r("#mainNav").find("li").keyup(function(e){var t=r(e.currentTarget);13==e.which&&t.visible()&&r(this).click()}),r("#homeButton, #header h1").click(function(e){e&&e.preventDefault(),r(this).hasClass("disabled")||L.showHomepage(!1)}),r("img.avatarImg ").on("error",u.avatar404),r("img.extraLargeAvatar ").on("error",u.avatar404),r("img.largeAvatar ").on("error",u.avatar404),L.showHomepage=function(t){globals.isLauncher||(h.isSignedIn()||p.showSignin(),r("#headerLoginOptionsDrop").is(":visible")&&r("#headerLoginOptionsButton").click(),t&&T.triggerLastNotificationClick()||r("#homefeedPanel").hasClass("active")||r(".active").is(":animated")||(h.setSelected(r("#homeButton")),h.clearActivePanel(function(){h.setUpLoadingPanel("#homefeedPanel");var t=r("#homefeedPanel");t.find("div.antiscroll-inner").css({width:"",height:""}),t.find(".box-wrap").antiscroll(),R.trackPage("/Home"),u.isGameSupported()?e(["common/games/"+globals.titleName],function(e){e.LoadHomeScreen()}):k.LoadHomeScreen()})))},r("#friendsPanel").find(".sideMenu a").keydown(function(e){var t=r(e.currentTarget);13==e.which&&t.visible()&&r(this).click()}),r("#myFriendsLink").click(function(e){e&&e.preventDefault(),globals.isLauncher||r(this).is(".on")||(r("#friendsList").empty(),r("#friendsList").removeData(),L.myFriendsQuery(),R.trackPage("/MyFriends"))}),r("#storeButton").click(function(e){if(e&&e.preventDefault(),!globals.isLauncher){var t=r(this);t.hasClass("disabled")||(h.setSelected(t),u.isStoreV2Enabled()?(t.removeData(),_.showCommerceV2()):_.showCommerce())}}),r("#socialButton").click(function(e){e&&e.preventDefault(),L.showSocialSection()}),r("#friendSearchForm").on("submit",function(e){e.preventDefault()}),r("#findPlayerLink").click(function(e){if(e&&e.preventDefault(),h.removeLoading("friendsPanel"),!globals.isLauncher&&!r(this).is(".on")){var t=r("#friendsPanel");r(this).is(".on")||(r("#headerLoginOptionsDrop").is(":visible")&&r("#headerLoginOptionsButton").click(),r("#findFriendsList").empty(),r("#findFriendsIntro").show(),r("#friendSearchTerm").removeAttr("style"),r("#friendsPanel div.content").removeAttr("style"),h.setSelectedSide(r(this)),h.resetScrollbar("#friendsPanel"),r("#friendSearchbox").val(""),r("#findFriends .emptyContainer").remove(),t.attr("class","panel active findPlayer"),t.find("#friendSearchLink").unbind("click").click(function(){var e=r(this).parents("#friendSearch").find(".searchTip"),t=r("#friendSearchbox").val();t=t.replace(/ /g,""),r("#friendSearchbox").val(t),""!=t&&t.length>2?S.SearchNicknameRegExValidation(t)?(g.findPlayer(t,"0"),e.fadeOut(),R.trackEvent(R.category.friend,R.action.friend_search)):e.html(h.getError("NickInvalid")).fadeIn():""!=t&&t.length<3&&e.html(h.getError("SearchMin3Chars")).fadeIn()}),t.find("#friendSearchbox").unbind("keydown").keydown(function(e){(13==e.keyCode||13==e.charCode)&&(e&&e.preventDefault(),r("#friendSearchLink").click())}).focus(),r("#friendsContainer").data("antiscroll").refresh(),R.trackPage("/FindPlayer"))}}),r("#friendMore").click(function(e){if(e&&e.preventDefault(),!globals.isLauncher){var t=r("#friendSearchbox"),n=parseInt(t.data("pageIndex"),10);u.WriteDebugLog("friendMore","pageIndex",n),g.findPlayer(t.val(),n+1)}}),r("#friendInvitesLink").click(function(e){e&&e.preventDefault(),r(this).is(".on")||globals.isLauncher||(h.setSelectedSide(r(this)),r("#friendInvitesList").empty().removeData(),L.friendInviteQuery())}),r("#gameInvitesLink").click(function(e){e&&e.preventDefault(),r(this).is(".on")||globals.isLauncher||(y.closeCrewViews(),h.setSelectedSide(r(this)),h.setUpLoadingPanel("#friendsPanel",function(){r("#gameInvitesList").show(),r("#friendsPanel").removeClass().addClass("panel active gameInvites"),C.GetGameInvites()}),R.trackPage("/GameInvites"))}),r("#myCrewsLink").click(function(e){e&&e.preventDefault(),r(this).is(".on")||globals.isLauncher||h.setUpLoadingPanel("#friendsPanel",function(){L.showCrews()})}),r("#crewMembersLink").click(function(e){e&&e.preventDefault(),r(this).is(".on")||globals.isLauncher||L.showPrimaryCrewMembers()}),r("#crewInvitesLink").click(function(e){e&&e.preventDefault(),r(this).is(".on")||globals.isLauncher||L.loadCrewInvites()}),r("#findCrewLink").click(function(e){e&&e.preventDefault(),r(this).is(".on")||globals.isLauncher||L.showCrewSearch()}),r("#gameInviteLink").click(function(e){e&&e.preventDefault(),C.SendGameInvite(r("#friendProfile").attr("data-id"))}),r("#newMessage, #messageLink").click(function(){var e=r("#friendProfilePanel.active");return e.length?v.openNewMessage(e.find("#friendProfile").attr("data-id"),e.find("#friendProfile img.avatarImg").attr("src"),e.find("#friendProfile .profilenickname:first").text(),"friendProfilePanel"):v.openNewMessage(),!1}),r("#friendsPanel form #crewMemberSearchText, #activation form").keydown(function(e){var t;return t=window.event?window.event.keyCode:e.which,13==t||10==t?(e&&e.preventDefault(),r(this).find("input:focus").focusout(),r(this).submit(),!1):!0}),n.on("click",".RGSCLoadExt",function(e){e&&e.preventDefault(),h.launchExternalBrowser.call(this,e)}),n.on("keyup","#messagePanel .closeCurrentPanel",function(e){var t=r(e.currentTarget);13==e.which&&t.visible()&&r(this).click()}),n.on("click",".inviteMsg",function(e){e&&e.preventDefault();var t=r(e.currentTarget),n='"'+t.attr("data-message")+'"';I.ShowConfirmModal(n,null,null,null,"Close",null)}),r("form").keydown(function(e){var t=r(e.originalEvent.target);if(!t.visible())return!1;if(t.hasClass("noEnterSubmit"))return!0;var n;return n=window.event?window.event.keyCode:e.which,13!=n&&10!=n?!0:void r(this).submit()}),r("fieldset.options").find("input:radio").click(function(){var e=r(this).data("previousValue");1==e?(r(this).prop("checked",!1),r(this).removeData()):r(this).data("previousValue",r(this).prop("checked"))}),r("#menuExit").click(function(){return h.clearActivePanel(function(){h.CloseUI()}),!1}),r("#menuQuitGame").click(function(){h.quitGame()}),r("#signupPanelsWrapper form input:text, #signupPanelsWrapper form input:password").bind({dblclick:function(){r(this).select()}}),n.on("click","form.toggleOptionsForm .toggleOptions a",function(e){e&&e.preventDefault();var t=r(this);return t.is(".selected")||t.data("updating")?!1:(t.data("updating",!0),C.UpdateSetting(t.find("input:radio").attr("name"),t.find("input:radio").val(),"",t),!1)}),r("[data-services]").each(function(e,t){var n=r(t),i=n.data("services").split(",");return globals.scsServiceEnabled?void("socialbutton"===n.attr("id").toLowerCase()?globals.friendsServiceEnabled&&globals.accountsServiceEnabled||n.unbind().click(globals.crewsServiceEnabled?function(){r("#myCrewsLink").click()}:function(){r("#gameInvitesLink").click()}):c.each(i,function(e){return globals[e+"ServiceEnabled"]?void 0:void(n.hasClass("doNotRemove")?n.addClass("disabled"):(n.parent("li").length&&n.parent("li").remove(),n.remove()))})):(n.parent("li").length&&n.parent("li").remove(),void(n.hasClass("doNotRemove")?n.addClass("disabled"):n.remove()))}),r("#friendsPanel").find(".sideMenu li").click(function(e){e&&e.preventDefault(),r("#friendsPanel .loadingMask").removeClass("bottom")}),r("#buttonServerErrorHome").click(function(e){e&&e.preventDefault(),L.showHomepage(!0)}),r("#customAvatar a").click(function(e){e&&e.preventDefault(),r("#customAvatarInfo").toggle(),r("#customAvatar a").toggleClass("open").toggleClass("close")}),r("#customAvatarInfo a.close").click(function(e){e&&e.preventDefault(),r("#customAvatarInfo").hide(),r("#customAvatar a").removeClass("open").addClass("close")})}),u.pubsub.on("setupEnv:timeOutRetryClick",L.timeOutRetryClick),u.pubsub.on("setupEnv:showServiceAlert",L.ShowServiceAlert),u.pubsub.on("setupEnv:showHomepage",L.showHomepage),u.pubsub.on("setupEnv.showSocial",L.showSocialSection),u.pubsub.on("setupEnv.showTimeOutRetry",L.showTimeOutRetry),L}),define("common/entitlements/entitlements",["require","jquery","utils","setup.environment.utils","common/formvalidation"],function(e){function t(){return r("#activation #ContentId").val()||0
}function n(){return r("#requestCode").val()}function i(){return r("#activationCode").val()}function a(){r("#activation").removeClass("pending")}var r=e("jquery"),o=e("utils"),s=e("setup.environment.utils"),l=e("common/formvalidation"),c={};return c.ActivateCode=function(e){l.clearErrorClasses();var n='{ "Message": 24, "ContentId":'+t()+', "ActivationCode":"'+i()+'", "Action": '+e+"}";s.CallGameMethod("RGSC_ACTIVATION_CODE_RESPONSE",n,"RGSC_ACTIVATION_CODE_RESPONSE_DEMO"),a()},c.ActivateCodeRecovery=function(e){l.clearErrorClasses();var r='{ "ContentId":'+t()+', "RequestCode":"'+n()+'", "ResponseCode":"'+i()+'", "Action": '+e+"}";s.CallGameMethod("RGSC_LICENSE_RECOVERY_RESPONSE",r,"RGSC_JS_LICENSE_RECOVERY_RESULT"),a()},c.ActivateCodeExpiration=function(e){l.clearErrorClasses();var t='{ "ContentId":'+r("#activation #ContentId").val()+', "ActivationCode":"'+i()+'", "Action": '+e+"}";s.CallGameMethod("RGSC_LICENSE_EXPIRATION_RESPONSE",t,"RGSC_JS_LICENSE_EXPIRATION_RESULT"),a()},c.RedeemCode=function(e){l.clearErrorClasses();var t='{ "Message": 36, "redemptionCode":"'+i()+'", "Action": '+e+"}";s.CallGameMethod("RGSC_REDEMPTION_CODE_RESPONSE",t,"RGSC_REDEMPTION_CODE_RESPONSE_DEMO"),a()},c.showActivationError=function(e,t){if(o.WriteDebugLog("showActivationError","errorMsg, codeDescription",e+", "+t),"confirmPanel"==r("div.panel.active").attr("id"))r("#confirmPanelTextLong").html('<span class="errorText">'+e+"</span>");else{r("#activation").find("#buttonBackToCodeEntry").click();var n=r("#activationCode");n.siblings(".error, .errorText, .errorCode").remove(),t&&n.after('<div class="errorCode">'+t+"</div>"),n.after('<div class="errorText">'+e+"</div>"),n.is(":visible")&&n.after('<span class="error"></span>')}c.resetActivationForm(),r("#activationCode").focus().select()},c.resetActivationForm=function(){var e=r("#activation");e.find("#spanActivate").hide(),e.find(".unlock, .unlockContinue").remove(),r("#activationWrapper").find("a.disabled").removeClass("disabled")},c.ShowVoucherContents=function(e){var t=r("#activation");e?t.data("isActivation",1):t.removeData("isActivation"),l.clearErrorClasses(),r("#activationWrapper").removeData("voucherContentsRequested");var n={voucherCode:i(),language:globals.titlelang},a=s.CallGameMethod("RGSC_REQUEST_VOUCHER_CONTENTS",n,"RGSC_REQUEST_VOUCHER_CONTENTS_DEMO");if(void 0!=a&&void 0!=a.Result&&a.Result)r("#activationWrapper").data("voucherContentsRequested",n.voucherCode);else{var u=o.errorCode("7001.67"),d=s.getErrorWithCode(u);c.showActivationError(d.Message,d.CodeDescription)}t.removeClass("pending")},c.ConsumeVoucher=function(){l.clearErrorClasses(),r("#activationWrapper").removeData("voucherContentsRequested");var e={voucherCode:i()},t=s.CallGameMethod("RGSC_REQUEST_VOUCHER_CONSUMPTION",e,"RGSC_REQUEST_VOUCHER_CONSUMPTION_DEMO");if(void 0==t||void 0==t.Result||!t.Result){var n=o.errorCode("7001.69"),u=s.getErrorWithCode(n);c.showActivationError(u.Message,u.CodeDescription)}a()},o.pubsub.on("entitlements.activateCode",c.ActivateCode),c}),define("common/sdk/v2_activation",["require","jquery","underscore","utils","common/baseUtils","common/profile/profile-utils","setup.environment.utils","common/datafunctions","common/gamefunctions","common/formvalidation","common/entitlements/entitlements","common/steam","am","common/am/customDimensions","common/jquery.visible"],function(t){function n(){var e="";return null!=Y.account&&(void 0!=Y.account.Nickname&&Y.account.Nickname.length>0?e=Y.account.Nickname:void 0!=Y.account.Email&&Y.account.Email.length>0&&(e=Y.account.Email)),e}function i(e){var t=e.find("#activationCode");return t.val()?void t.prop("disabled",!0).show():(t.prop("disabled",!1).show(),t.unbind("mouseup").bind("mouseup",function(){var e=window.getSelection();if(e){var t=this.selectionEnd-this.selectionStart;t>4&&t!=this.value.length&&(this.selectionEnd=this.selectionStart+4)}}),t.unbind("keyup").bind("keyup",function(e){var t=O(this),n=F.getCaretPosition(this),i=t.val(),a=F.areChunkedVoucherCodesEnabled(),r=/[^0-9A-Za-z]/g;if(a||(r=/[^0-9A-Za-z\-]/g),e.keyCode>=48&&e.keyCode<=57||e.keyCode>=65&&e.keyCode<=90||e.keyCode>=96&&e.keyCode<=105||!a&&189==e.keyCode){var o=i.replace(r,"");if(i=o,a){var s=o.replace(/\s+/g,"").chunk(4);i=s.join("-"),i=i.substr(0,19),4==s.length?1==s[3].length&&n>14?F.setCaretPosition(this,n+1):F.setCaretPosition(this,n):F.setCaretPosition(this,n+s.length%4)}i=i.substr(0,50),t.val(i.toUpperCase())}else 13===e.keyCode&&O("#buttonCheck").click()}),t.unbind("paste").bind("paste",function(){var e=O(this);e.val(""),setTimeout(function(){var t=e.val();F.areChunkedVoucherCodesEnabled()&&(t=t.replace(/-/g,"").replace(/\s+/g,"").chunk(4).join("-"),t=t.substr(0,19)),t=t.substr(0,50),e.val(t.toUpperCase())},100)}),void t.unbind("keydown").bind("keydown",function(e){F.areChunkedVoucherCodesEnabled()&&189==e.keyCode&&e.preventDefault()}))}function a(e){return void 0!=e&&void 0!=e.Data&&void 0!=e.Data.Referrer}function r(e,t,n){e.find("#buttonCancel").show(),e.find("#buttonCancel").unbind("click"),e.find("#buttonCancel").click(a(n)?function(){B.RGSC_JS_REQUEST_UI_STATE('{ "Visible": true, "Online": '+G.isOnline()+', "State": "COMMERCE", "Data" : { "Url" : "" } }')}:"REDEMPTIONCODE"==t?function(){q.RedeemCode(2),j.clearActivePanel(function(){j.requestUiState(!1)})}:F.isLegacyServiceLayer()?function(){O("#legalActivation input:checkbox").prop("checked",!1),q.ActivateCode(3),j.clearActivePanel(function(){j.requestUiState(!1)})}:function(){O("#legalActivation input:checkbox").prop("checked",!1),q.ActivateCode(3),j.clearActivePanel(function(){F.pubsub.trigger("signin.signOut")})})}function o(e,t){e.find("#buttonActivate").show(),"REDEMPTIONCODE"==t?e.find("#buttonActivate").unbind("click").click(function(){H.ActivationCodeValidation(!0)&&(O(this).hasClass("disabled")||(O(this).addClass("disabled"),O("#spanActivate").show(),q.RedeemCode(1)))}):"MAIN"==t&&e.find("#buttonActivate, #buttonActivateYes, #buttonActivateOk").unbind("click").click(function(){H.ActivationCodeValidation()&&(O(this).hasClass("disabled")||(O(this).addClass("disabled"),O("#spanActivate").show(),q.ActivateCode(1)))})}function s(e,t){e.find("#buttonActivate").hide(),e.find("#buttonCheck").show(),O("#activationWrapper").removeData("voucherContentsRequested"),"REDEMPTIONCODE"==t?(e.find("#buttonActivate, #buttonCheck").unbind("click").click(l),e.find("#buttonActivate, #buttonCheck").unbind("keydown").keydown(function(e){13==e.which&&O(this).click()})):"MAIN"==t&&(e.find("#buttonActivate, #buttonActivateOk, #buttonCheck").unbind("click").click(function(e){l(e,!0)}),e.find("#buttonActivate, #buttonActivateOk, #buttonCheck").unbind("keydown").keydown(function(e){13==e.which&&O(this).click()}))}function l(e,t){if(H.ActivationCodeValidation(!0,t)){var n=O(e.currentTarget);if(!n.hasClass("disabled")){n.addClass("disabled"),O("#spanActivate").show();var i=O("#activationWrapper").data("voucherContentsRequested");void 0!=i&&i.length&&i==O("#activationCode").val()?q.ConsumeVoucher(t):q.ShowVoucherContents(t)}}}function c(e){e.find("#buttonQuitGame").show(),e.find("#buttonQuitGame").unbind("click"),e.find("#buttonQuitGame").click(function(){q.ActivateCode(4),j.clearActivePanel(function(){j.quitGame(),j.requestUiState(!1)})}),e.find("#buttonQuitGame").unbind("keydown"),e.find("#buttonQuitGame").keydown(function(t){var n=t.keyCode||t.which;9==n&&(t.preventDefault(),e.find("#activationCode").focus()),13==n&&O(this).click()})}function u(e,t){j.showMessagePanel(j.getText("LicenseCorrupt","Activation"),"",j.getText("i"+t.Data.Message,"Activation")),e.find("#buttonCancelMessage, #buttonActivateYes, #buttonActivateOk, #buttonCheck").hide(),e.find("#messagePanel .closeCurrentPanel").unbind("click").show().click(function(){j.clearActivePanel(function(){j.CallGameMethod("RGSC_CORRUPT_LICENSE_DIALOG_RESPONSE",null,"RGSC_UI_STATE_RESPONSE_DEMO")})})}function d(t,n){t.find("#buttonActivateYes, #buttonActivateOk, #buttonCheck").hide(),t.find("#requestCode").val(n.Data.RequestCode),t.find(".requestCode").show(),t.find(".title").text(j.getText("i15","Activation")),t.find(".message").text(j.getText("i"+n.Data.Message,"Activation")),t.find("#buttonActivate").show(),t.find("#buttonActivate").unbind("click"),t.find("#buttonActivate").click(function(){H.ActivationCodeValidation()&&(O(this).hasClass("disabled")||(O(this).addClass("disabled"),O("#spanActivate").show(),q.ActivateCodeRecovery(1)))}),t.find("#buttonCancel").unbind("keydown"),t.find("#buttonCancel").keydown(function(){13==e.which&&O(this).click()}),t.find("#buttonCancel").unbind("click"),t.find("#buttonCancel").click(function(){q.ActivateCodeRecovery(3),j.clearActivePanel(function(){j.requestUiState(!1)})})}function f(e,t){e.find("#buttonActivateYes, #buttonActivateOk, #buttonCheck").hide(),e.find("#activationCode").val(t.Data.CurrentSerialNumber),e.find(".title").text("License Expiration"),e.find(".message").text(j.getText("i"+t.Data.Message,"Activation")),e.find("#buttonActivate").show(),e.find("#buttonActivate").unbind("click"),e.find("#buttonActivate").click(function(){H.ActivationCodeValidation()&&(O(this).hasClass("disabled")||(O(this).addClass("disabled"),O("#spanActivate").show(),q.ActivateCodeExpiration(1)))}),e.find("#buttonCancel").unbind("click"),e.find("#buttonCancel").click(function(){q.ActivateCodeExpiration(3),j.clearActivePanel(function(){j.requestUiState(!1)})})}function h(e){e.find("#activationContent").hide(),e.addClass("steam"),e.find("#linkSteam .message").html(j.getText("i42new","Activation").replace("[content name]","<span class='purple'>"+w(Y.titleDisplayName)+"</span>").replace(new RegExp(/\n/g),"<br />"));var t=Y.account,n=e.find("#linkSteam .accountPanel.SC");n.find(".username").text(t.Nickname),n.find(".email").text(t.Email);var i=F.getAvatarUrl(t.AvatarUrl,t.Nickname);n.find(".avatar img").attr(i);var a="",r=j.CallGameMethodAsync("RGSC_GET_STEAM_PERSONA",null,"RGSC_GET_STEAM_PERSONA_DEMO");r.done(function(e){a=null===e||"undefined"==typeof e||"undefined"==typeof e.Name||""===e.Name?j.getText("CurrentSteamAccount","Activation"):e.Name}),r.fail(function(){a=j.getText("CurrentSteamAccount","Activation")}),r.always(function(){var t=e.find("#linkSteam .accountPanel.STEAM");t.find(".username").text(a),W.GetUserNetworks(Y.account.RockstarId,"","",p)}),e.find("#linkSteam").show(),e.find(".inner").addClass("noBackground")}function p(e){var t=O(e),n=t.find("OnlineServiceName"),i=O("#linkSteam"),a=i.find(".linkedAccounts"),r=i.find(".currentLink");if(a.empty(),"undefined"==typeof n||0===n.length)return void r.hide();var o="";t.find("PlayerAccount").each(function(){var e=O(this),t=e.find("OnlineServiceName").text(),n=[{name:"np","class":"account-psn"},{name:"xbl","class":"account-xbl"},{name:"legacyds","class":"account-ds"},{name:"legacygfwl","class":"account-windows"}],i=U.find(n,function(e){return e.name===t});if("undefined"!=typeof i){r.find("span.username").text(Y.account.Nickname),r.find("span.alreadyLinked").text(j.getText("AlreadyLinked","Activation"));var a=i.class;"undefined"!=typeof a&&""!==a&&(o+='<li class="'+a+'">'+e.find("UserName").text()+"</li>")}}),r.show(),a.html(o)}function m(e,t){F.WriteDllLog("RGSC_JS_ACTIVATION_RESULT","json",t),O("#activationWrapper span").hide();var n=w(Y.titleDisplayName);if(t=O.parseJSON(t||"null"),t.Result&&1==t.Result){void 0!=t.ContentName&&(n=w(t.ContentName));var i="";void 0!=t.Message&&(i=isNaN(t.Message)?j.getText(t.Message,"Activation").replace("[content name]",n):j.getText("i"+t.Message,"Activation").replace("[content name]",n)),0==i.length&&(i=j.getText("i35","Activation").replace("[content name]",n)),void 0!=t.Message&&t.Message>35&&t.Message<42?j.showMessagePanel(j.getText("CodeRedemption","Activation"),"&nbsp;",i):void 0!=t.Message&&t.Message>41&&t.Message<45?j.showMessagePanel(j.getText("Success","Register"),"&nbsp;",i):void 0!=t.ContentId&&1==t.ContentId?j.showMessagePanel(j.getText("i35","Activation"),"&nbsp;",j.getText("YouHaveDLC","Activation").replace("[content name]",n)):j.showMessagePanel(j.getText("i35","Activation"),"&nbsp;",j.getText("i21","Activation").replace("[content name]",n)),O("#buttonCancelMessage").hide(),O("#messagePanel .closeCurrentPanel").unbind("click").show().click(function(){j.clearActivePanel(function(){j.requestUiState(!1)})})}else{var a="";if(void 0!==t.Message)if(isNaN(t.Message))a=j.getText(t.Message,"Activation");else{if("22"==t.Message)return j.showMessagePanel(j.getText("NotPassed","Activation"),"",j.getText("i"+t.Data.Message,"Activation")),O("#buttonCancelMessage").hide(),O("#buttonCloseMessage").show(),O("#messagePanel .closeCurrentPanel").unbind("click").show().click(function(){return j.clearActivePanel(function(){j.requestUiState(!1)}),!1}),void O("#activationWrapper a.disabled").removeClass("disabled");a=j.getText("i"+t.Message,"Activation")}if(0==a.length&&(a=j.getError("ErrorActivate")),"confirmPanel"==O("div.panel.active").attr("id"))O("#confirmPanelTextLong").html('<span class="errorText">'+a+"</span>");else{var r=O("#activationCode");r.after('<div class="errorText">'+a+"</div>"),r.is(":visible")&&r.after('<span class="error"></span>')}}O("#activationWrapper a.disabled").removeClass("disabled")}function g(e,t){F.WriteDllLog("RGSC_JS_LICENSE_EXPIRATION_RESULT","json",t),O("#activationWrapper span").hide(),t=O.parseJSON(t||"null"),null!=t.Result&&1==t.Result?(O("#lblActivation").html(t.Message),setTimeout(function(){j.requestUiState(!1)},2e3)):(O("#activationCode").before('<span class="errorText">'+j.getError("ErrorActivate")+"</span>"),O("#activationCode").before('<span class="error"></span>')),O("#activationWrapper a.disabled").removeClass("disabled")}function v(e,t){F.WriteDllLog("RGSC_JS_LICENSE_RECOVERY_RESULT","json",t),O("#activationWrapper span").hide(),t=O.parseJSON(t||"null"),t.Result&&1==t.Result?(O("#lblActivation").html(t.Message),setTimeout(function(){j.requestUiState(!1)},2e3)):(O("#activationCode").before('<span class="errorText">'+j.getError("ErrorActivate")+"</span>"),O("#activationCode").before('<span class="error"></span>')),O("#activationWrapper a.disabled").removeClass("disabled")}function b(e,t){F.WriteDllLog("RGSC_JS_REDEMPTION_RESULT","json",t),B.RGSC_JS_ACTIVATION_RESULT(t)}function C(e,t){var n="",i=", ",a="",r="";t&&(n="<li>",i="</li>",a="<ul>",r="</ul>");var o;return o="string"==typeof e?n+e+i:U.reduce(e,function(e,t){if(y(t)){var a=t.Count;"undefined"==typeof a&&(a=1);var r=t.FriendlyName;a>1&&(r=a+"x "+r),e+=n+r+i}return e},""),o.length&&(t||(o=o.substr(0,o.length-2)),o=a+o+r),o}function S(e){var t=e.Offers,n=e.EntitlementsGranted,i=[];if(null===t||void 0===t||!t.length)return"";for(var a=0,r=t.length;r>a;a++)for(var o=t[a].Entitlements,s=0,l=o.length;l>s;s++){var c=o[s];if(F.WriteDebugLog("getEntitlementsNotGrantedString","friendlyName",c.FriendlyName),y(c)){var u=U.filter(n,function(e){return e.EntitlementCode===c.EntitlementCode});u.length||i.push(c)}}return C(i,!0)}function y(e){return"undefined"==typeof e||"undefined"==typeof e.Visible||e.Visible}function w(e){return e&&e.replace(/ /g,"&nbsp;")}function _(e){var t="",n=e.Offers;if(void 0==n||0==n.length)return t;for(var i=0,a=n.length;a>i;i++)t+=n[i].OfferCode+", ";return t.replace(/,\s*$/,"")}function E(){}function k(e,t){if(O("#activationWrapper").removeData("voucherContentsRequested"),"undefined"==typeof e||"undefined"==typeof e.ErrorStringId){var n=j.getErrorWithCode(t);return q.showActivationError(n.Message,n.CodeDescription),void O("#activationCode").data("error",n.Message)}var i;i=isNaN(e.ErrorStringId)?j.getText(e.ErrorStringId,"Activation"):j.getText("i"+e.ErrorStringId,"Activation"),0===i.length&&(i=j.getError("ErrorActivate")),O("#activationCode").data("error",i),q.showActivationError(i)}function T(){return O("#activation").hasClass("redemption")}function I(e,t){F.WriteDllLog("RGSC_JS_VOUCHER_CONTENT_RESULT","jsonResult",t),"string"==typeof t&&(t=O.parseJSON(t||"null"));var n=O("#activation");n.removeData("offer");var i;if("undefined"!=typeof t&&(i=t.EntitlementsGranted),"undefined"==typeof t||!t.Result||"undefined"==typeof i){if("undefined"==typeof t){var a={iss:G.isSteam(),l:Y.titlelang};F.WriteDebugLog("RGSC_JS_VOUCHER_CONTENT_RESULT","Error: ",JSON.stringify(a)+Y.debugLog,F.logType.error,F.logController[Y.titleName]),Y.debugLog=""}var r=F.errorCode("7001.68");return k(t,r),void $.trackPage(T()?"/Store/CheckCodeFail":"/Activation/CheckCodeFail")}var o=t.EntitlementsGranted.length>0,s=L(t),l=j.getText("YouWillReceive","Activation");if(o){null!=t.Offers&&t.Offers.length&&(n.data("offer",s),n.data("offerCodes",_(t)));var c=U.any(t.EntitlementsGranted,y);c||(l=""),n.find("#buttonActivate").show()}else O("#activationWrapper").removeData("voucherContentsRequested"),l="";n.find("#buttonCheck").hide(),q.resetActivationForm(),O("#buttonActivate").focus(),R(l,s,t),E(t);var u=_(t);n.find("#formActivation").data("offerCodes",u),z.setCustomDimension(z.dimension.offerRedeemed,u),$.trackPage(T()?"/Store/CheckCodeSuccess":"/Activation/CheckCodeSuccess")}function R(e,t,n){var i=e.length?C(n.EntitlementsGranted,!0):"",a=S(n),r=O("#activation"),o=t.split("<br>"),s=o.length;if(s>0){var l=j.getText("ThisCodeUnlocks","Activation");r.find("#activationVoucherContents").append('<span class="unlock">'+l+"<ul></ul></span>");for(var c=0;s>c;c++)r.find("#activationVoucherContents ul").append("<li>"+o[c]+"</li>")}if(r.find("#activationVoucherContents").append('<span class="unlock">'+e+i+"</span>"),a.length){var u=j.getText("NotGrantedTitle","Activation");i.length||(u=j.getText("NotGrantedTitle2","Activation")),r.find("#activationVoucherContents").append('<span class="notGranted">'+u+a+"</span>")}r.find("#activationVoucherContents").show(),r.find("#activationCodeEntry").hide(),r.find("#buttonCancel").hide();var d=r.find("#buttonBackToCodeEntry");d.unbind("keyup").click(function(e){13==e.which&&O(this).visible()&&O(this).click()}),d.unbind("click").click(function(){A()}),d.show(),O("#activationContent").antiscroll()}function A(){var e=O("#activation"),t=e.find("#activationVoucherContents");t.empty(),t.hide(),e.find("#buttonActivate").hide(),e.find("#buttonBackToCodeEntry").hide(),e.find("#activationCodeEntry").show(),e.find("#buttonCheck").show(),e.find("#buttonCancel").show(),O("#activationWrapper").removeData("voucherContentsRequested"),O("#activationContent").antiscroll()}function L(e){var t="";if(null===e.Offers||!e.Offers.length)return t;if(!(e.Offers.length>1))return e.Offers[0].FriendlyName;for(var n=0,i=e.Offers.length;i>n;n++)t+=e.Offers[n].FriendlyName+"<br>";return t.length>2?t.substr(0,t.length-4):t}function P(e){var t=O("#activation").data("offer");return void 0!=t&&t.length||(t=C(e.EntitlementsGranted)),void 0!=t&&t.length||(t="Code"),t}function D(e,t){var n="";if(void 0!=e.ErrorStringId&&(n=isNaN(e.ErrorStringId)?j.getText(e.ErrorStringId,"Activation").replace("[content name]",t):j.getText("i"+e.ErrorStringId,"Activation").replace("[content name]",t)),0==n.length){var i=35;O("#activation").data("isActivation")||(i=36),n=j.getText("i"+i,"Activation").replace("[content name]",t)}return n}function x(e,t,n){if(O("#activation").data("isActivation"))if(void 0!=e.ErrorStringId&&e.ErrorStringId>41&&e.ErrorStringId<45)j.showMessagePanel(j.getText("Success","Register"),"&nbsp;",t);else if(void 0!=e.ContentId&&1==e.ContentId)j.showMessagePanel(j.getText("i35","Activation"),"&nbsp;",j.getText("YouHaveDLC","Activation").replace("[content name]",n));else{var i=M;j.showMessagePanel(j.getText("i35","Activation"),"&nbsp;",j.getText("i21","Activation").replace("[content name]",n),i)}else j.showMessagePanel(j.getText("CodeRedemption","Activation"),"&nbsp;",t,function(e){e.preventDefault(),O("#storeButton").click()})}function N(e,t){if("string"==typeof t&&(F.WriteDllLog("RGSC_JS_VOUCHER_CONSUME_RESULT","jsonResult string",t),t=O.parseJSON(t||"null")),A(),void 0==t||!t.Result){var n=F.errorCode("7001.70");return k(t,n),$.trackPage(T()?"/Store/ConsumeCodeFail":"/Activation/ConsumeCodeFail"),void q.ActivateCode(0)}var i=P(t),a=D(t,i);x(t,a,i),O("#buttonCancelMessage").hide(),O("#buttonCloseMessage").unbind("click").hide(),q.resetActivationForm();var r=O("#activation").find("#formActivation").data("offerCodes");z.setCustomDimension(z.dimension.offerRedeemed,r),$.trackPage(T()?"/Store/ConsumeCodeSuccess":"/Activation/ConsumeCodeSuccess")}function M(e){e&&e.preventDefault(),O("#activation").data("isActivation")?(q.ActivateCode(1),j.launcherNotifyEvent("Activate")):q.RedeemCode(1),j.clearActivePanel(function(){j.requestUiState(!1)})}var O=t("jquery"),U=t("underscore"),F=t("utils"),G=t("common/baseUtils"),V=t("common/profile/profile-utils"),j=t("setup.environment.utils"),W=t("common/datafunctions"),B=t("common/gamefunctions"),H=t("common/formvalidation"),q=t("common/entitlements/entitlements"),J=t("common/steam"),$=t("am"),z=t("common/am/customDimensions");t("common/jquery.visible"),"undefined"==typeof window.globals&&(window.globals={});var Y=window.globals,K={};return K.showActivation=function(e,t,l){if(F.WriteDebugLog("showActivation","jsonRequest, stateValue, subStateValue",JSON.stringify(e)+","+t+","+l),!j.isSignedIn())return void F.pubsub.trigger("signin.showSignin");if(a(e)||j.initHeaderMenu(!1),!e.Online||j.isOffline()||j.isLoadedInOfflineMode())return j.retryConnection(j.getText("OnlineRequired","Activation")),void setTimeout(function(){j.CallGameMethod("RGSC_UI_STATE_RESPONSE",'{ "Visible": true }',"RGSC_UI_STATE_RESPONSE_DEMO")},300);var h=O("#activation"),p=O("#activationContent");h.addClass("pending"),A(),h.hasClass("localized")||(h.find("[rel*=localize]").localize("Activation",{language:Y.titlelang,pathPrefix:Y.baseAssetUrl+"xml/Shared"}),h.addClass("localized"));var m=!0;h.find("#lblActivation").html(""),h.find("#activationDesc").html(""),q.resetActivationForm(),h.find("#ContentId").val(void 0!=e.Data&&void 0!=e.Data.ContentId?e.Data.ContentId:""),h.find(".requestCode").hide(),h.find("#buttonDeactivate").hide(),H.clearErrorClasses(),O("div.errorText:not(.emailerror,.nickerror), div.errorCode").remove();var g=h.find("#activationCode"),v=g.data("error");switch("undefined"!=typeof v&&(F.WriteDebugLog("showActivation","displaying previous error",v),q.showActivationError(v),g.removeData("error")),l){case"REDEMPTIONCODE":case"MAIN":var b=n();if(g.val(void 0!=e.Data&&void 0!=e.Data.CurrentSerialNumber?e.Data.CurrentSerialNumber:""),"MAIN"==l){var C=j.getText("i20","Activation");if(h.find(".title").text(C),h.find("#buttonActivate").text(C),F.isLegacyServiceLayer())h.find("#activationDesc").html(j.getText("ActivationDesc","Activation").replace("[content name]","<span class='purple'>"+w(Y.titleDisplayName)+"</span>").replace("[Nickname]","<span class='purple'>"+b+"</span>"));else if(h.find("label[for=activationCode]").html(j.getText("ActivationUser","Activation").replace("[Nickname]","<span class='purple'>"+b+"</span>")),h.find("#activationDesc").html(j.getText("ActivationUserDesc","Activation").replace("[Nickname]","<span>"+b+"</span>")+O("#activationDesc").text()),p.find(".message").html(j.getText("i19","Activation").replace("[content name]","<span class='purple'>"+w(Y.titleDisplayName)+"</span>")),F.isActLglEnabled()){var S=j.getText("Gta5LegalText","General","","gta5"),y=j.getText("Gta5LegalCheckbox","General","","gta5");h.find("#legalText1").text(S).show();var _=h.find("#legalActivation");_.find("#legalText2").text(y).show(),_.show()}$.trackPage("/Activation/CodeEntry")}else"REDEMPTIONCODE"==l&&(h.find(".title").text(j.getText("CodeRedemption","Activation")),h.find("label[for=activationCode]").text(j.getText("RedemptionCode","Activation")),h.find("#activationDesc").html(j.getText("RedemptionUserDesc","Activation").replace("[Nickname]","<span>"+b+"</span>")+O("#activationDesc").text()),h.find("#buttonActivate").text(j.getText("Redeem","Activation")),p.find(".message").html(j.getText("i41","Activation").replace("[content name]","<span class='purple'>"+w(Y.titleDisplayName)+"</span>")),F.isActLglEnabled()&&(h.find(".legal").hide(),h.find("#legalActivation").hide(),h.find("#redemptionCodeLegal").html(j.getText("RedemptionCodeLegal","Store")).show()),h.addClass("redemption"),$.trackPage("/Store/CodeRedemption"));h.find("#activationWrapper a").hide(),void 0!=e.Data&&void 0!=e.Data.IsAlreadyActivated&&e.Data.IsAlreadyActivated?(g.prop("disabled",!0).hide(),h.find("label[for=activationCode]").hide(),p.find(".message").text(j.getText("YouHaveDLC","Activation"))):(i(h),void 0!=e.Data&&void 0!=e.Data.ContentId&&1==e.Data.ContentId?(p.find(".message").text(j.getText("ActivateDLC","Activation").replace("[content name]",w(Y.titleDisplayName))),h.find("#activationDesc").html(j.getText("InstructionDLC","Activation").replace("[content name]",w(Y.titleDisplayName)))):(h.find("label[for=activationCode]").show(),void 0!=e.Data&&void 0!=e.Data.Message&&p.find(".message").html(j.getText("i"+e.Data.Message,"Activation").replace("[content name]","<span class='purple'>"+w(Y.titleDisplayName)+"</span>").replace("[Nickname]","<span class='purple'>"+b+"</span>"))),F.isEntitlementsV2Enabled()?s(h,l):o(h,l)),F.isLegacyServiceLayer()||O("div#headerLogin a").removeClass("disabled dimLayer"),r(h,l,e),"MAIN"!=l||F.isLegacyServiceLayer()||c(h);break;case"LICENSECORRUPTED":m=!1,u(h,e);break;case"LICENSERECOVERY":F.isLegacyServiceLayer()||c(h),d(h,e);break;case"LICENSEEXPIRATION":f(h,e)}return j.pendingAccountCompletion()?(V.showDOBPrompt(),void j.CallGameMethod("RGSC_UI_STATE_RESPONSE",'{ "Visible":'+(e.Visible?"true":"false")+" }","RGSC_UI_STATE_RESPONSE_DEMO")):(m&&!h.hasClass("active")&&(F.areChunkedVoucherCodesEnabled()||g.attr("placeholder",""),j.clearActivePanel(function(){j.setUpLoadingPanel("#activation",function(){p.antiscroll(),g.focus()})})),void(O("#linkSteam").is(":visible")&&(h.find(".inner").removeClass("noBackground"),p.show(),h.find("#linkSteam").hide())))},K.showActivationSteamSuccess=function(){if(j.isActivation()){var e=O("#activation");q.resetActivationForm(),e.find("#buttonActivate, #buttonDeactivate, #buttonQuitGame, #buttonCheck, #buttonCancel").hide(),e.find(".requestCode, #spanActivate, #spanDeactivate").hide(),j.setUpLoadingPanel("#activation");var t=j.getText("i43","Activation");e.find(".message").text(t),e.find("#linkSteamAccounts").hide(),j.initHeaderMenu(!0),e.find("#buttonActivateOk").off("click").on("click",function(){j.clearActivePanel(function(){j.requestUiState(!1)})}),e.find("#buttonActivateOk").show()}},K.showActivationSteamLink=function(e){if(F.WriteDebugLog("showActivationSteamLink","signedinJSON",JSON.stringify(e)),j.showHeaderMenu(),j.initHeaderMenu(!1),j.isOffline()||j.isLoadedInOfflineMode())return j.retryConnection(j.getText("OnlineRequired","Activation")),void setTimeout(function(){j.CallGameMethod("RGSC_UI_STATE_RESPONSE",'{ "Visible": true }',"RGSC_UI_STATE_RESPONSE_DEMO")},300);var t=O("#activation");if(t.addClass("pending"),j.pendingAccountCompletion())return V.showDOBPrompt(),void j.CallGameMethod("RGSC_UI_STATE_RESPONSE",'{ "Visible": true }',"RGSC_UI_STATE_RESPONSE_DEMO");t.hasClass("localized")||t.find("[rel*=localize]").localize("Activation",{language:Y.titlelang,pathPrefix:Y.baseAssetUrl+"xml/Shared"}),q.resetActivationForm(),t.find("#lblActivation, #activationDesc").html(""),t.find("#buttonDeactivate, #buttonQuitGame, #buttonCheck, .requestCode").hide(),t.find(".title").text(j.getText("SteamSetup","Activation")),t.find("#activationCode").prop("disabled",!0).hide(),t.find("label[for=activationCode]").hide(),t.find("#buttonActivate").hide(),t.find("#buttonActivateOk").show(),H.clearErrorClasses(),O("div.errorText:not(.emailerror,.nickerror), div.errorCode").remove();var n="";null!=Y.account&&(void 0!=Y.account.Nickname&&Y.account.Nickname.length>0?n=Y.account.Nickname:void 0!=Y.account.Email&&Y.account.Email.length>0&&(n=Y.account.Email)),h(t),t.find("#buttonActivateOk").unbind("click").click(function(){O(this).hasClass("disabled")||(O(this).addClass("disabled"),t.find("#buttonCancel").addClass("disabled"),O("#spanActivate").show(),J.BindSteamAccount(Y.steamAppId,Y.steamAuthTicket,e))}),t.find("#buttonCancel").show(),t.find("#buttonCancel").unbind("click").click(function(){O(this).hasClass("disabled")||j.clearActivePanel(function(){O("a.disabled:first").removeClass("disabled"),O("a.buttonSignIn.disabled").removeClass("disabled"),F.stopSpinner(O("div.buttonSignInWrapper span")).hide(),F.pubsub.trigger("signin.signOut")})}),t.hasClass("active")||j.clearActivePanel(function(){j.setUpLoadingPanel("#activation")})},F.pubsub.on("steam:showActivationSteamLink",K.showActivationSteamLink),F.pubsub.on("steam:showActivationSteamSuccess",K.showActivationSteamSuccess),F.pubsub.on("gamefunctions:showActivation",K.showActivation),G.pubsub.subscribe("SDK.RGSC_JS_ACTIVATION_RESULT",m),G.pubsub.subscribe("SDK.RGSC_JS_LICENSE_EXPIRATION_RESULT",g),G.pubsub.subscribe("SDK.RGSC_JS_LICENSE_RECOVERY_RESULT",v),G.pubsub.subscribe("SDK.RGSC_JS_REDEMPTION_RESULT",b),G.pubsub.subscribe("SDK.RGSC_JS_VOUCHER_CONTENT_RESULT",I),G.pubsub.subscribe("SDK.RGSC_JS_VOUCHER_CONSUME_RESULT",N),K}),define("common/sdk/v2_commerce",["require","jquery","utils","common/baseUtils","setup.environment.utils","common/modals/modal-views"],function(e){function t(e,t){r.WriteDllLog("RGSC_JS_CHECKOUT_URL_REQUEST_RESULT","jsonResponse",t);var n=a.parseJSON(t||"null");if(null==n||!n.Result||void 0==n.Url){if(r.WriteDebugLog("RGSC_JS_CHECKOUT_URL_REQUEST_RESULT","failed",JSON.stringify(t),r.logType.error,r.logController[globals.titleName]),!s.isActivePanel("#storev2Panel"))return;var i=r.errorCode("7000.64"),o=s.getErrorWithCode(i,"RGSC_JS_CHECKOUT_URL_REQUEST_RESULT").Message;return void s.showGenericFatalError(i,o)}r.pubsub.trigger("gamefunctions:checkoutUrl",n)}function n(e,t){r.WriteDllLog("RGSC_JS_INSTALL_PRODUCT_RESULT","jsonstring",t);var n=a.parseJSON(t||"null");if("undefined"==typeof n||!n.Result){var i=r.errorCode("7000.90"),o=s.getErrorWithCode(i);l.ShowErrorModal({errorCode:i,message:o.Message,supportText:o.SupportText,errorCodeDesc:o.CodeDescription})}}function i(e,t){var n=window.amd.store.StoreView;if("undefined"!=typeof n&&n.model.isSimplifiedCommerce()){try{var i=a.parseJSON(t||"null")}catch(r){i=a.parseJSON(t.replace(/\\\\\"/g,"'")||"null")}"undefined"!=typeof i&&i.Manifest&&(i=a.parseJSON(i.Manifest)),n.model.getCommerceCatalogSuccess(i)}}var a=e("jquery"),r=e("utils"),o=e("common/baseUtils"),s=e("setup.environment.utils"),l=e("common/modals/modal-views"),c={};return o.pubsub.subscribe("SDK.RGSC_JS_CHECKOUT_URL_REQUEST_RESULT",t),o.pubsub.subscribe("SDK.RGSC_JS_INSTALL_PRODUCT_RESULT",n),o.pubsub.subscribe("SDK.RGSC_JS_COMMERCE_MANIFEST_REQUEST_RESULT",i),c}),define("common/sdk/v2_friends",["require","jquery","underscore","utils","common/baseUtils","setup.environment.utils","common/datafunctions.friends","common/profile/profile-views","common/profile/profile-models","common/modals/modal-views","common/am/socialCount","jquery.localize"],function(e){function t(e,t){if(w.WriteDllLog("RGSC_JS_PLAYER_LIST_RESPONSE","jsonFriendList",t),t=S.parseJSON(t||"null")){var n=t.PageIndex;("undefined"==typeof t.Total||0===t.Total)&&(t.Total="");var i,a=t.PlayerListType;switch(a){case 4:i=S("#friendInvitesList"),S("#friendInvitesLink span.count").html(t.Total);break;case 8:if(i=S("#blockListPlayercards"),0===n){("undefined"==typeof t.Total||""===t.Total)&&(t.Total=0);var r=S("#blockedUsersHeader");0==t.Total?(r.find(".noBlockedUsers").show(),r.find(".blockInfo").show(),r.show()):(S("#blockListLink span.count").html(t.Total),r.find(".noBlockedUsers").hide(),r.find(".blockInfo").show(),r.show())}break;case 99:i=S("#findFriendsList");break;default:i=S("#friendsList"),S("#myFriendsLink span.count").html(t.Total),A.setSocialCountTotals(-1,t.Total)}if(i.data("total",t.Total),("undefined"==typeof n||0===n)&&i.empty(),t.Count>0){w.WriteDebugLog("RGSC_JS_PLAYER_LIST_RESPONSE","listType",a);var o=g(t.Players,a,n),s={collection:new I.FriendCollection(o),model:new I.ProfileCard(y.extend(o[0])),el:"#"+i.attr("id")};
v(a,o,n,s),i.parent().find("div.content").removeAttr("style"),i.show()}else i.parent().find("div.content").removeAttr("style"),99===a&&0===i.find("div.profileButton").length?i.append('<div class="emptyContainer"><p rel="localize[NoSearchResults]">Sorry. Your search returned no results.</p></div>'):4===a?p(null,i):3===a&&m(null,i);switch(i.find("[rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),a){case 8:E.removeLoading("editProfile"),S("#editProfileContainer").data("antiscroll").refresh();break;case 99:E.removeLoading("friendsPanel"),E.resetScrollbar("#friendsPanel");break;default:E.removeLoading("friendsPanel"),t&&void 0!=t.Success&&0==t.Success&&void 0!==i&&i.append("<tr><td>"+E.getError("InternetAccess")+"</td></tr>"),S("#friendsContainer").data("antiscroll").refresh()}}}function n(e,t){w.WriteDllLog("RGSC_JS_PLAYER_LIST_MINI_RESPONSE","jsonFriendList",t),t=S.parseJSON(t||"null");var n="",i=S("#compareSelectList").empty();t.Count>0?(S.each(t.Players,function(e,t){var i='<li><a data-userid="'+t.RockstarId+'">'+t.DisplayName+"</a></li>";n+=i}),i.append(n)):i.append("<li>"+E.getText("NoFriends","Social")+"</li>")}function i(e,t){w.WriteDllLog("RGSC_JS_FRIEND_SEND_INVITE_RESULT","jsonResponse",t);try{t=S.parseJSON(t||"null")}catch(n){t=!1}if(!t||!t.Success)return t&&0!=t.ResultCode&&C(t.ResultCode),void S("#friendsContainer").find(".friend.add.addFriend").removeClass("disabled");var i=t.RockstarId,a=k.getNicknameAsync(i);a.done(function(e){var t=JSON.parse(e),n=S("div.panel.active"),a=n.find("div.profileButton[data-id='"+i+"']");E.updateUIAFterFriendInviteSent(i,t,a);var r=E.getText("Cancel","Social");a.find(".options").prepend('<a class="optionCancelInvite btn btnGrey btnSmall"><span>'+r+"</span></a>")}),a.fail(function(e,t,n){w.WriteDebugLog("RGSC_JS_FRIEND_SEND_INVITE_RESULT.GetNickname","ERROR",n),w.WriteDebugLog("RGSC_JS_FRIEND_SEND_INVITE_RESULT.GetNickname","ERROR status",t),w.WriteDebugLog("RGSC_JS_FRIEND_SEND_INVITE_RESULT.GetNickname","ERROR responseText",e.responseText,w.logType.error,w.logController.friend)})}function a(e,t){if(w.WriteDllLog("RGSC_FRIEND_DECLINE_INVITE_RESULT","jsonResponse",t),t=S.parseJSON(t||"null"),!t)return void C();var n=t.RockstarId,i=k.getNicknameAsync(n);i.done(function(e){var n=JSON.parse(e);S("#friendsPanel #friendInvitesList").find("div.profileButton[data-id='"+t.RequestId+"']").remove(),E.UpdateSocialSideMenuCount("subtract","#friendInvitesLink",!1),w.pubsub.trigger("gameFnFriends:UpdateFriendStatus_"+t.RockstarId,{RockstarId:t.RockstarId,Relationship:0}),b(E.getText("FriendInviteDeclined","Social"),n)}),i.fail(function(e,t,n){w.WriteDebugLog("RGSC_JS_FRIEND_DECLINE_INVITE_RESULT.GetNickname","ERROR",n),w.WriteDebugLog("RGSC_JS_FRIEND_DECLINE_INVITE_RESULT.GetNickname","ERROR status",t),w.WriteDebugLog("RGSC_JS_FRIEND_DECLINE_INVITE_RESULT.GetNickname","ERROR responseText",e.responseText,w.logType.error,w.logController.friend)})}function r(e,t){if(w.WriteDllLog("RGSC_JS_FRIEND_ACCEPT_INVITE_RESULT","jsonResponse",t),t=S.parseJSON(t||"null"),!t||!t.Success)return w.WriteDebugLog("RGSC_JS_FRIEND_ACCEPT_INVITE_RESULT","Success",t.Success),void(t&&0!=t.ResultCode&&C(t.ResultCode));var n=t.RockstarId,i=k.getNicknameAsync(n);i.done(function(e){var n=JSON.parse(e);w.pubsub.trigger("gameFnFriends:UpdateFriendStatus_"+t.RockstarId,{RockstarId:t.RockstarId,Relationship:6});var i=S("#friendsPanel");if(i.hasClass("active")){E.UpdateSocialSideMenuCount("add","#myFriendsLink",!0);var a=E.UpdateSocialSideMenuCount("subtract","#friendInvitesLink",!1);0===a&&i.hasClass("friendInvites")?S("#myFriendsLink").click():i.find("#friendInvitesList .profileButton[data-id='"+t.RockstarId+"']").remove(),b(E.getText("FriendInviteAccepted","Social"),n)}}),i.fail(function(e,t,n){w.WriteDebugLog("RGSC_JS_FRIEND_ACCEPT_INVITE_RESULT.GetNickname","ERROR",n),w.WriteDebugLog("RGSC_JS_FRIEND_ACCEPT_INVITE_RESULT.GetNickname","ERROR status",t),w.WriteDebugLog("RGSC_JS_FRIEND_ACCEPT_INVITE_RESULT.GetNickname","ERROR responseText",e.responseText,w.logType.error,w.logController.friend)})}function o(e,t){w.WriteDllLog("RGSC_JS_GAME_INVITE_SEND_RESULT","jsonResponse",t),t=S.parseJSON(t||"null");var n=t.RockstarId,i=k.getNicknameAsync(n);i.done(function(e){var n=JSON.parse(e);t&&void 0!=t.Success&&t.Success?b(E.getText("GameInviteSent","Social"),n):b(E.getText("GameInviteFail","Social"),n)}),i.fail(function(e,t,n){w.WriteDebugLog("RGSC_JS_GAME_INVITE_SEND_RESULT.GetNickname","ERROR",n),w.WriteDebugLog("RGSC_JS_GAME_INVITE_SEND_RESULT.GetNickname","ERROR status",t),w.WriteDebugLog("RGSC_JS_GAME_INVITE_SEND_RESULT.GetNickname","ERROR responseText",e.responseText,w.logType.error,w.logController.friend)})}function s(e,t){w.WriteDllLog("RGSC_JS_JOIN_VIA_PRESENCE_RESULT","jsonResponse",t),t=S.parseJSON(t||"null");var n=t.RockstarId,i=k.getNicknameAsync(n);i.done(function(e){var n=JSON.parse(e);t&&void 0!=t.Success&&t.Success?b(E.getText("JoinGameSent","Social"),n):b(E.getText("JoinGameFail","Social"),n)}),i.fail(function(e,t,n){w.WriteDebugLog("RGSC_JS_JOIN_VIA_PRESENCE_RESULT.GetNickname","ERROR",n),w.WriteDebugLog("RGSC_JS_JOIN_VIA_PRESENCE_RESULT.GetNickname","ERROR status",t),w.WriteDebugLog("RGSC_JS_JOIN_VIA_PRESENCE_RESULT.GetNickname","ERROR responseText",e.responseText,w.logType.error,w.logController.friend)})}function l(e,t){if(w.WriteDllLog("RGSC_JS_FRIEND_DELETE_FRIEND_RESULT","jsonResponse",t),S("#friendProfilePanel").find("a.backFriendLink").click(),t=S.parseJSON(t||"null"),!t||!t.Success)return void(t&&0!=t.ResultCode&&C(t.ResultCode));var n=t.RockstarId,i=k.getNicknameAsync(n);i.done(function(e){var n=JSON.parse(e);w.pubsub.trigger("gameFnFriends:UpdateFriendStatus_"+t.RockstarId,{RockstarId:t.RockstarId,Relationship:0}),S("#friendsList").find("div.profileButton[data-id='"+t.RequestId+"']").remove(),b(E.getText("FriendRemoved","Social"),n),E.UpdateSocialSideMenuCount("subtract","#myFriendsLink",!0)}),i.fail(function(e,t,n){w.WriteDebugLog("RGSC_JS_FRIEND_DELETE_FRIEND_RESULT.GetNickname","ERROR",n),w.WriteDebugLog("RGSC_JS_FRIEND_DELETE_FRIEND_RESULT.GetNickname","ERROR status",t),w.WriteDebugLog("RGSC_JS_FRIEND_DELETE_FRIEND_RESULT.GetNickname","ERROR responseText",e.responseText,w.logType.error,w.logController.friend)})}function c(e,t){if(w.WriteDllLog("RGSC_JS_FRIEND_CANCEL_INVITE_RESULT","jsonResponse",t),S("#friendProfilePanel").find("a.backFriendLink").click(),t=S.parseJSON(t||"null"),!t||!t.Success)return void(t&&0!=t.ResultCode&&C(t.ResultCode));var n=t.RockstarId,i=k.getNicknameAsync(n);i.done(function(e){var t=JSON.parse(e);E.updateUIAFterFriendCancelInviteSent(n,t)}),i.fail(function(e,t,n){w.WriteDebugLog("RGSC_JS_FRIEND_CANCEL_INVITE_RESULT.GetNickname","ERROR",n),w.WriteDebugLog("RGSC_JS_FRIEND_CANCEL_INVITE_RESULT.GetNickname","ERROR status",t),w.WriteDebugLog("RGSC_JS_FRIEND_CANCEL_INVITE_RESULT.GetNickname","ERROR responseText",e.responseText,w.logType.error,w.logController.friend)})}function u(e,t){w.WriteDllLog("RGSC_JS_FRIEND_BLOCK_PLAYER_RESULT","jsonResponse",t),S("#friendProfilePanel").find("a.backFriendLink").click(),t=S.parseJSON(t||"null");var n=t.RockstarId,i=k.getNicknameAsync(n);i.done(function(e){var n=JSON.parse(e);t&&void 0!=t.Success&&t.Success?b(E.getText("PlayerBlocked","Social"),n):b(E.getText("PlayerBlockFail","Social"),n)}),i.fail(function(e,t,n){w.WriteDebugLog("RGSC_JS_FRIEND_BLOCK_PLAYER_RESULT.GetNickname","ERROR",n),w.WriteDebugLog("RGSC_JS_FRIEND_BLOCK_PLAYER_RESULT.GetNickname","ERROR status",t),w.WriteDebugLog("RGSC_JS_FRIEND_BLOCK_PLAYER_RESULT.GetNickname","ERROR responseText",e.responseText,w.logType.error,w.logController.friend)})}function d(e,t){if(w.WriteDllLog("RGSC_JS_FRIEND_UNBLOCK_PLAYER_RESULT","jsonResponse",t),t=S.parseJSON(t||"null"),!t||!t.Success)return void(t&&0!=t.ResultCode&&C(t.ResultCode));var n=t.RockstarId,i=k.getNicknameAsync(n);i.done(function(e){var t=JSON.parse(e),i=S("#blockListPlayercards").find("div.profileButton[data-id='"+n+"']");i.remove(),b(E.getText("PlayerUnBlocked","Social"),t),w.pubsub.trigger("gameFnFriends:UpdateFriendStatus_"+n,{RockstarId:n,Relationship:0});var a=S("#blockListLink span.count"),r=parseInt(a.html(),10)-1;a.html(r>0?r:"")}),i.fail(function(e,t,n){w.WriteDebugLog("RGSC_JS_FRIEND_UNBLOCK_PLAYER_RESULT.GetNickname","ERROR",n),w.WriteDebugLog("RGSC_JS_FRIEND_UNBLOCK_PLAYER_RESULT.GetNickname","ERROR status",t),w.WriteDebugLog("RGSC_JS_FRIEND_UNBLOCK_PLAYER_RESULT.GetNickname","ERROR responseText",e.responseText,w.logType.error,w.logController.friend)})}function f(e,t){if(w.WriteDllLog("RGSC_JS_PLAYER_LIST_COUNTS_RESPONSE","jsonResponse",t),t=S.parseJSON(t||"null")){w.WriteDebugLog("RGSC_JS_PLAYER_LIST_COUNTS_RESPONSE","jsonResponse.NumFriends",t.NumFriends);var n=t.NumFriends>0?t.NumFriends:"",i=t.NumInvitesReceieved>0?t.NumInvitesReceieved:"",a=t.NumGameInvites>0?t.NumGameInvites:"",r=t.NumBlocked>0?t.NumBlocked:"";E.updatePlayerListCounts(n,i,a,r),"true"!==S("#menuMessages").attr("countRetrieved")&&k.GetAccountActivity(globals.account.RockstarId),S("#friendsPanel").attr("countsRetrieved",!0)}}function h(e,t){w.WriteDllLog("RGSC_JS_PLAYER_INFO_RESPONSE","jsonResponse",t);try{t=S.parseJSON(t||"null");var n;t.IsOnline?(n='<span title="online" class="status"></span><span class="title">'+E.getText("NowPlaying","Social")+"</span>",void 0!=t.IsPlayingSameTitle&&t.IsPlayingSameTitle&&(n+=" "+titleDisplayName),S("#friendProfile").removeClass("offline").addClass("online")):(n='<span title="offline" class="status"></span><span class="title">'+E.getText("Offline","Social")+"</span>",S("#friendProfile").removeClass("online").addClass("offline")),S("#friendProfileHead .nowPlaying").html(n)}catch(i){w.WriteDebugLog("RGSC_JS_PLAYER_INFO_RESPONSE","error",i.message,w.logType.error,w.logController[globals.titleName])}}function p(e,t){t.append('<div id="noFriendInvites" class="emptySocial"><p rel="localize[NoFriendInvites]">No pending friend invites</p><span></span><a class="btn btnPurple" href="#" rel="localize[FindFriends]">Find friends</a></div>'),S("#noFriendInvites [rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),S("#noFriendInvites.emptySocial .btn").click(function(){S("#findPlayerLink").click()})}function m(e,t){t.append('<div id="noFriends" class="emptySocial"><p rel="localize[NoFriendsAdded]">No friends added yet</p><span></span><a class="btn btnPurple" href="#" rel="localize[FindFriends]">Find friends</a></div>'),S("#noFriends [rel*=localize]").localize("Social",{language:globals.titlelang,pathPrefix:globals.baseAssetUrl+"xml/Shared"}),S("#noFriends.emptySocial .btn").click(function(){S("#findPlayerLink").click()})}function g(e,t,n){var i=0,a=e.length;if(4==t){var r=20;n>0&&(i=r*n),a=i+20}return e.slice(i,a)}function v(e,t,n,i){var a=window.amd.friends;switch(e){case 4:y.extend(i,{activePanel:"friendsPanel"}),void 0==a.FriendInvitesView?a.FriendInvitesView=new T.ProfileFriendsView(i):n>0?a.FriendInvitesView.collection.push(t):a.FriendInvitesView.collection.reset(t);break;case 8:y.extend(i,{activePanel:"editProfile"}),void 0==a.BlockedPlayersView?a.BlockedPlayersView=new T.ProfileFriendsView(i):n>0?a.BlockedPlayersView.collection.push(t):a.BlockedPlayersView.collection.reset(t);break;case 99:y.extend(i,{activePanel:"friendsPanel"}),void 0==a.FriendSearchView?a.FriendSearchView=new T.ProfileFriendsView(i):n>0?a.FriendSearchView.collection.push(t):a.FriendSearchView.collection.reset(t);break;default:y.extend(i,{activePanel:"friendsPanel"}),void 0==a.MyFriendsView?a.MyFriendsView=new T.ProfileFriendsView(i):n>0?a.MyFriendsView.collection.push(t):a.MyFriendsView.collection.reset(t)}}function b(e,t){var n=e.replace("[PlayerNickname]","<strong><em> "+t+" </em></strong>");_.pubsub.publish("notificationFn.infoMessage",n)}function C(e){w.WriteDebugLog("showError","errorCode",e);var t,n=typeof e;"undefined"!==n&&"400"===e?t=w.errorCodeLocKey(w.errorCode("8000")):"undefined"!==n&&(t=y.findKey(P,function(t){return t===e})),"undefined"==typeof t&&(t="GenericFriendActionError"),R.ShowErrorModal({errorCode:"",message:E.getError(t)})}var S=e("jquery"),y=e("underscore"),w=e("utils"),_=e("common/baseUtils"),E=e("setup.environment.utils"),k=e("common/datafunctions.friends"),T=e("common/profile/profile-views"),I=e("common/profile/profile-models"),R=e("common/modals/modal-views"),A=e("common/am/socialCount");e("jquery.localize");var L={},P={RL_SC_FRIENDS_ERR_AUTHENTICATION_FAILED:1,RL_SC_FRIENDS_ERR_INVITE_DOES_NOT_EXIST:6,RL_SC_FRIENDS_ERR_INVITER_FRIEND_LIMIT_REACHED:7,RL_SC_FRIENDS_ERR_INVITEE_FRIEND_LIMIT_REACHED:8,RL_SC_FRIENDS_ERR_FRIEND_INVITE_BLOCKED:9,RL_SC_FRIENDS_ERR_ALREADY_FRIENDS:10,RL_SC_FRIENDS_ERR_ALREADY_BLOCKED:13,RL_SC_FRIENDS_ERR_BLOCKER_FRIEND_LIMIT_REACHED:14,RL_SC_FRIENDS_ERR_FRIEND_INVITE_DOES_NOT_EXIST:15,RL_SC_FRIENDS_ERR_INVALID_INVITEE_ID:17,RL_SC_FRIENDS_ERR_PENDING_SENT_LIMIT_REACHED:18,RL_SC_FRIENDS_ERR_FRIEND_INVITE_EXISTS:20,RL_SC_FRIENDS_ERR_FRIEND_DOES_NOT_EXIST:21,RL_SC_FRIENDS_ERR_BLOCK_DOES_NOT_EXIST:22};return _.pubsub.subscribe("SDK.RGSC_JS_PLAYER_LIST_RESPONSE",t),_.pubsub.subscribe("SDK.RGSC_JS_PLAYER_LIST_MINI_RESPONSE",n),_.pubsub.subscribe("SDK.RGSC_JS_FRIEND_SEND_INVITE_RESULT",i),_.pubsub.subscribe("SDK.RGSC_JS_FRIEND_DECLINE_INVITE_RESULT",a),_.pubsub.subscribe("SDK.RGSC_JS_FRIEND_ACCEPT_INVITE_RESULT",r),_.pubsub.subscribe("SDK.RGSC_JS_GAME_INVITE_SEND_RESULT",o),_.pubsub.subscribe("SDK.RGSC_JS_JOIN_VIA_PRESENCE_RESULT",s),_.pubsub.subscribe("SDK.RGSC_JS_FRIEND_DELETE_FRIEND_RESULT",l),_.pubsub.subscribe("SDK.RGSC_JS_FRIEND_CANCEL_INVITE_RESULT",c),_.pubsub.subscribe("SDK.RGSC_JS_FRIEND_BLOCK_PLAYER_RESULT",u),_.pubsub.subscribe("SDK.RGSC_JS_FRIEND_UNBLOCK_PLAYER_RESULT",d),_.pubsub.subscribe("SDK.RGSC_JS_PLAYER_LIST_COUNTS_RESPONSE",f),_.pubsub.subscribe("SDK.RGSC_JS_PLAYER_INFO_RESPONSE",h),_.pubsub.subscribe("friendFn.handlePlayerListResponse",t),_.pubsub.subscribe("friendFn.showNoFriendInvites",p),_.pubsub.subscribe("friendFn.showNoFriends",m),L}),define("common/sdk/v2_init",["require","jquery","domReady","utils","common/baseUtils","setup.environment","common/datafunctions","common/sdk"],function(e){function t(){return s.WriteDllLog("RGSC_JS_PING"),window.cssErr?(d.CallGameMethod("RGSC_PAGE_LOAD_ERROR",'{ "Reason": "cssError" }',"RGSC_PAGE_LOAD_ERROR_DEMO"),void s.WriteDebugLog("RGSC_JS_PING","Error","CSS load error",s.logType.error,s.logController[globals.titleName])):void d.CallGameMethod("RGSC_PONG",null,"RGSC_PONG_DEMO")}function n(){if(window.cssErr)return d.CallGameMethod("RGSC_PAGE_LOAD_ERROR",'{ "Reason": "cssError" }',"RGSC_PAGE_LOAD_ERROR_DEMO"),void s.WriteDebugLog("RGSC_JS_READY_TO_ACCEPT_COMMANDS","Error","CSS load error",s.logType.error,s.logController[globals.titleName]);s.WriteDllLog("RGSC_JS_READY_TO_ACCEPT_COMMANDS");var e=u.SetGameTitleAsync();e.then(function(){s.WriteDebugLog("RGSC_JS_READY_TO_ACCEPT_COMMANDS","Game Title Set"),o(function(){setTimeout(function(){s.WriteDebugLog("RGSC_JS_READY_TO_ACCEPT_COMMANDS","DOM ready"),d.CallGameMethod("RGSC_READY_TO_ACCEPT_COMMANDS",null,"RGSC_READY_TO_ACCEPT_COMMANDS_DEMO")},10)})},function(){s.WriteDebugLog("RGSC_JS_READY_TO_ACCEPT_COMMANDS","Error","Set Game Title Failed",s.logType.error,s.logController[globals.titleName])})}function i(){s.WriteDllLog("RGSC_JS_INTERNET_CONNECTED_STATE_CHANGED","","")}function a(e,t){s.WriteDllLog("RGSC_JS_NETWORK_CHANGE","jsonString",t),t=r.parseJSON(t||"null"),c.processNetworkStatusChange(t)}var r=e("jquery"),o=e("domReady"),s=e("utils"),l=e("common/baseUtils"),c=e("setup.environment"),u=e("common/datafunctions"),d=e("common/sdk"),f={};return l.pubsub.subscribe("SDK.RGSC_JS_PING",t),l.pubsub.subscribe("SDK.RGSC_JS_READY_TO_ACCEPT_COMMANDS",n),l.pubsub.subscribe("SDK.RGSC_JS_INTERNET_CONNECTED_STATE_CHANGED",i),l.pubsub.subscribe("SDK.RGSC_JS_NETWORK_CHANGE",a),f}),define("hbs!common/templates/ime/ime_suggestions",["hbs","common/hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,i,a){function r(e,t){var i,a,r,s="";return s+="\r\n			<li ",r={hash:{},inverse:d.noop,fn:d.program(2,o,t)},(a=n.active)?i=a.call(e,r):(a=e&&e.active,i=typeof a===f?a.call(e,r):a),n.active||(i=h.call(e,i,{hash:{},inverse:d.noop,fn:d.program(2,o,t)})),(i||0===i)&&(s+=i),s+="> ",(a=n.id)?i=a.call(e,{hash:{}}):(a=e&&e.id,i=typeof a===f?a.call(e,{hash:{}}):a),s+=p(i)+": ",(a=n.candidate)?i=a.call(e,{hash:{}}):(a=e&&e.candidate,i=typeof a===f?a.call(e,{hash:{}}):a),s+=p(i)+" </li>\r\n			"}function o(){return' class="ime-active" '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s,l,c,u="",d=this,f="function",h=n.blockHelperMissing,p=this.escapeExpression;return u+='<div id="js-ime-suggestions-container" class="ime-container">\r\n	<div class="ime-suggestions">\r\n		<input type="text" class="js-ime-input" value="',(l=n.val)?s=l.call(t,{hash:{}}):(l=t&&t.val,s=typeof l===f?l.call(t,{hash:{}}):l),u+=p(s)+'" />\r\n		<ul>\r\n			',c={hash:{},inverse:d.noop,fn:d.program(1,r,a)},(l=n.candidates)?s=l.call(t,c):(l=t&&t.candidates,s=typeof l===f?l.call(t,c):l),n.candidates||(s=h.call(t,s,{hash:{},inverse:d.noop,fn:d.program(1,r,a)})),(s||0===s)&&(u+=s),u+="\r\n		</ul>\r\n	</div>\r\n</div>"});return n}),define("common/ime/ime-views",["jquery","backbone","underscore","hbs!common/templates/ime/ime_suggestions"],function(e,t,n,i){var a={};return a.SuggestionsView=t.View.extend({initialize:function(e){n.bindAll(this,"render","cleanup","updateParent"),this.$inputEl=e.$inputEl,this.$inputEl.attr("data-ime-composition","true"),this.$inputEl.addClass("ime-active-input-highlight"),this.$inputEl.parent(".js-ime-wrapper").append(this.$el),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"update:parent",this.updateParent),this.listenTo(this.model,"cleanup",this.cleanup),this.render()},render:function(){var e=i(this.model.toJSON());this.$el.html(e)},updateParent:function(){var e=this.$inputEl.val();this.$inputEl.val(e+this.model.get("val"))},cleanup:function(){this.undelegateEvents(),this.stopListening(),this.$inputEl.removeClass("ime-active-input-highlight"),this.$inputEl.removeClass("js-ime-input-ready"),this.$inputEl.removeAttr("data-ime-composition"),this.$el.remove()}}),a}),function(e){function t(t){return l?t.data("events"):e._data(t[0]).events}function n(e,n,i){var a=t(e),r=a[n];if(!l){var o=i?r.splice(r.delegateCount-1,1)[0]:r.pop();return void r.splice(i?0:r.delegateCount||0,0,o)}i?a.live.unshift(a.live.pop()):r.unshift(r.pop())}function i(t,i,a){var r=i.split(/\s+/);t.each(function(){for(var t=0;t<r.length;++t){var i=e.trim(r[t]).match(/[^\.]+/i)[0];n(e(this),i,a)}})}function a(t){e.fn[t+"First"]=function(){var n=e.makeArray(arguments),a=n.shift();return a&&(e.fn[t].apply(this,arguments),i(this,a)),this}}var r=e.fn.jquery.split("."),o=parseInt(r[0]),s=parseInt(r[1]),l=1>o||1==o&&7>s;a("bind"),a("one"),e.fn.delegateFirst=function(){var t=e.makeArray(arguments),n=t[1];return n&&(t.splice(0,2),e.fn.delegate.apply(this,arguments),i(this,n,!0)),this},e.fn.liveFirst=function(){var t=e.makeArray(arguments);return t.unshift(this.selector),e.fn.delegateFirst.apply(e(document),t),this},l||(e.fn.onFirst=function(t,n){var a=e(this),r="string"==typeof n;if(e.fn.on.apply(a,arguments),"object"==typeof t)for(type in t)t.hasOwnProperty(type)&&i(a,type,r);else"string"==typeof t&&i(a,t,r);return a})}(jQuery),define("jquery.bind.first",["jquery"],function(e){return function(){var t;return t||e.$}}(this)),define("common/ime/ime-system",["jquery","underscore","backbone","common/ime/ime-views","jquery.bind.first"],function(e,t,n,i){function a(e){if(e.eventName===m.notify&&"IMN_CHANGECANDIDATE"===e.eventParam){var n=t.map(e.candidates,function(e,t){return{candidate:e,id:t+1,active:h.get("val")===e}});h.set("candidates",n)}e.eventName===m.notify&&"IMN_CLOSECANDIDATE"===e.eventParam&&h.set("candidates",[])}function r(){l()}function o(t){13===t.which&&(e(this).off(t),t.stopImmediatePropagation(),e(this).keyup())}function s(e){h=new p,f=new i.SuggestionsView({$inputEl:e,model:h}),e.one("focusout",r),e.onFirst("keyup",o)}function l(){h.clear(),h.trigger("cleanup")}function c(e){e.off("focusout",r)}function u(e,n){if(n.hasClass("js-ime-input-ready")||(d.attachTo(n),n.addClass("js-ime-input-ready")),e.CompositionOpen){var i=t.find([m.startComposition,m.compositionInProgress],function(t){return t===e.Event});i&&(t.has(e,"Composition")?h.set("val",e.Composition):t.has(e,"Result")&&(h.set("val",e.Result),h.trigger("update:parent")))}a({eventName:e.Event,eventParam:e.Param,candidates:e.Candidates}),e.Event===m.endComposition&&(l(),c(n))}var d={},f=null,h=null,p=n.Model.extend({defaults:{candidates:[],val:""}}),m={startComposition:"WM_IME_STARTCOMPOSITION",compositionInProgress:"WM_IME_COMPOSITION",endComposition:"WM_IME_ENDCOMPOSITION",notify:"WM_IME_NOTIFY"};return d.attachTo=s,d.detach=l,d.notifyEvent=u,d}),define("common/sdk/v2_input",["require","jquery","utils","common/baseUtils","underscore","setup.environment.utils","common/modals/modal-views","common/ime/ime-system","common/virtualKeyboard"],function(e){function t(e,t){o.WriteDllLog("RGSC_JS_SET_INPUT_METHOD","jsonString",t);var n=r.parseJSON(t||"null");void 0!=n&&void 0!=n.InputMethod&&(globals.inputMethod=n.InputMethod,s.inGamePadMode()||o.pubsub.trigger("virtualKeyboard",!1),o.pubsub.trigger("setCloseInstructions"))}function n(){o.WriteDllLog("RGSC_JS_SHOW_VIRTUAL_KEYBOARD"),o.pubsub.trigger("virtualKeyboard",!0)}function i(e,t){o.WriteDllLog("RGSC_JS_VIRTUAL_KEYBOARD_RESULT","jsonstring",t);var n=r.parseJSON(t||"null"),i=n.Result;f.setFocusedInput(i)}function a(e,t){if(globals.ime){var n=r.parseJSON(t||"null");if(l.isObject(n)){var i=r(document.activeElement);if(!i.attr("data-allow-ime-input")){var a=o.errorCode("5002.93"),s=c.getErrorWithCode(a);return void u.ShowErrorModal({errorCode:a,message:s})}d.notifyEvent(n,i)}}}var r=e("jquery"),o=e("utils"),s=e("common/baseUtils"),l=e("underscore"),c=e("setup.environment.utils"),u=e("common/modals/modal-views"),d=e("common/ime/ime-system"),f=e("common/virtualKeyboard"),h={};return s.pubsub.subscribe("SDK.RGSC_JS_SET_INPUT_METHOD",t),s.pubsub.subscribe("SDK.RGSC_JS_SHOW_VIRTUAL_KEYBOARD",n),s.pubsub.subscribe("SDK.RGSC_JS_VIRTUAL_KEYBOARD_RESULT",i),s.pubsub.subscribe("SDK.RGSC_JS_IME_EVENT",a),h}),define("common/sdk/v2_message",["require","jquery","utils","common/baseUtils","common/datafunctions","common/datafunctions.friends","common/profile/friends","common/settings/settings"],function(e){function t(e,t){if(r.WriteDllLog("RGSC_JS_RECEIVE_MESSAGE","messageText",t),!globals.receiveMsgEnabled)return void r.WriteDebugLog("RGSC_JS_RECEIVE_MESSAGE","ignored",t);var n=JSON.parse(t||"null"),i=n.Commands;"undefined"!=typeof i&&i.forEach(function(e){o.pubsub.publish("launcher.launcherCommand",{command:e.Command,parameter:e.Parameter})})}function n(e,t){r.WriteDllLog("RGSC_JS_PLAYER_MULTIPLAYER_PRESENCE_INFO_RESPONSE","jsonResponse",t);var n=JSON.parse(t||"null");n&&n.Success&&n.Players&&c.processMpPresenceInfo(n)}function i(e,t){if(r.WriteDllLog("RGSC_JS_PRESENCE_MESSAGE_RECEIVED","presenceJson",JSON.stringify(t)),t){var n=JSON.parse(t||"null"),i={Count:0,Notifications:[]};for(var c in n){var d=c.toUpperCase(),f=n[c];switch(d){case"ROS.FRIENDS.CHANGED":case"ROS.FRIENDS.INVITE.CANCELED":case"ROS.FRIENDS.INVITE.RECEIVED":l.ClearFriendsCache();break;case"ROS.CLAN.NOTIFY":var h,p=f.type.toUpperCase();h="JOINREQUEST"===p?f.clanid:f,s.ClearCrewCache(h),s.GetCrewById(h,function(e){var t=a(e),n="true"==t.find("Status").text();if(n){var i=t.find("CrewName").text();o.pubsub.publish("SDK.RGSC_JS_NOTIFICATION",JSON.stringify({Count:1,Notifications:[{Type:p,Data:[{cn:i}]}]}))}});break;case"ROS.CLAN.INVITE":s.ClearCrewCache(f.ci),o.pubsub.publish("SDK.RGSC_JS_NOTIFICATION",JSON.stringify({Count:1,Notifications:[{Type:d,Data:[{cn:f.cn}]}]}));break;case"ROS.CLAN.MEMBER.PROMOTED":var m=function(e){var t=a(e),n="true"==t.find("Status").text();if(n){s.ClearCrewCache(f.clanid);var i=t.find("CrewName").text();o.pubsub.publish("SDK.RGSC_JS_NOTIFICATION",JSON.stringify({Count:1,Notifications:[{Type:d,Data:[{cn:i}]}]}))}};s.GetCrewById(f.clanid,m);break;case"ROS.CLAN.MEMBER.DEMOTED":s.ClearCrewCache(f.clanid);break;case"ROS.CLAN.JOINED":a("#crewInvitesLink span.count").html("");case"ROS.CLAN.LEFT":case"ROS.CLAN.PRIMARY.CHANGED":s.ClearCrewCache(f);break;case"ROS.ACCOUNT.LINK":u.UpdateAccountLinking("scui"==f.r,f.n,f.s)}}i.Count>0&&o.pubsub.publish("SDK.RGSC_JS_NOTIFICATION",JSON.stringify(i))}}var a=e("jquery"),r=e("utils"),o=e("common/baseUtils"),s=e("common/datafunctions"),l=e("common/datafunctions.friends"),c=e("common/profile/friends"),u=e("common/settings/settings"),d={};return o.pubsub.subscribe("SDK.RGSC_JS_RECEIVE_MESSAGE",t),o.pubsub.subscribe("SDK.RGSC_JS_PLAYER_MULTIPLAYER_PRESENCE_INFO_RESPONSE",n),o.pubsub.subscribe("SDK.RGSC_JS_PRESENCE_MESSAGE_RECEIVED",i),d}),define("common/sdk/v2_nav",["require","jquery","utils","common/baseUtils","common/profile/profile-utils","setup.environment.utils","setup.environment","common/datafunctions.friends","common/profile/friends","common/profile/signin","common/settings/settings","common/store/store-views","common/sdk"],function(e){function t(e,t){var n=t.request,a=t.noResponse;u.WriteDllLog("RGSC_JS_REQUEST_UI_STATE","json",n),globals.waitingResponse=!0;var v=c.parseJSON(n||"null"),C="";void 0!=v.State&&(C=v.State.toUpperCase());var y="";if(void 0!=v.SubState&&(y=v.SubState.toUpperCase()),h.closeModalsAndHideMenu(),r(v.Visible)&&(void 0!=v.Online&&1==v.Online&&(v.Online=!0,u.WriteDebugLog("RGSC_JS_REQUEST_UI_STATE","jsonRequest.Online",v.Online)),h.clearSelectedTabsAndPages(),h.resetCommerceStyling(C,y),h.initStyling(v.Visible),!o(C,v.Visible))){if(h.pendingAccountCompletion()&&"ACTIVATION"!=C)return f.showDOBPrompt(),void S.CallGameMethod("RGSC_UI_STATE_RESPONSE",'{ "Visible":'+(v.Visible?"true":"false")+" }","RGSC_UI_STATE_RESPONSE_DEMO");u.WriteDebugLog("RGSC_JS_REQUEST_UI_STATE","stateValue",C);var w;switch(C){case"ACCOUNTLINKING":v.Visible?(h.initHeaderMenu(!0),h.setSelected(),c("#accountsLink").click()):h.clearActivePanel();break;case"ACHIEVEMENTS":v.Visible?(h.initHeaderMenu(!0),c("#awardsLink2").click()):h.clearActivePanel();break;case"ACTIVATION":v.Visible&&u.pubsub.trigger("gamefunctions:showActivation",v,C,y);break;case"COMMERCE":if(w=s(v,C,y),w===!1)return;break;case"GAMEINVITES":v.Visible?(h.initHeaderMenu(!0),c("#gameInvitesLink").click(),g.localize()):h.clearActivePanel();break;case"MESSAGES":v.Visible?(h.initHeaderMenu(!0),p.showMessagesPage(),g.localize()):h.clearActivePanel();break;case"FRIENDS":if(v.Visible){switch(h.initHeaderMenu(!0),y){case"REQUEST":p.showSocialSection("#friendInvitesLink");break;case"SENDINVITE":void 0!=v.Data&&void 0!=v.Data.RockstarId&&u.pubsub.trigger("datafnfriends:SendFriendRequest",v.Data.RockstarId),p.showSocialSection();break;case"FRIENDSEARCH":p.showSocialSection("#findPlayerLink");break;default:p.showSocialSection()}g.localize()}else h.clearActivePanel();break;case"STATS":v.Visible&&c("#statsLink2").click();break;case"SETTINGS":v.Visible&&b.loadSettings();break;case"EULA":v.Visible&&p.ShowEULA(v.Online);break;case"SIGNUP":v.Visible&&!d.isSignedIn()&&p.ShowSignup(v.Online);break;case"SIGNIN":if(w=l(v),w===!1)return;break;case"ERROR":switch(y){case"404":gameFn.RGSC_JS_NETWORK_CHANGE('{ "Online": false }');break;default:h.showMessagePanel(h.getError("ServerError"),"",h.getError("SorryTry"))}h.clearActivePanel(function(){h.setUpLoadingPanel("#confirmPanel")});break;case"MAIN":if(h.isSignedIn())v.Visible&&p.StartUp(!v.Online);else if(w=l(v),w===!1)return;break;case"PLAYERS":v.Visible&&(h.initHeaderMenu(!0),void 0!=v.Data&&void 0!=v.Data.RockstarId&&v.Data.RockstarId&&m.friendProfileViewByRockstarId(v.Data.RockstarId));break;case"LAUNCHER":break;case"CREWINVITES":v.Visible?(h.initHeaderMenu(!0),p.loadCrewInvites()):h.clearActivePanel();break;case"CREWREQUESTS":v.Visible?(h.initHeaderMenu(!0),p.loadCrewRequests()):h.clearActivePanel();break;default:if(w=i(v),w===!1)return}a||S.CallGameMethod("RGSC_UI_STATE_RESPONSE",'{ "Visible":'+(v.Visible?"true":"false")+" }","RGSC_UI_STATE_RESPONSE_DEMO")}}function n(e,t){u.WriteDllLog("RGSC_JS_UI_STATE_RESPONSE","jsonResponse",t);var n=c.parseJSON(t||"null");if(null!=n&&void 0!=n.Visible)if(globals.isScuiVisible=n.Visible,n.Visible){h.isHeaderRequired()?h.showHeaderMenu():h.hideHeaderMenu();var i=c("div.panel.active");i.length>=0&&!d.isPanelVisible(i)&&h.clearActivePanel(function(){h.setUpLoadingPanel(i)})}else h.hideUI();u.pubsub.trigger("RGSC_JS_UI_STATE_RESPONSE")}function i(e){if(u.WriteDebugLog("onNoState","jsonRequest.Visible",e.Visible),!e.Visible)return h.cancelAndCloseMsgPanel(e),!1;var t=c("div.panel.active");if(t.length<=0){var n=!e.Online;return p.StartUp(n),!0}return a(e),!0}function a(e){var t=!1;u.WriteDebugLog("onNetworkChangeRequest","default switch jsonRequest.Online",e.Online),e.Online?h.isLoadedInOfflineMode()?(gameFn.RGSC_JS_NETWORK_CHANGE('{ "Online": true }'),t=!0):(h.setOffline(!1),c("#confirmPanel").hide(),h.initHeaderMenu(!0)):h.isOnline()&&(h.isLoadedInOnlineMode()?(gameFn.RGSC_JS_NETWORK_CHANGE('{ "Online": false }'),t=!0):h.setOffline(!0)),t||h.reloadActiveStatsPage()}function r(e){if(void 0==globals.titleName||""==globals.titleName){h.initStyling(e);var t=u.errorCode("1000.34"),n=h.getErrorWithCode(t),i={errorCode:t,message:n.Message,supportText:n.SupportText,codeDesc:n.CodeDescription};return h.showFatalError(i),!1}return!0}function o(e,t){return globals.isLauncher&&"MAIN"==e?(u.WriteDebugLog("isLauncherStateRequestIgnored","skipped due to launcher mode"),globals.receiveMsgEnabled=!0,S.CallGameMethod("RGSC_UI_STATE_RESPONSE",'{ "Visible":'+(t?"true":"false")+" }","RGSC_UI_STATE_RESPONSE_DEMO"),!0):(globals.receiveMsgEnabled=!1,!1)}function s(e,t,n){if(!e.Visible)return!0;switch(n){case"REDEMPTIONCODE":case"SERIALKEYREDEMPTION":u.pubsub.trigger("gamefunctions:showActivation",e,t,n);break;default:var i=void 0!=e.Data&&void 0!=e.Data.Url?e.Data.Url:"";if(u.isStoreV2Enabled()){if(h.initHeaderMenu(!0),!e.Online||h.isOffline()||h.isLoadedInOfflineMode())return h.retryConnection(h.getText("OnlineRequired","Store")),setTimeout(function(){S.CallGameMethod("RGSC_UI_STATE_RESPONSE",'{ "Visible": true }',"RGSC_UI_STATE_RESPONSE_DEMO")},300),!1;C.clearAutoSearch(),"undefined"!=typeof e.Data&&("undefined"!=typeof e.Data.Category&&C.setAutoSearchCategory(decodeURI(e.Data.Category)),"undefined"!=typeof e.Data.Product&&C.setAutoSearchProduct(decodeURI(e.Data.Product))),C.showCommerceV2(i)}else C.showCommerce(i)}return!0}function l(e){return e.Visible?(u.WriteDebugLog("SIGNIN","signin json",JSON.stringify(e.Data)),v.showSignin(e.Online)):!0}var c=e("jquery"),u=e("utils"),d=e("common/baseUtils"),f=e("common/profile/profile-utils"),h=e("setup.environment.utils"),p=e("setup.environment"),m=e("common/datafunctions.friends"),g=e("common/profile/friends"),v=e("common/profile/signin"),b=e("common/settings/settings"),C=e("common/store/store-views"),S=e("common/sdk"),y={};return d.pubsub.subscribe("SDK.RGSC_JS_REQUEST_UI_STATE",t),d.pubsub.subscribe("SDK.RGSC_JS_UI_STATE_RESPONSE",n),y}),define("common/sdk/v2_profile",["require","utils","common/baseUtils","setup.environment.utils","common/profile/signin","common/settings/settings","common/localize","common/sdk"],function(e){function t(e,t){l.WriteDllLog("RGSC_JS_SIGN_IN","json",t),c.isSignedIn()||(t=JSON.parse(t||"null"),d.sdkAutoSignInRequest(t))}function n(e,t){l.WriteDllLog("RGSC_JS_FINISH_SIGN_IN","json",t),d.gameFinishedSignin(t),l.WriteDebugLog("RGSC_JS_FINISH_SIGN_IN","MethodCompleted","")}function i(e,t){l.WriteDllLog("RGSC_JS_SIGN_OUT");var n=JSON.parse(t||"null");if(n.DuplicateSignIn&&globals.account){var i={Count:1,Notifications:[{Type:"DUPLICATESIGNEDOUT",Count:1,Data:[{Id:"DuplicateSignedOut",Name:globals.account.Nickname,Description:h.getText("DuplicateSignedOut","Notifications").replace("[nickname]",globals.account.Nickname)}]}]};
c.pubsub.publish("SDK.RGSC_JS_NOTIFICATION",JSON.stringify(i))}l.WriteDebugLog("RGSC_JS_SIGN_OUT","finished",""),d.signOut()}function a(e,t){l.WriteDllLog("RGSC_JS_FINISH_MODIFY_PROFILE","json",t),f.modifyProfileComplete()}function r(e,t){if(l.WriteDllLog("RGSC_JS_REFRESH_STEAM_TICKET_RESULT","jsonstring",t),u.isSignedIn())return void l.WriteDebugLog("RGSC_JS_REFRESH_STEAM_TICKET_RESULT","aborted","user is signed in already");var n=JSON.parse(t||"null");"undefined"!=typeof n&&"undefined"!=typeof n.Ticket&&n.Ticket.length&&(globals.steamAuthTicket=n.Ticket,d.signInOnline())}function o(e,t){var n=JSON.parse(t||"null");null===n&&l.WriteDebugLog("handleGetAvatarUrl","aborted","missing required parameter data");var i=l.getAvatarUrlFromNickname(n.Nickname,n.Size);p.CallGameMethod("RGSC_GET_AVATAR_URL_RESPONSE",{AvatarUrl:i,RequestId:n.RequestId||0})}function s(e,t){var n=JSON.parse(t||"null"),i=n?n.RequestId||0:0,a="https://socialclub.rockstargames.com/xml/avatar.xml";p.CallGameMethod("RGSC_GET_AVATAR_LAYOUT_URL_RESPONSE",{AvatarLayoutUrl:a,RequestId:i})}var l=e("utils"),c=e("common/baseUtils"),u=e("setup.environment.utils"),d=e("common/profile/signin"),f=e("common/settings/settings"),h=e("common/localize"),p=e("common/sdk"),m={};return c.pubsub.subscribe("SDK.RGSC_JS_SIGN_IN",t),c.pubsub.subscribe("SDK.RGSC_JS_FINISH_SIGN_IN",n),c.pubsub.subscribe("SDK.RGSC_JS_SIGN_OUT",i),c.pubsub.subscribe("SDK.RGSC_JS_FINISH_MODIFY_PROFILE",a),c.pubsub.subscribe("SDK.RGSC_JS_REFRESH_STEAM_TICKET_RESULT",r),c.pubsub.subscribe("SDK.RGSC_JS_GET_AVATAR_URL",o),c.pubsub.subscribe("SDK.RGSC_JS_GET_AVATAR_LAYOUT_URL",s),m}),function(e,t,n){t[e]=t[e]||n(),"undefined"!=typeof module&&module.exports?module.exports=t[e]:"function"==typeof define&&define.amd&&define("common/npo",[],function(){return t[e]})}("Promise","undefined"!=typeof global?global:this,function(){function e(e,t){f.add(e,t),d||(d=p(f.drain))}function t(e){var t,n=typeof e;return null==e||"object"!=n&&"function"!=n||(t=e.then),"function"==typeof t?t:!1}function n(){for(var e=0;e<this.chain.length;e++)i(this,1===this.state?this.chain[e].success:this.chain[e].failure,this.chain[e]);this.chain.length=0}function i(e,n,i){var a,r;try{n===!1?i.reject(e.msg):(a=n===!0?e.msg:n.call(void 0,e.msg),a===i.promise?i.reject(TypeError("Promise-chain cycle")):(r=t(a))?r.call(a,i.resolve,i.reject):i.resolve(a))}catch(o){i.reject(o)}}function a(i){var o,l=this;if(!l.triggered){l.triggered=!0,l.def&&(l=l.def);try{(o=t(i))?e(function(){var e=new s(l);try{o.call(i,function(){a.apply(e,arguments)},function(){r.apply(e,arguments)})}catch(t){r.call(e,t)}}):(l.msg=i,l.state=1,l.chain.length>0&&e(n,l))}catch(c){r.call(new s(l),c)}}}function r(t){var i=this;i.triggered||(i.triggered=!0,i.def&&(i=i.def),i.msg=t,i.state=2,i.chain.length>0&&e(n,i))}function o(e,t,n,i){for(var a=0;a<t.length;a++)!function(a){e.resolve(t[a]).then(function(e){n(a,e)},i)}(a)}function s(e){this.def=e,this.triggered=!1}function l(e){this.promise=e,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function c(t){if("function"!=typeof t)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var i=new l(this);this.then=function(t,a){var r={success:"function"==typeof t?t:!0,failure:"function"==typeof a?a:!1};return r.promise=new this.constructor(function(e,t){if("function"!=typeof e||"function"!=typeof t)throw TypeError("Not a function");r.resolve=e,r.reject=t}),i.chain.push(r),0!==i.state&&e(n,i),r.promise},this["catch"]=function(e){return this.then(void 0,e)};try{t.call(void 0,function(e){a.call(i,e)},function(e){r.call(i,e)})}catch(o){r.call(i,o)}}var u,d,f,h=Object.prototype.toString,p="undefined"!=typeof setImmediate?function(e){return setImmediate(e)}:setTimeout;try{Object.defineProperty({},"x",{}),u=function(e,t,n,i){return Object.defineProperty(e,t,{value:n,writable:!0,configurable:i!==!1})}}catch(m){u=function(e,t,n){return e[t]=n,e}}f=function(){function e(e,t){this.fn=e,this.self=t,this.next=void 0}var t,n,i;return{add:function(a,r){i=new e(a,r),n?n.next=i:t=i,n=i,i=void 0},drain:function(){var e=t;for(t=n=d=void 0;e;)e.fn.call(e.self),e=e.next}}}();var g=u({},"constructor",c,!1);return c.prototype=g,u(g,"__NPO__",0,!1),u(c,"resolve",function(e){var t=this;return e&&"object"==typeof e&&1===e.__NPO__?e:new t(function(t,n){if("function"!=typeof t||"function"!=typeof n)throw TypeError("Not a function");t(e)})}),u(c,"reject",function(e){return new this(function(t,n){if("function"!=typeof t||"function"!=typeof n)throw TypeError("Not a function");n(e)})}),u(c,"all",function(e){var t=this;return"[object Array]"!=h.call(e)?t.reject(TypeError("Not an array")):0===e.length?t.resolve([]):new t(function(n,i){if("function"!=typeof n||"function"!=typeof i)throw TypeError("Not a function");var a=e.length,r=Array(a),s=0;o(t,e,function(e,t){r[e]=t,++s===a&&n(r)},i)})}),u(c,"race",function(e){var t=this;return"[object Array]"!=h.call(e)?t.reject(TypeError("Not an array")):new t(function(n,i){if("function"!=typeof n||"function"!=typeof i)throw TypeError("Not a function");o(t,e,function(e,t){n(t)},i)})}),c}),define("common/common",["jquery","moment","common/formvalidation","common/gamefunctions","common/gamefunctions.friends","common/games/gamecommon","common/datafunctions","common/datafunctions.friends","common/captcha","common/jquery.mousewheel","jquery-ui","jquery.localize","common/antiscroll","setup.environment","setup.environment.utils","common/sdk/v2_activation","common/sdk/v2_commerce","common/sdk/v2_friends","common/sdk/v2_init","common/sdk/v2_input","common/sdk/v2_message","common/sdk/v2_nav","common/sdk/v2_notifications","common/sdk/v2_profile","common/npo"],function(){}),define("desktop/common",function(){});